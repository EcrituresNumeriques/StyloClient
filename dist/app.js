!function t(e,i,s){function n(o,a){if(!i[o]){if(!e[o]){var l="function"==typeof require&&require;if(!a&&l)return l(o,!0);if(r)return r(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};e[o][0].call(c.exports,function(t){var i=e[o][1][t];return n(i?i:t)},c,c.exports,t,e,i,s)}return i[o].exports}for(var r="function"==typeof require&&require,o=0;o<s.length;o++)n(s[o]);return n}({1:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.handleActions({toggleBibItem:this.toggleBibItem})}var n=t("lodash/object/extend"),r=t("substance/util/jquery"),o=t("substance/ui/TwoPanelController"),a=t("./packages/bibliography/CrossrefSearch"),l=t("substance/ui/i18n");l.instance.load(t("./i18n/en")),s.Prototype=function(){var t=Object.getPrototypeOf(this);this.getContentPanel=function(){return this.refs.contentPanel},this.toggleBibItem=function(t){this.state.bibItemId===t.id?this.setState({contextId:"bib-items"}):this.setState({contextId:"bib-items",bibItemId:t.id})},this.getChildContext=function(){var e=t.getChildContext.call(this);return n(e,{bibSearchEngines:[new a],embedResolver:function(t,e){r.get("http://iframe.ly/api/iframely?url="+encodeURIComponent(t)+"&api_key=712fe98e864c79e054e2da").success(function(t){e(null,t.html)}).error(function(t){e(t)})}})},this.handleStateUpdate=function(t){function e(t){if(t.citationId){var e=s.get(t.citationId);if(e&&["image-figure","table-figure"].indexOf(e.getItemType())>=0)return[t.citationId].concat(e.targets)}return[]}function i(t){if(t.bibItemId){var e=Object.keys(s.citationsIndex.get(t.bibItemId));return e}if(t.citationId){var i=s.get(t.citationId);if(i&&"bib-item"===i.getItemType())return[t.citationId].concat(i.targets)}return[]}var s=this.getDocument(),n=i(t),r=e(t);setTimeout(function(){this.contentHighlights.set({"bib-item":n,figure:r})}.bind(this),0)}},o.extend(s),e.exports=s},{"./i18n/en":6,"./packages/bibliography/CrossrefSearch":506,"lodash/object/extend":74,"substance/ui/TwoPanelController":471,"substance/ui/i18n":476,"substance/util/jquery":484}],2:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.connect(this,{"citation:selected":this.onCitationSelected})}var n=t("./LensController"),r=t("./packages/bibliography/BibliographyComponent"),o=t("substance/ui/ContainerAnnotator"),a=(t("substance/ui/SplitPane"),t("substance/ui/ScrollPane")),l=t("./packages/reader/Cover"),u=t("substance/ui/Component"),c=u.$$,h={controller:{commands:[t("substance/ui/UndoCommand"),t("substance/ui/RedoCommand"),t("substance/ui/SaveCommand")],components:{paragraph:t("substance/packages/paragraph/ParagraphComponent"),heading:t("substance/packages/heading/HeadingComponent"),blockquote:t("substance/packages/blockquote/BlockquoteComponent"),codeblock:t("substance/packages/codeblock/CodeblockComponent"),embed:t("substance/packages/embed/EmbedComponent"),image:t("substance/packages/image/ImageComponent"),"image-figure":t("substance/packages/figure/FigureComponent"),"bib-item-citation":t("./packages/citations/CitationComponent"),"image-figure-citation":t("./packages/citations/CitationComponent"),toc:t("substance/ui/TOCPanel"),cite:t("./packages/citations/CitePanel"),"bib-items":t("./packages/bibliography/BibItemsPanel"),"cite-bib-item":t("./packages/citations/CitePanel"),"cite-image-figure":t("./packages/citations/CitePanel"),"bib-item-entry":t("./packages/bibliography/BibItemEntry"),"image-figure-entry":t("./packages/figures/ImageFigureEntry")}},main:{commands:[]},cover:{commands:[]},panels:{toc:{},"bib-items":{}},tabOrder:["toc","bib-items"],containerId:"main",isEditable:!1};s.Prototype=function(){var t=Object.getPrototypeOf(this);this.dispose=function(){n.prototype.dispose.call(this),this.disconnect(this)},this.render=function(){return t.render.call(this).addClass("sc-lens sc-lens-reader sc-controller")},this._renderMainSection=function(){var t=this.getConfig();return c("div").ref("main").addClass("se-main-section").append(c(a,{scrollbarType:"substance",scrollbarPosition:"left",toc:this.toc,highlights:this.contentHighlights}).ref("contentPanel").append(c(l,{name:"cover",commands:t.cover.commands}).ref("coverView"),c("div").ref("main").addClass("document-content").append(c(o,{name:"main",editable:!1,containerId:t.containerId,commands:t.main.commands}).ref("mainEditor")),c(r).ref("bib")))},this.onCitationSelected=function(t){return this.state.citationId===t.id?void this.setState({contextId:"toc"}):void("bib-item-citation"===t.type?this.setState({contextId:"bib-items",citationId:t.id}):this.setState({contextId:"toc",citationId:t.id}))}},n.extend(s),s["static"].config=h,e.exports=s},{"./LensController":1,"./packages/bibliography/BibItemEntry":498,"./packages/bibliography/BibItemsPanel":500,"./packages/bibliography/BibliographyComponent":502,"./packages/citations/CitationComponent":513,"./packages/citations/CitePanel":515,"./packages/figures/ImageFigureEntry":521,"./packages/reader/Cover":526,"substance/packages/blockquote/BlockquoteComponent":366,"substance/packages/codeblock/CodeblockComponent":373,"substance/packages/embed/EmbedComponent":377,"substance/packages/figure/FigureComponent":384,"substance/packages/heading/HeadingComponent":389,"substance/packages/image/ImageComponent":392,"substance/packages/paragraph/ParagraphComponent":403,"substance/ui/Component":437,"substance/ui/ContainerAnnotator":438,"substance/ui/RedoCommand":451,"substance/ui/SaveCommand":454,"substance/ui/ScrollPane":456,"substance/ui/SplitPane":458,"substance/ui/TOCPanel":464,"substance/ui/UndoCommand":472}],3:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./LensController"),r=t("substance/ui/SplitPane"),o=t("substance/ui/ScrollPane"),a=t("./packages/bibliography/BibliographyComponent"),l=t("./packages/writer/CoverEditor"),u=t("substance/ui/Toolbar"),c=t("./packages/writer/WriterTools"),h=t("substance/ui/ContainerEditor"),p=t("substance/model/documentHelpers"),d=t("substance/ui/Component"),f=d.$$,m={controller:{commands:[t("substance/ui/UndoCommand"),t("substance/ui/RedoCommand"),t("substance/ui/SaveCommand")],components:{paragraph:t("substance/packages/paragraph/ParagraphComponent"),heading:t("substance/packages/heading/HeadingComponent"),blockquote:t("substance/packages/blockquote/BlockquoteComponent"),codeblock:t("substance/packages/codeblock/CodeblockComponent"),embed:t("substance/packages/embed/EmbedComponent"),image:t("substance/packages/image/ImageComponent"),"image-figure":t("substance/packages/figure/FigureComponent"),"bib-item-citation":t("./packages/citations/CitationComponent"),"image-figure-citation":t("./packages/citations/CitationComponent"),toc:t("substance/ui/TOCPanel"),cite:t("./packages/citations/CitePanel"),"bib-items":t("./packages/bibliography/BibItemsPanel"),"add-bib-items":t("./packages/bibliography/AddBibItemsPanel"),"cite-bib-item":t("./packages/citations/CitePanel"),"cite-image-figure":t("./packages/citations/CitePanel"),"bib-item-entry":t("./packages/bibliography/BibItemEntry"),"image-figure-entry":t("./packages/figures/ImageFigureEntry")}},main:{commands:[t("substance/packages/embed/EmbedCommand"),t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/strong/StrongCommand"),t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/link/LinkCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand"),t("substance/packages/code/CodeCommand"),t("substance/packages/figure/InsertFigureCommand"),t("./packages/bibliography/BibItemCitationCommand"),t("./packages/figures/ImageFigureCitationCommand")],textTypes:[{name:"paragraph",data:{type:"paragraph"}},{name:"heading1",data:{type:"heading",level:1}},{name:"heading2",data:{type:"heading",level:2}},{name:"heading3",data:{type:"heading",level:3}},{name:"codeblock",data:{type:"codeblock"}},{name:"blockquote",data:{type:"blockquote"}}]},title:{commands:[t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand")]},"abstract":{commands:[t("substance/packages/text/SwitchTextTypeCommand"),t("substance/packages/emphasis/EmphasisCommand"),t("substance/packages/strong/StrongCommand"),t("substance/packages/subscript/SubscriptCommand"),t("substance/packages/superscript/SuperscriptCommand"),t("substance/packages/link/LinkCommand")]},panels:{toc:{},"bib-items":{},"cite-bib-item":{isDialog:!0},"cite-image-figure":{idDialog:!0},"add-bib-items":{isDialog:!0}},tabOrder:["toc","bib-items"],containerId:"main",isEditable:!0};s.Prototype=function(){var t=Object.getPrototypeOf(this);this.render=function(){return t.render.call(this).addClass("sc-lens sc-lens-writer")},this._renderMainSection=function(){var t=this.getConfig();return f("div").ref("main").addClass("se-main-section").append(f(r,{splitType:"horizontal"}).append(f(u).ref("toolbar").append(f(c)),f(o,{scrollbarType:"substance",scrollbarPosition:"left",toc:this.toc,highlights:this.contentHighlights}).ref("contentPanel").append(f(l).ref("coverEditor"),f("div").ref("main").addClass("document-content").append(f(h,{name:"main",containerId:t.containerId,commands:t.main.commands,textTypes:t.main.textTypes}).ref("mainEditor")),f(a).ref("bib"))).ref("mainSectionSplitPane"))},this.onSelectionChanged=function(t,e){function i(e){return p.getAnnotationsForSelection(s,t,e,"main")[0]}var s;if("main"===e.name&&!t.isNull()&&t.isPropertySelection()&&!t.equals(this.prevSelection)){this.prevSelection=t,s=e.getDocument();var n=i("citation");if(n&&n.getSelection().equals(t)){var r=n.type.replace("-citation","").replace("_","-");this.setState({contextId:"cite-"+r,citationType:r,citationId:n.id})}else"toc"!==this.state.contextId&&this.setState({contextId:"toc"})}}},n.extend(s),s["static"].config=m,e.exports=s},{"./LensController":1,"./packages/bibliography/AddBibItemsPanel":491,"./packages/bibliography/BibItemCitationCommand":494,"./packages/bibliography/BibItemEntry":498,"./packages/bibliography/BibItemsPanel":500,"./packages/bibliography/BibliographyComponent":502,"./packages/citations/CitationComponent":513,"./packages/citations/CitePanel":515,"./packages/figures/ImageFigureCitationCommand":518,"./packages/figures/ImageFigureEntry":521,"./packages/writer/CoverEditor":527,"./packages/writer/WriterTools":528,"substance/model/documentHelpers":131,"substance/packages/blockquote/BlockquoteComponent":366,"substance/packages/code/CodeCommand":369,"substance/packages/codeblock/CodeblockComponent":373,"substance/packages/embed/EmbedCommand":376,"substance/packages/embed/EmbedComponent":377,"substance/packages/emphasis/EmphasisCommand":380,"substance/packages/figure/FigureComponent":384,"substance/packages/figure/InsertFigureCommand":386,"substance/packages/heading/HeadingComponent":389,"substance/packages/image/ImageComponent":392,"substance/packages/link/LinkCommand":395,"substance/packages/paragraph/ParagraphComponent":403,"substance/packages/strong/StrongCommand":406,"substance/packages/subscript/SubscriptCommand":410,"substance/packages/superscript/SuperscriptCommand":414,"substance/packages/text/SwitchTextTypeCommand":427,"substance/ui/Component":437,"substance/ui/ContainerEditor":439,"substance/ui/RedoCommand":451,"substance/ui/SaveCommand":454,"substance/ui/ScrollPane":456,"substance/ui/SplitPane":458,"substance/ui/TOCPanel":464,"substance/ui/Toolbar":470,"substance/ui/UndoCommand":472}],4:[function(t,e,i){"use strict";function s(){n.apply(this,arguments),this.backend=new o}var n=t("substance/ui/Component"),r=n.$$,o=t("./backend"),a=t("substance/model/DocumentSession"),l=window.$=t("substance/util/jquery"),u=t("../LensWriter"),c=t("../LensReader"),h=t("substance/ui/Router");s.Prototype=function(){this.getInitialContext=function(){return{router:new h(this)}},this.getInitialState=function(){return{mode:"write"}},this.openReader=function(){this.extendState({mode:"read"})},this.openWriter=function(){this.extendState({mode:"write"})},this.render=function(){var t=r("div").addClass("app");if(t.append(r("div").addClass("menu").append(r("button").addClass("write"===this.state.mode?"active":"").on("click",this.openWriter).append("Write"),r("button").addClass("read"===this.state.mode?"active":"").on("click",this.openReader).append("Read"))),this.documentSession){var e;e="write"===this.state.mode?r(u,{documentSession:this.documentSession,onUploadFile:function(t,e){console.log("custom file upload handler in action...");var i=window.URL.createObjectURL(t);e(null,i)},onSave:function(t,e,i){console.log("custom save handler in action..."),i(null)}}).ref("writer").route():r(c,{documentSession:this.documentSession}).ref("reader").route(),t.append(r("div").addClass("context").append(e))}return t},this.didMount=function(){this.backend.getDocument("sample",function(t,e){this.documentSession=new a(e),window.documentSession=this.documentSession,this.rerender()}.bind(this))}},n.extend(s),l(function(){window.app=n.mount(s,l("#container"))})},{"../LensReader":2,"../LensWriter":3,"./backend":5,"substance/model/DocumentSession":100,"substance/ui/Component":437,"substance/ui/Router":453,"substance/util/jquery":484}],5:[function(t,e,i){var s=t("substance/util/oo"),n=t("substance/util/jquery"),r=t("../model/LensArticleImporter"),o=new r,a=function(){};a.Prototype=function(){this._request=function(t,e,i,s){var r={type:t,url:e,contentType:"application/json; charset=UTF-8",dataType:"text",success:function(t){s(null,t)},error:function(t){console.error(t),s(t.responseText)}};i&&(r.data=JSON.stringify(i)),n.ajax(r)},this.getDocument=function(t,e){this._request("GET","data/example-doc.xml",null,function(t,i){t&&(console.error(t),e(t));var s=o.importDocument(i);window.doc=s,s.updateCollections(),e(null,s)})},this.saveDocument=function(t,e){e("Not supported in dev version")},this.uploadFigure=function(t,e){var i=window.URL.createObjectURL(t);e(null,i)}},s.initClass(a),e.exports=a},{"../model/LensArticleImporter":9,"substance/util/jquery":484,"substance/util/oo":486}],6:[function(t,e,i){e.exports={enter_search_term:"Enter search term",choose_referenced_items:"Choose referenced items",no_items_found:"No items found.",add_references:"Add references",figure:"Figure",insert:"Insert",cite:"Cite",focus:"Focus",bib_item:"Reference",manage:"Manage",add_reference:"Add References","bib-items":"References","embed-src":"Embed URL",paragraph:"Paragraph",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",codeblock:"Codeblock",blockquote:"Blockquote","article-meta.title":"Title","article-meta.abstract":"Abstract","image-figure.title":"Figure Title","image-figure.caption":"Figure Caption","container-selection":"Multiple Elements","add-bib-entries":"Add new references",bibItemCitation:"Bibliographic Citation",imageFigureCitation:"Figure Citation"}},{}],7:[function(t,e,i){function s(t,e,i,s){this.doc=t,this.containerId=e,this.itemType=i,this.labelPrefix=s,this.doc.connect(this,{"document:changed":this.onDocumentChanged})}var n=t("substance/util/helpers"),r=t("substance/util/pluck"),o=t("substance/util/oo");s.Prototype=function(){this.dispose=function(){this.doc.disconnect(this)},this.getDocument=function(){return this.doc},this.determineItems=function(){var t=this.doc,e=t.get(this.containerId),i=t.getIndex("type").get(this.itemType),s=[];n.each(i,function(t){var i,n=e.getPosition(t.id);n>=0?i=!0:(i=!1,n=Number.MAX_VALUE),s.push({pos:n,item:t,isShown:i})}),s=n.sortBy(s,"pos");var r=0;return n.each(s,function(t){t.isShown?t.index=r++:t.index=-1}),s},this.createItemLabel=function(t){return t.index<0?this.labelPrefix+" ?":[this.labelPrefix,t.index+1].join(" ")},this.createCitationLabel=function(t){var e,i=t.citation,s=i.targets,r=[],o=this.doc;n.each(s,function(t){var i=o.get(t),s=this.items.indexOf(i);if(0>s)return console.error("citation target not found: ",t),void(e=t);var n=this._items[s];if(n.index<0)return console.error("citation target does not have a label: ",t),void(e=t);var a=n.index+1;r.push(a)}.bind(this)),r.sort();var a;return a=0===r.length?this.labelPrefix+" ???":[this.labelPrefix,r.join(", ")].join(" ")},this.updateItemLabels=function(){n.each(this._items,function(t){var e=this.createItemLabel(t);t.item.setLabel(e)}.bind(this))},this.updateCitationLabels=function(){n.each(this._citations,function(t){var e=this.createCitationLabel(t);t.citation.setLabel(e)}.bind(this))},this.determineCitations=function(){var t=this.doc,e=t.getIndex("type").get(this.itemType+"-citation"),i=t.get(this.containerId),s=n.map(e,function(t){var e=i.getAddress(t.path);return{citation:t,address:e}});return s.sort(function(t,e){return e>t?-1:t>e?1:t.citation.startOffset-e.citation.startOffset}),s},this.update=function(){this._items=this.determineItems(),this.items=r(this._items,"item"),this._citations=this.determineCitations(),this.citations=r(this._citations,"citation"),this.updateItemLabels(),this.updateCitationLabels()},this.getItems=function(){return this.items},this.onDocumentChanged=function(t){var e,i,s=this.doc,r=!1;n.each(t.ops,function(t){if(t.isCreate()||t.isSet()||t.isUpdate()){var n=t.path[0];if(e=s.get(n),!e)return;t.isCreate()?("image-figure-citation"===e.type||"table-figure-citation"===e.type)&&(r=!0):("image-figure-citation"===e.type||"table-figure-citation"===e.type)&&"targets"===t.path[1]&&(r=!0)}else t.isDelete()&&(i=t.val,("image-figure-citation"===i.type||"table-figure-citation"===i.type)&&(r=!0));if(!r&&t.path[0]===this.containerId&&("set"===t.type&&(r=!0),"update"===t.type)){var o=t.diff.val;if(e=s.get(o),!e)return;e.type===this.itemType&&(r=!0)}t.isDelete()&&(i=t.val,i.type===this.itemType&&(r=!0))}.bind(this)),r&&this.update()}},o.initClass(s),e.exports=s},{"substance/util/helpers":482,"substance/util/oo":486,"substance/util/pluck":488}],8:[function(t,e,i){var s=t("./articleSchema"),n=t("substance/util/helpers"),r=t("substance/model/Document"),o=t("substance/model/DocumentIndex"),a=t("../packages/bibliography/CiteprocCompiler"),l=t("../packages/bibliography/Bibliography"),u=t("./Collection"),c=t("lodash/array/without"),h=function(){h["super"].call(this,s),this.create({type:"container",id:"main",nodes:[]}),this.citeprocCompiler=new a,this.collections={"bib-item":new l(this,"main"),"image-figure":new u(this,"main","image-figure","Figure"),"table-figure":new u(this,"main","table-figure","Table")},this.includesIndex=this.addIndex("includes",o.create({type:"include",property:"nodeId"})),this.citationsIndex=this.addIndex("citations",o.create({type:"citation",property:"targets"})),this.connect(this,{"document:changed":this.onDocumentChanged})};h.Prototype=function(){this.onDocumentChanged=function(t){n.each(t.ops,function(t){if(t.isDelete()){var e=t.val;if("image-figure"===e.type||"table-figure"===e.type||"bib-item"===e.type){var i=this.getIndex("citations").get(e.id);n.each(i,function(t){t.targets=c(t.targets,e.id)})}}}.bind(this))},this.updateCollections=function(){n.each(this.collections,function(t){t.update()})},this.getDocumentMeta=function(){return this.get("article-meta")},this.getCiteprocCompiler=function(){return this.citeprocCompiler},this.getBibliography=function(){return this.collections["bib-item"]},this.getFiguresCollection=function(){return this.collections["image-figure"]},this.getTablesCollection=function(){return this.collections["table-figure"]},this.getCollection=function(t){return this.collections[t]},this.getTitle=function(){return this.get("article-meta").title},this.deleteFigure=function(t){this.transaction(function(e,i){var s=n.map(this.citationsIndex.get(t));n.each(s,function(t){e["delete"](t.id)});var r=n.map(e.getIndex("includes").get(t));return n.each(r,function(t){e.get("main").hide(t.id),e["delete"](t.id)}),e["delete"](t),i})},this.deleteBibItem=function(t){this.transaction(function(e,i){var s=n.map(e.getIndex("citations").get(t));return n.each(s,function(t){e["delete"](t.id)}),e["delete"](t),i})}},r.extend(h),h.XML_TEMPLATE=['<article xmlns="http://substance.io/science-article/0.1.0" lang="en">',"<metadata>","<title>Enter title</title>","<abstract>Enter abstract</abstract>","</metadata>","<resources></resources>","<body>",'<p id="p1">Enter your article here.</p>',"</body>","</article>"].join(""),e.exports=h},{"../packages/bibliography/Bibliography":501,"../packages/bibliography/CiteprocCompiler":504,"./Collection":7,"./articleSchema":10,"lodash/array/without":15,"substance/model/Document":93,"substance/model/DocumentIndex":96,"substance/util/helpers":482}],9:[function(t,e,i){"use strict";function s(){n.call(this,{schema:r,converters:a,DocumentClass:o})}var n=t("substance/model/XMLImporter"),r=t("./articleSchema"),o=t("./LensArticle"),a=[t("substance/packages/paragraph/ParagraphHTMLConverter"),t("substance/packages/blockquote/BlockquoteHTMLConverter"),t("substance/packages/codeblock/CodeblockHTMLConverter"),t("substance/packages/heading/HeadingHTMLConverter"),t("substance/packages/image/ImageXMLConverter"),t("substance/packages/strong/StrongHTMLConverter"),t("substance/packages/emphasis/EmphasisHTMLConverter"),t("substance/packages/link/LinkHTMLConverter"),t("../packages/metadata/MetadataXMLConverter"),t("../packages/bibliography/BibItemXMLConverter"),t("../packages/figures/ImageFigureXMLConverter"),t("../packages/figures/ImageFigureCitationXMLConverter"),t("../packages/bibliography/BibItemCitationXMLConverter")];s.Prototype=function(){this.convertDocument=function(t){var e=t.find("meta");this.convertElement(e);var i=t.find("resources");i.children.forEach(function(t){this.convertElement(t)}.bind(this));var s=t.find("body").children;this.convertContainer(s,"main")}},s.converters=a,n.extend(s),e.exports=s},{"../packages/bibliography/BibItemCitationXMLConverter":496,"../packages/bibliography/BibItemXMLConverter":499,"../packages/figures/ImageFigureCitationXMLConverter":520,"../packages/figures/ImageFigureXMLConverter":522,"../packages/metadata/MetadataXMLConverter":525,"./LensArticle":8,"./articleSchema":10,"substance/model/XMLImporter":116,"substance/packages/blockquote/BlockquoteHTMLConverter":367,"substance/packages/codeblock/CodeblockHTMLConverter":374,"substance/packages/emphasis/EmphasisHTMLConverter":381,"substance/packages/heading/HeadingHTMLConverter":390,"substance/packages/image/ImageXMLConverter":393,"substance/packages/link/LinkHTMLConverter":396,"substance/packages/paragraph/ParagraphHTMLConverter":404,"substance/packages/strong/StrongHTMLConverter":407}],10:[function(t,e,i){var s=t("substance/model/DocumentSchema"),n=t("substance/packages/paragraph/Paragraph"),r=t("substance/packages/heading/Heading"),o=t("substance/packages/codeblock/Codeblock"),a=t("substance/packages/blockquote/Blockquote"),l=t("substance/packages/embed/Embed"),u=t("substance/packages/image/Image"),c=t("substance/packages/list/List"),h=t("substance/packages/list/ListItem"),p=t("substance/packages/table/Table"),d=t("substance/packages/table/TableSection"),f=t("substance/packages/table/TableRow"),m=t("substance/packages/table/TableCell"),g=t("substance/packages/emphasis/Emphasis"),b=t("substance/packages/strong/Strong"),v=t("substance/packages/subscript/Subscript"),y=t("substance/packages/superscript/Superscript"),_=t("substance/packages/code/Code"),x=t("substance/packages/link/Link"),C=t("substance/packages/figure/Figure"),w=t("../packages/figures/ImageFigure"),S=t("../packages/figures/ImageFigureCitation"),T=t("../packages/bibliography/BibItem"),E=t("../packages/bibliography/BibItemCitation"),I=t("../packages/metadata/Author"),O=t("../packages/metadata/ArticleMeta"),A=new s("lens-article","3.0.0");A.getDefaultTextType=function(){return"paragraph"},A.addNodes([O,n,r,o,a,l,_,g,b,v,y,x,u,I,C,w,p,d,f,m,S,E,c,h,T]),e.exports=A},{"../packages/bibliography/BibItem":492,"../packages/bibliography/BibItemCitation":493,"../packages/figures/ImageFigure":516,"../packages/figures/ImageFigureCitation":517,"../packages/metadata/ArticleMeta":523,"../packages/metadata/Author":524,"substance/model/DocumentSchema":99,"substance/packages/blockquote/Blockquote":365,"substance/packages/code/Code":368,"substance/packages/codeblock/Codeblock":372,"substance/packages/embed/Embed":375,"substance/packages/emphasis/Emphasis":379,"substance/packages/figure/Figure":383,"substance/packages/heading/Heading":388,"substance/packages/image/Image":391,"substance/packages/link/Link":394,"substance/packages/list/List":398,"substance/packages/list/ListItem":400,"substance/packages/paragraph/Paragraph":402,"substance/packages/strong/Strong":405,"substance/packages/subscript/Subscript":409,"substance/packages/superscript/Superscript":413,"substance/packages/table/Table":417,"substance/packages/table/TableCell":418,"substance/packages/table/TableRow":423,"substance/packages/table/TableSection":425}],11:[function(t,e,i){},{}],12:[function(t,e,i){!function(t,i){"object"==typeof e&&"object"==typeof e.exports?e.exports=t.document?i(t,!0):function(t){if(!t.document)throw new Error("jQuery requires a window with a document");return i(t)}:i(t)}("undefined"!=typeof window?window:this,function(t,e){function i(t){var e="length"in t&&t.length,i=Z.type(t);return"function"===i||Z.isWindow(t)?!1:1===t.nodeType&&e?!0:"array"===i||0===e||"number"==typeof e&&e>0&&e-1 in t}function s(t,e,i){if(Z.isFunction(e))return Z.grep(t,function(t,s){return!!e.call(t,s,t)!==i});if(e.nodeType)return Z.grep(t,function(t){return t===e!==i});if("string"==typeof e){if(at.test(e))return Z.filter(e,t,i);e=Z.filter(e,t)}return Z.grep(t,function(t){return G.call(e,t)>=0!==i})}function n(t,e){for(;(t=t[e])&&1!==t.nodeType;);return t}function r(t){var e=ft[t]={};return Z.each(t.match(dt)||[],function(t,i){e[i]=!0}),e}function o(){Q.removeEventListener("DOMContentLoaded",o,!1),t.removeEventListener("load",o,!1),Z.ready()}function a(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=Z.expando+a.uid++}function l(t,e,i){var s;if(void 0===i&&1===t.nodeType)if(s="data-"+e.replace(_t,"-$1").toLowerCase(),i=t.getAttribute(s),"string"==typeof i){try{i="true"===i?!0:"false"===i?!1:"null"===i?null:+i+""===i?+i:yt.test(i)?Z.parseJSON(i):i}catch(n){}vt.set(t,e,i)}else i=void 0;return i}function u(){return!0}function c(){return!1}function h(){try{return Q.activeElement}catch(t){}}function p(t,e){return Z.nodeName(t,"table")&&Z.nodeName(11!==e.nodeType?e:e.firstChild,"tr")?t.getElementsByTagName("tbody")[0]||t.appendChild(t.ownerDocument.createElement("tbody")):t}function d(t){return t.type=(null!==t.getAttribute("type"))+"/"+t.type,t}function f(t){var e=jt.exec(t.type);return e?t.type=e[1]:t.removeAttribute("type"),t}function m(t,e){for(var i=0,s=t.length;s>i;i++)bt.set(t[i],"globalEval",!e||bt.get(e[i],"globalEval"))}function g(t,e){var i,s,n,r,o,a,l,u;if(1===e.nodeType){if(bt.hasData(t)&&(r=bt.access(t),o=bt.set(e,r),u=r.events)){delete o.handle,o.events={};for(n in u)for(i=0,s=u[n].length;s>i;i++)Z.event.add(e,n,u[n][i])}vt.hasData(t)&&(a=vt.access(t),l=Z.extend({},a),vt.set(e,l))}}function b(t,e){var i=t.getElementsByTagName?t.getElementsByTagName(e||"*"):t.querySelectorAll?t.querySelectorAll(e||"*"):[];return void 0===e||e&&Z.nodeName(t,e)?Z.merge([t],i):i}function v(t,e){var i=e.nodeName.toLowerCase();"input"===i&&St.test(t.type)?e.checked=t.checked:("input"===i||"textarea"===i)&&(e.defaultValue=t.defaultValue)}function y(e,i){var s,n=Z(i.createElement(e)).appendTo(i.body),r=t.getDefaultComputedStyle&&(s=t.getDefaultComputedStyle(n[0]))?s.display:Z.css(n[0],"display");return n.detach(),r}function _(t){var e=Q,i=qt[t];return i||(i=y(t,e),"none"!==i&&i||(Bt=(Bt||Z("<iframe frameborder='0' width='0' height='0'/>")).appendTo(e.documentElement),e=Bt[0].contentDocument,e.write(),e.close(),i=y(t,e),Bt.detach()),qt[t]=i),i}function x(t,e,i){var s,n,r,o,a=t.style;return i=i||$t(t),i&&(o=i.getPropertyValue(e)||i[e]),i&&(""!==o||Z.contains(t.ownerDocument,t)||(o=Z.style(t,e)),Ht.test(o)&&Ut.test(e)&&(s=a.width,n=a.minWidth,r=a.maxWidth,a.minWidth=a.maxWidth=a.width=o,o=i.width,a.width=s,a.minWidth=n,a.maxWidth=r)),void 0!==o?o+"":o}function C(t,e){return{get:function(){return t()?void delete this.get:(this.get=e).apply(this,arguments)}}}function w(t,e){if(e in t)return e;for(var i=e[0].toUpperCase()+e.slice(1),s=e,n=Jt.length;n--;)if(e=Jt[n]+i,e in t)return e;return s}function S(t,e,i){var s=Vt.exec(e);return s?Math.max(0,s[1]-(i||0))+(s[2]||"px"):e}function T(t,e,i,s,n){for(var r=i===(s?"border":"content")?4:"width"===e?1:0,o=0;4>r;r+=2)"margin"===i&&(o+=Z.css(t,i+Ct[r],!0,n)),s?("content"===i&&(o-=Z.css(t,"padding"+Ct[r],!0,n)),"margin"!==i&&(o-=Z.css(t,"border"+Ct[r]+"Width",!0,n))):(o+=Z.css(t,"padding"+Ct[r],!0,n),"padding"!==i&&(o+=Z.css(t,"border"+Ct[r]+"Width",!0,n)));return o}function E(t,e,i){var s=!0,n="width"===e?t.offsetWidth:t.offsetHeight,r=$t(t),o="border-box"===Z.css(t,"boxSizing",!1,r);if(0>=n||null==n){if(n=x(t,e,r),(0>n||null==n)&&(n=t.style[e]),Ht.test(n))return n;s=o&&(K.boxSizingReliable()||n===t.style[e]),n=parseFloat(n)||0}return n+T(t,e,i||(o?"border":"content"),s,r)+"px"}function I(t,e){for(var i,s,n,r=[],o=0,a=t.length;a>o;o++)s=t[o],s.style&&(r[o]=bt.get(s,"olddisplay"),i=s.style.display,e?(r[o]||"none"!==i||(s.style.display=""),""===s.style.display&&wt(s)&&(r[o]=bt.access(s,"olddisplay",_(s.nodeName)))):(n=wt(s),"none"===i&&n||bt.set(s,"olddisplay",n?i:Z.css(s,"display"))));for(o=0;a>o;o++)s=t[o],s.style&&(e&&"none"!==s.style.display&&""!==s.style.display||(s.style.display=e?r[o]||"":"none"));return t}function O(t,e,i,s,n){return new O.prototype.init(t,e,i,s,n)}function A(){return setTimeout(function(){Kt=void 0}),Kt=Z.now()}function N(t,e){var i,s=0,n={height:t};for(e=e?1:0;4>s;s+=2-e)i=Ct[s],n["margin"+i]=n["padding"+i]=t;return e&&(n.opacity=n.width=t),n}function k(t,e,i){for(var s,n=(ie[e]||[]).concat(ie["*"]),r=0,o=n.length;o>r;r++)if(s=n[r].call(i,e,t))return s}function P(t,e,i){var s,n,r,o,a,l,u,c,h=this,p={},d=t.style,f=t.nodeType&&wt(t),m=bt.get(t,"fxshow");i.queue||(a=Z._queueHooks(t,"fx"),null==a.unqueued&&(a.unqueued=0,l=a.empty.fire,a.empty.fire=function(){a.unqueued||l()}),a.unqueued++,h.always(function(){h.always(function(){a.unqueued--,Z.queue(t,"fx").length||a.empty.fire()})})),1===t.nodeType&&("height"in e||"width"in e)&&(i.overflow=[d.overflow,d.overflowX,d.overflowY],u=Z.css(t,"display"),c="none"===u?bt.get(t,"olddisplay")||_(t.nodeName):u,"inline"===c&&"none"===Z.css(t,"float")&&(d.display="inline-block")),i.overflow&&(d.overflow="hidden",h.always(function(){d.overflow=i.overflow[0],d.overflowX=i.overflow[1],d.overflowY=i.overflow[2]}));for(s in e)if(n=e[s],Yt.exec(n)){if(delete e[s],r=r||"toggle"===n,n===(f?"hide":"show")){if("show"!==n||!m||void 0===m[s])continue;f=!0}p[s]=m&&m[s]||Z.style(t,s)}else u=void 0;if(Z.isEmptyObject(p))"inline"===("none"===u?_(t.nodeName):u)&&(d.display=u);else{m?"hidden"in m&&(f=m.hidden):m=bt.access(t,"fxshow",{}),r&&(m.hidden=!f),f?Z(t).show():h.done(function(){Z(t).hide()}),h.done(function(){var e;bt.remove(t,"fxshow");for(e in p)Z.style(t,e,p[e])});for(s in p)o=k(f?m[s]:0,s,h),s in m||(m[s]=o.start,f&&(o.end=o.start,o.start="width"===s||"height"===s?1:0))}}function D(t,e){var i,s,n,r,o;for(i in t)if(s=Z.camelCase(i),n=e[s],r=t[i],Z.isArray(r)&&(n=r[1],r=t[i]=r[0]),i!==s&&(t[s]=r,delete t[i]),o=Z.cssHooks[s],o&&"expand"in o){r=o.expand(r),delete t[s];for(i in r)i in t||(t[i]=r[i],e[i]=n)}else e[s]=n}function R(t,e,i){var s,n,r=0,o=ee.length,a=Z.Deferred().always(function(){delete l.elem}),l=function(){if(n)return!1;for(var e=Kt||A(),i=Math.max(0,u.startTime+u.duration-e),s=i/u.duration||0,r=1-s,o=0,l=u.tweens.length;l>o;o++)u.tweens[o].run(r);return a.notifyWith(t,[u,r,i]),1>r&&l?i:(a.resolveWith(t,[u]),!1)},u=a.promise({elem:t,props:Z.extend({},e),opts:Z.extend(!0,{specialEasing:{}},i),originalProperties:e,originalOptions:i,startTime:Kt||A(),duration:i.duration,tweens:[],createTween:function(e,i){var s=Z.Tween(t,u.opts,e,i,u.opts.specialEasing[e]||u.opts.easing);return u.tweens.push(s),
s},stop:function(e){var i=0,s=e?u.tweens.length:0;if(n)return this;for(n=!0;s>i;i++)u.tweens[i].run(1);return e?a.resolveWith(t,[u,e]):a.rejectWith(t,[u,e]),this}}),c=u.props;for(D(c,u.opts.specialEasing);o>r;r++)if(s=ee[r].call(u,t,c,u.opts))return s;return Z.map(c,k,u),Z.isFunction(u.opts.start)&&u.opts.start.call(t,u),Z.fx.timer(Z.extend(l,{elem:t,anim:u,queue:u.opts.queue})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function L(t){return function(e,i){"string"!=typeof e&&(i=e,e="*");var s,n=0,r=e.toLowerCase().match(dt)||[];if(Z.isFunction(i))for(;s=r[n++];)"+"===s[0]?(s=s.slice(1)||"*",(t[s]=t[s]||[]).unshift(i)):(t[s]=t[s]||[]).push(i)}}function j(t,e,i,s){function n(a){var l;return r[a]=!0,Z.each(t[a]||[],function(t,a){var u=a(e,i,s);return"string"!=typeof u||o||r[u]?o?!(l=u):void 0:(e.dataTypes.unshift(u),n(u),!1)}),l}var r={},o=t===ye;return n(e.dataTypes[0])||!r["*"]&&n("*")}function M(t,e){var i,s,n=Z.ajaxSettings.flatOptions||{};for(i in e)void 0!==e[i]&&((n[i]?t:s||(s={}))[i]=e[i]);return s&&Z.extend(!0,t,s),t}function F(t,e,i){for(var s,n,r,o,a=t.contents,l=t.dataTypes;"*"===l[0];)l.shift(),void 0===s&&(s=t.mimeType||e.getResponseHeader("Content-Type"));if(s)for(n in a)if(a[n]&&a[n].test(s)){l.unshift(n);break}if(l[0]in i)r=l[0];else{for(n in i){if(!l[0]||t.converters[n+" "+l[0]]){r=n;break}o||(o=n)}r=r||o}return r?(r!==l[0]&&l.unshift(r),i[r]):void 0}function B(t,e,i,s){var n,r,o,a,l,u={},c=t.dataTypes.slice();if(c[1])for(o in t.converters)u[o.toLowerCase()]=t.converters[o];for(r=c.shift();r;)if(t.responseFields[r]&&(i[t.responseFields[r]]=e),!l&&s&&t.dataFilter&&(e=t.dataFilter(e,t.dataType)),l=r,r=c.shift())if("*"===r)r=l;else if("*"!==l&&l!==r){if(o=u[l+" "+r]||u["* "+r],!o)for(n in u)if(a=n.split(" "),a[1]===r&&(o=u[l+" "+a[0]]||u["* "+a[0]])){o===!0?o=u[n]:u[n]!==!0&&(r=a[0],c.unshift(a[1]));break}if(o!==!0)if(o&&t["throws"])e=o(e);else try{e=o(e)}catch(h){return{state:"parsererror",error:o?h:"No conversion from "+l+" to "+r}}}return{state:"success",data:e}}function q(t,e,i,s){var n;if(Z.isArray(e))Z.each(e,function(e,n){i||Se.test(t)?s(t,n):q(t+"["+("object"==typeof n?e:"")+"]",n,i,s)});else if(i||"object"!==Z.type(e))s(t,e);else for(n in e)q(t+"["+n+"]",e[n],i,s)}function U(t){return Z.isWindow(t)?t:9===t.nodeType&&t.defaultView}var H=[],$=H.slice,z=H.concat,V=H.push,G=H.indexOf,W={},X=W.toString,J=W.hasOwnProperty,K={},Q=t.document,Y="2.1.4",Z=function(t,e){return new Z.fn.init(t,e)},tt=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,et=/^-ms-/,it=/-([\da-z])/gi,st=function(t,e){return e.toUpperCase()};Z.fn=Z.prototype={jquery:Y,constructor:Z,selector:"",length:0,toArray:function(){return $.call(this)},get:function(t){return null!=t?0>t?this[t+this.length]:this[t]:$.call(this)},pushStack:function(t){var e=Z.merge(this.constructor(),t);return e.prevObject=this,e.context=this.context,e},each:function(t,e){return Z.each(this,t,e)},map:function(t){return this.pushStack(Z.map(this,function(e,i){return t.call(e,i,e)}))},slice:function(){return this.pushStack($.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(t){var e=this.length,i=+t+(0>t?e:0);return this.pushStack(i>=0&&e>i?[this[i]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:V,sort:H.sort,splice:H.splice},Z.extend=Z.fn.extend=function(){var t,e,i,s,n,r,o=arguments[0]||{},a=1,l=arguments.length,u=!1;for("boolean"==typeof o&&(u=o,o=arguments[a]||{},a++),"object"==typeof o||Z.isFunction(o)||(o={}),a===l&&(o=this,a--);l>a;a++)if(null!=(t=arguments[a]))for(e in t)i=o[e],s=t[e],o!==s&&(u&&s&&(Z.isPlainObject(s)||(n=Z.isArray(s)))?(n?(n=!1,r=i&&Z.isArray(i)?i:[]):r=i&&Z.isPlainObject(i)?i:{},o[e]=Z.extend(u,r,s)):void 0!==s&&(o[e]=s));return o},Z.extend({expando:"jQuery"+(Y+Math.random()).replace(/\D/g,""),isReady:!0,error:function(t){throw new Error(t)},noop:function(){},isFunction:function(t){return"function"===Z.type(t)},isArray:Array.isArray,isWindow:function(t){return null!=t&&t===t.window},isNumeric:function(t){return!Z.isArray(t)&&t-parseFloat(t)+1>=0},isPlainObject:function(t){return"object"!==Z.type(t)||t.nodeType||Z.isWindow(t)?!1:t.constructor&&!J.call(t.constructor.prototype,"isPrototypeOf")?!1:!0},isEmptyObject:function(t){var e;for(e in t)return!1;return!0},type:function(t){return null==t?t+"":"object"==typeof t||"function"==typeof t?W[X.call(t)]||"object":typeof t},globalEval:function(t){var e,i=eval;t=Z.trim(t),t&&(1===t.indexOf("use strict")?(e=Q.createElement("script"),e.text=t,Q.head.appendChild(e).parentNode.removeChild(e)):i(t))},camelCase:function(t){return t.replace(et,"ms-").replace(it,st)},nodeName:function(t,e){return t.nodeName&&t.nodeName.toLowerCase()===e.toLowerCase()},each:function(t,e,s){var n,r=0,o=t.length,a=i(t);if(s){if(a)for(;o>r&&(n=e.apply(t[r],s),n!==!1);r++);else for(r in t)if(n=e.apply(t[r],s),n===!1)break}else if(a)for(;o>r&&(n=e.call(t[r],r,t[r]),n!==!1);r++);else for(r in t)if(n=e.call(t[r],r,t[r]),n===!1)break;return t},trim:function(t){return null==t?"":(t+"").replace(tt,"")},makeArray:function(t,e){var s=e||[];return null!=t&&(i(Object(t))?Z.merge(s,"string"==typeof t?[t]:t):V.call(s,t)),s},inArray:function(t,e,i){return null==e?-1:G.call(e,t,i)},merge:function(t,e){for(var i=+e.length,s=0,n=t.length;i>s;s++)t[n++]=e[s];return t.length=n,t},grep:function(t,e,i){for(var s,n=[],r=0,o=t.length,a=!i;o>r;r++)s=!e(t[r],r),s!==a&&n.push(t[r]);return n},map:function(t,e,s){var n,r=0,o=t.length,a=i(t),l=[];if(a)for(;o>r;r++)n=e(t[r],r,s),null!=n&&l.push(n);else for(r in t)n=e(t[r],r,s),null!=n&&l.push(n);return z.apply([],l)},guid:1,proxy:function(t,e){var i,s,n;return"string"==typeof e&&(i=t[e],e=t,t=i),Z.isFunction(t)?(s=$.call(arguments,2),n=function(){return t.apply(e||this,s.concat($.call(arguments)))},n.guid=t.guid=t.guid||Z.guid++,n):void 0},now:Date.now,support:K}),Z.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(t,e){W["[object "+e+"]"]=e.toLowerCase()});var nt=function(t){function e(t,e,i,s){var n,r,o,a,l,u,h,d,f,m;if((e?e.ownerDocument||e:q)!==P&&k(e),e=e||P,i=i||[],a=e.nodeType,"string"!=typeof t||!t||1!==a&&9!==a&&11!==a)return i;if(!s&&R){if(11!==a&&(n=vt.exec(t)))if(o=n[1]){if(9===a){if(r=e.getElementById(o),!r||!r.parentNode)return i;if(r.id===o)return i.push(r),i}else if(e.ownerDocument&&(r=e.ownerDocument.getElementById(o))&&F(e,r)&&r.id===o)return i.push(r),i}else{if(n[2])return Y.apply(i,e.getElementsByTagName(t)),i;if((o=n[3])&&x.getElementsByClassName)return Y.apply(i,e.getElementsByClassName(o)),i}if(x.qsa&&(!L||!L.test(t))){if(d=h=B,f=e,m=1!==a&&t,1===a&&"object"!==e.nodeName.toLowerCase()){for(u=T(t),(h=e.getAttribute("id"))?d=h.replace(_t,"\\$&"):e.setAttribute("id",d),d="[id='"+d+"'] ",l=u.length;l--;)u[l]=d+p(u[l]);f=yt.test(t)&&c(e.parentNode)||e,m=u.join(",")}if(m)try{return Y.apply(i,f.querySelectorAll(m)),i}catch(g){}finally{h||e.removeAttribute("id")}}}return I(t.replace(lt,"$1"),e,i,s)}function i(){function t(i,s){return e.push(i+" ")>C.cacheLength&&delete t[e.shift()],t[i+" "]=s}var e=[];return t}function s(t){return t[B]=!0,t}function n(t){var e=P.createElement("div");try{return!!t(e)}catch(i){return!1}finally{e.parentNode&&e.parentNode.removeChild(e),e=null}}function r(t,e){for(var i=t.split("|"),s=t.length;s--;)C.attrHandle[i[s]]=e}function o(t,e){var i=e&&t,s=i&&1===t.nodeType&&1===e.nodeType&&(~e.sourceIndex||W)-(~t.sourceIndex||W);if(s)return s;if(i)for(;i=i.nextSibling;)if(i===e)return-1;return t?1:-1}function a(t){return function(e){var i=e.nodeName.toLowerCase();return"input"===i&&e.type===t}}function l(t){return function(e){var i=e.nodeName.toLowerCase();return("input"===i||"button"===i)&&e.type===t}}function u(t){return s(function(e){return e=+e,s(function(i,s){for(var n,r=t([],i.length,e),o=r.length;o--;)i[n=r[o]]&&(i[n]=!(s[n]=i[n]))})})}function c(t){return t&&"undefined"!=typeof t.getElementsByTagName&&t}function h(){}function p(t){for(var e=0,i=t.length,s="";i>e;e++)s+=t[e].value;return s}function d(t,e,i){var s=e.dir,n=i&&"parentNode"===s,r=H++;return e.first?function(e,i,r){for(;e=e[s];)if(1===e.nodeType||n)return t(e,i,r)}:function(e,i,o){var a,l,u=[U,r];if(o){for(;e=e[s];)if((1===e.nodeType||n)&&t(e,i,o))return!0}else for(;e=e[s];)if(1===e.nodeType||n){if(l=e[B]||(e[B]={}),(a=l[s])&&a[0]===U&&a[1]===r)return u[2]=a[2];if(l[s]=u,u[2]=t(e,i,o))return!0}}}function f(t){return t.length>1?function(e,i,s){for(var n=t.length;n--;)if(!t[n](e,i,s))return!1;return!0}:t[0]}function m(t,i,s){for(var n=0,r=i.length;r>n;n++)e(t,i[n],s);return s}function g(t,e,i,s,n){for(var r,o=[],a=0,l=t.length,u=null!=e;l>a;a++)(r=t[a])&&(!i||i(r,s,n))&&(o.push(r),u&&e.push(a));return o}function b(t,e,i,n,r,o){return n&&!n[B]&&(n=b(n)),r&&!r[B]&&(r=b(r,o)),s(function(s,o,a,l){var u,c,h,p=[],d=[],f=o.length,b=s||m(e||"*",a.nodeType?[a]:a,[]),v=!t||!s&&e?b:g(b,p,t,a,l),y=i?r||(s?t:f||n)?[]:o:v;if(i&&i(v,y,a,l),n)for(u=g(y,d),n(u,[],a,l),c=u.length;c--;)(h=u[c])&&(y[d[c]]=!(v[d[c]]=h));if(s){if(r||t){if(r){for(u=[],c=y.length;c--;)(h=y[c])&&u.push(v[c]=h);r(null,y=[],u,l)}for(c=y.length;c--;)(h=y[c])&&(u=r?tt(s,h):p[c])>-1&&(s[u]=!(o[u]=h))}}else y=g(y===o?y.splice(f,y.length):y),r?r(null,o,y,l):Y.apply(o,y)})}function v(t){for(var e,i,s,n=t.length,r=C.relative[t[0].type],o=r||C.relative[" "],a=r?1:0,l=d(function(t){return t===e},o,!0),u=d(function(t){return tt(e,t)>-1},o,!0),c=[function(t,i,s){var n=!r&&(s||i!==O)||((e=i).nodeType?l(t,i,s):u(t,i,s));return e=null,n}];n>a;a++)if(i=C.relative[t[a].type])c=[d(f(c),i)];else{if(i=C.filter[t[a].type].apply(null,t[a].matches),i[B]){for(s=++a;n>s&&!C.relative[t[s].type];s++);return b(a>1&&f(c),a>1&&p(t.slice(0,a-1).concat({value:" "===t[a-2].type?"*":""})).replace(lt,"$1"),i,s>a&&v(t.slice(a,s)),n>s&&v(t=t.slice(s)),n>s&&p(t))}c.push(i)}return f(c)}function y(t,i){var n=i.length>0,r=t.length>0,o=function(s,o,a,l,u){var c,h,p,d=0,f="0",m=s&&[],b=[],v=O,y=s||r&&C.find.TAG("*",u),_=U+=null==v?1:Math.random()||.1,x=y.length;for(u&&(O=o!==P&&o);f!==x&&null!=(c=y[f]);f++){if(r&&c){for(h=0;p=t[h++];)if(p(c,o,a)){l.push(c);break}u&&(U=_)}n&&((c=!p&&c)&&d--,s&&m.push(c))}if(d+=f,n&&f!==d){for(h=0;p=i[h++];)p(m,b,o,a);if(s){if(d>0)for(;f--;)m[f]||b[f]||(b[f]=K.call(l));b=g(b)}Y.apply(l,b),u&&!s&&b.length>0&&d+i.length>1&&e.uniqueSort(l)}return u&&(U=_,O=v),m};return n?s(o):o}var _,x,C,w,S,T,E,I,O,A,N,k,P,D,R,L,j,M,F,B="sizzle"+1*new Date,q=t.document,U=0,H=0,$=i(),z=i(),V=i(),G=function(t,e){return t===e&&(N=!0),0},W=1<<31,X={}.hasOwnProperty,J=[],K=J.pop,Q=J.push,Y=J.push,Z=J.slice,tt=function(t,e){for(var i=0,s=t.length;s>i;i++)if(t[i]===e)return i;return-1},et="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",it="[\\x20\\t\\r\\n\\f]",st="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",nt=st.replace("w","w#"),rt="\\["+it+"*("+st+")(?:"+it+"*([*^$|!~]?=)"+it+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+nt+"))|)"+it+"*\\]",ot=":("+st+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+rt+")*)|.*)\\)|)",at=new RegExp(it+"+","g"),lt=new RegExp("^"+it+"+|((?:^|[^\\\\])(?:\\\\.)*)"+it+"+$","g"),ut=new RegExp("^"+it+"*,"+it+"*"),ct=new RegExp("^"+it+"*([>+~]|"+it+")"+it+"*"),ht=new RegExp("="+it+"*([^\\]'\"]*?)"+it+"*\\]","g"),pt=new RegExp(ot),dt=new RegExp("^"+nt+"$"),ft={ID:new RegExp("^#("+st+")"),CLASS:new RegExp("^\\.("+st+")"),TAG:new RegExp("^("+st.replace("w","w*")+")"),ATTR:new RegExp("^"+rt),PSEUDO:new RegExp("^"+ot),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+it+"*(even|odd|(([+-]|)(\\d*)n|)"+it+"*(?:([+-]|)"+it+"*(\\d+)|))"+it+"*\\)|)","i"),bool:new RegExp("^(?:"+et+")$","i"),needsContext:new RegExp("^"+it+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+it+"*((?:-\\d)?\\d*)"+it+"*\\)|)(?=[^-]|$)","i")},mt=/^(?:input|select|textarea|button)$/i,gt=/^h\d$/i,bt=/^[^{]+\{\s*\[native \w/,vt=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,yt=/[+~]/,_t=/'|\\/g,xt=new RegExp("\\\\([\\da-f]{1,6}"+it+"?|("+it+")|.)","ig"),Ct=function(t,e,i){var s="0x"+e-65536;return s!==s||i?e:0>s?String.fromCharCode(s+65536):String.fromCharCode(s>>10|55296,1023&s|56320)},wt=function(){k()};try{Y.apply(J=Z.call(q.childNodes),q.childNodes),J[q.childNodes.length].nodeType}catch(St){Y={apply:J.length?function(t,e){Q.apply(t,Z.call(e))}:function(t,e){for(var i=t.length,s=0;t[i++]=e[s++];);t.length=i-1}}}x=e.support={},S=e.isXML=function(t){var e=t&&(t.ownerDocument||t).documentElement;return e?"HTML"!==e.nodeName:!1},k=e.setDocument=function(t){var e,i,s=t?t.ownerDocument||t:q;return s!==P&&9===s.nodeType&&s.documentElement?(P=s,D=s.documentElement,i=s.defaultView,i&&i!==i.top&&(i.addEventListener?i.addEventListener("unload",wt,!1):i.attachEvent&&i.attachEvent("onunload",wt)),R=!S(s),x.attributes=n(function(t){return t.className="i",!t.getAttribute("className")}),x.getElementsByTagName=n(function(t){return t.appendChild(s.createComment("")),!t.getElementsByTagName("*").length}),x.getElementsByClassName=bt.test(s.getElementsByClassName),x.getById=n(function(t){return D.appendChild(t).id=B,!s.getElementsByName||!s.getElementsByName(B).length}),x.getById?(C.find.ID=function(t,e){if("undefined"!=typeof e.getElementById&&R){var i=e.getElementById(t);return i&&i.parentNode?[i]:[]}},C.filter.ID=function(t){var e=t.replace(xt,Ct);return function(t){return t.getAttribute("id")===e}}):(delete C.find.ID,C.filter.ID=function(t){var e=t.replace(xt,Ct);return function(t){var i="undefined"!=typeof t.getAttributeNode&&t.getAttributeNode("id");return i&&i.value===e}}),C.find.TAG=x.getElementsByTagName?function(t,e){return"undefined"!=typeof e.getElementsByTagName?e.getElementsByTagName(t):x.qsa?e.querySelectorAll(t):void 0}:function(t,e){var i,s=[],n=0,r=e.getElementsByTagName(t);if("*"===t){for(;i=r[n++];)1===i.nodeType&&s.push(i);return s}return r},C.find.CLASS=x.getElementsByClassName&&function(t,e){return R?e.getElementsByClassName(t):void 0},j=[],L=[],(x.qsa=bt.test(s.querySelectorAll))&&(n(function(t){D.appendChild(t).innerHTML="<a id='"+B+"'></a><select id='"+B+"-\f]' msallowcapture=''><option selected=''></option></select>",t.querySelectorAll("[msallowcapture^='']").length&&L.push("[*^$]="+it+"*(?:''|\"\")"),t.querySelectorAll("[selected]").length||L.push("\\["+it+"*(?:value|"+et+")"),t.querySelectorAll("[id~="+B+"-]").length||L.push("~="),t.querySelectorAll(":checked").length||L.push(":checked"),t.querySelectorAll("a#"+B+"+*").length||L.push(".#.+[+~]")}),n(function(t){var e=s.createElement("input");e.setAttribute("type","hidden"),t.appendChild(e).setAttribute("name","D"),t.querySelectorAll("[name=d]").length&&L.push("name"+it+"*[*^$|!~]?="),t.querySelectorAll(":enabled").length||L.push(":enabled",":disabled"),t.querySelectorAll("*,:x"),L.push(",.*:")})),(x.matchesSelector=bt.test(M=D.matches||D.webkitMatchesSelector||D.mozMatchesSelector||D.oMatchesSelector||D.msMatchesSelector))&&n(function(t){x.disconnectedMatch=M.call(t,"div"),M.call(t,"[s!='']:x"),j.push("!=",ot)}),L=L.length&&new RegExp(L.join("|")),j=j.length&&new RegExp(j.join("|")),e=bt.test(D.compareDocumentPosition),F=e||bt.test(D.contains)?function(t,e){var i=9===t.nodeType?t.documentElement:t,s=e&&e.parentNode;return t===s||!(!s||1!==s.nodeType||!(i.contains?i.contains(s):t.compareDocumentPosition&&16&t.compareDocumentPosition(s)))}:function(t,e){if(e)for(;e=e.parentNode;)if(e===t)return!0;return!1},G=e?function(t,e){if(t===e)return N=!0,0;var i=!t.compareDocumentPosition-!e.compareDocumentPosition;return i?i:(i=(t.ownerDocument||t)===(e.ownerDocument||e)?t.compareDocumentPosition(e):1,1&i||!x.sortDetached&&e.compareDocumentPosition(t)===i?t===s||t.ownerDocument===q&&F(q,t)?-1:e===s||e.ownerDocument===q&&F(q,e)?1:A?tt(A,t)-tt(A,e):0:4&i?-1:1)}:function(t,e){if(t===e)return N=!0,0;var i,n=0,r=t.parentNode,a=e.parentNode,l=[t],u=[e];if(!r||!a)return t===s?-1:e===s?1:r?-1:a?1:A?tt(A,t)-tt(A,e):0;if(r===a)return o(t,e);for(i=t;i=i.parentNode;)l.unshift(i);for(i=e;i=i.parentNode;)u.unshift(i);for(;l[n]===u[n];)n++;return n?o(l[n],u[n]):l[n]===q?-1:u[n]===q?1:0},s):P},e.matches=function(t,i){return e(t,null,null,i)},e.matchesSelector=function(t,i){if((t.ownerDocument||t)!==P&&k(t),i=i.replace(ht,"='$1']"),x.matchesSelector&&R&&(!j||!j.test(i))&&(!L||!L.test(i)))try{var s=M.call(t,i);if(s||x.disconnectedMatch||t.document&&11!==t.document.nodeType)return s}catch(n){}return e(i,P,null,[t]).length>0},e.contains=function(t,e){return(t.ownerDocument||t)!==P&&k(t),F(t,e)},e.attr=function(t,e){(t.ownerDocument||t)!==P&&k(t);var i=C.attrHandle[e.toLowerCase()],s=i&&X.call(C.attrHandle,e.toLowerCase())?i(t,e,!R):void 0;return void 0!==s?s:x.attributes||!R?t.getAttribute(e):(s=t.getAttributeNode(e))&&s.specified?s.value:null},e.error=function(t){throw new Error("Syntax error, unrecognized expression: "+t)},e.uniqueSort=function(t){var e,i=[],s=0,n=0;if(N=!x.detectDuplicates,A=!x.sortStable&&t.slice(0),t.sort(G),N){for(;e=t[n++];)e===t[n]&&(s=i.push(n));for(;s--;)t.splice(i[s],1)}return A=null,t},w=e.getText=function(t){var e,i="",s=0,n=t.nodeType;if(n){if(1===n||9===n||11===n){if("string"==typeof t.textContent)return t.textContent;for(t=t.firstChild;t;t=t.nextSibling)i+=w(t)}else if(3===n||4===n)return t.nodeValue}else for(;e=t[s++];)i+=w(e);return i},C=e.selectors={cacheLength:50,createPseudo:s,match:ft,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(t){return t[1]=t[1].replace(xt,Ct),t[3]=(t[3]||t[4]||t[5]||"").replace(xt,Ct),"~="===t[2]&&(t[3]=" "+t[3]+" "),t.slice(0,4)},CHILD:function(t){return t[1]=t[1].toLowerCase(),"nth"===t[1].slice(0,3)?(t[3]||e.error(t[0]),t[4]=+(t[4]?t[5]+(t[6]||1):2*("even"===t[3]||"odd"===t[3])),t[5]=+(t[7]+t[8]||"odd"===t[3])):t[3]&&e.error(t[0]),t},PSEUDO:function(t){var e,i=!t[6]&&t[2];return ft.CHILD.test(t[0])?null:(t[3]?t[2]=t[4]||t[5]||"":i&&pt.test(i)&&(e=T(i,!0))&&(e=i.indexOf(")",i.length-e)-i.length)&&(t[0]=t[0].slice(0,e),t[2]=i.slice(0,e)),t.slice(0,3))}},filter:{TAG:function(t){var e=t.replace(xt,Ct).toLowerCase();return"*"===t?function(){return!0}:function(t){return t.nodeName&&t.nodeName.toLowerCase()===e}},CLASS:function(t){var e=$[t+" "];return e||(e=new RegExp("(^|"+it+")"+t+"("+it+"|$)"))&&$(t,function(t){return e.test("string"==typeof t.className&&t.className||"undefined"!=typeof t.getAttribute&&t.getAttribute("class")||"")})},ATTR:function(t,i,s){return function(n){var r=e.attr(n,t);return null==r?"!="===i:i?(r+="","="===i?r===s:"!="===i?r!==s:"^="===i?s&&0===r.indexOf(s):"*="===i?s&&r.indexOf(s)>-1:"$="===i?s&&r.slice(-s.length)===s:"~="===i?(" "+r.replace(at," ")+" ").indexOf(s)>-1:"|="===i?r===s||r.slice(0,s.length+1)===s+"-":!1):!0}},CHILD:function(t,e,i,s,n){var r="nth"!==t.slice(0,3),o="last"!==t.slice(-4),a="of-type"===e;return 1===s&&0===n?function(t){return!!t.parentNode}:function(e,i,l){var u,c,h,p,d,f,m=r!==o?"nextSibling":"previousSibling",g=e.parentNode,b=a&&e.nodeName.toLowerCase(),v=!l&&!a;if(g){if(r){for(;m;){for(h=e;h=h[m];)if(a?h.nodeName.toLowerCase()===b:1===h.nodeType)return!1;f=m="only"===t&&!f&&"nextSibling"}return!0}if(f=[o?g.firstChild:g.lastChild],o&&v){for(c=g[B]||(g[B]={}),u=c[t]||[],d=u[0]===U&&u[1],p=u[0]===U&&u[2],h=d&&g.childNodes[d];h=++d&&h&&h[m]||(p=d=0)||f.pop();)if(1===h.nodeType&&++p&&h===e){c[t]=[U,d,p];break}}else if(v&&(u=(e[B]||(e[B]={}))[t])&&u[0]===U)p=u[1];else for(;(h=++d&&h&&h[m]||(p=d=0)||f.pop())&&((a?h.nodeName.toLowerCase()!==b:1!==h.nodeType)||!++p||(v&&((h[B]||(h[B]={}))[t]=[U,p]),h!==e)););return p-=n,p===s||p%s===0&&p/s>=0}}},PSEUDO:function(t,i){var n,r=C.pseudos[t]||C.setFilters[t.toLowerCase()]||e.error("unsupported pseudo: "+t);return r[B]?r(i):r.length>1?(n=[t,t,"",i],C.setFilters.hasOwnProperty(t.toLowerCase())?s(function(t,e){for(var s,n=r(t,i),o=n.length;o--;)s=tt(t,n[o]),t[s]=!(e[s]=n[o])}):function(t){return r(t,0,n)}):r}},pseudos:{not:s(function(t){var e=[],i=[],n=E(t.replace(lt,"$1"));return n[B]?s(function(t,e,i,s){for(var r,o=n(t,null,s,[]),a=t.length;a--;)(r=o[a])&&(t[a]=!(e[a]=r))}):function(t,s,r){return e[0]=t,n(e,null,r,i),e[0]=null,!i.pop()}}),has:s(function(t){return function(i){return e(t,i).length>0}}),contains:s(function(t){return t=t.replace(xt,Ct),function(e){return(e.textContent||e.innerText||w(e)).indexOf(t)>-1}}),lang:s(function(t){return dt.test(t||"")||e.error("unsupported lang: "+t),t=t.replace(xt,Ct).toLowerCase(),function(e){var i;do if(i=R?e.lang:e.getAttribute("xml:lang")||e.getAttribute("lang"))return i=i.toLowerCase(),i===t||0===i.indexOf(t+"-");while((e=e.parentNode)&&1===e.nodeType);return!1}}),target:function(e){var i=t.location&&t.location.hash;return i&&i.slice(1)===e.id},root:function(t){return t===D},focus:function(t){return t===P.activeElement&&(!P.hasFocus||P.hasFocus())&&!!(t.type||t.href||~t.tabIndex)},enabled:function(t){return t.disabled===!1},disabled:function(t){return t.disabled===!0},checked:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&!!t.checked||"option"===e&&!!t.selected},selected:function(t){return t.parentNode&&t.parentNode.selectedIndex,t.selected===!0},empty:function(t){for(t=t.firstChild;t;t=t.nextSibling)if(t.nodeType<6)return!1;return!0},parent:function(t){return!C.pseudos.empty(t)},header:function(t){return gt.test(t.nodeName)},input:function(t){return mt.test(t.nodeName)},button:function(t){var e=t.nodeName.toLowerCase();return"input"===e&&"button"===t.type||"button"===e},text:function(t){var e;return"input"===t.nodeName.toLowerCase()&&"text"===t.type&&(null==(e=t.getAttribute("type"))||"text"===e.toLowerCase())},first:u(function(){return[0]}),last:u(function(t,e){return[e-1]}),eq:u(function(t,e,i){return[0>i?i+e:i]}),even:u(function(t,e){for(var i=0;e>i;i+=2)t.push(i);return t}),odd:u(function(t,e){for(var i=1;e>i;i+=2)t.push(i);return t}),lt:u(function(t,e,i){for(var s=0>i?i+e:i;--s>=0;)t.push(s);return t}),gt:u(function(t,e,i){for(var s=0>i?i+e:i;++s<e;)t.push(s);return t})}},C.pseudos.nth=C.pseudos.eq;for(_ in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})C.pseudos[_]=a(_);for(_ in{submit:!0,reset:!0})C.pseudos[_]=l(_);return h.prototype=C.filters=C.pseudos,C.setFilters=new h,T=e.tokenize=function(t,i){var s,n,r,o,a,l,u,c=z[t+" "];if(c)return i?0:c.slice(0);for(a=t,l=[],u=C.preFilter;a;){(!s||(n=ut.exec(a)))&&(n&&(a=a.slice(n[0].length)||a),l.push(r=[])),s=!1,(n=ct.exec(a))&&(s=n.shift(),r.push({value:s,type:n[0].replace(lt," ")}),a=a.slice(s.length));for(o in C.filter)!(n=ft[o].exec(a))||u[o]&&!(n=u[o](n))||(s=n.shift(),r.push({value:s,type:o,matches:n}),a=a.slice(s.length));if(!s)break}return i?a.length:a?e.error(t):z(t,l).slice(0)},E=e.compile=function(t,e){var i,s=[],n=[],r=V[t+" "];if(!r){for(e||(e=T(t)),i=e.length;i--;)r=v(e[i]),r[B]?s.push(r):n.push(r);r=V(t,y(n,s)),r.selector=t}return r},I=e.select=function(t,e,i,s){var n,r,o,a,l,u="function"==typeof t&&t,h=!s&&T(t=u.selector||t);if(i=i||[],1===h.length){if(r=h[0]=h[0].slice(0),r.length>2&&"ID"===(o=r[0]).type&&x.getById&&9===e.nodeType&&R&&C.relative[r[1].type]){if(e=(C.find.ID(o.matches[0].replace(xt,Ct),e)||[])[0],!e)return i;u&&(e=e.parentNode),t=t.slice(r.shift().value.length)}for(n=ft.needsContext.test(t)?0:r.length;n--&&(o=r[n],!C.relative[a=o.type]);)if((l=C.find[a])&&(s=l(o.matches[0].replace(xt,Ct),yt.test(r[0].type)&&c(e.parentNode)||e))){if(r.splice(n,1),t=s.length&&p(r),!t)return Y.apply(i,s),i;break}}return(u||E(t,h))(s,e,!R,i,yt.test(t)&&c(e.parentNode)||e),i},x.sortStable=B.split("").sort(G).join("")===B,x.detectDuplicates=!!N,k(),x.sortDetached=n(function(t){return 1&t.compareDocumentPosition(P.createElement("div"))}),n(function(t){return t.innerHTML="<a href='#'></a>","#"===t.firstChild.getAttribute("href")})||r("type|href|height|width",function(t,e,i){return i?void 0:t.getAttribute(e,"type"===e.toLowerCase()?1:2)}),x.attributes&&n(function(t){return t.innerHTML="<input/>",t.firstChild.setAttribute("value",""),""===t.firstChild.getAttribute("value")})||r("value",function(t,e,i){return i||"input"!==t.nodeName.toLowerCase()?void 0:t.defaultValue}),n(function(t){return null==t.getAttribute("disabled")})||r(et,function(t,e,i){var s;return i?void 0:t[e]===!0?e.toLowerCase():(s=t.getAttributeNode(e))&&s.specified?s.value:null}),e}(t);Z.find=nt,Z.expr=nt.selectors,Z.expr[":"]=Z.expr.pseudos,Z.unique=nt.uniqueSort,Z.text=nt.getText,Z.isXMLDoc=nt.isXML,Z.contains=nt.contains;var rt=Z.expr.match.needsContext,ot=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,at=/^.[^:#\[\.,]*$/;Z.filter=function(t,e,i){var s=e[0];return i&&(t=":not("+t+")"),1===e.length&&1===s.nodeType?Z.find.matchesSelector(s,t)?[s]:[]:Z.find.matches(t,Z.grep(e,function(t){return 1===t.nodeType}))},Z.fn.extend({find:function(t){var e,i=this.length,s=[],n=this;if("string"!=typeof t)return this.pushStack(Z(t).filter(function(){for(e=0;i>e;e++)if(Z.contains(n[e],this))return!0}));for(e=0;i>e;e++)Z.find(t,n[e],s);return s=this.pushStack(i>1?Z.unique(s):s),s.selector=this.selector?this.selector+" "+t:t,s},filter:function(t){return this.pushStack(s(this,t||[],!1))},not:function(t){return this.pushStack(s(this,t||[],!0))},is:function(t){return!!s(this,"string"==typeof t&&rt.test(t)?Z(t):t||[],!1).length}});var lt,ut=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,ct=Z.fn.init=function(t,e){var i,s;if(!t)return this;if("string"==typeof t){if(i="<"===t[0]&&">"===t[t.length-1]&&t.length>=3?[null,t,null]:ut.exec(t),!i||!i[1]&&e)return!e||e.jquery?(e||lt).find(t):this.constructor(e).find(t);if(i[1]){if(e=e instanceof Z?e[0]:e,Z.merge(this,Z.parseHTML(i[1],e&&e.nodeType?e.ownerDocument||e:Q,!0)),ot.test(i[1])&&Z.isPlainObject(e))for(i in e)Z.isFunction(this[i])?this[i](e[i]):this.attr(i,e[i]);return this}return s=Q.getElementById(i[2]),s&&s.parentNode&&(this.length=1,this[0]=s),this.context=Q,this.selector=t,this}return t.nodeType?(this.context=this[0]=t,this.length=1,this):Z.isFunction(t)?"undefined"!=typeof lt.ready?lt.ready(t):t(Z):(void 0!==t.selector&&(this.selector=t.selector,this.context=t.context),Z.makeArray(t,this))};ct.prototype=Z.fn,lt=Z(Q);var ht=/^(?:parents|prev(?:Until|All))/,pt={children:!0,contents:!0,next:!0,prev:!0};Z.extend({dir:function(t,e,i){for(var s=[],n=void 0!==i;(t=t[e])&&9!==t.nodeType;)if(1===t.nodeType){if(n&&Z(t).is(i))break;s.push(t)}return s},sibling:function(t,e){for(var i=[];t;t=t.nextSibling)1===t.nodeType&&t!==e&&i.push(t);return i}}),Z.fn.extend({has:function(t){var e=Z(t,this),i=e.length;return this.filter(function(){for(var t=0;i>t;t++)if(Z.contains(this,e[t]))return!0})},closest:function(t,e){for(var i,s=0,n=this.length,r=[],o=rt.test(t)||"string"!=typeof t?Z(t,e||this.context):0;n>s;s++)for(i=this[s];i&&i!==e;i=i.parentNode)if(i.nodeType<11&&(o?o.index(i)>-1:1===i.nodeType&&Z.find.matchesSelector(i,t))){r.push(i);break}return this.pushStack(r.length>1?Z.unique(r):r)},index:function(t){return t?"string"==typeof t?G.call(Z(t),this[0]):G.call(this,t.jquery?t[0]:t):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(t,e){return this.pushStack(Z.unique(Z.merge(this.get(),Z(t,e))))},addBack:function(t){return this.add(null==t?this.prevObject:this.prevObject.filter(t))}}),Z.each({parent:function(t){var e=t.parentNode;return e&&11!==e.nodeType?e:null},parents:function(t){return Z.dir(t,"parentNode")},parentsUntil:function(t,e,i){return Z.dir(t,"parentNode",i)},next:function(t){return n(t,"nextSibling")},prev:function(t){return n(t,"previousSibling")},nextAll:function(t){return Z.dir(t,"nextSibling")},prevAll:function(t){return Z.dir(t,"previousSibling")},nextUntil:function(t,e,i){return Z.dir(t,"nextSibling",i)},prevUntil:function(t,e,i){return Z.dir(t,"previousSibling",i)},siblings:function(t){return Z.sibling((t.parentNode||{}).firstChild,t)},children:function(t){return Z.sibling(t.firstChild)},contents:function(t){return t.contentDocument||Z.merge([],t.childNodes)}},function(t,e){Z.fn[t]=function(i,s){var n=Z.map(this,e,i);return"Until"!==t.slice(-5)&&(s=i),s&&"string"==typeof s&&(n=Z.filter(s,n)),this.length>1&&(pt[t]||Z.unique(n),ht.test(t)&&n.reverse()),this.pushStack(n)}});var dt=/\S+/g,ft={};Z.Callbacks=function(t){t="string"==typeof t?ft[t]||r(t):Z.extend({},t);var e,i,s,n,o,a,l=[],u=!t.once&&[],c=function(r){for(e=t.memory&&r,i=!0,a=n||0,n=0,o=l.length,s=!0;l&&o>a;a++)if(l[a].apply(r[0],r[1])===!1&&t.stopOnFalse){e=!1;break}s=!1,l&&(u?u.length&&c(u.shift()):e?l=[]:h.disable())},h={add:function(){if(l){var i=l.length;!function r(e){Z.each(e,function(e,i){var s=Z.type(i);"function"===s?t.unique&&h.has(i)||l.push(i):i&&i.length&&"string"!==s&&r(i)})}(arguments),s?o=l.length:e&&(n=i,c(e))}return this},remove:function(){return l&&Z.each(arguments,function(t,e){for(var i;(i=Z.inArray(e,l,i))>-1;)l.splice(i,1),s&&(o>=i&&o--,a>=i&&a--)}),this},has:function(t){return t?Z.inArray(t,l)>-1:!(!l||!l.length)},empty:function(){return l=[],o=0,this},disable:function(){return l=u=e=void 0,this},disabled:function(){return!l},lock:function(){return u=void 0,e||h.disable(),this},locked:function(){return!u},fireWith:function(t,e){return!l||i&&!u||(e=e||[],e=[t,e.slice?e.slice():e],s?u.push(e):c(e)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!i}};return h},Z.extend({Deferred:function(t){var e=[["resolve","done",Z.Callbacks("once memory"),"resolved"],["reject","fail",Z.Callbacks("once memory"),"rejected"],["notify","progress",Z.Callbacks("memory")]],i="pending",s={state:function(){return i},always:function(){return n.done(arguments).fail(arguments),this},then:function(){var t=arguments;return Z.Deferred(function(i){Z.each(e,function(e,r){var o=Z.isFunction(t[e])&&t[e];n[r[1]](function(){var t=o&&o.apply(this,arguments);t&&Z.isFunction(t.promise)?t.promise().done(i.resolve).fail(i.reject).progress(i.notify):i[r[0]+"With"](this===s?i.promise():this,o?[t]:arguments)})}),t=null}).promise()},promise:function(t){return null!=t?Z.extend(t,s):s}},n={};return s.pipe=s.then,Z.each(e,function(t,r){var o=r[2],a=r[3];s[r[1]]=o.add,a&&o.add(function(){i=a},e[1^t][2].disable,e[2][2].lock),n[r[0]]=function(){return n[r[0]+"With"](this===n?s:this,arguments),this},n[r[0]+"With"]=o.fireWith}),s.promise(n),t&&t.call(n,n),n},when:function(t){var e,i,s,n=0,r=$.call(arguments),o=r.length,a=1!==o||t&&Z.isFunction(t.promise)?o:0,l=1===a?t:Z.Deferred(),u=function(t,i,s){return function(n){i[t]=this,s[t]=arguments.length>1?$.call(arguments):n,s===e?l.notifyWith(i,s):--a||l.resolveWith(i,s)}};if(o>1)for(e=new Array(o),i=new Array(o),s=new Array(o);o>n;n++)r[n]&&Z.isFunction(r[n].promise)?r[n].promise().done(u(n,s,r)).fail(l.reject).progress(u(n,i,e)):--a;return a||l.resolveWith(s,r),l.promise()}});var mt;Z.fn.ready=function(t){return Z.ready.promise().done(t),this},Z.extend({isReady:!1,readyWait:1,holdReady:function(t){t?Z.readyWait++:Z.ready(!0)},ready:function(t){(t===!0?--Z.readyWait:Z.isReady)||(Z.isReady=!0,t!==!0&&--Z.readyWait>0||(mt.resolveWith(Q,[Z]),Z.fn.triggerHandler&&(Z(Q).triggerHandler("ready"),Z(Q).off("ready"))))}}),Z.ready.promise=function(e){return mt||(mt=Z.Deferred(),"complete"===Q.readyState?setTimeout(Z.ready):(Q.addEventListener("DOMContentLoaded",o,!1),t.addEventListener("load",o,!1))),mt.promise(e)},Z.ready.promise();var gt=Z.access=function(t,e,i,s,n,r,o){var a=0,l=t.length,u=null==i;if("object"===Z.type(i)){n=!0;for(a in i)Z.access(t,e,a,i[a],!0,r,o)}else if(void 0!==s&&(n=!0,Z.isFunction(s)||(o=!0),u&&(o?(e.call(t,s),e=null):(u=e,e=function(t,e,i){return u.call(Z(t),i)})),e))for(;l>a;a++)e(t[a],i,o?s:s.call(t[a],a,e(t[a],i)));return n?t:u?e.call(t):l?e(t[0],i):r};Z.acceptData=function(t){return 1===t.nodeType||9===t.nodeType||!+t.nodeType},a.uid=1,a.accepts=Z.acceptData,a.prototype={key:function(t){if(!a.accepts(t))return 0;var e={},i=t[this.expando];if(!i){i=a.uid++;try{e[this.expando]={value:i},Object.defineProperties(t,e)}catch(s){e[this.expando]=i,Z.extend(t,e)}}return this.cache[i]||(this.cache[i]={}),
i},set:function(t,e,i){var s,n=this.key(t),r=this.cache[n];if("string"==typeof e)r[e]=i;else if(Z.isEmptyObject(r))Z.extend(this.cache[n],e);else for(s in e)r[s]=e[s];return r},get:function(t,e){var i=this.cache[this.key(t)];return void 0===e?i:i[e]},access:function(t,e,i){var s;return void 0===e||e&&"string"==typeof e&&void 0===i?(s=this.get(t,e),void 0!==s?s:this.get(t,Z.camelCase(e))):(this.set(t,e,i),void 0!==i?i:e)},remove:function(t,e){var i,s,n,r=this.key(t),o=this.cache[r];if(void 0===e)this.cache[r]={};else{Z.isArray(e)?s=e.concat(e.map(Z.camelCase)):(n=Z.camelCase(e),e in o?s=[e,n]:(s=n,s=s in o?[s]:s.match(dt)||[])),i=s.length;for(;i--;)delete o[s[i]]}},hasData:function(t){return!Z.isEmptyObject(this.cache[t[this.expando]]||{})},discard:function(t){t[this.expando]&&delete this.cache[t[this.expando]]}};var bt=new a,vt=new a,yt=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,_t=/([A-Z])/g;Z.extend({hasData:function(t){return vt.hasData(t)||bt.hasData(t)},data:function(t,e,i){return vt.access(t,e,i)},removeData:function(t,e){vt.remove(t,e)},_data:function(t,e,i){return bt.access(t,e,i)},_removeData:function(t,e){bt.remove(t,e)}}),Z.fn.extend({data:function(t,e){var i,s,n,r=this[0],o=r&&r.attributes;if(void 0===t){if(this.length&&(n=vt.get(r),1===r.nodeType&&!bt.get(r,"hasDataAttrs"))){for(i=o.length;i--;)o[i]&&(s=o[i].name,0===s.indexOf("data-")&&(s=Z.camelCase(s.slice(5)),l(r,s,n[s])));bt.set(r,"hasDataAttrs",!0)}return n}return"object"==typeof t?this.each(function(){vt.set(this,t)}):gt(this,function(e){var i,s=Z.camelCase(t);if(r&&void 0===e){if(i=vt.get(r,t),void 0!==i)return i;if(i=vt.get(r,s),void 0!==i)return i;if(i=l(r,s,void 0),void 0!==i)return i}else this.each(function(){var i=vt.get(this,s);vt.set(this,s,e),-1!==t.indexOf("-")&&void 0!==i&&vt.set(this,t,e)})},null,e,arguments.length>1,null,!0)},removeData:function(t){return this.each(function(){vt.remove(this,t)})}}),Z.extend({queue:function(t,e,i){var s;return t?(e=(e||"fx")+"queue",s=bt.get(t,e),i&&(!s||Z.isArray(i)?s=bt.access(t,e,Z.makeArray(i)):s.push(i)),s||[]):void 0},dequeue:function(t,e){e=e||"fx";var i=Z.queue(t,e),s=i.length,n=i.shift(),r=Z._queueHooks(t,e),o=function(){Z.dequeue(t,e)};"inprogress"===n&&(n=i.shift(),s--),n&&("fx"===e&&i.unshift("inprogress"),delete r.stop,n.call(t,o,r)),!s&&r&&r.empty.fire()},_queueHooks:function(t,e){var i=e+"queueHooks";return bt.get(t,i)||bt.access(t,i,{empty:Z.Callbacks("once memory").add(function(){bt.remove(t,[e+"queue",i])})})}}),Z.fn.extend({queue:function(t,e){var i=2;return"string"!=typeof t&&(e=t,t="fx",i--),arguments.length<i?Z.queue(this[0],t):void 0===e?this:this.each(function(){var i=Z.queue(this,t,e);Z._queueHooks(this,t),"fx"===t&&"inprogress"!==i[0]&&Z.dequeue(this,t)})},dequeue:function(t){return this.each(function(){Z.dequeue(this,t)})},clearQueue:function(t){return this.queue(t||"fx",[])},promise:function(t,e){var i,s=1,n=Z.Deferred(),r=this,o=this.length,a=function(){--s||n.resolveWith(r,[r])};for("string"!=typeof t&&(e=t,t=void 0),t=t||"fx";o--;)i=bt.get(r[o],t+"queueHooks"),i&&i.empty&&(s++,i.empty.add(a));return a(),n.promise(e)}});var xt=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,Ct=["Top","Right","Bottom","Left"],wt=function(t,e){return t=e||t,"none"===Z.css(t,"display")||!Z.contains(t.ownerDocument,t)},St=/^(?:checkbox|radio)$/i;!function(){var t=Q.createDocumentFragment(),e=t.appendChild(Q.createElement("div")),i=Q.createElement("input");i.setAttribute("type","radio"),i.setAttribute("checked","checked"),i.setAttribute("name","t"),e.appendChild(i),K.checkClone=e.cloneNode(!0).cloneNode(!0).lastChild.checked,e.innerHTML="<textarea>x</textarea>",K.noCloneChecked=!!e.cloneNode(!0).lastChild.defaultValue}();var Tt="undefined";K.focusinBubbles="onfocusin"in t;var Et=/^key/,It=/^(?:mouse|pointer|contextmenu)|click/,Ot=/^(?:focusinfocus|focusoutblur)$/,At=/^([^.]*)(?:\.(.+)|)$/;Z.event={global:{},add:function(t,e,i,s,n){var r,o,a,l,u,c,h,p,d,f,m,g=bt.get(t);if(g)for(i.handler&&(r=i,i=r.handler,n=r.selector),i.guid||(i.guid=Z.guid++),(l=g.events)||(l=g.events={}),(o=g.handle)||(o=g.handle=function(e){return typeof Z!==Tt&&Z.event.triggered!==e.type?Z.event.dispatch.apply(t,arguments):void 0}),e=(e||"").match(dt)||[""],u=e.length;u--;)a=At.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d&&(h=Z.event.special[d]||{},d=(n?h.delegateType:h.bindType)||d,h=Z.event.special[d]||{},c=Z.extend({type:d,origType:m,data:s,handler:i,guid:i.guid,selector:n,needsContext:n&&Z.expr.match.needsContext.test(n),namespace:f.join(".")},r),(p=l[d])||(p=l[d]=[],p.delegateCount=0,h.setup&&h.setup.call(t,s,f,o)!==!1||t.addEventListener&&t.addEventListener(d,o,!1)),h.add&&(h.add.call(t,c),c.handler.guid||(c.handler.guid=i.guid)),n?p.splice(p.delegateCount++,0,c):p.push(c),Z.event.global[d]=!0)},remove:function(t,e,i,s,n){var r,o,a,l,u,c,h,p,d,f,m,g=bt.hasData(t)&&bt.get(t);if(g&&(l=g.events)){for(e=(e||"").match(dt)||[""],u=e.length;u--;)if(a=At.exec(e[u])||[],d=m=a[1],f=(a[2]||"").split(".").sort(),d){for(h=Z.event.special[d]||{},d=(s?h.delegateType:h.bindType)||d,p=l[d]||[],a=a[2]&&new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"),o=r=p.length;r--;)c=p[r],!n&&m!==c.origType||i&&i.guid!==c.guid||a&&!a.test(c.namespace)||s&&s!==c.selector&&("**"!==s||!c.selector)||(p.splice(r,1),c.selector&&p.delegateCount--,h.remove&&h.remove.call(t,c));o&&!p.length&&(h.teardown&&h.teardown.call(t,f,g.handle)!==!1||Z.removeEvent(t,d,g.handle),delete l[d])}else for(d in l)Z.event.remove(t,d+e[u],i,s,!0);Z.isEmptyObject(l)&&(delete g.handle,bt.remove(t,"events"))}},trigger:function(e,i,s,n){var r,o,a,l,u,c,h,p=[s||Q],d=J.call(e,"type")?e.type:e,f=J.call(e,"namespace")?e.namespace.split("."):[];if(o=a=s=s||Q,3!==s.nodeType&&8!==s.nodeType&&!Ot.test(d+Z.event.triggered)&&(d.indexOf(".")>=0&&(f=d.split("."),d=f.shift(),f.sort()),u=d.indexOf(":")<0&&"on"+d,e=e[Z.expando]?e:new Z.Event(d,"object"==typeof e&&e),e.isTrigger=n?2:3,e.namespace=f.join("."),e.namespace_re=e.namespace?new RegExp("(^|\\.)"+f.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,e.result=void 0,e.target||(e.target=s),i=null==i?[e]:Z.makeArray(i,[e]),h=Z.event.special[d]||{},n||!h.trigger||h.trigger.apply(s,i)!==!1)){if(!n&&!h.noBubble&&!Z.isWindow(s)){for(l=h.delegateType||d,Ot.test(l+d)||(o=o.parentNode);o;o=o.parentNode)p.push(o),a=o;a===(s.ownerDocument||Q)&&p.push(a.defaultView||a.parentWindow||t)}for(r=0;(o=p[r++])&&!e.isPropagationStopped();)e.type=r>1?l:h.bindType||d,c=(bt.get(o,"events")||{})[e.type]&&bt.get(o,"handle"),c&&c.apply(o,i),c=u&&o[u],c&&c.apply&&Z.acceptData(o)&&(e.result=c.apply(o,i),e.result===!1&&e.preventDefault());return e.type=d,n||e.isDefaultPrevented()||h._default&&h._default.apply(p.pop(),i)!==!1||!Z.acceptData(s)||u&&Z.isFunction(s[d])&&!Z.isWindow(s)&&(a=s[u],a&&(s[u]=null),Z.event.triggered=d,s[d](),Z.event.triggered=void 0,a&&(s[u]=a)),e.result}},dispatch:function(t){t=Z.event.fix(t);var e,i,s,n,r,o=[],a=$.call(arguments),l=(bt.get(this,"events")||{})[t.type]||[],u=Z.event.special[t.type]||{};if(a[0]=t,t.delegateTarget=this,!u.preDispatch||u.preDispatch.call(this,t)!==!1){for(o=Z.event.handlers.call(this,t,l),e=0;(n=o[e++])&&!t.isPropagationStopped();)for(t.currentTarget=n.elem,i=0;(r=n.handlers[i++])&&!t.isImmediatePropagationStopped();)(!t.namespace_re||t.namespace_re.test(r.namespace))&&(t.handleObj=r,t.data=r.data,s=((Z.event.special[r.origType]||{}).handle||r.handler).apply(n.elem,a),void 0!==s&&(t.result=s)===!1&&(t.preventDefault(),t.stopPropagation()));return u.postDispatch&&u.postDispatch.call(this,t),t.result}},handlers:function(t,e){var i,s,n,r,o=[],a=e.delegateCount,l=t.target;if(a&&l.nodeType&&(!t.button||"click"!==t.type))for(;l!==this;l=l.parentNode||this)if(l.disabled!==!0||"click"!==t.type){for(s=[],i=0;a>i;i++)r=e[i],n=r.selector+" ",void 0===s[n]&&(s[n]=r.needsContext?Z(n,this).index(l)>=0:Z.find(n,this,null,[l]).length),s[n]&&s.push(r);s.length&&o.push({elem:l,handlers:s})}return a<e.length&&o.push({elem:this,handlers:e.slice(a)}),o},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(t,e){return null==t.which&&(t.which=null!=e.charCode?e.charCode:e.keyCode),t}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(t,e){var i,s,n,r=e.button;return null==t.pageX&&null!=e.clientX&&(i=t.target.ownerDocument||Q,s=i.documentElement,n=i.body,t.pageX=e.clientX+(s&&s.scrollLeft||n&&n.scrollLeft||0)-(s&&s.clientLeft||n&&n.clientLeft||0),t.pageY=e.clientY+(s&&s.scrollTop||n&&n.scrollTop||0)-(s&&s.clientTop||n&&n.clientTop||0)),t.which||void 0===r||(t.which=1&r?1:2&r?3:4&r?2:0),t}},fix:function(t){if(t[Z.expando])return t;var e,i,s,n=t.type,r=t,o=this.fixHooks[n];for(o||(this.fixHooks[n]=o=It.test(n)?this.mouseHooks:Et.test(n)?this.keyHooks:{}),s=o.props?this.props.concat(o.props):this.props,t=new Z.Event(r),e=s.length;e--;)i=s[e],t[i]=r[i];return t.target||(t.target=Q),3===t.target.nodeType&&(t.target=t.target.parentNode),o.filter?o.filter(t,r):t},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==h()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===h()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&Z.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(t){return Z.nodeName(t.target,"a")}},beforeunload:{postDispatch:function(t){void 0!==t.result&&t.originalEvent&&(t.originalEvent.returnValue=t.result)}}},simulate:function(t,e,i,s){var n=Z.extend(new Z.Event,i,{type:t,isSimulated:!0,originalEvent:{}});s?Z.event.trigger(n,null,e):Z.event.dispatch.call(e,n),n.isDefaultPrevented()&&i.preventDefault()}},Z.removeEvent=function(t,e,i){t.removeEventListener&&t.removeEventListener(e,i,!1)},Z.Event=function(t,e){return this instanceof Z.Event?(t&&t.type?(this.originalEvent=t,this.type=t.type,this.isDefaultPrevented=t.defaultPrevented||void 0===t.defaultPrevented&&t.returnValue===!1?u:c):this.type=t,e&&Z.extend(this,e),this.timeStamp=t&&t.timeStamp||Z.now(),void(this[Z.expando]=!0)):new Z.Event(t,e)},Z.Event.prototype={isDefaultPrevented:c,isPropagationStopped:c,isImmediatePropagationStopped:c,preventDefault:function(){var t=this.originalEvent;this.isDefaultPrevented=u,t&&t.preventDefault&&t.preventDefault()},stopPropagation:function(){var t=this.originalEvent;this.isPropagationStopped=u,t&&t.stopPropagation&&t.stopPropagation()},stopImmediatePropagation:function(){var t=this.originalEvent;this.isImmediatePropagationStopped=u,t&&t.stopImmediatePropagation&&t.stopImmediatePropagation(),this.stopPropagation()}},Z.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(t,e){Z.event.special[t]={delegateType:e,bindType:e,handle:function(t){var i,s=this,n=t.relatedTarget,r=t.handleObj;return(!n||n!==s&&!Z.contains(s,n))&&(t.type=r.origType,i=r.handler.apply(this,arguments),t.type=e),i}}}),K.focusinBubbles||Z.each({focus:"focusin",blur:"focusout"},function(t,e){var i=function(t){Z.event.simulate(e,t.target,Z.event.fix(t),!0)};Z.event.special[e]={setup:function(){var s=this.ownerDocument||this,n=bt.access(s,e);n||s.addEventListener(t,i,!0),bt.access(s,e,(n||0)+1)},teardown:function(){var s=this.ownerDocument||this,n=bt.access(s,e)-1;n?bt.access(s,e,n):(s.removeEventListener(t,i,!0),bt.remove(s,e))}}}),Z.fn.extend({on:function(t,e,i,s,n){var r,o;if("object"==typeof t){"string"!=typeof e&&(i=i||e,e=void 0);for(o in t)this.on(o,e,i,t[o],n);return this}if(null==i&&null==s?(s=e,i=e=void 0):null==s&&("string"==typeof e?(s=i,i=void 0):(s=i,i=e,e=void 0)),s===!1)s=c;else if(!s)return this;return 1===n&&(r=s,s=function(t){return Z().off(t),r.apply(this,arguments)},s.guid=r.guid||(r.guid=Z.guid++)),this.each(function(){Z.event.add(this,t,s,i,e)})},one:function(t,e,i,s){return this.on(t,e,i,s,1)},off:function(t,e,i){var s,n;if(t&&t.preventDefault&&t.handleObj)return s=t.handleObj,Z(t.delegateTarget).off(s.namespace?s.origType+"."+s.namespace:s.origType,s.selector,s.handler),this;if("object"==typeof t){for(n in t)this.off(n,e,t[n]);return this}return(e===!1||"function"==typeof e)&&(i=e,e=void 0),i===!1&&(i=c),this.each(function(){Z.event.remove(this,t,i,e)})},trigger:function(t,e){return this.each(function(){Z.event.trigger(t,e,this)})},triggerHandler:function(t,e){var i=this[0];return i?Z.event.trigger(t,e,i,!0):void 0}});var Nt=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,kt=/<([\w:]+)/,Pt=/<|&#?\w+;/,Dt=/<(?:script|style|link)/i,Rt=/checked\s*(?:[^=]|=\s*.checked.)/i,Lt=/^$|\/(?:java|ecma)script/i,jt=/^true\/(.*)/,Mt=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Ft={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};Ft.optgroup=Ft.option,Ft.tbody=Ft.tfoot=Ft.colgroup=Ft.caption=Ft.thead,Ft.th=Ft.td,Z.extend({clone:function(t,e,i){var s,n,r,o,a=t.cloneNode(!0),l=Z.contains(t.ownerDocument,t);if(!(K.noCloneChecked||1!==t.nodeType&&11!==t.nodeType||Z.isXMLDoc(t)))for(o=b(a),r=b(t),s=0,n=r.length;n>s;s++)v(r[s],o[s]);if(e)if(i)for(r=r||b(t),o=o||b(a),s=0,n=r.length;n>s;s++)g(r[s],o[s]);else g(t,a);return o=b(a,"script"),o.length>0&&m(o,!l&&b(t,"script")),a},buildFragment:function(t,e,i,s){for(var n,r,o,a,l,u,c=e.createDocumentFragment(),h=[],p=0,d=t.length;d>p;p++)if(n=t[p],n||0===n)if("object"===Z.type(n))Z.merge(h,n.nodeType?[n]:n);else if(Pt.test(n)){for(r=r||c.appendChild(e.createElement("div")),o=(kt.exec(n)||["",""])[1].toLowerCase(),a=Ft[o]||Ft._default,r.innerHTML=a[1]+n.replace(Nt,"<$1></$2>")+a[2],u=a[0];u--;)r=r.lastChild;Z.merge(h,r.childNodes),r=c.firstChild,r.textContent=""}else h.push(e.createTextNode(n));for(c.textContent="",p=0;n=h[p++];)if((!s||-1===Z.inArray(n,s))&&(l=Z.contains(n.ownerDocument,n),r=b(c.appendChild(n),"script"),l&&m(r),i))for(u=0;n=r[u++];)Lt.test(n.type||"")&&i.push(n);return c},cleanData:function(t){for(var e,i,s,n,r=Z.event.special,o=0;void 0!==(i=t[o]);o++){if(Z.acceptData(i)&&(n=i[bt.expando],n&&(e=bt.cache[n]))){if(e.events)for(s in e.events)r[s]?Z.event.remove(i,s):Z.removeEvent(i,s,e.handle);bt.cache[n]&&delete bt.cache[n]}delete vt.cache[i[vt.expando]]}}}),Z.fn.extend({text:function(t){return gt(this,function(t){return void 0===t?Z.text(this):this.empty().each(function(){(1===this.nodeType||11===this.nodeType||9===this.nodeType)&&(this.textContent=t)})},null,t,arguments.length)},append:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=p(this,t);e.appendChild(t)}})},prepend:function(){return this.domManip(arguments,function(t){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var e=p(this,t);e.insertBefore(t,e.firstChild)}})},before:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this)})},after:function(){return this.domManip(arguments,function(t){this.parentNode&&this.parentNode.insertBefore(t,this.nextSibling)})},remove:function(t,e){for(var i,s=t?Z.filter(t,this):this,n=0;null!=(i=s[n]);n++)e||1!==i.nodeType||Z.cleanData(b(i)),i.parentNode&&(e&&Z.contains(i.ownerDocument,i)&&m(b(i,"script")),i.parentNode.removeChild(i));return this},empty:function(){for(var t,e=0;null!=(t=this[e]);e++)1===t.nodeType&&(Z.cleanData(b(t,!1)),t.textContent="");return this},clone:function(t,e){return t=null==t?!1:t,e=null==e?t:e,this.map(function(){return Z.clone(this,t,e)})},html:function(t){return gt(this,function(t){var e=this[0]||{},i=0,s=this.length;if(void 0===t&&1===e.nodeType)return e.innerHTML;if("string"==typeof t&&!Dt.test(t)&&!Ft[(kt.exec(t)||["",""])[1].toLowerCase()]){t=t.replace(Nt,"<$1></$2>");try{for(;s>i;i++)e=this[i]||{},1===e.nodeType&&(Z.cleanData(b(e,!1)),e.innerHTML=t);e=0}catch(n){}}e&&this.empty().append(t)},null,t,arguments.length)},replaceWith:function(){var t=arguments[0];return this.domManip(arguments,function(e){t=this.parentNode,Z.cleanData(b(this)),t&&t.replaceChild(e,this)}),t&&(t.length||t.nodeType)?this:this.remove()},detach:function(t){return this.remove(t,!0)},domManip:function(t,e){t=z.apply([],t);var i,s,n,r,o,a,l=0,u=this.length,c=this,h=u-1,p=t[0],m=Z.isFunction(p);if(m||u>1&&"string"==typeof p&&!K.checkClone&&Rt.test(p))return this.each(function(i){var s=c.eq(i);m&&(t[0]=p.call(this,i,s.html())),s.domManip(t,e)});if(u&&(i=Z.buildFragment(t,this[0].ownerDocument,!1,this),s=i.firstChild,1===i.childNodes.length&&(i=s),s)){for(n=Z.map(b(i,"script"),d),r=n.length;u>l;l++)o=i,l!==h&&(o=Z.clone(o,!0,!0),r&&Z.merge(n,b(o,"script"))),e.call(this[l],o,l);if(r)for(a=n[n.length-1].ownerDocument,Z.map(n,f),l=0;r>l;l++)o=n[l],Lt.test(o.type||"")&&!bt.access(o,"globalEval")&&Z.contains(a,o)&&(o.src?Z._evalUrl&&Z._evalUrl(o.src):Z.globalEval(o.textContent.replace(Mt,"")))}return this}}),Z.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(t,e){Z.fn[t]=function(t){for(var i,s=[],n=Z(t),r=n.length-1,o=0;r>=o;o++)i=o===r?this:this.clone(!0),Z(n[o])[e](i),V.apply(s,i.get());return this.pushStack(s)}});var Bt,qt={},Ut=/^margin/,Ht=new RegExp("^("+xt+")(?!px)[a-z%]+$","i"),$t=function(e){return e.ownerDocument.defaultView.opener?e.ownerDocument.defaultView.getComputedStyle(e,null):t.getComputedStyle(e,null)};!function(){function e(){o.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:block;margin-top:1%;top:1%;border:1px;padding:1px;width:4px;position:absolute",o.innerHTML="",n.appendChild(r);var e=t.getComputedStyle(o,null);i="1%"!==e.top,s="4px"===e.width,n.removeChild(r)}var i,s,n=Q.documentElement,r=Q.createElement("div"),o=Q.createElement("div");o.style&&(o.style.backgroundClip="content-box",o.cloneNode(!0).style.backgroundClip="",K.clearCloneStyle="content-box"===o.style.backgroundClip,r.style.cssText="border:0;width:0;height:0;top:0;left:-9999px;margin-top:1px;position:absolute",r.appendChild(o),t.getComputedStyle&&Z.extend(K,{pixelPosition:function(){return e(),i},boxSizingReliable:function(){return null==s&&e(),s},reliableMarginRight:function(){var e,i=o.appendChild(Q.createElement("div"));return i.style.cssText=o.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",i.style.marginRight=i.style.width="0",o.style.width="1px",n.appendChild(r),e=!parseFloat(t.getComputedStyle(i,null).marginRight),n.removeChild(r),o.removeChild(i),e}}))}(),Z.swap=function(t,e,i,s){var n,r,o={};for(r in e)o[r]=t.style[r],t.style[r]=e[r];n=i.apply(t,s||[]);for(r in e)t.style[r]=o[r];return n};var zt=/^(none|table(?!-c[ea]).+)/,Vt=new RegExp("^("+xt+")(.*)$","i"),Gt=new RegExp("^([+-])=("+xt+")","i"),Wt={position:"absolute",visibility:"hidden",display:"block"},Xt={letterSpacing:"0",fontWeight:"400"},Jt=["Webkit","O","Moz","ms"];Z.extend({cssHooks:{opacity:{get:function(t,e){if(e){var i=x(t,"opacity");return""===i?"1":i}}}},cssNumber:{columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(t,e,i,s){if(t&&3!==t.nodeType&&8!==t.nodeType&&t.style){var n,r,o,a=Z.camelCase(e),l=t.style;return e=Z.cssProps[a]||(Z.cssProps[a]=w(l,a)),o=Z.cssHooks[e]||Z.cssHooks[a],void 0===i?o&&"get"in o&&void 0!==(n=o.get(t,!1,s))?n:l[e]:(r=typeof i,"string"===r&&(n=Gt.exec(i))&&(i=(n[1]+1)*n[2]+parseFloat(Z.css(t,e)),r="number"),null!=i&&i===i&&("number"!==r||Z.cssNumber[a]||(i+="px"),K.clearCloneStyle||""!==i||0!==e.indexOf("background")||(l[e]="inherit"),o&&"set"in o&&void 0===(i=o.set(t,i,s))||(l[e]=i)),void 0)}},css:function(t,e,i,s){var n,r,o,a=Z.camelCase(e);return e=Z.cssProps[a]||(Z.cssProps[a]=w(t.style,a)),o=Z.cssHooks[e]||Z.cssHooks[a],o&&"get"in o&&(n=o.get(t,!0,i)),void 0===n&&(n=x(t,e,s)),"normal"===n&&e in Xt&&(n=Xt[e]),""===i||i?(r=parseFloat(n),i===!0||Z.isNumeric(r)?r||0:n):n}}),Z.each(["height","width"],function(t,e){Z.cssHooks[e]={get:function(t,i,s){return i?zt.test(Z.css(t,"display"))&&0===t.offsetWidth?Z.swap(t,Wt,function(){return E(t,e,s)}):E(t,e,s):void 0},set:function(t,i,s){var n=s&&$t(t);return S(t,i,s?T(t,e,s,"border-box"===Z.css(t,"boxSizing",!1,n),n):0)}}}),Z.cssHooks.marginRight=C(K.reliableMarginRight,function(t,e){return e?Z.swap(t,{display:"inline-block"},x,[t,"marginRight"]):void 0}),Z.each({margin:"",padding:"",border:"Width"},function(t,e){Z.cssHooks[t+e]={expand:function(i){for(var s=0,n={},r="string"==typeof i?i.split(" "):[i];4>s;s++)n[t+Ct[s]+e]=r[s]||r[s-2]||r[0];return n}},Ut.test(t)||(Z.cssHooks[t+e].set=S)}),Z.fn.extend({css:function(t,e){return gt(this,function(t,e,i){var s,n,r={},o=0;if(Z.isArray(e)){for(s=$t(t),n=e.length;n>o;o++)r[e[o]]=Z.css(t,e[o],!1,s);return r}return void 0!==i?Z.style(t,e,i):Z.css(t,e)},t,e,arguments.length>1)},show:function(){return I(this,!0)},hide:function(){return I(this)},toggle:function(t){return"boolean"==typeof t?t?this.show():this.hide():this.each(function(){wt(this)?Z(this).show():Z(this).hide()})}}),Z.Tween=O,O.prototype={constructor:O,init:function(t,e,i,s,n,r){this.elem=t,this.prop=i,this.easing=n||"swing",this.options=e,this.start=this.now=this.cur(),this.end=s,this.unit=r||(Z.cssNumber[i]?"":"px")},cur:function(){var t=O.propHooks[this.prop];return t&&t.get?t.get(this):O.propHooks._default.get(this)},run:function(t){var e,i=O.propHooks[this.prop];return this.options.duration?this.pos=e=Z.easing[this.easing](t,this.options.duration*t,0,1,this.options.duration):this.pos=e=t,this.now=(this.end-this.start)*e+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),i&&i.set?i.set(this):O.propHooks._default.set(this),this}},O.prototype.init.prototype=O.prototype,O.propHooks={_default:{get:function(t){var e;return null==t.elem[t.prop]||t.elem.style&&null!=t.elem.style[t.prop]?(e=Z.css(t.elem,t.prop,""),e&&"auto"!==e?e:0):t.elem[t.prop]},set:function(t){Z.fx.step[t.prop]?Z.fx.step[t.prop](t):t.elem.style&&(null!=t.elem.style[Z.cssProps[t.prop]]||Z.cssHooks[t.prop])?Z.style(t.elem,t.prop,t.now+t.unit):t.elem[t.prop]=t.now}}},O.propHooks.scrollTop=O.propHooks.scrollLeft={set:function(t){t.elem.nodeType&&t.elem.parentNode&&(t.elem[t.prop]=t.now)}},Z.easing={linear:function(t){return t},swing:function(t){return.5-Math.cos(t*Math.PI)/2}},Z.fx=O.prototype.init,Z.fx.step={};var Kt,Qt,Yt=/^(?:toggle|show|hide)$/,Zt=new RegExp("^(?:([+-])=|)("+xt+")([a-z%]*)$","i"),te=/queueHooks$/,ee=[P],ie={"*":[function(t,e){var i=this.createTween(t,e),s=i.cur(),n=Zt.exec(e),r=n&&n[3]||(Z.cssNumber[t]?"":"px"),o=(Z.cssNumber[t]||"px"!==r&&+s)&&Zt.exec(Z.css(i.elem,t)),a=1,l=20;if(o&&o[3]!==r){r=r||o[3],n=n||[],o=+s||1;do a=a||".5",o/=a,Z.style(i.elem,t,o+r);while(a!==(a=i.cur()/s)&&1!==a&&--l)}return n&&(o=i.start=+o||+s||0,i.unit=r,i.end=n[1]?o+(n[1]+1)*n[2]:+n[2]),i}]};Z.Animation=Z.extend(R,{tweener:function(t,e){Z.isFunction(t)?(e=t,t=["*"]):t=t.split(" ");for(var i,s=0,n=t.length;n>s;s++)i=t[s],ie[i]=ie[i]||[],ie[i].unshift(e)},prefilter:function(t,e){e?ee.unshift(t):ee.push(t)}}),Z.speed=function(t,e,i){var s=t&&"object"==typeof t?Z.extend({},t):{complete:i||!i&&e||Z.isFunction(t)&&t,duration:t,easing:i&&e||e&&!Z.isFunction(e)&&e};return s.duration=Z.fx.off?0:"number"==typeof s.duration?s.duration:s.duration in Z.fx.speeds?Z.fx.speeds[s.duration]:Z.fx.speeds._default,(null==s.queue||s.queue===!0)&&(s.queue="fx"),s.old=s.complete,s.complete=function(){Z.isFunction(s.old)&&s.old.call(this),s.queue&&Z.dequeue(this,s.queue)},s},Z.fn.extend({fadeTo:function(t,e,i,s){return this.filter(wt).css("opacity",0).show().end().animate({opacity:e},t,i,s)},animate:function(t,e,i,s){var n=Z.isEmptyObject(t),r=Z.speed(e,i,s),o=function(){var e=R(this,Z.extend({},t),r);(n||bt.get(this,"finish"))&&e.stop(!0)};return o.finish=o,n||r.queue===!1?this.each(o):this.queue(r.queue,o)},stop:function(t,e,i){var s=function(t){var e=t.stop;delete t.stop,e(i)};return"string"!=typeof t&&(i=e,e=t,t=void 0),e&&t!==!1&&this.queue(t||"fx",[]),this.each(function(){var e=!0,n=null!=t&&t+"queueHooks",r=Z.timers,o=bt.get(this);if(n)o[n]&&o[n].stop&&s(o[n]);else for(n in o)o[n]&&o[n].stop&&te.test(n)&&s(o[n]);for(n=r.length;n--;)r[n].elem!==this||null!=t&&r[n].queue!==t||(r[n].anim.stop(i),e=!1,r.splice(n,1));(e||!i)&&Z.dequeue(this,t)})},finish:function(t){return t!==!1&&(t=t||"fx"),this.each(function(){var e,i=bt.get(this),s=i[t+"queue"],n=i[t+"queueHooks"],r=Z.timers,o=s?s.length:0;for(i.finish=!0,Z.queue(this,t,[]),n&&n.stop&&n.stop.call(this,!0),e=r.length;e--;)r[e].elem===this&&r[e].queue===t&&(r[e].anim.stop(!0),r.splice(e,1));for(e=0;o>e;e++)s[e]&&s[e].finish&&s[e].finish.call(this);delete i.finish})}}),Z.each(["toggle","show","hide"],function(t,e){var i=Z.fn[e];Z.fn[e]=function(t,s,n){return null==t||"boolean"==typeof t?i.apply(this,arguments):this.animate(N(e,!0),t,s,n)}}),Z.each({slideDown:N("show"),slideUp:N("hide"),slideToggle:N("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(t,e){Z.fn[t]=function(t,i,s){return this.animate(e,t,i,s)}}),Z.timers=[],Z.fx.tick=function(){var t,e=0,i=Z.timers;for(Kt=Z.now();e<i.length;e++)t=i[e],t()||i[e]!==t||i.splice(e--,1);i.length||Z.fx.stop(),Kt=void 0},Z.fx.timer=function(t){Z.timers.push(t),t()?Z.fx.start():Z.timers.pop()},Z.fx.interval=13,Z.fx.start=function(){Qt||(Qt=setInterval(Z.fx.tick,Z.fx.interval))},Z.fx.stop=function(){clearInterval(Qt),Qt=null},Z.fx.speeds={slow:600,fast:200,_default:400},Z.fn.delay=function(t,e){return t=Z.fx?Z.fx.speeds[t]||t:t,e=e||"fx",this.queue(e,function(e,i){var s=setTimeout(e,t);i.stop=function(){clearTimeout(s)}})},function(){var t=Q.createElement("input"),e=Q.createElement("select"),i=e.appendChild(Q.createElement("option"));t.type="checkbox",K.checkOn=""!==t.value,K.optSelected=i.selected,e.disabled=!0,K.optDisabled=!i.disabled,t=Q.createElement("input"),t.value="t",t.type="radio",K.radioValue="t"===t.value}();var se,ne,re=Z.expr.attrHandle;Z.fn.extend({attr:function(t,e){return gt(this,Z.attr,t,e,arguments.length>1)},removeAttr:function(t){return this.each(function(){Z.removeAttr(this,t)})}}),Z.extend({attr:function(t,e,i){var s,n,r=t.nodeType;if(t&&3!==r&&8!==r&&2!==r)return typeof t.getAttribute===Tt?Z.prop(t,e,i):(1===r&&Z.isXMLDoc(t)||(e=e.toLowerCase(),s=Z.attrHooks[e]||(Z.expr.match.bool.test(e)?ne:se)),void 0===i?s&&"get"in s&&null!==(n=s.get(t,e))?n:(n=Z.find.attr(t,e),null==n?void 0:n):null!==i?s&&"set"in s&&void 0!==(n=s.set(t,i,e))?n:(t.setAttribute(e,i+""),i):void Z.removeAttr(t,e))},removeAttr:function(t,e){var i,s,n=0,r=e&&e.match(dt);if(r&&1===t.nodeType)for(;i=r[n++];)s=Z.propFix[i]||i,Z.expr.match.bool.test(i)&&(t[s]=!1),t.removeAttribute(i)},attrHooks:{type:{set:function(t,e){if(!K.radioValue&&"radio"===e&&Z.nodeName(t,"input")){var i=t.value;return t.setAttribute("type",e),i&&(t.value=i),e}}}}}),ne={set:function(t,e,i){return e===!1?Z.removeAttr(t,i):t.setAttribute(i,i),i}},Z.each(Z.expr.match.bool.source.match(/\w+/g),function(t,e){var i=re[e]||Z.find.attr;re[e]=function(t,e,s){var n,r;return s||(r=re[e],re[e]=n,n=null!=i(t,e,s)?e.toLowerCase():null,re[e]=r),n}});var oe=/^(?:input|select|textarea|button)$/i;Z.fn.extend({prop:function(t,e){return gt(this,Z.prop,t,e,arguments.length>1)},removeProp:function(t){return this.each(function(){delete this[Z.propFix[t]||t]})}}),Z.extend({propFix:{"for":"htmlFor","class":"className"},prop:function(t,e,i){var s,n,r,o=t.nodeType;if(t&&3!==o&&8!==o&&2!==o)return r=1!==o||!Z.isXMLDoc(t),r&&(e=Z.propFix[e]||e,n=Z.propHooks[e]),void 0!==i?n&&"set"in n&&void 0!==(s=n.set(t,i,e))?s:t[e]=i:n&&"get"in n&&null!==(s=n.get(t,e))?s:t[e]},propHooks:{tabIndex:{get:function(t){return t.hasAttribute("tabindex")||oe.test(t.nodeName)||t.href?t.tabIndex:-1}}}}),K.optSelected||(Z.propHooks.selected={get:function(t){var e=t.parentNode;return e&&e.parentNode&&e.parentNode.selectedIndex,null}}),Z.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){Z.propFix[this.toLowerCase()]=this});var ae=/[\t\r\n\f]/g;Z.fn.extend({addClass:function(t){var e,i,s,n,r,o,a="string"==typeof t&&t,l=0,u=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).addClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(dt)||[];u>l;l++)if(i=this[l],s=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(ae," "):" ")){for(r=0;n=e[r++];)s.indexOf(" "+n+" ")<0&&(s+=n+" ");o=Z.trim(s),i.className!==o&&(i.className=o)}return this},removeClass:function(t){var e,i,s,n,r,o,a=0===arguments.length||"string"==typeof t&&t,l=0,u=this.length;if(Z.isFunction(t))return this.each(function(e){Z(this).removeClass(t.call(this,e,this.className))});if(a)for(e=(t||"").match(dt)||[];u>l;l++)if(i=this[l],s=1===i.nodeType&&(i.className?(" "+i.className+" ").replace(ae," "):"")){for(r=0;n=e[r++];)for(;s.indexOf(" "+n+" ")>=0;)s=s.replace(" "+n+" "," ");o=t?Z.trim(s):"",i.className!==o&&(i.className=o)}return this},toggleClass:function(t,e){var i=typeof t;return"boolean"==typeof e&&"string"===i?e?this.addClass(t):this.removeClass(t):Z.isFunction(t)?this.each(function(i){Z(this).toggleClass(t.call(this,i,this.className,e),e)}):this.each(function(){if("string"===i)for(var e,s=0,n=Z(this),r=t.match(dt)||[];e=r[s++];)n.hasClass(e)?n.removeClass(e):n.addClass(e);else(i===Tt||"boolean"===i)&&(this.className&&bt.set(this,"__className__",this.className),this.className=this.className||t===!1?"":bt.get(this,"__className__")||"")})},hasClass:function(t){for(var e=" "+t+" ",i=0,s=this.length;s>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(ae," ").indexOf(e)>=0)return!0;return!1}});var le=/\r/g;Z.fn.extend({val:function(t){var e,i,s,n=this[0];{if(arguments.length)return s=Z.isFunction(t),this.each(function(i){var n;1===this.nodeType&&(n=s?t.call(this,i,Z(this).val()):t,null==n?n="":"number"==typeof n?n+="":Z.isArray(n)&&(n=Z.map(n,function(t){return null==t?"":t+""})),e=Z.valHooks[this.type]||Z.valHooks[this.nodeName.toLowerCase()],e&&"set"in e&&void 0!==e.set(this,n,"value")||(this.value=n))});if(n)return e=Z.valHooks[n.type]||Z.valHooks[n.nodeName.toLowerCase()],e&&"get"in e&&void 0!==(i=e.get(n,"value"))?i:(i=n.value,"string"==typeof i?i.replace(le,""):null==i?"":i)}}}),Z.extend({valHooks:{option:{get:function(t){var e=Z.find.attr(t,"value");return null!=e?e:Z.trim(Z.text(t))}},select:{get:function(t){for(var e,i,s=t.options,n=t.selectedIndex,r="select-one"===t.type||0>n,o=r?null:[],a=r?n+1:s.length,l=0>n?a:r?n:0;a>l;l++)if(i=s[l],(i.selected||l===n)&&(K.optDisabled?!i.disabled:null===i.getAttribute("disabled"))&&(!i.parentNode.disabled||!Z.nodeName(i.parentNode,"optgroup"))){if(e=Z(i).val(),r)return e;o.push(e)}return o},set:function(t,e){for(var i,s,n=t.options,r=Z.makeArray(e),o=n.length;o--;)s=n[o],(s.selected=Z.inArray(s.value,r)>=0)&&(i=!0);return i||(t.selectedIndex=-1),r}}}}),Z.each(["radio","checkbox"],function(){Z.valHooks[this]={set:function(t,e){return Z.isArray(e)?t.checked=Z.inArray(Z(t).val(),e)>=0:void 0}},K.checkOn||(Z.valHooks[this].get=function(t){return null===t.getAttribute("value")?"on":t.value})}),Z.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(t,e){Z.fn[e]=function(t,i){return arguments.length>0?this.on(e,null,t,i):this.trigger(e)}}),Z.fn.extend({hover:function(t,e){return this.mouseenter(t).mouseleave(e||t)},bind:function(t,e,i){return this.on(t,null,e,i)},unbind:function(t,e){return this.off(t,null,e);
},delegate:function(t,e,i,s){return this.on(e,t,i,s)},undelegate:function(t,e,i){return 1===arguments.length?this.off(t,"**"):this.off(e,t||"**",i)}});var ue=Z.now(),ce=/\?/;Z.parseJSON=function(t){return JSON.parse(t+"")},Z.parseXML=function(t){var e,i;if(!t||"string"!=typeof t)return null;try{i=new DOMParser,e=i.parseFromString(t,"text/xml")}catch(s){e=void 0}return(!e||e.getElementsByTagName("parsererror").length)&&Z.error("Invalid XML: "+t),e};var he=/#.*$/,pe=/([?&])_=[^&]*/,de=/^(.*?):[ \t]*([^\r\n]*)$/gm,fe=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,me=/^(?:GET|HEAD)$/,ge=/^\/\//,be=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,ve={},ye={},_e="*/".concat("*"),xe=t.location.href,Ce=be.exec(xe.toLowerCase())||[];Z.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:xe,type:"GET",isLocal:fe.test(Ce[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":_e,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":Z.parseJSON,"text xml":Z.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(t,e){return e?M(M(t,Z.ajaxSettings),e):M(Z.ajaxSettings,t)},ajaxPrefilter:L(ve),ajaxTransport:L(ye),ajax:function(t,e){function i(t,e,i,o){var l,c,b,v,_,C=e;2!==y&&(y=2,a&&clearTimeout(a),s=void 0,r=o||"",x.readyState=t>0?4:0,l=t>=200&&300>t||304===t,i&&(v=F(h,x,i)),v=B(h,v,x,l),l?(h.ifModified&&(_=x.getResponseHeader("Last-Modified"),_&&(Z.lastModified[n]=_),_=x.getResponseHeader("etag"),_&&(Z.etag[n]=_)),204===t||"HEAD"===h.type?C="nocontent":304===t?C="notmodified":(C=v.state,c=v.data,b=v.error,l=!b)):(b=C,(t||!C)&&(C="error",0>t&&(t=0))),x.status=t,x.statusText=(e||C)+"",l?f.resolveWith(p,[c,C,x]):f.rejectWith(p,[x,C,b]),x.statusCode(g),g=void 0,u&&d.trigger(l?"ajaxSuccess":"ajaxError",[x,h,l?c:b]),m.fireWith(p,[x,C]),u&&(d.trigger("ajaxComplete",[x,h]),--Z.active||Z.event.trigger("ajaxStop")))}"object"==typeof t&&(e=t,t=void 0),e=e||{};var s,n,r,o,a,l,u,c,h=Z.ajaxSetup({},e),p=h.context||h,d=h.context&&(p.nodeType||p.jquery)?Z(p):Z.event,f=Z.Deferred(),m=Z.Callbacks("once memory"),g=h.statusCode||{},b={},v={},y=0,_="canceled",x={readyState:0,getResponseHeader:function(t){var e;if(2===y){if(!o)for(o={};e=de.exec(r);)o[e[1].toLowerCase()]=e[2];e=o[t.toLowerCase()]}return null==e?null:e},getAllResponseHeaders:function(){return 2===y?r:null},setRequestHeader:function(t,e){var i=t.toLowerCase();return y||(t=v[i]=v[i]||t,b[t]=e),this},overrideMimeType:function(t){return y||(h.mimeType=t),this},statusCode:function(t){var e;if(t)if(2>y)for(e in t)g[e]=[g[e],t[e]];else x.always(t[x.status]);return this},abort:function(t){var e=t||_;return s&&s.abort(e),i(0,e),this}};if(f.promise(x).complete=m.add,x.success=x.done,x.error=x.fail,h.url=((t||h.url||xe)+"").replace(he,"").replace(ge,Ce[1]+"//"),h.type=e.method||e.type||h.method||h.type,h.dataTypes=Z.trim(h.dataType||"*").toLowerCase().match(dt)||[""],null==h.crossDomain&&(l=be.exec(h.url.toLowerCase()),h.crossDomain=!(!l||l[1]===Ce[1]&&l[2]===Ce[2]&&(l[3]||("http:"===l[1]?"80":"443"))===(Ce[3]||("http:"===Ce[1]?"80":"443")))),h.data&&h.processData&&"string"!=typeof h.data&&(h.data=Z.param(h.data,h.traditional)),j(ve,h,e,x),2===y)return x;u=Z.event&&h.global,u&&0===Z.active++&&Z.event.trigger("ajaxStart"),h.type=h.type.toUpperCase(),h.hasContent=!me.test(h.type),n=h.url,h.hasContent||(h.data&&(n=h.url+=(ce.test(n)?"&":"?")+h.data,delete h.data),h.cache===!1&&(h.url=pe.test(n)?n.replace(pe,"$1_="+ue++):n+(ce.test(n)?"&":"?")+"_="+ue++)),h.ifModified&&(Z.lastModified[n]&&x.setRequestHeader("If-Modified-Since",Z.lastModified[n]),Z.etag[n]&&x.setRequestHeader("If-None-Match",Z.etag[n])),(h.data&&h.hasContent&&h.contentType!==!1||e.contentType)&&x.setRequestHeader("Content-Type",h.contentType),x.setRequestHeader("Accept",h.dataTypes[0]&&h.accepts[h.dataTypes[0]]?h.accepts[h.dataTypes[0]]+("*"!==h.dataTypes[0]?", "+_e+"; q=0.01":""):h.accepts["*"]);for(c in h.headers)x.setRequestHeader(c,h.headers[c]);if(h.beforeSend&&(h.beforeSend.call(p,x,h)===!1||2===y))return x.abort();_="abort";for(c in{success:1,error:1,complete:1})x[c](h[c]);if(s=j(ye,h,e,x)){x.readyState=1,u&&d.trigger("ajaxSend",[x,h]),h.async&&h.timeout>0&&(a=setTimeout(function(){x.abort("timeout")},h.timeout));try{y=1,s.send(b,i)}catch(C){if(!(2>y))throw C;i(-1,C)}}else i(-1,"No Transport");return x},getJSON:function(t,e,i){return Z.get(t,e,i,"json")},getScript:function(t,e){return Z.get(t,void 0,e,"script")}}),Z.each(["get","post"],function(t,e){Z[e]=function(t,i,s,n){return Z.isFunction(i)&&(n=n||s,s=i,i=void 0),Z.ajax({url:t,type:e,dataType:n,data:i,success:s})}}),Z._evalUrl=function(t){return Z.ajax({url:t,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})},Z.fn.extend({wrapAll:function(t){var e;return Z.isFunction(t)?this.each(function(e){Z(this).wrapAll(t.call(this,e))}):(this[0]&&(e=Z(t,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&e.insertBefore(this[0]),e.map(function(){for(var t=this;t.firstElementChild;)t=t.firstElementChild;return t}).append(this)),this)},wrapInner:function(t){return Z.isFunction(t)?this.each(function(e){Z(this).wrapInner(t.call(this,e))}):this.each(function(){var e=Z(this),i=e.contents();i.length?i.wrapAll(t):e.append(t)})},wrap:function(t){var e=Z.isFunction(t);return this.each(function(i){Z(this).wrapAll(e?t.call(this,i):t)})},unwrap:function(){return this.parent().each(function(){Z.nodeName(this,"body")||Z(this).replaceWith(this.childNodes)}).end()}}),Z.expr.filters.hidden=function(t){return t.offsetWidth<=0&&t.offsetHeight<=0},Z.expr.filters.visible=function(t){return!Z.expr.filters.hidden(t)};var we=/%20/g,Se=/\[\]$/,Te=/\r?\n/g,Ee=/^(?:submit|button|image|reset|file)$/i,Ie=/^(?:input|select|textarea|keygen)/i;Z.param=function(t,e){var i,s=[],n=function(t,e){e=Z.isFunction(e)?e():null==e?"":e,s[s.length]=encodeURIComponent(t)+"="+encodeURIComponent(e)};if(void 0===e&&(e=Z.ajaxSettings&&Z.ajaxSettings.traditional),Z.isArray(t)||t.jquery&&!Z.isPlainObject(t))Z.each(t,function(){n(this.name,this.value)});else for(i in t)q(i,t[i],e,n);return s.join("&").replace(we,"+")},Z.fn.extend({serialize:function(){return Z.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var t=Z.prop(this,"elements");return t?Z.makeArray(t):this}).filter(function(){var t=this.type;return this.name&&!Z(this).is(":disabled")&&Ie.test(this.nodeName)&&!Ee.test(t)&&(this.checked||!St.test(t))}).map(function(t,e){var i=Z(this).val();return null==i?null:Z.isArray(i)?Z.map(i,function(t){return{name:e.name,value:t.replace(Te,"\r\n")}}):{name:e.name,value:i.replace(Te,"\r\n")}}).get()}}),Z.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(t){}};var Oe=0,Ae={},Ne={0:200,1223:204},ke=Z.ajaxSettings.xhr();t.attachEvent&&t.attachEvent("onunload",function(){for(var t in Ae)Ae[t]()}),K.cors=!!ke&&"withCredentials"in ke,K.ajax=ke=!!ke,Z.ajaxTransport(function(t){var e;return K.cors||ke&&!t.crossDomain?{send:function(i,s){var n,r=t.xhr(),o=++Oe;if(r.open(t.type,t.url,t.async,t.username,t.password),t.xhrFields)for(n in t.xhrFields)r[n]=t.xhrFields[n];t.mimeType&&r.overrideMimeType&&r.overrideMimeType(t.mimeType),t.crossDomain||i["X-Requested-With"]||(i["X-Requested-With"]="XMLHttpRequest");for(n in i)r.setRequestHeader(n,i[n]);e=function(t){return function(){e&&(delete Ae[o],e=r.onload=r.onerror=null,"abort"===t?r.abort():"error"===t?s(r.status,r.statusText):s(Ne[r.status]||r.status,r.statusText,"string"==typeof r.responseText?{text:r.responseText}:void 0,r.getAllResponseHeaders()))}},r.onload=e(),r.onerror=e("error"),e=Ae[o]=e("abort");try{r.send(t.hasContent&&t.data||null)}catch(a){if(e)throw a}},abort:function(){e&&e()}}:void 0}),Z.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(t){return Z.globalEval(t),t}}}),Z.ajaxPrefilter("script",function(t){void 0===t.cache&&(t.cache=!1),t.crossDomain&&(t.type="GET")}),Z.ajaxTransport("script",function(t){if(t.crossDomain){var e,i;return{send:function(s,n){e=Z("<script>").prop({async:!0,charset:t.scriptCharset,src:t.url}).on("load error",i=function(t){e.remove(),i=null,t&&n("error"===t.type?404:200,t.type)}),Q.head.appendChild(e[0])},abort:function(){i&&i()}}}});var Pe=[],De=/(=)\?(?=&|$)|\?\?/;Z.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var t=Pe.pop()||Z.expando+"_"+ue++;return this[t]=!0,t}}),Z.ajaxPrefilter("json jsonp",function(e,i,s){var n,r,o,a=e.jsonp!==!1&&(De.test(e.url)?"url":"string"==typeof e.data&&!(e.contentType||"").indexOf("application/x-www-form-urlencoded")&&De.test(e.data)&&"data");return a||"jsonp"===e.dataTypes[0]?(n=e.jsonpCallback=Z.isFunction(e.jsonpCallback)?e.jsonpCallback():e.jsonpCallback,a?e[a]=e[a].replace(De,"$1"+n):e.jsonp!==!1&&(e.url+=(ce.test(e.url)?"&":"?")+e.jsonp+"="+n),e.converters["script json"]=function(){return o||Z.error(n+" was not called"),o[0]},e.dataTypes[0]="json",r=t[n],t[n]=function(){o=arguments},s.always(function(){t[n]=r,e[n]&&(e.jsonpCallback=i.jsonpCallback,Pe.push(n)),o&&Z.isFunction(r)&&r(o[0]),o=r=void 0}),"script"):void 0}),Z.parseHTML=function(t,e,i){if(!t||"string"!=typeof t)return null;"boolean"==typeof e&&(i=e,e=!1),e=e||Q;var s=ot.exec(t),n=!i&&[];return s?[e.createElement(s[1])]:(s=Z.buildFragment([t],e,n),n&&n.length&&Z(n).remove(),Z.merge([],s.childNodes))};var Re=Z.fn.load;Z.fn.load=function(t,e,i){if("string"!=typeof t&&Re)return Re.apply(this,arguments);var s,n,r,o=this,a=t.indexOf(" ");return a>=0&&(s=Z.trim(t.slice(a)),t=t.slice(0,a)),Z.isFunction(e)?(i=e,e=void 0):e&&"object"==typeof e&&(n="POST"),o.length>0&&Z.ajax({url:t,type:n,dataType:"html",data:e}).done(function(t){r=arguments,o.html(s?Z("<div>").append(Z.parseHTML(t)).find(s):t)}).complete(i&&function(t,e){o.each(i,r||[t.responseText,e,t])}),this},Z.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(t,e){Z.fn[e]=function(t){return this.on(e,t)}}),Z.expr.filters.animated=function(t){return Z.grep(Z.timers,function(e){return t===e.elem}).length};var Le=t.document.documentElement;Z.offset={setOffset:function(t,e,i){var s,n,r,o,a,l,u,c=Z.css(t,"position"),h=Z(t),p={};"static"===c&&(t.style.position="relative"),a=h.offset(),r=Z.css(t,"top"),l=Z.css(t,"left"),u=("absolute"===c||"fixed"===c)&&(r+l).indexOf("auto")>-1,u?(s=h.position(),o=s.top,n=s.left):(o=parseFloat(r)||0,n=parseFloat(l)||0),Z.isFunction(e)&&(e=e.call(t,i,a)),null!=e.top&&(p.top=e.top-a.top+o),null!=e.left&&(p.left=e.left-a.left+n),"using"in e?e.using.call(t,p):h.css(p)}},Z.fn.extend({offset:function(t){if(arguments.length)return void 0===t?this:this.each(function(e){Z.offset.setOffset(this,t,e)});var e,i,s=this[0],n={top:0,left:0},r=s&&s.ownerDocument;if(r)return e=r.documentElement,Z.contains(e,s)?(typeof s.getBoundingClientRect!==Tt&&(n=s.getBoundingClientRect()),i=U(r),{top:n.top+i.pageYOffset-e.clientTop,left:n.left+i.pageXOffset-e.clientLeft}):n},position:function(){if(this[0]){var t,e,i=this[0],s={top:0,left:0};return"fixed"===Z.css(i,"position")?e=i.getBoundingClientRect():(t=this.offsetParent(),e=this.offset(),Z.nodeName(t[0],"html")||(s=t.offset()),s.top+=Z.css(t[0],"borderTopWidth",!0),s.left+=Z.css(t[0],"borderLeftWidth",!0)),{top:e.top-s.top-Z.css(i,"marginTop",!0),left:e.left-s.left-Z.css(i,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var t=this.offsetParent||Le;t&&!Z.nodeName(t,"html")&&"static"===Z.css(t,"position");)t=t.offsetParent;return t||Le})}}),Z.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(e,i){var s="pageYOffset"===i;Z.fn[e]=function(n){return gt(this,function(e,n,r){var o=U(e);return void 0===r?o?o[i]:e[n]:void(o?o.scrollTo(s?t.pageXOffset:r,s?r:t.pageYOffset):e[n]=r)},e,n,arguments.length,null)}}),Z.each(["top","left"],function(t,e){Z.cssHooks[e]=C(K.pixelPosition,function(t,i){return i?(i=x(t,e),Ht.test(i)?Z(t).position()[e]+"px":i):void 0})}),Z.each({Height:"height",Width:"width"},function(t,e){Z.each({padding:"inner"+t,content:e,"":"outer"+t},function(i,s){Z.fn[s]=function(s,n){var r=arguments.length&&(i||"boolean"!=typeof s),o=i||(s===!0||n===!0?"margin":"border");return gt(this,function(e,i,s){var n;return Z.isWindow(e)?e.document.documentElement["client"+t]:9===e.nodeType?(n=e.documentElement,Math.max(e.body["scroll"+t],n["scroll"+t],e.body["offset"+t],n["offset"+t],n["client"+t])):void 0===s?Z.css(e,i,o):Z.style(e,i,s,o)},e,r?s:void 0,r,null)}})}),Z.fn.size=function(){return this.length},Z.fn.andSelf=Z.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return Z});var je=t.jQuery,Me=t.$;return Z.noConflict=function(e){return t.$===Z&&(t.$=Me),e&&t.jQuery===Z&&(t.jQuery=je),Z},typeof e===Tt&&(t.jQuery=t.$=Z),Z})},{}],13:[function(t,e,i){function s(t){for(var e=-1,i=t?t.length:0,s=-1,n=[];++e<i;){var r=t[e];r&&(n[++s]=r)}return n}e.exports=s},{}],14:[function(t,e,i){function s(t){var e=t?t.length:0;return e?t[e-1]:void 0}e.exports=s},{}],15:[function(t,e,i){var s=t("../internal/baseDifference"),n=t("../internal/isArrayLike"),r=t("../function/restParam"),o=r(function(t,e){return n(t)?s(t,e):[]});e.exports=o},{"../function/restParam":17,"../internal/baseDifference":25,"../internal/isArrayLike":57}],16:[function(t,e,i){function s(t,e,i){if(null==t)return[];i&&l(t,e,i)&&(e=void 0);var s=-1;e=n(e,i,3);var u=r(t,function(t,i,n){return{criteria:e(t,i,n),index:++s,value:t}});return o(u,a)}var n=t("../internal/baseCallback"),r=t("../internal/baseMap"),o=t("../internal/baseSortBy"),a=t("../internal/compareAscending"),l=t("../internal/isIterateeCall");e.exports=s},{"../internal/baseCallback":22,"../internal/baseMap":34,"../internal/baseSortBy":40,"../internal/compareAscending":45,"../internal/isIterateeCall":59}],17:[function(t,e,i){function s(t,e){if("function"!=typeof t)throw new TypeError(n);return e=r(void 0===e?t.length-1:+e||0,0),function(){for(var i=arguments,s=-1,n=r(i.length-e,0),o=Array(n);++s<n;)o[s]=i[e+s];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,i[0],o);case 2:return t.call(this,i[0],i[1],o)}var a=Array(e+1);for(s=-1;++s<e;)a[s]=i[s];return a[e]=o,t.apply(this,a)}}var n="Expected a function",r=Math.max;e.exports=s},{}],18:[function(t,e,i){(function(i){function s(t){var e=t?t.length:0;for(this.data={hash:a(null),set:new o};e--;)this.push(t[e])}var n=t("./cachePush"),r=t("./getNative"),o=r(i,"Set"),a=r(Object,"create");s.prototype.push=n,e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./cachePush":44,"./getNative":55}],19:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}e.exports=s},{}],20:[function(t,e,i){function s(t,e,i){for(var s=-1,r=n(e),o=r.length;++s<o;){var a=r[s],l=t[a],u=i(l,e[a],a,t,e);(u===u?u===l:l!==l)&&(void 0!==l||a in t)||(t[a]=u)}return t}var n=t("../object/keys");e.exports=s},{"../object/keys":75}],21:[function(t,e,i){function s(t,e){return null==e?t:n(e,r(e),t)}var n=t("./baseCopy"),r=t("../object/keys");e.exports=s},{"../object/keys":75,"./baseCopy":24}],22:[function(t,e,i){function s(t,e,i){var s=typeof t;return"function"==s?void 0===e?t:o(t,e,i):null==t?a:"object"==s?n(t):void 0===e?l(t):r(t,e)}var n=t("./baseMatches"),r=t("./baseMatchesProperty"),o=t("./bindCallback"),a=t("../utility/identity"),l=t("../utility/property");e.exports=s},{"../utility/identity":78,"../utility/property":79,"./baseMatches":35,"./baseMatchesProperty":36,"./bindCallback":42}],23:[function(t,e,i){function s(t,e){if(t!==e){var i=null===t,s=void 0===t,n=t===t,r=null===e,o=void 0===e,a=e===e;if(t>e&&!r||!n||i&&!o&&a||s&&a)return 1;if(e>t&&!i||!a||r&&!s&&n||o&&n)return-1}return 0}e.exports=s},{}],24:[function(t,e,i){function s(t,e,i){i||(i={});for(var s=-1,n=e.length;++s<n;){var r=e[s];i[r]=t[r]}return i}e.exports=s},{}],25:[function(t,e,i){function s(t,e){var i=t?t.length:0,s=[];if(!i)return s;var l=-1,u=n,c=!0,h=c&&e.length>=a?o(e):null,p=e.length;h&&(u=r,c=!1,e=h);t:for(;++l<i;){var d=t[l];if(c&&d===d){for(var f=p;f--;)if(e[f]===d)continue t;s.push(d)}else u(e,d,0)<0&&s.push(d)}return s}var n=t("./baseIndexOf"),r=t("./cacheIndexOf"),o=t("./createCache"),a=200;e.exports=s},{"./baseIndexOf":30,"./cacheIndexOf":43,"./createCache":49}],26:[function(t,e,i){var s=t("./baseForOwn"),n=t("./createBaseEach"),r=n(s);e.exports=r},{"./baseForOwn":28,"./createBaseEach":47}],27:[function(t,e,i){var s=t("./createBaseFor"),n=s();e.exports=n},{"./createBaseFor":48}],28:[function(t,e,i){function s(t,e){return n(t,e,r)}var n=t("./baseFor"),r=t("../object/keys");e.exports=s},{"../object/keys":75,"./baseFor":27}],29:[function(t,e,i){function s(t,e,i){if(null!=t){void 0!==i&&i in n(t)&&(e=[i]);for(var s=0,r=e.length;null!=t&&r>s;)t=t[e[s++]];return s&&s==r?t:void 0}}var n=t("./toObject");e.exports=s},{"./toObject":65}],30:[function(t,e,i){function s(t,e,i){if(e!==e)return n(t,i);for(var s=i-1,r=t.length;++s<r;)if(t[s]===e)return s;return-1}var n=t("./indexOfNaN");e.exports=s},{"./indexOfNaN":56}],31:[function(t,e,i){function s(t,e,i,a,l,u){return t===e?!0:null==t||null==e||!r(t)&&!o(e)?t!==t&&e!==e:n(t,e,s,i,a,l,u)}var n=t("./baseIsEqualDeep"),r=t("../lang/isObject"),o=t("./isObjectLike");e.exports=s},{"../lang/isObject":71,"./baseIsEqualDeep":32,"./isObjectLike":62}],32:[function(t,e,i){function s(t,e,i,s,p,m,g){var b=a(t),v=a(e),y=c,_=c;b||(y=f.call(t),y==u?y=h:y!=h&&(b=l(t))),v||(_=f.call(e),_==u?_=h:_!=h&&(v=l(e)));var x=y==h,C=_==h,w=y==_;if(w&&!b&&!x)return r(t,e,y);if(!p){var S=x&&d.call(t,"__wrapped__"),T=C&&d.call(e,"__wrapped__");if(S||T)return i(S?t.value():t,T?e.value():e,s,p,m,g)}if(!w)return!1;m||(m=[]),g||(g=[]);for(var E=m.length;E--;)if(m[E]==t)return g[E]==e;m.push(t),g.push(e);var I=(b?n:o)(t,e,i,s,p,m,g);return m.pop(),g.pop(),I}var n=t("./equalArrays"),r=t("./equalByTag"),o=t("./equalObjects"),a=t("../lang/isArray"),l=t("../lang/isTypedArray"),u="[object Arguments]",c="[object Array]",h="[object Object]",p=Object.prototype,d=p.hasOwnProperty,f=p.toString;e.exports=s},{"../lang/isArray":68,"../lang/isTypedArray":72,"./equalArrays":50,"./equalByTag":51,"./equalObjects":52}],33:[function(t,e,i){function s(t,e,i){var s=e.length,o=s,a=!i;if(null==t)return!o;for(t=r(t);s--;){var l=e[s];if(a&&l[2]?l[1]!==t[l[0]]:!(l[0]in t))return!1}for(;++s<o;){l=e[s];var u=l[0],c=t[u],h=l[1];if(a&&l[2]){if(void 0===c&&!(u in t))return!1}else{var p=i?i(c,h,u):void 0;if(!(void 0===p?n(h,c,i,!0):p))return!1}}return!0}var n=t("./baseIsEqual"),r=t("./toObject");e.exports=s},{"./baseIsEqual":31,"./toObject":65}],34:[function(t,e,i){function s(t,e){var i=-1,s=r(t)?Array(t.length):[];return n(t,function(t,n,r){s[++i]=e(t,n,r)}),s}var n=t("./baseEach"),r=t("./isArrayLike");e.exports=s},{"./baseEach":26,"./isArrayLike":57}],35:[function(t,e,i){function s(t){var e=r(t);if(1==e.length&&e[0][2]){var i=e[0][0],s=e[0][1];return function(t){return null==t?!1:t[i]===s&&(void 0!==s||i in o(t))}}return function(t){return n(t,e)}}var n=t("./baseIsMatch"),r=t("./getMatchData"),o=t("./toObject");e.exports=s},{"./baseIsMatch":33,"./getMatchData":54,"./toObject":65}],36:[function(t,e,i){function s(t,e){var i=a(t),s=l(t)&&u(e),d=t+"";return t=p(t),function(a){if(null==a)return!1;var l=d;if(a=h(a),(i||!s)&&!(l in a)){if(a=1==t.length?a:n(a,o(t,0,-1)),null==a)return!1;l=c(t),a=h(a)}return a[l]===e?void 0!==e||l in a:r(e,a[l],void 0,!0)}}var n=t("./baseGet"),r=t("./baseIsEqual"),o=t("./baseSlice"),a=t("../lang/isArray"),l=t("./isKey"),u=t("./isStrictComparable"),c=t("../array/last"),h=t("./toObject"),p=t("./toPath");e.exports=s},{"../array/last":14,"../lang/isArray":68,"./baseGet":29,"./baseIsEqual":31,"./baseSlice":39,"./isKey":60,"./isStrictComparable":63,"./toObject":65,"./toPath":66}],37:[function(t,e,i){function s(t){return function(e){return null==e?void 0:e[t]}}e.exports=s},{}],38:[function(t,e,i){function s(t){var e=t+"";return t=r(t),function(i){return n(i,t,e)}}var n=t("./baseGet"),r=t("./toPath");e.exports=s},{"./baseGet":29,"./toPath":66}],39:[function(t,e,i){function s(t,e,i){var s=-1,n=t.length;e=null==e?0:+e||0,0>e&&(e=-e>n?0:n+e),i=void 0===i||i>n?n:+i||0,0>i&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var r=Array(n);++s<n;)r[s]=t[s+e];return r}e.exports=s},{}],40:[function(t,e,i){function s(t,e){var i=t.length;for(t.sort(e);i--;)t[i]=t[i].value;return t}e.exports=s},{}],41:[function(t,e,i){function s(t){return null==t?"":t+""}e.exports=s},{}],42:[function(t,e,i){function s(t,e,i){if("function"!=typeof t)return n;if(void 0===e)return t;switch(i){case 1:return function(i){return t.call(e,i)};case 3:return function(i,s,n){return t.call(e,i,s,n)};case 4:return function(i,s,n,r){return t.call(e,i,s,n,r)};case 5:return function(i,s,n,r,o){return t.call(e,i,s,n,r,o)}}return function(){return t.apply(e,arguments)}}var n=t("../utility/identity");e.exports=s},{"../utility/identity":78}],43:[function(t,e,i){function s(t,e){var i=t.data,s="string"==typeof e||n(e)?i.set.has(e):i.hash[e];return s?0:-1}var n=t("../lang/isObject");e.exports=s},{"../lang/isObject":71}],44:[function(t,e,i){function s(t){var e=this.data;"string"==typeof t||n(t)?e.set.add(t):e.hash[t]=!0}var n=t("../lang/isObject");e.exports=s},{"../lang/isObject":71}],45:[function(t,e,i){function s(t,e){return n(t.criteria,e.criteria)||t.index-e.index}var n=t("./baseCompareAscending");e.exports=s},{"./baseCompareAscending":23}],46:[function(t,e,i){function s(t){return o(function(e,i){var s=-1,o=null==e?0:i.length,a=o>2?i[o-2]:void 0,l=o>2?i[2]:void 0,u=o>1?i[o-1]:void 0;for("function"==typeof a?(a=n(a,u,5),o-=2):(a="function"==typeof u?u:void 0,o-=a?1:0),l&&r(i[0],i[1],l)&&(a=3>o?void 0:a,o=1);++s<o;){var c=i[s];c&&t(e,c,a)}return e})}var n=t("./bindCallback"),r=t("./isIterateeCall"),o=t("../function/restParam");e.exports=s},{"../function/restParam":17,"./bindCallback":42,"./isIterateeCall":59}],47:[function(t,e,i){function s(t,e){return function(i,s){var a=i?n(i):0;if(!r(a))return t(i,s);for(var l=e?a:-1,u=o(i);(e?l--:++l<a)&&s(u[l],l,u)!==!1;);return i}}var n=t("./getLength"),r=t("./isLength"),o=t("./toObject");e.exports=s},{"./getLength":53,"./isLength":61,"./toObject":65}],48:[function(t,e,i){function s(t){return function(e,i,s){for(var r=n(e),o=s(e),a=o.length,l=t?a:-1;t?l--:++l<a;){var u=o[l];if(i(r[u],u,r)===!1)break}return e}}var n=t("./toObject");e.exports=s},{"./toObject":65}],49:[function(t,e,i){(function(i){function s(t){return a&&o?new n(t):null}var n=t("./SetCache"),r=t("./getNative"),o=r(i,"Set"),a=r(Object,"create");e.exports=s}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./SetCache":18,"./getNative":55}],50:[function(t,e,i){function s(t,e,i,s,r,o,a){var l=-1,u=t.length,c=e.length;if(u!=c&&!(r&&c>u))return!1;for(;++l<u;){var h=t[l],p=e[l],d=s?s(r?p:h,r?h:p,l):void 0;if(void 0!==d){if(d)continue;return!1}if(r){if(!n(e,function(t){return h===t||i(h,t,s,r,o,a)}))return!1}else if(h!==p&&!i(h,p,s,r,o,a))return!1}return!0}var n=t("./arraySome");e.exports=s},{"./arraySome":19}],51:[function(t,e,i){function s(t,e,i){switch(i){case n:case r:return+t==+e;case o:return t.name==e.name&&t.message==e.message;case a:return t!=+t?e!=+e:t==+e;case l:case u:return t==e+""}return!1}var n="[object Boolean]",r="[object Date]",o="[object Error]",a="[object Number]",l="[object RegExp]",u="[object String]";e.exports=s},{}],52:[function(t,e,i){function s(t,e,i,s,r,a,l){var u=n(t),c=u.length,h=n(e),p=h.length;if(c!=p&&!r)return!1;for(var d=c;d--;){var f=u[d];if(!(r?f in e:o.call(e,f)))return!1}for(var m=r;++d<c;){f=u[d];var g=t[f],b=e[f],v=s?s(r?b:g,r?g:b,f):void 0;if(!(void 0===v?i(g,b,s,r,a,l):v))return!1;m||(m="constructor"==f)}if(!m){var y=t.constructor,_=e.constructor;if(y!=_&&"constructor"in t&&"constructor"in e&&!("function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _))return!1}return!0}var n=t("../object/keys"),r=Object.prototype,o=r.hasOwnProperty;e.exports=s},{"../object/keys":75}],53:[function(t,e,i){var s=t("./baseProperty"),n=s("length");e.exports=n},{"./baseProperty":37}],54:[function(t,e,i){function s(t){for(var e=r(t),i=e.length;i--;)e[i][2]=n(e[i][1]);return e}var n=t("./isStrictComparable"),r=t("../object/pairs");e.exports=s},{"../object/pairs":77,"./isStrictComparable":63}],55:[function(t,e,i){function s(t,e){var i=null==t?void 0:t[e];return n(i)?i:void 0}var n=t("../lang/isNative");e.exports=s},{"../lang/isNative":70}],56:[function(t,e,i){function s(t,e,i){for(var s=t.length,n=e+(i?0:-1);i?n--:++n<s;){var r=t[n];if(r!==r)return n}return-1}e.exports=s},{}],57:[function(t,e,i){function s(t){return null!=t&&r(n(t))}var n=t("./getLength"),r=t("./isLength");e.exports=s},{"./getLength":53,"./isLength":61}],58:[function(t,e,i){function s(t,e){return t="number"==typeof t||n.test(t)?+t:-1,e=null==e?r:e,t>-1&&t%1==0&&e>t}var n=/^\d+$/,r=9007199254740991;e.exports=s},{}],59:[function(t,e,i){function s(t,e,i){if(!o(i))return!1;var s=typeof e;if("number"==s?n(i)&&r(e,i.length):"string"==s&&e in i){var a=i[e];return t===t?t===a:a!==a}return!1}var n=t("./isArrayLike"),r=t("./isIndex"),o=t("../lang/isObject");e.exports=s},{"../lang/isObject":71,"./isArrayLike":57,"./isIndex":58}],60:[function(t,e,i){function s(t,e){var i=typeof t;if("string"==i&&a.test(t)||"number"==i)return!0;if(n(t))return!1;var s=!o.test(t);return s||null!=e&&t in r(e)}var n=t("../lang/isArray"),r=t("./toObject"),o=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,a=/^\w*$/;e.exports=s},{"../lang/isArray":68,"./toObject":65}],61:[function(t,e,i){function s(t){return"number"==typeof t&&t>-1&&t%1==0&&n>=t}var n=9007199254740991;e.exports=s},{}],62:[function(t,e,i){function s(t){return!!t&&"object"==typeof t}e.exports=s},{}],63:[function(t,e,i){function s(t){return t===t&&!n(t)}var n=t("../lang/isObject");e.exports=s},{"../lang/isObject":71}],64:[function(t,e,i){function s(t){for(var e=l(t),i=e.length,s=i&&t.length,u=!!s&&a(s)&&(r(t)||n(t)),h=-1,p=[];++h<i;){var d=e[h];(u&&o(d,s)||c.call(t,d))&&p.push(d)}return p}var n=t("../lang/isArguments"),r=t("../lang/isArray"),o=t("./isIndex"),a=t("./isLength"),l=t("../object/keysIn"),u=Object.prototype,c=u.hasOwnProperty;e.exports=s},{"../lang/isArguments":67,"../lang/isArray":68,"../object/keysIn":76,"./isIndex":58,"./isLength":61}],65:[function(t,e,i){function s(t){return n(t)?t:Object(t)}var n=t("../lang/isObject");e.exports=s},{"../lang/isObject":71}],66:[function(t,e,i){function s(t){if(r(t))return t;var e=[];return n(t).replace(o,function(t,i,s,n){e.push(s?n.replace(a,"$1"):i||t)}),e}var n=t("./baseToString"),r=t("../lang/isArray"),o=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,a=/\\(\\)?/g;e.exports=s},{"../lang/isArray":68,"./baseToString":41}],67:[function(t,e,i){function s(t){return r(t)&&n(t)&&a.call(t,"callee")&&!l.call(t,"callee")}var n=t("../internal/isArrayLike"),r=t("../internal/isObjectLike"),o=Object.prototype,a=o.hasOwnProperty,l=o.propertyIsEnumerable;e.exports=s},{"../internal/isArrayLike":57,"../internal/isObjectLike":62}],68:[function(t,e,i){var s=t("../internal/getNative"),n=t("../internal/isLength"),r=t("../internal/isObjectLike"),o="[object Array]",a=Object.prototype,l=a.toString,u=s(Array,"isArray"),c=u||function(t){return r(t)&&n(t.length)&&l.call(t)==o};e.exports=c},{"../internal/getNative":55,"../internal/isLength":61,"../internal/isObjectLike":62}],69:[function(t,e,i){function s(t){return n(t)&&a.call(t)==r}var n=t("./isObject"),r="[object Function]",o=Object.prototype,a=o.toString;e.exports=s},{"./isObject":71}],70:[function(t,e,i){function s(t){return null==t?!1:n(t)?c.test(l.call(t)):r(t)&&o.test(t)}var n=t("./isFunction"),r=t("../internal/isObjectLike"),o=/^\[object .+?Constructor\]$/,a=Object.prototype,l=Function.prototype.toString,u=a.hasOwnProperty,c=RegExp("^"+l.call(u).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=s},{"../internal/isObjectLike":62,"./isFunction":69}],71:[function(t,e,i){function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=s},{}],72:[function(t,e,i){function s(t){return r(t)&&n(t.length)&&!!A[k.call(t)]}var n=t("../internal/isLength"),r=t("../internal/isObjectLike"),o="[object Arguments]",a="[object Array]",l="[object Boolean]",u="[object Date]",c="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object RegExp]",g="[object Set]",b="[object String]",v="[object WeakMap]",y="[object ArrayBuffer]",_="[object Float32Array]",x="[object Float64Array]",C="[object Int8Array]",w="[object Int16Array]",S="[object Int32Array]",T="[object Uint8Array]",E="[object Uint8ClampedArray]",I="[object Uint16Array]",O="[object Uint32Array]",A={};A[_]=A[x]=A[C]=A[w]=A[S]=A[T]=A[E]=A[I]=A[O]=!0,A[o]=A[a]=A[y]=A[l]=A[u]=A[c]=A[h]=A[p]=A[d]=A[f]=A[m]=A[g]=A[b]=A[v]=!1;var N=Object.prototype,k=N.toString;e.exports=s},{"../internal/isLength":61,"../internal/isObjectLike":62}],73:[function(t,e,i){var s=t("../internal/assignWith"),n=t("../internal/baseAssign"),r=t("../internal/createAssigner"),o=r(function(t,e,i){return i?s(t,e,i):n(t,e)});e.exports=o},{"../internal/assignWith":20,"../internal/baseAssign":21,"../internal/createAssigner":46}],74:[function(t,e,i){e.exports=t("./assign")},{"./assign":73}],75:[function(t,e,i){var s=t("../internal/getNative"),n=t("../internal/isArrayLike"),r=t("../lang/isObject"),o=t("../internal/shimKeys"),a=s(Object,"keys"),l=a?function(t){var e=null==t?void 0:t.constructor;return"function"==typeof e&&e.prototype===t||"function"!=typeof t&&n(t)?o(t):r(t)?a(t):[]}:o;e.exports=l},{"../internal/getNative":55,"../internal/isArrayLike":57,"../internal/shimKeys":64,"../lang/isObject":71}],76:[function(t,e,i){function s(t){if(null==t)return[];l(t)||(t=Object(t));var e=t.length;e=e&&a(e)&&(r(t)||n(t))&&e||0;for(var i=t.constructor,s=-1,u="function"==typeof i&&i.prototype===t,h=Array(e),p=e>0;++s<e;)h[s]=s+"";for(var d in t)p&&o(d,e)||"constructor"==d&&(u||!c.call(t,d))||h.push(d);return h}var n=t("../lang/isArguments"),r=t("../lang/isArray"),o=t("../internal/isIndex"),a=t("../internal/isLength"),l=t("../lang/isObject"),u=Object.prototype,c=u.hasOwnProperty;e.exports=s},{"../internal/isIndex":58,"../internal/isLength":61,"../lang/isArguments":67,"../lang/isArray":68,"../lang/isObject":71}],77:[function(t,e,i){function s(t){t=r(t);for(var e=-1,i=n(t),s=i.length,o=Array(s);++e<s;){var a=i[e];o[e]=[a,t[a]]}return o}var n=t("./keys"),r=t("../internal/toObject");e.exports=s},{"../internal/toObject":65,"./keys":75}],78:[function(t,e,i){function s(t){return t}e.exports=s},{}],79:[function(t,e,i){function s(t){return o(t)?n(t):r(t)}var n=t("../internal/baseProperty"),r=t("../internal/basePropertyDeep"),o=t("../internal/isKey");e.exports=s},{"../internal/baseProperty":37,"../internal/basePropertyDeep":38,"../internal/isKey":60}],80:[function(t,e,i){e.exports={switch_text:"Switch text",hyperlink:"Hyperlink",subscript:"Subscript",superscript:"Superscript",code:"Code","delete":"Delete",emphasis:"Emphasis",strong:"Strong",redo:"Redo",undo:"Undo",save:"Save",untitled:"Untitled",manage:"Manage",toc:"Contents","embed-src":"Embed URL",paragraph:"Paragraph",heading1:"Heading 1",heading2:"Heading 2",heading3:"Heading 3",codeblock:"Codeblock",blockquote:"Blockquote","container-selection":"Multiple Elements"}},{}],81:[function(t,e,i){"use strict";function s(t,e){this.path=t,this.offset=e}var n=t("../util/oo");s.Prototype=function(){this.isAnchor=function(){return!0},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset}},n.initClass(s),e.exports=s},{"../util/oo":486}],82:[function(t,e,i){"use strict";
var s=t("lodash/filter"),n=t("../util/TreeIndex"),r=t("./ContainerAnnotation"),o=t("./DocumentIndex"),a=function(t){this.doc=t,this.byPath=new n.Arrays,this.byId={}};o.extend(a,function(){this.select=function(t){return t instanceof r},this.reset=function(t){this.byPath.clear(),this.byId={},this._initialize(t)},this.get=function(t,e){var i=this.byPath.getAll(t);return e?s(i,function(t){return t.container===e}):i.slice(0)},this.create=function(t){var e=t.getStartAnchor(),i=t.getEndAnchor();this.byPath.add(e.path,e),this.byPath.add(i.path,i),this.byId[t.id]=t},this["delete"]=function(t){var e=t.getStartAnchor(),i=t.getEndAnchor();this.byPath.remove(e.path,e),this.byPath.remove(i.path,i),delete this.byId[t.id]},this.update=function(t,e,i,s){if(this.select(t)){var n=null;if("startPath"===e[1])n=t.getStartAnchor();else{if("endPath"!==e[1])return;n=t.getEndAnchor()}this.byPath.remove(s,n),this.byPath.add(n.path,n)}}}),e.exports=a},{"../util/TreeIndex":480,"./ContainerAnnotation":86,"./DocumentIndex":96,"lodash/filter":316}],83:[function(t,e,i){"use strict";var s=t("lodash/isString"),n=t("lodash/map"),r=t("lodash/filter"),o=t("../util/TreeIndex"),a=t("./PropertyAnnotation"),l=t("./DocumentIndex"),u=function(){this.byPath=new o,this.byType=new o};u.Prototype=function(){this.property="path",this.select=function(t){return t instanceof a},this.reset=function(t){this.byPath.clear(),this.byType.clear(),this._initialize(t)},this.get=function(t,e,i,o){var a;return a=s(t)||1===t.length?this.byPath.getAll(t)||{}:this.byPath.get(t),a=n(a),null!=e&&(a=r(a,u.filterByRange(e,i))),o&&(a=r(a,u.filterByType(o))),a},this.create=function(t){this.byType.set([t.type,t.id],t),this.byPath.set(t.path.concat([t.id]),t)},this["delete"]=function(t){this.byType["delete"]([t.type,t.id]),this.byPath["delete"](t.path.concat([t.id]))},this.update=function(t,e,i,s){this.select(t)&&e[1]===this.property&&(this["delete"]({id:t.id,type:t.type,path:s}),this.create(t))}},l.extend(u),u.filterByRange=function(t,e){return function(i){var s=i.startOffset,n=i.endOffset,r=n>=t;return null!=e&&(r=r&&e>=s),r}},u.filterByType=function(t){return function(e){return e.isInstanceOf(t)}},e.exports=u},{"../util/TreeIndex":480,"./DocumentIndex":96,"./PropertyAnnotation":109,"lodash/filter":316,"lodash/isString":340,"lodash/map":346}],84:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./DocumentNode");n.extend(s),s["static"].isBlock=!0,e.exports=s},{"./DocumentNode":97}],85:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("lodash/last"),r=t("./DocumentNode"),o=t("./ParentNodeMixin"),a=t("./DocumentAddress");r.extend(s,o,function(){this.getChildrenProperty=function(){return"nodes"},this.getPosition=function(t){var e=this.nodes.indexOf(t);return e},this.getLength=function(){return this.nodes.length},this.show=function(t,e){var i=this.getDocument();null==e&&(e=this.nodes.length),i.update([this.id,"nodes"],{insert:{offset:e,value:t}})},this.hide=function(t){var e=this.getDocument(),i=this.nodes.indexOf(t);i>=0&&e.update([this.id,"nodes"],{"delete":{offset:i}})},this.getAddress=function(t){var e=this.getDocument(),i=t[0],s=t[1],n=e.get(i);if(!n)throw new Error("Can not find node "+i);var r=n.getAddressablePropertyNames().indexOf(s);if(0>r)throw new Error("Can not resolve index for property "+s);for(var o,l,u=(new a).push(r);n.hasParent();){if(o=n.getParent(),l=o.getChildIndex(n),0>l)throw new Error("Can not resolve index for child node "+n.id+" and parent "+o.id);u.unshift(l),n=o}var c=this.getPosition(n.id);return 0>c?null:(u.unshift(c),u)},this.getPath=function(t){return this.getPathForAddress(t)},this._getNodeChain=function(t){var e=this.getDocument();if(t.length<2)throw new Error("Property addresses have a length of >= 2");var i,s=[],n=this.nodes[t[0]];if(2===t.length){if(i=e.get(n),!i)throw new Error("Can not find node "+n);s.push(i)}else{if(i=e.get(n),!i)throw new Error("Can not find node "+n);s.push(i);for(var r=1;i&&r<t.length-1;r++)i=i.getChildAt(t[r]),s.push(i)}if(0===s.length)throw new Error("Could not resolve address: "+t.toString());return s},this._getNodeForAddress=function(t){if(0===t.length)throw new Error("Illegal argument.");if(t.length<3){var e=this.nodes[t[0]],i=this.getDocument();return i.get(e)}return n(this._getNodeChain(t))},this.getPathForAddress=function(t){var e=this._getNodeForAddress(t),i=e.getAddressablePropertyNames();if(0===i.length)return null;var s=i[n(t)];if(!s)throw new Error("No property with index "+n(t)+" in node "+JSON.stringify(e.toJSON()));var r=[e.id,s];return r},this._getNextAddress=function(t){var e,i,s,r=this.getDocument();if(2===t.length)return e=this.nodes[t[0]],i=r.get(e),s=i.getAddressablePropertyNames(),s.length>1&&t[1]<s.length-1?(new a).push(t[0],t[1]+1):t[0]<this.nodes.length-1?(e=this.nodes[t[0]+1],i=r.get(e),i.hasAddressableProperties()?new a(t[0]+1).append(this._getFirstAddress(r.get(e))):new a(t[0]+1,-1)):null;var o=this._getNodeChain(t);i=n(o),s=i.getAddressablePropertyNames();var l;if(s.length>1&&n(t)<s.length-1)return l=t.clone(),l[l.length-1]++,l;var u,c;o.unshift(this);for(var h=o.length-2;h>=0&&(u=o[h],c=t[h],!(c<u.getChildCount()-1));h--)i=u;if(0>h)return null;var p=c+1,d=u.getChildAt(p),f=this._getFirstAddress(d);return l=t.slice(0,h).push(p).append(f)},this.getNextAddress=this._getNextAddress,this._getPreviousAddress=function(t){var e,i,s=this.getDocument();if(2===t.length)return t[1]>0?(new a).push(t[0],t[1]-1):t[0]>0?(e=this.nodes[t[0]-1],i=s.get(e),i.hasAddressableProperties()?new a(t[0]-1).append(this._getLastAddress(i)):new a(t[0]-1,-1)):null;var r=this._getNodeChain(t);i=n(r);var o;if(n(t)>0)return o=t.clone(),o[o.length-1]--,o;r.unshift(this);for(var l=r.length-2;l>=0&&!(t[l]>0);l--);if(0>l)return null;var u=r[l],c=t[l]-1,h=u.getChildAt(c),p=this._getLastAddress(h);return o=t.slice(0,l).push(c).append(p)},this.getPreviousAddress=this._getPreviousAddress,this._getFirstAddress=function(t){if(!t.hasAddressableProperties())return null;for(var e=new a;t.hasChildren();)e.push(0),t=t.getChildAt(0);return e.push(0),e},this._getLastAddress=function(t){if(!t.hasAddressableProperties())return null;for(var e=new a;t.hasChildren();){var i=t.getChildCount()-1;e.push(i),t=t.getChildAt(i)}return e.push(t.getAddressablePropertyNames().length-1),e},this.getFirstAddress=function(t){t||(t=this.getChildAt(0));var e=this.getChildIndex(t);return 0>e?(console.warn("Container.getLastAddress(): Illegal argument. Could not find node position."),null):(new a).push(e).append(this._getFirstAddress(t))},this.getFirstPath=function(t){var e=this.getFirstAddress(t);return e?this.getPath(e):null},this.getLastAddress=function(t){t||(t=this.getChildAt(this.length-1));var e=this.getChildIndex(t);return 0>e?(console.warn("Container.getLastAddress(): Illegal argument. Could not find node position."),null):(new a).push(e).append(this._getLastAddress(t))},this.getLastPath=function(t){var e=this.getLastAddress(t);return e?this.getPath(e):null},this.getAddressRange=function(t,e){if(!t||!e)return[];if(e.isBefore(t)){var i=t;t=e,e=i}for(var s=[t],n=t;n.isBefore(e);)n=this._getNextAddress(n),s.push(n);return s},this.getPathRange=function(t,e){var i=this.getAddress(t),s=this.getAddress(e),n=this.getAddressRange(i,s);return n.map(this.getPathForAddress.bind(this))},this.getNextPath=function(t){var e=this.getAddress(t),i=this.getNextAddress(e);return i?this.getPath(i):null},this.getPreviousPath=function(t){var e=this.getAddress(t),i=this.getPreviousAddress(e);return i?this.getPath(i):null},this.getAddressesForNode=function(t){if(t.hasAddressableProperties()){var e=this.getChildIndex(t),i=(new a).push(e).append(this._getFirstAddress(t)),s=(new a).push(e).append(this._getLastAddress(t));return this.getAddressRange(i,s)}return[]},this.getPathsForNode=function(t){var e=this.getAddressesForNode(t);return e.map(this.getPathForAddress.bind(this))}}),s["static"].name="container",s["static"].defineSchema({nodes:{type:["id"],"default":[]}}),Object.defineProperty(s.prototype,"length",{get:function(){return console.warn("DEPRECATED: want to get rid of unnecessary properties. Use this.getLength() instead."),this.nodes.length}}),e.exports=s},{"./DocumentAddress":94,"./DocumentNode":97,"./ParentNodeMixin":107,"lodash/last":345}],86:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("lodash/isEqual"),r=t("lodash/last"),o=t("lodash/each"),a=t("../util/EventEmitter"),l=t("./DocumentNode"),u=t("./Selection"),c=t("./Anchor"),h=t("./documentHelpers");s.Prototype=function(){this.getText=function(){var t=this.getDocument();return t?h.getTextForSelection(t,this.getSelection()):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),"")},this.getSelection=function(){var t=this.getDocument();return t?t.createSelection({type:"container",containerId:this.container,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset}):(console.warn("Trying to use a ContainerAnnotation which is not attached to the document."),u.nullSelection())},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlighted=t,this.highlightedScope=e,this.emit("highlighted",t,e),o(this.fragments,function(i){i.emit("highlighted",t,e)}))},this.updateRange=function(t,e){if(!e.isContainerSelection())throw new Error("Cannot change to ContainerAnnotation.");n(this.startPath,e.start.path)||t.set([this.id,"startPath"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),n(this.endPath,e.end.path)||t.set([this.id,"endPath"],e.end.path),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)},this.getFragments=function(){var t=[],e=this.getDocument(),i=e.get(this.container),n=i.getPathRange(this.startPath,this.endPath);if(1===n.length)t.push(new s.Fragment(this,n[0],"property"));else if(n.length>1){t.push(new s.Fragment(this,n[0],"start")),t.push(new s.Fragment(this,r(n),"end"));for(var o=1;o<n.length-1;o++)t.push(new s.Fragment(this,n[o],"inner"))}return t},this.getStartAnchor=function(){return this._startAnchor||(this._startAnchor=new s.Anchor(this,"isStart")),this._startAnchor},this.getEndAnchor=function(){return this._endAnchor||(this._endAnchor=new s.Anchor(this)),this._endAnchor}},l.extend(s),s["static"].name="container-annotation",s["static"].defineSchema({container:"container",startPath:["string"],startOffset:"number",endPath:["string"],endOffset:"number"}),s["static"].isContainerAnnotation=!0,s.Anchor=function(t,e){a.call(this),this.type="container-annotation-anchor",this.anno=t,this.node=t,this.id=t.id,this.container=t.container,this.isStart=!!e,Object.freeze(this)},s.Anchor.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getPath=function(){return this.isStart?this.node.startPath:this.node.endPath},this.getOffset=function(){return this.isStart?this.node.startOffset:this.node.endOffset}},c.extend(s.Anchor,a.prototype),Object.defineProperties(s.Anchor.prototype,{path:{get:function(){return this.getPath()}},offset:{get:function(){return this.getOffset()}}}),s.Fragment=function(t,e,i){a.call(this),this.type="container-annotation-fragment",this.anno=t,this.id=t.id,this.path=e,this.mode=i},s.Fragment.Prototype=function(){this.getTypeNames=function(){return[this.type]},this.getStartOffset=function(){return"start"===this.mode||"property"===this.mode?this.anno.startOffset:0},this.getEndOffset=function(){var t=this.anno.getDocument(),e=t.get(this.path),i=e.length;return"end"===this.mode||"property"===this.mode?this.anno.endOffset:i}},a.extend(s.Fragment),s.Fragment["static"].fragmentation=Number.MAX_VALUE,Object.defineProperties(s.Fragment.prototype,{startOffset:{get:function(){return this.getStartOffset()},set:function(){throw new Error("ContainerAnnotation.Fragment.startOffset is read-only.")}},endOffset:{get:function(){return this.getEndOffset()},set:function(){throw new Error("ContainerAnnotation.Fragment.endOffset is read-only.")}},highlighted:{get:function(){return this.anno.highlighted},set:function(){throw new Error("ContainerAnnotation.Fragment.highlighted is read-only.")}}}),e.exports=s},{"../util/EventEmitter":477,"./Anchor":81,"./DocumentNode":97,"./Selection":112,"./documentHelpers":131,"lodash/each":313,"lodash/isEqual":332,"lodash/last":345}],87:[function(t,e,i){"use strict";function s(t,e,i,s,r,a,c){if(o.call(this),this.containerId=t,this.startPath=e,this.startOffset=i,this.endPath=s,this.endOffset=r,this.reverse=!!a,this.surfaceId=c,!(this.containerId&&this.startPath&&n(this.startOffset)&&this.endPath&&n(this.endOffset)))throw new Error("Invalid arguments: `containerId`, `startPath`, `startOffset`, `endPath`, and `endOffset` are mandatory");this._internal.start=new l(this,"startPath","startOffset"),this._internal.end=new l(this,"endPath","endOffset"),this._internal.range=new u(this)}var n=t("lodash/isNumber"),r=t("lodash/map"),o=t("./Selection"),a=t("./PropertySelection"),l=a.CoordinateAdapter,u=a.RangeAdapter;s.Prototype=function(){this.toJSON=function(){return{type:"container",containerId:this.containerId,startPath:this.startPath,startOffset:this.startOffset,endPath:this.endPath,endOffset:this.endOffset,reverse:this.reverse,surfaceId:this.surfaceId}},this.isContainerSelection=function(){return!0},this.isNull=function(){return!1},this.isCollapsed=function(){return this.start.equals(this.end)},this.isReverse=function(){return this.reverse},this.equals=function(t){return o.prototype.equals.call(this,t)&&this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return"ContainerSelection("+JSON.stringify(this.startPath)+":"+this.startOffset+" -> "+JSON.stringify(this.endPath)+":"+this.endOffset+(this.reverse?", reverse":"")+")"},this.getContainer=function(){return this.getDocument().get(this.containerId)},this.collapse=function(t){var e;return e="left"===t?this.start:this.end,this.createWithNewRange(e,e)},this.expand=function(t){var e=this._coordinates(this),s=this._coordinates(t),n=e.start,r=s.start,o=e.end,a=s.end,l={address:n.address,offset:n.offset},u={address:o.address,offset:o.offset};return n.address.equals(r.address)?l.offset=Math.min(n.offset,r.offset):n.address.isAfter(r.address)&&(l.address=r.address,l.offset=r.offset),o.address.equals(a.address)?u.offset=Math.max(o.offset,a.offset):o.address.isBefore(a.address)&&(u.address=a.address,u.offset=a.offset),i(this,l,u)},this.truncate=function(s){var n,r,a=this._coordinates(this),l=this._coordinates(s);if(t(l.start,a.start,"strict"))n=a.start,r=l.end;else if(t(a.end,l.end,"strict"))n=l.start,r=a.end;else if(e(a.start,l.start)){if(e(a.end,l.end))return o.nullSelection;n=l.end,r=a.end}else{if(!e(a.end,l.end))throw new Error("Could not determine coordinates for truncate. Check input");n=a.start,r=l.start}return i(this,n,r)},this.isInsideOf=function(e,i){if(e.isNull())return!1;var s=this._coordinates(this),n=this._coordinates(e);return t(n.start,s.start,i)&&t(s.end,n.end,i)},this.contains=function(e){var i=this._coordinates(this),s=this._coordinates(e);return t(i.start,s.start)&&t(s.end,i.end)},this.includesWithOneBoundary=function(i){var s=this._coordinates(this),n=this._coordinates(i);return e(s.start,n.start)&&t(n.end,s.end)||e(s.end,n.end)&&t(s.start,n.start)},this.overlaps=function(e){var i=this._coordinates(this),s=this._coordinates(e);return!(t(i.end,s.start)||t(s.end,i.start))},this.isLeftAlignedWith=function(t){var i=this._coordinates(this),s=this._coordinates(t);return e(i.start,s.start)},this.isRightAlignedWith=function(t){var i=this._coordinates(this),s=this._coordinates(t);return e(i.end,s.end)},this.splitIntoPropertySelections=function(){for(var t=[],e=this.getContainer(),i=e.getPathRange(this.startPath,this.endPath),s=e.getDocument(),n=0;n<i.length;n++){var r,o,l=i[n];r=0===n?this.startOffset:0,o=n===i.length-1?this.endOffset:s.get(l).length,t.push(new a(l,r,o,!1,this.surfaceId))}return t},this.getFragments=function(){var t=this.splitIntoPropertySelections(),e=r(t,function(t){return new o.Fragment(t.path,t.startOffset,t.endOffset)});return e},this._coordinates=function(t){if(t._internal.containerRange)return t._internal.containerRange;var e,i=this.getContainer(),n=i.getAddress(t.startPath);e=t.isCollapsed()?n:i.getAddress(t.endPath);var r={start:{address:n,offset:t.startOffset},end:{address:e,offset:t.endOffset}};return t instanceof s&&(t._internal.containerRange=r),r};var t=function(t,e,i){return t.address.isBefore(e.address)?!0:t.address.isAfter(e.address)?!1:t.offset>e.offset?!1:i&&t.offset===e.offset?!1:!0},e=function(t,e){return t.address.equals(e.address)&&t.offset===e.offset},i=function(t,e,i){var n=t.getContainer();e.path=n.getPathForAddress(e.address),i.path=n.getPathForAddress(i.address);var r=new s(t.containerId,e.path,e.offset,i.path,i.offset,!1,t.surfaceId),o=t._internal.doc;return o&&r.attach(o),r}},o.extend(s),Object.defineProperties(s.prototype,{path:{get:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead")},set:function(){throw new Error("ContainerSelection has no path property. Use startPath and endPath instead.")}},start:{get:function(){return this._internal.start},set:function(){throw new Error("ContainerSelection.prototype.start is read-only.")}},end:{get:function(){return this._internal.end},set:function(){throw new Error("ContainerSelection.prototype.end is read-only.")}},range:{get:function(){return this._internal.range},set:function(){throw new Error("ContainerSelection.prototype.range is read-only.")}}}),s.fromJSON=function(t){var e=t.containerId,i=t.startPath,n=t.endPath||t.startPath,r=t.startOffset,o=t.endOffset,a=!!t.reverse,l=t.surfaceId,u=new s(e,i,r,n,o,a,l);return u},e.exports=s},{"./PropertySelection":110,"./Selection":112,"lodash/isNumber":337,"lodash/map":346}],88:[function(t,e,i){"use strict";function s(t,e,i){if(this.path=t,this.offset=e,this.after=i,!n(t))throw new Error("Invalid arguments: path should be an array.");if(!r(e)||0>e)throw new Error("Invalid arguments: offset must be a positive number.");Object.isFrozen(t)||Object.freeze(t)}var n=t("lodash/isArray"),r=t("lodash/isNumber"),o=t("../util/isArrayEqual"),a=t("../util/oo");s.Prototype=function(){this.equals=function(t){return t===this||o(t.path,this.path)&&t.offset===this.offset},this.withCharPos=function(t){return new s(this.path,t)},this.getNodeId=function(){return this.path[0]},this.getPath=function(){return this.path},this.getOffset=function(){return this.offset},this.toJSON=function(){return{path:this.path,offset:this.offset,after:this.after}},this.toString=function(){return"("+this.path.join(".")+", "+this.offset+")"}},a.initClass(s),e.exports=s},{"../util/isArrayEqual":483,"../util/oo":486,"lodash/isArray":327,"lodash/isNumber":337}],89:[function(t,e,i){"use strict";function s(t){o.call(this),this.data=t}var n=t("lodash/cloneDeep"),r=t("lodash/isEqual"),o=t("./Selection");s.Prototype=function(){this.toString=function(){return JSON.stringify(this.data)+")"},this.isCustomSelection=function(){return!0},this.toJSON=function(){return{type:"custom",data:n(this.data)}},this.equals=function(t){return o.prototype.equals.call(this,t)&&t.isCustomSelection()&&r(this.data,t.data)}},o.extend(s),s.fromJSON=function(t){return new s(t.data||{})},e.exports=s},{"./Selection":112,"lodash/cloneDeep":309,"lodash/isEqual":332}],90:[function(t,e,i){"use strict";function s(t){if(!t.converters)throw new Error("config.converters is mandatory");this.converters=new a,this.state={doc:null},this.config=r({idAttribute:"id"},t),t.converters.forEach(function(t){return t.type?void this.converters.add(t.type,t):void console.error("Converter must provide the type of the associated node.",t)}.bind(this)),this._el=null,this.$$=this.createElement.bind(this)}var n=t("../util/oo"),r=t("lodash/extend"),o=t("./Fragmenter"),a=t("../util/Registry");s.Prototype=function(){this.exportDocument=function(t){return this.convertDocument(t)},this.convertDocument=function(t){throw new Error("This method is abstract")},this.convertContainer=function(t){if(!t)throw new Error("Illegal arguments: container is mandatory.");var e=t.getDocument();this.state.doc=e;var i=[];return t.nodes.forEach(function(t){var s=e.get(t),n=this.convertNode(s);i.push(n)}.bind(this)),i},this.convertNode=function(t){this.state.doc=t.getDocument();var e=this.getNodeConverter(t);e||(e=this.getDefaultBlockConverter());var i;return i=e.tagName?this.$$(e.tagName):this.$$("div"),i.attr(this.config.idAttribute,t.id),i=e["export"]?e["export"](t,i,this)||i:this.getDefaultBlockConverter()["export"](t,i,this)||i},this.convertProperty=function(t,e,i){this.initialize(t,i);var s=this.$$("div").append(this.annotatedText(e));return s.innerHTML},this.annotatedText=function(t){var e=this,i=this.state.doc,s=i.getIndex("annotations").get(t),n=i.get(t),r=new o;r.onText=function(t,e){t.children.push(e)},r.onEnter=function(t){var e=t.node;return{annotation:e,children:[]}},r.onExit=function(t,i,s){var n=i.annotation,r=e.getNodeConverter(n);r||(r=e.getDefaultPropertyAnnotationConverter());var o;o=r.tagName?this.$$(r.tagName):this.$$("span"),o.attr(this.config.idAttribute,n.id),o.append(i.children),r["export"]&&r["export"](n,o,e),s.children.push(o)}.bind(this);var a={children:[]};return r.start(a,n,s),a.children},this.getNodeConverter=function(t){return this.converters.get(t.type)},this.getDefaultBlockConverter=function(){throw new Error("This method is abstract.")},this.getDefaultPropertyAnnotationConverter=function(){throw new Error("This method is abstract.")},this.getDocument=function(){return this.state.doc},this.createElement=function(t){return this._el.createElement(t)}},n.initClass(s),e.exports=s},{"../util/Registry":479,"../util/oo":486,"./Fragmenter":102,"lodash/extend":315}],91:[function(t,e,i){"use strict";function s(t){if(!t.converters)throw new Error("config.converters is mandatory");this.config=a({idAttribute:"id"},t),this.schema=t.schema,this.state=null,this._defaultBlockConverter=null,this._allConverters=[],this._blockConverters=[],this._propertyAnnotationConverters=[];var e=this.schema,i=e.getDefaultTextType();t.converters.forEach(function(t){var s;if("function"==typeof t?(console.log("installing converter",t),s=new t):s=t,!s.type)return void console.error("Converter must provide the type of the associated node.",s);if(!s.matchElement&&!s.tagName)return void console.error("Converter must provide a matchElement function or a tagName property.",s);s.matchElement||(s.matchElement=this._defaultElementMatcher.bind(s));var n=e.getNodeClass(s.type);n&&(i===s.type&&(this._defaultBlockConverter=s),this._allConverters.push(s),n["static"].isPropertyAnnotation?this._propertyAnnotationConverters.push(s):this._blockConverters.push(s))}.bind(this)),this._initState()}var n=t("../util/oo"),r=t("lodash/each"),o=t("lodash/last"),a=t("lodash/extend"),l=t("../util/uuid"),u=t("../ui/DefaultDOMElement");s.Prototype=function(){this._initState=function(){var t={preserveWhitespace:!1};return this.state=t,this.reset(),t},this.reset=function(){this.state=a(this.state,{nodes:[],inlineNodes:[],containerId:null,container:[],ids:{},stack:[],lastChar:"",skipTypes:{},ignoreAnnotations:!1})},this.createDocument=function(){var t=this._createDocument();return t},this.generateDocument=function(){var t=this.createDocument();return r(this.state.nodes,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)}),r(this.state.inlineNodes,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)}),t},this._createDocument=function(){var t=new this.config.DocumentClass;return t},this.convertContainer=function(t,e){var i=this.state;i.container=[],i.containerId=e;for(var s=new u.NodeIterator(t);s.hasNext();){var n,r=s.next(),o=this._getConverterForElement(r,"block");if(o)n=this._nodeData(r,o.type),n=o["import"](r,n,this)||n,this._createAndShow(n);else if(r.isCommentNode());else if(r.isTextNode()){var a=r.textContent;if(/^\s*$/.exec(a))continue;s.back(),this._wrapInlineElementsIntoBlockElement(s)}else r.isElementNode()&&(s.back(),this._wrapInlineElementsIntoBlockElement(s))}var l={type:"container",id:e,nodes:this.state.container.slice(0)};return this.createNode(l),l},this.convertElement=function(t){return this._convertElement(t)},this._convertElement=function(t,e){var i,s=this._getConverterForElement(t,e);if(!s)throw new Error("No converter found for "+t.tagName);return i=this._nodeData(t,s.type),i=s["import"](t,i,this)||i,this.createNode(i),i},this.createNode=function(t){if(this.state.ids[t.id])throw new Error("Node with id alread exists:"+t.id);this.state.ids[t.id]=!0,this.state.nodes.push(t)},this.show=function(t){this.state.container.push(t.id)},this._createAndShow=function(t){this.createNode(t),this.show(t)},this._nodeData=function(t,e){return{type:e,id:this.getIdForElement(t,e)}},this.annotatedText=function(t,e,i){var s=this.state;if(e){if(s.stack.length>0)throw new Error("Contract: it is not allowed to bind a new call annotatedText to a path while the previous has not been completed.",t.outerHTML);i&&i.preserveWhitespace&&(s.preserveWhitespace=!0),s.stack=[{path:e,offset:0,text:""}]}else if(0===s.stack.length)throw new Error("Contract: DOMImporter.annotatedText() requires 'path' for non-reentrant call.",t.outerHTML);this.state.lastChar="";var n=t.getChildNodeIterator(),r=this._annotatedText(n);return e&&(s.stack.pop(),s.preserveWhitespace=!1),r},this.plainText=function(t){var e=this.state,i=t.textContent;if(e.stack.length>0){var s=o(e.stack);s.offset+=i.length,s.text+=s.text.concat(i)}return i},this.customText=function(t){var e=this.state;if(e.stack.length>0){var i=o(e.stack);i.offset+=t.length,i.text+=i.text.concat(t)}return t},this.nextId=function(t){return l(t)},this.getIdForElement=function(t,e){for(var i=t.getAttribute(this.config.idAttribute)||this.nextId(e);this.state.ids[i];)i=this.nextId(e);return i},this.defaultConverter=function(t,e){this.IGNORE_DEFAULT_WARNINGS||console.warn("This element is not handled by the converters you provided. This is the default implementation which just skips conversion. Override DOMImporter.defaultConverter(el, converter) to change this behavior.",t.outerHTML);var i=this.schema.getDefaultTextType(),s=this._defaultBlockConverter;if(!s)throw new Error("Could not find converter for default type ",i);var n=this._nodeData(t,i);return n=s["import"](t,n,e)||n},this._defaultElementMatcher=function(t){return t.is(this.tagName)},this._annotatedText=function(t){var e=this.state,i=o(e.stack);if(!i)throw new Error("Illegal state: context is null.");for(;t.hasNext();){var s=t.next(),n="";if(s.isTextNode())n=this._prepareText(e,s.textContent),n.length&&(i.text=i.text.concat(n),i.offset+=n.length);else{if(s.isCommentNode())continue;if(s.isElementNode()){var r=this._getConverterForElement(s,"inline");if(!r){this.IGNORE_DEFAULT_WARNINGS||console.warn("Unsupported inline element. We will not create an annotation for it, but process its children to extract annotated text.",s.outerHTML),this.annotatedText(s);continue}var a=i.offset,l=r.type,u=this._nodeData(s,l);if(r["import"]){e.stack.push({path:i.path,offset:a,text:""}),u=r["import"](s,u,this)||u;var c=this.schema.getNodeClass(l);c["static"].isInline?this.customText(""):this.annotatedText(s);var h=e.stack.pop();i.offset=h.offset,i.text=i.text.concat(h.text)}else this.annotatedText(s);var p=i.offset;u.startOffset=a,u.endOffset=p,u.path=i.path.slice(0),e.inlineNodes.push(u)}else console.warn("Unknown element type. Taking plain text.",s.outerHTML),n=this._prepareText(e,s.textContent),i.text=i.text.concat(n),i.offset+=n.length}}return i.text},this._getConverterForElement=function(t,e){var i;if("block"===e){if(!t.tagName)return null;i=this._blockConverters}else i="inline"===e?this._propertyAnnotationConverters:this._allConverters;for(var s=0;s<i.length;s++)if(i[s].matchElement(t))return i[s]},this._createElement=function(t){return this._el.createElement(t)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("div");t.hasNext();){var i=t.next(),s=this._getConverterForElement(i,"block");if(s){t.back();break}e.append(i.clone())}var n=this.defaultConverter(e,this);if(n){if(!n.type)throw new Error("Contract: DOMImporter.defaultConverter() must return a node with type.");this._createAndShow(n)}return n},this._createDefaultBlockElement=function(t){var e=this.defaultConverter(t,this);if(e){if(!e.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.",t.outerHTML);e.id=e.id||this.defaultId(t,e.type),this._createAndShow(e)}};var t=/^\s+/g,e=/^\s*/g,i=/\s+$/g,s=/\s+/g,n=" ",c=/[\t\n\r]+/g;this._prepareText=function(r,o){if(r.preserveWhitespace)return o;var a=n;return o=o.replace(c,""),o=r.lastChar===n?o.replace(e,a):o.replace(t,a),o=o.replace(i,a),(this.config.REMOVE_INNER_WS||r.removeInnerWhitespace)&&(o=o.replace(s,n)),r.lastChar=o[o.length-1]||r.lastChar,o},this._trimTextContent=function(t){var e,i,s=t[0].childNodes,n=s[0],r=r(s);return n&&"text"===this._getDomNodeType(n)&&(e=n.textContent,i=this.trimLeft(e),n.textContent=i),r&&"text"===this._getDomNodeType(r)&&(e=r.textContent,i=this.trimRight(e),r.textContent=i),t},this._trimLeft=function(e){return e.replace(t,"")},this._trimRight=function(t){return t.replace(i,"")}},n.initClass(s),e.exports=s},{"../ui/DefaultDOMElement":445,"../util/oo":486,"../util/uuid":490,"lodash/each":313,"lodash/extend":315,"lodash/last":345}],92:[function(t,e,i){"use strict";function s(){}var n=(t("lodash/isEqual"),t("../util/oo")),r=t("./data/ObjectOperation");s.Prototype=function(){this.shouldMerge=function(t,e){return!1},this.merge=function(t,e){var i=t.ops[0],s=e.ops[0],n=i.diff,o=s.diff,a=!1;return n.isInsert()?n.pos+n.getLength()===o.pos&&(a=i.toJSON(),a.diff.str+=o.str):n.isDelete()&&(n.pos===o.pos?(a=i.toJSON(),a.diff.str+=o.str):o.pos+o.getLength()===n.pos&&(a=i.toJSON(),a.diff=o,a.diff.str+=n.str)),a?(t.ops[0]=r.fromJSON(a),t.ops.length>1&&(t.ops=t.ops.concat(e.ops.slice(1)),t.after=e.after),!0):!1}},n.initClass(s),e.exports=s},{"../util/oo":486,"./data/ObjectOperation":126,"lodash/isEqual":332}],93:[function(t,e,i){"use strict";function s(t){s["super"].apply(this),this.__id__=m++,this.schema=t,this.nodeFactory=new p(this),this.data=new h(t,{nodeFactory:this.nodeFactory}),this.addIndex("type",o.create({property:"type"})),this.addIndex("annotations",new a),this.addIndex("container-annotation-anchors",new l),this.eventProxies={path:new c(this)},this.on("document:changed",this._updateEventProxies,this)}var n=t("lodash/each"),r=t("../util/EventEmitter"),o=t("./DocumentIndex"),a=t("./AnnotationIndex"),l=t("./AnchorIndex"),u=t("./DocumentChange"),c=t("./PathEventProxy"),h=t("./data/IncrementalData"),p=t("./DocumentNodeFactory"),d=t("./Selection"),f=t("./documentHelpers"),m=0;s.Prototype=function(){this.addIndex=function(t,e){return this.data.addIndex(t,e)},this.getIndex=function(t){return this.data.getIndex(t)},this.getNodes=function(){return this.data.nodes},this.getSchema=function(){return this.schema},this.contains=function(t){this.data.contains(t)},this.get=function(t){return this.data.get(t)},this.getNodes=function(){return this.data.getNodes()},this["import"]=function(t){try{this.data._stopIndexing(),t(this),this.data._startIndexing()}finally{this.data.queue=[],this.data._startIndexing()}},this.create=function(t){var e=this._create(t),i=new u([e],{},{});return i._extractInformation(this),this._notifyChangeListeners(i),this.data.get(t.id)},this["delete"]=function(t){var e=this.get(t),i=this._delete(t),s=new u([i],{},{});return s._extractInformation(this),this._notifyChangeListeners(s),e},this.set=function(t,e){var i=this.get(t),s=this._set(t,e),n=new u([s],{},{});return n._extractInformation(this),this._notifyChangeListeners(n),i},this.update=function(t,e){var i=this._update(t,e),s=new u([i],{},{});return s._extractInformation(this),this._notifyChangeListeners(s),i},this.addIndex=function(t,e){return this.data.addIndex(t,e);
},this.getIndex=function(t){return this.data.getIndex(t)},this.createSelection=function(){var t=d.create.apply(null,arguments);return t.attach(this),t},this.getEventProxy=function(t){return this.eventProxies[t]},this.newInstance=function(){var t=this.constructor;return new t(this.schema)},this.fromSnapshot=function(t){var e=this.newInstance();return e.loadSeed(t),e},this.getDocumentMeta=function(){return this.get("document")},this._apply=function(t){n(t.ops,function(t){this.data.apply(t),this.emit("operation:applied",t)}.bind(this)),t._extractInformation(this)},this._notifyChangeListeners=function(t,e){e=e||{},this.emit("document:changed",t,e,this)},this._updateEventProxies=function(t,e){n(this.eventProxies,function(i){i.onDocumentChanged(t,e,this)}.bind(this))},this.loadSeed=function(t){n(this.data.nodes,function(t){this["delete"](t.id)}.bind(this)),n(t.nodes,function(t){this.create(t)}.bind(this))},this.toJSON=function(){var t={};return n(this.getNodes(),function(e){t[e.id]=e.toJSON()}),{schema:[this.schema.name,this.schema.version],nodes:t}},this.getTextForSelection=function(t){return console.warn("DEPRECATED: use docHelpers.getTextForSelection() instead."),f.getTextForSelection(this,t)},this.setText=function(t,e,i){var s,n=this.getIndex("annotations").get(t);for(s=0;s<n.length;s++)this["delete"](n[s].id);for(this.set(t,e),s=0;s<i.length;s++)this.create(i[s])},this._create=function(t){var e=this.data.create(t);return e},this._delete=function(t){var e=this.data["delete"](t);return e},this._update=function(t,e){var i=this.data.update(t,e);return i},this._set=function(t,e){var i=this.data.set(t,e);return i}},r.extend(s),e.exports=s},{"../util/EventEmitter":477,"./AnchorIndex":82,"./AnnotationIndex":83,"./DocumentChange":95,"./DocumentIndex":96,"./DocumentNodeFactory":98,"./PathEventProxy":108,"./Selection":112,"./data/IncrementalData":122,"./documentHelpers":131,"lodash/each":313}],94:[function(t,e,i){"use strict";function s(){Array.apply(this),arguments.length>0&&this._pushVals(arguments)}s.Prototype=function(){this.isBefore=function(t){if(0===this.length)return!1;if(0===t.length)return!1;for(var e=this.length<t.length,i=0;;i++){var s=this[i],n=t[i];if(void 0===s)return e?!0:!1;if(void 0===n)return!1;if(s!==n)return n>s}},this.isAfter=function(t){return t.isBefore(this)},this.isEqual=function(t){return s.equal(this,t)},this.equals=this.isEqual,this.append=function(t){return this._pushVals(t)},this.clone=function(){return(new s).append(this)},this.slice=function(){return(new s)._pushVals(Array.prototype.slice.apply(this,arguments))},this.push=function(){return Array.prototype.push.apply(this,arguments),this},this._pushVals=function(t){return Array.prototype.push.apply(this,t),this}},s.Prototype.prototype=Array.prototype,s.prototype=new s.Prototype,s.prototype.constructor=s,s.equal=function(t,e){var i=t.length;if(i!==e.length)return!1;for(var s=0;i>s;s++)if(t[s]!==e[s])return!1;return!0},e.exports=s},{}],95:[function(t,e,i){"use strict";function s(t,e,i){if(1===arguments.length&&u(arguments[0])){var s=arguments[0];this.sessionId=s.sessionId,this.sha=s.sha,this.timestamp=s.timestamp,this.before=s.before,this.ops=s.ops,this.after=s.after}else{if(3!==arguments.length)throw new Error("Illegal arguments.");this.sha=m(),this.timestamp=Date.now(),this.ops=t.slice(0),this.before=e,this.after=i}this.updated=null,this.created=null,this.deleted=null}function n(t,e){for(var i=0;i<t.ops.length;i++)for(var s=t.ops[i],n=0;n<e.ops.length;n++){var r=e.ops[n];v.transform(s,r,{inplace:!0})}t.before&&o(t.before.selection,e),t.after&&o(t.after.selection,e),e.before&&o(e.before.selection,t),e.after&&o(e.after.selection,t)}function r(t,e){c(t)||(t=[t]),c(e)||(e=[e]);for(var i=0;i<t.length;i++)for(var s=t[i],r=0;r<e.length;r++){var o=e[r];n(s,o)}}function o(t,e){if(!t||!t.isPropertySelection()&&!t.isContainerSelection())return!1;for(var i=e.ops,s=!1,n=t.isCollapsed(),r=0;r<i.length;r++){var o=i[r];s|=a(t.start,o),n?(t.isContainerSelection()&&(t.endPath=t.startPath),t.endOffset=t.startOffset):s|=a(t.end,o)}return s}function a(t,e){if(!l(e.path,t.path))return!1;var i=!1;if("update"===e.type&&"string"===e.propertyType){var s,n=e.diff;n.isInsert()&&n.pos<=t.offset?(s=t.offset+n.str.length,t.offset=s,i=!0):n.isDelete()&&n.pos<=t.offset&&(s=Math.max(n.pos,t.offset-n.str.length),t.offset=s,i=!0)}return i}var l=t("lodash/isEqual"),u=t("lodash/isObject"),c=t("lodash/isArray"),h=t("lodash/map"),p=t("lodash/clone"),d=t("lodash/cloneDeep"),f=t("../util/oo"),m=t("../util/uuid"),g=t("../util/TreeIndex"),b=t("./data/OperationSerializer"),v=t("./data/ObjectOperation"),y=t("./Selection");s.Prototype=function(){this._extractInformation=function(t){function e(e){var i,s,a=e.val;switch(e.type){case"create":case"delete":a.hasOwnProperty("startOffset")&&(i=a.path||a.startPath,r.set(i,!0)),a.hasOwnProperty("endPath")&&(i=a.endPath,r.set(i,!0));break;case"update":case"set":a=t.get(e.path[0]),a&&(s=e.path[1],a.isPropertyAnnotation()?"path"!==s&&"startOffset"!==s&&"endOffset"!==s||n[a.path[0]]||r.set(a.path,!0):a.isContainerAnnotation()&&("startPath"===s||"startOffset"===s||"endPath"===s||"endOffset"===s)&&o.push(a))}}for(var i=this.ops,s={},n={},r=new g,o=[],a=0;a<i.length;a++){var l=i[a];"create"===l.type&&(s[l.val.id]=l.val,delete n[l.val.id]),"delete"===l.type&&(delete s[l.val.id],delete r[l.val.id],n[l.val.id]=l.val),("set"===l.type||"update"===l.type)&&r.set(l.path,!0),e(l)}o.forEach(function(e){var i=t.get(e.container),s=i.getPathRange(e.startPath,e.endPath);s.forEach(function(t){n[t[0]]||r.set(t,!0)})}),this.created=s,this.deleted=n,this.updated=r},this.invert=function(){var t=this.toJSON();t.ops=[];var e=t.before;t.before=t.after,t.after=e;for(var i=s.fromJSON(t),n=[],r=this.ops.length-1;r>=0;r--)n.push(this.ops[r].invert());return i.ops=n,i},this.isAffected=function(t){return!!this.updated.get(t)},this.isUpdated=this.isAffected,this.serialize=function(){var t=new b,e=this.toJSON();return e.ops=this.ops.map(function(e){return t.serialize(e)}),JSON.stringify(e)},this.clone=function(){return s.fromJSON(this.toJSON())},this.toJSON=function(){var t={sessionId:this.sessionId,sha:this.sha,before:p(this.before),ops:h(this.ops,function(t){return t.toJSON()}),after:p(this.after)};t.after.selection=void 0,t.before.selection=void 0;var e=this.before.selection;return e&&e instanceof y&&(t.before.selection=e.toJSON()),e=this.after.selection,e&&e instanceof y&&(t.after.selection=e.toJSON()),t}},f.initClass(s),s.deserialize=function(t){var e=new b,i=JSON.parse(t);return i.ops=i.ops.map(function(t){return e.deserialize(t)}),i.before.selection&&(i.before.selection=y.fromJSON(i.before.selection)),i.after.selection&&(i.after.selection=y.fromJSON(i.after.selection)),new s(i)},s.fromJSON=function(t){var e=d(t);return e.ops=t.ops.map(function(t){return v.fromJSON(t)}),e.before.selection=y.fromJSON(t.before.selection),e.after.selection=y.fromJSON(t.after.selection),new s(e)},s.transformInplace=function(t,e){r(t,e)},s.transformSelection=o,e.exports=s},{"../util/TreeIndex":480,"../util/oo":486,"../util/uuid":490,"./Selection":112,"./data/ObjectOperation":126,"./data/OperationSerializer":128,"lodash/clone":308,"lodash/cloneDeep":309,"lodash/isArray":327,"lodash/isEqual":332,"lodash/isObject":338,"lodash/map":346}],96:[function(t,e,i){"use strict";function s(){}var n=t("./data/NodeIndex");n.extend(s),e.exports=n},{"./data/NodeIndex":124}],97:[function(t,e,i){"use strict";function s(t,e){if(r.call(this,e),!t)throw new Error("Document instance is mandatory.");this.document=t}var n=t("lodash/each"),r=t("./data/Node");s.Prototype=function(){this.getDocument=function(){return this.document},this.hasParent=function(){return!!this.parent},this.getParent=function(){return this.document.get(this.parent)},this.hasChildren=function(){return!1},this.getChildIndex=function(t){return-1},this.getChildAt=function(t){return null},this.getChildCount=function(){return 0},this.getRoot=function(){for(var t=this;t.hasParent();)t=t.getParent();return t},this.getAddressablePropertyNames=function(){var t=this.constructor["static"].addressablePropertyNames;return t||[]},this.hasAddressableProperties=function(){return this.getAddressablePropertyNames().length>0},this.getPropertyNameAt=function(t){var e=this.constructor["static"].addressablePropertyNames||[];return e[t]},this.setHighlighted=function(t,e){this.highlighted!==t&&(this.highlightedScope=e,this.highlighted=t,this.emit("highlighted",t))},this.connect=function(t,e){n(e,function(t,e){var i=/([a-zA-Z_0-9]+):changed/.exec(e);if(i){var s=i[1];this.constructor["static"].schema[s]&&this.getDocument().getEventProxy("path").connect(this,[this.id,s],this._onPropertyChange.bind(this,s))}}.bind(this)),r.prototype.connect.apply(this,arguments)},this.disconnect=function(){r.prototype.disconnect.apply(this,arguments)},this._onPropertyChange=function(t){var e=[t+":changed"].concat(Array.prototype.slice.call(arguments,1));this.emit.apply(this,e)},this.isBlock=function(){return this.constructor["static"].isBlock},this.isText=function(){return this.constructor["static"].isText},this.isPropertyAnnotation=function(){return this.constructor["static"].isPropertyAnnotation},this.isInline=function(){return this.constructor["static"].isInline},this.isContainerAnnotation=function(){return this.constructor["static"].isContainerAnnotation}},r.extend(s),s["static"].name="node",s["static"].isBlock=!1,s["static"].isText=!1,s["static"].isPropertyAnnotation=!1,s["static"].isContainerAnnotation=!1,s["static"].isInline=!1,e.exports=s},{"./data/Node":123,"lodash/each":313}],98:[function(t,e,i){"use strict";function s(t){s["super"].call(this),this.doc=t,t.schema.each(function(t){this.register(t)}.bind(this))}var n=t("./data/NodeRegistry");s.Prototype=function(){this.create=function(t,e){var i=this.get(t);if(!i)throw new Error("No Node registered by that name: "+t);return new i(this.doc,e)}},n.extend(s),e.exports=s},{"./data/NodeRegistry":125}],99:[function(t,e,i){"use strict";function s(t,e){s["super"].call(this,t,e)}var n=t("./data/Schema"),r=t("./DocumentNode"),o=t("./Container"),a=t("./PropertyAnnotation"),l=t("./ContainerAnnotation");s.Prototype=function(){this.getDefaultTextType=function(){throw new Error("DocumentSchema.getDefaultTextType() is abstract and must be overridden.")},this.isAnnotationType=function(t){var e=this.getNodeClass(t);return e&&e.prototype instanceof a},this.getBuiltIns=function(){return[r,a,o,l]}},n.extend(s),e.exports=s},{"./Container":85,"./ContainerAnnotation":86,"./DocumentNode":97,"./PropertyAnnotation":109,"./data/Schema":129}],100:[function(t,e,i){"use strict";function s(t,e){s["super"].apply(this),this.__id__=p++,this.sessionId=p,e=e||{},this.doc=t,this.selection=c.nullSelection,this.stage=new l(this.doc,this),this.isTransacting=!1,this.doneChanges=[],this.undoneChanges=[],this._lastChange=null,this.compressor=e.compressor||new u,this.doc.on("document:changed",this.onDocumentChange,this,{priority:1e3}),this.doc.on("document:changed",this.afterDocumentChange,this,{priority:-10})}var n=t("lodash/extend"),r=t("lodash/each"),o=t("../util/oo"),a=t("../util/EventEmitter"),l=t("./TransactionDocument"),u=t("./DefaultChangeCompressor"),c=t("./Selection"),h=t("./DocumentChange"),p=0;s.Prototype=function(){this.getDocument=function(){return this.doc},this.getSelection=function(){return this.selection},this.setSelection=function(t){this.selection=t,this.emit("selection:changed",t,this),this.emit("selection:changed:explicitly",t,this)},this.getCollaborators=function(){return null},this.canUndo=function(){return this.doneChanges.length>0},this.canRedo=function(){return this.undoneChanges.length>0},this.undo=function(){var t=this.doneChanges.pop();t?(this.stage._apply(t),this.doc._apply(t),t.after.selection&&(this.selection=t.after.selection),this.undoneChanges.push(t.invert()),this._notifyChangeListeners(t,{replay:!0})):console.error("No change can be undone.")},this.redo=function(){var t=this.undoneChanges.pop();t?(this.stage._apply(t),this.doc._apply(t),t.after.selection&&(this.selection=t.after.selection),this.doneChanges.push(t.invert()),this._notifyChangeListeners(t,{replay:!0})):console.error("No change can be redone.")},this.transaction=function(t,e){if(this.isTransacting)throw new Error("Nested transactions are not supported.");this.isTransacting=!0,this.stage.reset();var i=this.selection;e=e||{};var s=i.surfaceId,r=this.stage._transaction(function(r){r.before.selection=i;var o={selection:i},a=t(r,o)||{};i=a.selection||i,i instanceof c&&!i.isNull()&&!i.surfaceId&&(i.surfaceId=s),r.after.selection=i,n(e,r.info)});return r?(r.after.selection instanceof c&&(this.selection=r.after.selection,this.selection&&!this.selection.isNull()&&r.after.surfaceId&&(this.selection.surfaceId=r.after.surfaceId),this._selectionHasChanged=!0),this.isTransacting=!1,this._commit(r,e),r):void(this.isTransacting=!1)},this.onDocumentChange=function(t,e){e.session!==this&&(this.stage._apply(t),this._transformLocalChangeHistory(t,e),this._transformSelections(t,e))},this._transformLocalChangeHistory=function(t){var e={ops:t.ops.map(function(t){return t.clone()})};h.transformInplace(e,this.doneChanges),h.transformInplace(e,this.undoneChanges)},this._transformSelections=function(t){this._selectionHasChanged=h.transformSelection(this.selection,t);var e=this.getCollaborators();e&&r(e,function(e){h.transformSelection(e.selection,t)})},this.afterDocumentChange=function(){this._selectionHasChanged&&(this._selectionHasChanged=!1,this.emit("selection:changed",this.selection,this))},this._commit=function(t,e){t.sessionId=this.sessionId,t.timestamp=Date.now(),this.doc._apply(t);var i=this.getCollaborators();i&&r(i,function(e){h.transformSelection(e.selection,t)});var s=this._currentChange,n=!1;s&&this.compressor.shouldMerge(s,t)&&(n=this.compressor.merge(s,t)),n||(this._currentChange=t,this.doneChanges.push(t.invert())),this.undoneChanges=[],this._notifyChangeListeners(t,e)},this._notifyChangeListeners=function(t,e){e=e||{},e.session=this,this.doc._notifyChangeListeners(t,e)}},o.inherit(s,a),e.exports=s},{"../util/EventEmitter":477,"../util/oo":486,"./DefaultChangeCompressor":92,"./DocumentChange":95,"./Selection":112,"./TransactionDocument":115,"lodash/each":313,"lodash/extend":315}],101:[function(t,e,i){"use strict";function s(){this._merge={},this._mergeComponents={},this._break={}}var n=t("../util/oo");s.Prototype=function(){this.defineMerge=function(t,e,i){return this._merge[t]||(this._merge[t]={}),this._merge[t][e]=i,this},this.canMerge=function(t,e){return this._merge[t]&&this._merge[t][e]},this.getMerger=function(t,e){return this._merge[t][e]},this.defineComponentMerge=function(t,e){this._mergeComponents[t]=e},this.canMergeComponents=function(t){return this._mergeComponents[t]},this.getComponentMerger=function(t){return this._mergeComponents[t]},this.defineBreak=function(t,e){return this._break[t]=e,this},this.canBreak=function(t){return this._break[t]},this.getBreaker=function(t){return this._break[t]}},n.initClass(s),e.exports=s},{"../util/oo":486}],102:[function(t,e,i){"use strict";var s=t("../util/oo"),n=t("lodash/extend"),r=t("lodash/each"),o=1,a=-1,l=-2,u=function(t){n(this,t)};u.Prototype=function(){function t(t){var s=[],n=[];r(t,function(t){var e=t.isAnchor?t.isAnchor():!1;if(e)s.push({mode:l,pos:t.offset,id:t.id,level:u.ALWAYS_ON_TOP,type:"anchor",node:t,counter:-1,length:0});else{var i=u.NORMAL,r=t.isInline?t.isInline():!1;r?i=Number.MAX_VALUE:t.constructor["static"]&&t.constructor["static"].hasOwnProperty("fragmentation")?i=t.constructor["static"].fragmentation:t.hasOwnProperty("fragmentationHint")&&(i=t.fragmentationHint);var c=Math.min(t.startOffset,t.endOffset),h=Math.max(t.startOffset,t.endOffset),p={pos:c,mode:o,level:i,id:t.id,type:t.type,node:t,length:0,counter:-1};s.push(p),n.push({pos:h,mode:a,level:i,id:t.id,type:t.type,node:t,opener:p})}}),s.sort(e);for(var c=s.length-1;c>=0;c--)s[c].idx=c;n.sort(i);for(var h=[],p=0,d=0,f=0;;){var m=s[d],g=n[f];if(m&&g)g.pos<=m.pos&&g.opener!==m?(h[p]=g,p++,f++):(h[p]=m,p++,d++);else if(m)h[p++]=m,d++;else{if(!g)break;h[p++]=g,f++}}return h}function e(t,e){if(t.pos<e.pos)return-1;if(t.pos>e.pos)return 1;if(t.mode<e.mode)return-1;if(t.mode>e.mode)return 1;if(t.mode===e.mode){if(t.level<e.level)return-1;if(t.level>e.level)return 1}return 0}function i(t,e){return t.pos<e.pos?-1:t.pos>e.pos?1:t.pos===t.opener.pos&&e.pos===e.opener.pos?t.opener.idx<e.opener.idx?-1:1:t.opener.idx>e.opener.idx?-1:t.opener.idx<e.opener.idx?1:0}this.start=function(t,e,i){return this._start(t,e,i)},this.onText=function(t,e,i){},this.onEnter=function(t,e){return null},this.onExit=function(t,e,i){},this._enter=function(t,e){return t.counter++,this.onEnter(t,e)},this._exit=function(t,e,i){this.onExit(t,e,i)},this._createText=function(t,e,i){this.onText(t,e,i)},this._start=function(e,i,s){for(var n=t.call(this,s),r=[{context:e,entry:null}],u=0,c=0;c<n.length;c++){var h=n[c],p=i.substring(u,h.pos);p&&this._createText(r[r.length-1].context,p,h),u=h.pos;var d,f,m;if(h.mode===o||h.mode===l){for(d=1;d<r.length&&!(h.level<r[d].entry.level);d++);for(f=r.length-1;f>=d;f--)m=r[f].entry,m.length=u-m.pos,this._exit(m,r[f].context,r[f-1].context);for(r.splice(d,0,{entry:h}),f=d;f<r.length;f++)m=r[f].entry,m.pos=u,r[f].context=this._enter(m,r[f-1].context)}if(h.mode===a||h.mode===l){for(d=1;d<r.length&&r[d].entry.node!==h.node;d++);for(f=r.length-1;f>=d;f--)m=r[f].entry,m.length=u-m.pos,this._exit(m,r[f].context,r[f-1].context);for(r.splice(d,1),f=d;f<r.length;f++)m=r[f].entry,m.pos=u,r[f].context=this._enter(m,r[f-1].context)}}var g=i.substring(u);g&&this._createText(e,g)}},s.initClass(u),u.SHOULD_NOT_SPLIT=0,u.NORMAL=10,u.ANY=100,u.ALWAYS_ON_TOP=Number.MAX_VALUE,e.exports=u},{"../util/oo":486,"lodash/each":313,"lodash/extend":315}],103:[function(t,e,i){"use strict";function s(t){t=o({idAttribute:"data-id"},t),n.call(this,t),this._el=r.parseHTML("<html></html>")}var n=t("./DOMExporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/extend"),a=t("lodash/each"),l=t("lodash/isBoolean"),u=t("lodash/isNumber"),c=t("lodash/isString");s.Prototype=function(){this.exportDocument=function(t){var e=r.parseHTML("<html><head></head><body></body></html>");return this.convertDocument(t,e)};var t={tagName:"span","export":function(t,e){e=e.withTagName("span"),e.attr("data-type",t.type);var i=t.toJSON();a(i,function(t,i){"id"!==i&&"type"!==i&&(c(t)||u(t)||l(t))&&e.attr("data-"+i,t)})}},e={"export":function(t,e,i){e.attr("data-type",t.type);var s=t.toJSON();a(s,function(s,n){if("id"!==n&&"type"!==n){var r=i.$$("div").attr("property",n);"string"===t.getPropertyType(n)?r.append(i.annotatedText([t.id,n])):r.text(s),e.append(r)}})}};this.getDefaultBlockConverter=function(){return e},this.getDefaultPropertyAnnotationConverter=function(){return t}},n.extend(s),e.exports=s},{"../ui/DefaultDOMElement":445,"./DOMExporter":90,"lodash/each":313,"lodash/extend":315,"lodash/isBoolean":330,"lodash/isNumber":337,"lodash/isString":340}],104:[function(t,e,i){"use strict";function s(t){t=o({idAttribute:"data-id"},t),n.call(this,t),this._el=r.parseHTML("<html></html>")}var n=t("./DOMImporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/extend");s.Prototype=function(){this.importDocument=function(t){this.reset();var e=r.parseHTML(t);this.convertDocument(e);var i=this.generateDocument();return i},this.convertDocument=function(t){throw new Error("This method is abstract")}},n.extend(s),e.exports=s},{"../ui/DefaultDOMElement":445,"./DOMImporter":91,"lodash/extend":315}],105:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./PropertyAnnotation");n.extend(s),s["static"].isInline=!0,e.exports=s},{"./PropertyAnnotation":109}],106:[function(t,e,i){"use strict";function s(){}var n=t("../util/oo"),r=t("lodash/isArray"),o=t("lodash/each");s.Prototype=function(){this.importDocument=function(t,e){if(!e.schema||!r(e.nodes))throw new Error("Invalid JSON format.");var i=t.getSchema();if(i.name!==e.schema.name)throw new Error("Incompatible schema.");i.version!==e.schema.version&&console.error("Different schema version. Conversion might be problematic.");var s=e.nodes;return t["import"](function(t){o(s,function(e){t.get(e.id)&&t["delete"](e.id),t.create(e)})}),t},this.exportDocument=function(t){var e=t.getSchema(),i={schema:{name:e.name,version:e.version},nodes:[]};return o(t.getNodes(),function(t){i.nodes.push(t.toJSON())}),i}},n.initClass(s),e.exports=s},{"../util/oo":486,"lodash/each":313,"lodash/isArray":327}],107:[function(t,e,i){"use strict";var s={hasChildren:function(){return!0},getChildrenProperty:function(){throw new Error("ParentNodeMixin.getChildrenProperty is abstract and must be implemented in "+this.constructor.name+".")},getChildIndex:function(t){return this[this.getChildrenProperty()].indexOf(t.id)},getChildren:function(){var t=this.getDocument(),e=this[this.getChildrenProperty()];return e.map(function(e){return t.get(e)}.bind(this))},getChildAt:function(t){var e=this[this.getChildrenProperty()];if(0>t||t>=e.length)throw new Error("Array index out of bounds: "+t+", "+e.length);return this.getDocument().get(e[t])},getChildCount:function(){return this[this.getChildrenProperty()].length},getAddressablePropertyNames:function(){return[this.getChildrenProperty()]}};e.exports=s},{}],108:[function(t,e,i){"use strict";var s=t("../util/oo"),n=t("lodash/each"),r=t("../util/TreeIndex"),o=function(t){this.listeners=new r.Arrays,this._list=[],this.doc=t};o.Prototype=function(){this.onDocumentChanged=function(t,e,i){if(0!==this._list.length){var s=this.listeners;t.updated.forEach(function(r,o){var a=s.get(o);n(a,function(s){s.method.call(s.listener,t,e,i)})}.bind(this))}},this._add=function(t,e,i){if(!i)throw new Error("Invalid argument: expected function but got "+i);var s={path:t,method:i,listener:e};this.listeners.add(t,s),this._list.push(s)},this.connect=function(t,e,i){this._add(e,t,i)},this.disconnect=function(t){for(var e=0;e<this._list.length;e++)if(this._list[e].listener===t){var i=this._list[e];this._list.splice(e,1),this.listeners.remove(i.path,i)}},this.add=function(t,e,i){return console.warn("DEPRECATED: use PathEventProxy#connect(this, path, method) instead."),this._add(t,e,i)},this.remove=function(t,e){console.warn("DEPRECATED: use PathEventProxy#disconnect(this) instead."),this.disconnect(e)}},s.initClass(o),e.exports=o},{"../util/TreeIndex":480,"../util/oo":486,"lodash/each":313}],109:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("lodash/isEqual"),r=t("./DocumentNode");s.Prototype=function(){this.getText=function(){var t=this.getDocument();if(!t)return console.warn("Trying to use an PropertyAnnotation which is not attached to the document."),"";var e=t.get(this.path);return e.substring(this.startOffset,this.endOffset)},this.canSplit=function(){return!0},this.isAnchor=function(){return!1},this.getSelection=function(){return this.getDocument().createSelection({type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset})},this.updateRange=function(t,e){if(!e.isPropertySelection())throw new Error("Cannot change to ContainerAnnotation.");n(this.startPath,e.start.path)||t.set([this.id,"path"],e.start.path),this.startOffset!==e.start.offset&&t.set([this.id,"startOffset"],e.start.offset),this.endOffset!==e.end.offset&&t.set([this.id,"endOffset"],e.end.offset)}},r.extend(s),s["static"].name="annotation",s["static"].defineSchema({path:["string"],startOffset:"number",endOffset:"number"}),s["static"].isPropertyAnnotation=!0,Object.defineProperties(s.prototype,{startPath:{get:function(){return this.path}},endPath:{get:function(){return this.path}}}),e.exports=s},{"./DocumentNode":97,"lodash/isEqual":332}],110:[function(t,e,i){"use strict";function s(t,e,i,s,o){if(l.call(this),this.path=t,this.startOffset=e,this.endOffset=i,this.reverse=!!s,this.surfaceId=o,!t||!a(e))throw new Error("Invalid arguments: `path` and `startOffset` are mandatory");this._internal.start=new n(this,"path","startOffset"),this._internal.end=new n(this,"path","endOffset"),this._internal.range=new r(this)}function n(t,e,i){this._sel=t,this._pathProp=e,this._offsetProp=i,Object.freeze(this)}function r(t){this._sel=t,this.start=t.start,this.end=t.end,Object.freeze(this)}var o=t("lodash/isEqual"),a=t("lodash/isNumber"),l=t("./Selection"),u=t("./Coordinate"),c=t("./Range");s.Prototype=function(){this.toJSON=function(){return{type:"property",path:this.path,startOffset:this.startOffset,endOffset:this.endOffset,reverse:this.reverse,surfaceId:this.surfaceId}},this.isPropertySelection=function(){return!0},this.isNull=function(){return!1},this.isCollapsed=function(){return this.startOffset===this.endOffset},this.isReverse=function(){return this.reverse},this.equals=function(t){return l.prototype.equals.call(this,t)&&this.start.equals(t.start)&&this.end.equals(t.end)},this.toString=function(){return["PropertySelection(",JSON.stringify(this.path),", ",this.startOffset," -> ",this.endOffset,this.reverse?", reverse":"",")"].join("")},this.collapse=function(t){var e;return e="left"===t?this.startOffset:this.endOffset,this.createWithNewRange(e,e)},this.getRange=function(){return this.range},this.getPath=function(){return this.path},this.getStartOffset=function(){return this.startOffset},this.getEndOffset=function(){return this.endOffset},this.isInsideOf=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.contains(this):e?o(this.path,t.path)&&this.startOffset>t.startOffset&&this.endOffset<t.endOffset:o(this.path,t.path)&&this.startOffset>=t.startOffset&&this.endOffset<=t.endOffset},this.contains=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.isInsideOf(this):e?o(this.path,t.path)&&this.startOffset<t.startOffset&&this.endOffset>t.endOffset:o(this.path,t.path)&&this.startOffset<=t.startOffset&&this.endOffset>=t.endOffset},this.overlaps=function(t,e){return t.isNull()?!1:t.isContainerSelection()?t.overlaps(this):o(this.path,t.path)?e?!(this.startOffset>=t.endOffset||this.endOffset<=t.startOffset):!(this.startOffset>t.endOffset||this.endOffset<t.startOffset):!1},this.isRightAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isRightAlignedWith(this):o(this.path,t.path)&&this.endOffset===t.endOffset},this.isLeftAlignedWith=function(t){return t.isNull()?!1:t.isContainerSelection()?t.isLeftAlignedWith(this):o(this.path,t.path)&&this.startOffset===t.startOffset},this.expand=function(t){if(t.isNull())return this;if(t.isContainerSelection())return t.expand(this);if(!o(this.path,t.path))throw new Error("Can not expand PropertySelection to a different property.");var e=Math.min(this.startOffset,t.startOffset),i=Math.max(this.endOffset,t.endOffset);return this.createWithNewRange(e,i)},this.createWithNewRange=function(t,e){var i=new s(this.path,t,e,!1,this.surfaceId),n=this._internal.doc;return n&&i.attach(n),i},this.truncate=function(t){if(t.isNull())return this;if(!o(this.startPath,t.startPath)||!o(this.endPath,t.endPath))throw new Error("Can not expand PropertySelection to a different property.");var e,i;return this.startOffset===t.startOffset?(e=t.endOffset,i=this.endOffset):this.endOffset===t.endOffset&&(e=this.startOffset,i=t.startOffset),this.createWithNewRange(e,i)},this.getFragments=function(){return this.isCollapsed()?[new l.Cursor(this.path,this.startOffset)]:[new l.Fragment(this.path,this.startOffset,this.endOffset)]}},l.extend(s),Object.defineProperties(s.prototype,{start:{get:function(){return this._internal.start},set:function(){throw new Error("PropertySelection.prototype.start is read-only.")},enumerable:!1},end:{get:function(){return this._internal.end},set:function(){throw new Error("PropertySelection.prototype.end is read-only.")},enumerable:!1},range:{get:function(){return this._internal.range},set:function(){throw new Error("PropertySelection.prototype.range is read-only.")},enumerable:!1},startPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1},endPath:{get:function(){return this.path},set:function(){throw new Error("immutable.")},enumerable:!1}}),s.fromJSON=function(t){var e=t.path,i=t.startOffset,n=t.hasOwnProperty("endOffset")?t.endOffset:t.startOffset,r=t.reverse,o=t.surfaceId;return new s(e,i,n,r,o)},u.extend(n),Object.defineProperties(n.prototype,{path:{get:function(){return this._sel[this._pathProp]},set:function(t){this._sel[this._pathProp]=t}},offset:{get:function(){return this._sel[this._offsetProp]},set:function(t){this._sel[this._offsetProp]=t}}}),s.CoordinateAdapter=n,c.extend(r),Object.defineProperties(r.prototype,{reverse:{get:function(){return this._sel.reverse},set:function(t){this._sel.reverse=t}},surfaceId:{get:function(){return this._sel.surfaceId},set:function(t){this._sel.surfaceId=t}}}),s.RangeAdapter=r,e.exports=s},{"./Coordinate":88,"./Range":111,"./Selection":112,"lodash/isEqual":332,"lodash/isNumber":337}],111:[function(t,e,i){"use strict";var s=t("../util/oo"),n=function(t,e,i,s){this.start=t,this.end=e,this.reverse=!!i,this.containerId=s};n.Prototype=function(){this.isCollapsed=function(){return this.start.equals(this.end)},this.equals=function(t){return this===t?!0:this.containerId===t.containerId&&this.start.equals(t.start)&&this.end.equals(t.end)},this.isReverse=function(){return this.reverse},this.toString=function(){var t=[this.start.toString(),"->",this.end.toString()];return this.isReverse()&&t.push("(reverse)"),t.join("")}},s.initClass(n),e.exports=n},{"../util/oo":486}],112:[function(t,e,i){"use strict";function s(){var t={};Object.defineProperty(this,"_internal",{enumerable:!1,value:t}),t.doc=null}var n=t("lodash/isEqual"),r=t("lodash/isArray"),o=t("lodash/isObject"),a=t("lodash/isString"),l=t("../util/oo"),u=t("../util/EventEmitter"),c=t("./Coordinate"),h=t("./Range"),p=t("./Anchor");s.Prototype=function(){this.getDocument=function(){var t=this._internal.doc;if(!t)throw new Error("Selection is not attached to a document.");return t},this.attach=function(t){return this._internal.doc=t,this},this.isNull=function(){return!1},this.isPropertySelection=function(){return!1},this.isContainerSelection=function(){return!1},this.isCustomSelection=function(){return!1},this.isTableSelection=function(){return!1},this.isCollapsed=function(){return!0},this.isReverse=function(){return!1},this.equals=function(t){return this===t?!0:t?this.isNull()!==t.isNull()?!1:!0:!1},this.toString=function(){return"null"},this.toJSON=function(){throw new Error("This method is abstract.")},this.getFragments=function(){return[]}},l.initClass(s),s.NullSelection=function(){s.call(this)},s.NullSelection.Prototype=function(){this.isNull=function(){return!0},this.toJSON=function(){return null},this.clone=function(){return this}},s.extend(s.NullSelection),s.nullSelection=Object.freeze(new s.NullSelection),s.fromJSON=function(e){if(!e)return s.nullSelection;var i=e.type;switch(i){case"property":var n=t("./PropertySelection");return n.fromJSON(e);case"container":var r=t("./ContainerSelection");return r.fromJSON(e);case"custom":var o=t("./CustomSelection");return o.fromJSON(e);case"default":return console.error("Selection.fromJSON(): unsupported selection data",e),s.nullSelection}},s.create=function(){var e,i,l=t("./PropertySelection"),u=t("./ContainerSelection");if(1===arguments.length&&null===arguments[0])return s.nullSelection;var p;if(arguments[0]instanceof c)e=arguments[0],p=new l(e.start.path,e.start.offset,e.end.offset,!1);else if(arguments[0]instanceof h)i=arguments[0],p=n(i.start.path,i.end.path)?new l(i.start.path,i.start.offset,i.end.offset,i.reverse):new u(i.containerId,i.start.path,i.start.offset,i.end.path,i.end.offset,i.isReverse());else if(1===arguments.length&&o(arguments[0])){var d=arguments[0];switch(d.type){case"property":p=new l.fromJSON(d);break;case"container":p=new u.fromJSON(d);break;default:throw new Error("Unsupported selection type",d.type)}}else 2===arguments.length&&r(arguments[0])?p=new l(arguments[0],arguments[1],arguments[1]):3===arguments.length&&r(arguments[0])?p=new l(arguments[0],arguments[1],arguments[2]):5===arguments.length&&a(arguments[0])?p=new u(arguments[0],arguments[1],arguments[2],arguments[3],arguments[4]):(console.error("Illegal arguments for Selection.create().",arguments),
p=s.nullSelection);return p},s.Fragment=function(t,e,i){u.call(this),this.type="selection-fragment",this.path=t,this.startOffset=e,this.endOffset=i||e},s.Fragment.Prototype=function(){this.isAnchor=function(){return!1},this.isInline=function(){return!1}},u.extend(s.Fragment),s.Cursor=function(t,e){p.call(this,t,e),this.type="cursor"},p.extend(s.Cursor),e.exports=s},{"../util/EventEmitter":477,"../util/oo":486,"./Anchor":81,"./ContainerSelection":87,"./Coordinate":88,"./CustomSelection":89,"./PropertySelection":110,"./Range":111,"lodash/isArray":327,"lodash/isEqual":332,"lodash/isObject":338,"lodash/isString":340}],113:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./TextNode");n.extend(s),s["static"].isBlock=!0,e.exports=s},{"./TextNode":114}],114:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./DocumentNode");s.Prototype=function(){this.getTextPath=function(){return[this.id,"content"]},this.getText=function(){return this.content}},n.extend(s),s["static"].name="text",s["static"].isText=!0,s["static"].defineSchema({content:"text"}),e.exports=s},{"./DocumentNode":97}],115:[function(t,e,i){"use strict";function s(t,e){this.__id__="TX_"+h++,this.schema=t.schema,this.nodeFactory=new c(this),this.data=new u(this.schema,{nodeFactory:this.nodeFactory}),this.document=t,this.session=e,this.ops=[],this.before={},o(t.data.indexes,function(t,e){this.data.addIndex(e,t.clone())}.bind(this)),this.loadSeed(t.toJSON())}var n=t("lodash/isFunction"),r=t("lodash/extend"),o=t("lodash/each"),a=t("./Document"),l=t("./DocumentChange"),u=t("./data/IncrementalData"),c=t("./DocumentNodeFactory"),h=0;s.Prototype=function(){this.reset=function(){this.ops=[],this.before={}},this.create=function(t){var e=this.data.create(t);if(e)return this.ops.push(e),this.data.get(t.id)},this["delete"]=function(t){var e=this.data["delete"](t);if(e)return this.ops.push(e),e},this.set=function(t,e){var i=this.data.set(t,e);if(i)return this.ops.push(i),i},this.update=function(t,e){var i=this.data.update(t,e);if(i)return this.ops.push(i),i},this.cancel=function(){this._cancelTransaction()},this.getOperations=function(){return this.ops},this._apply=function(t){t.ops.forEach(function(t){this.data.apply(t)}.bind(this))},this._transaction=function(t){if(!n(t))throw new Error("Document.transaction() requires a transformation function.");this._startTransaction();try{if(t(this,{}),!this._isCancelled)return this._saveTransaction()}finally{this._isSaved||this.cancel(),this.session.isTransacting=!1}},this._startTransaction=function(){this.before={},this.after={},this.info={},this._isCancelled=!1,this._isSaved=!1,this.document.emit("transaction:started",this)},this._saveTransaction=function(){if(!this._isCancelled){var t,e=this.before,i=r({},e,this.after),s=this.ops;return s.length>0&&(t=new l(s,e,i)),this._isSaved=!0,this.reset(),t}},this._cancelTransaction=function(){for(var t=this.ops.length-1;t>=0;t--)this.data.apply(this.ops[t].invert());this._isCancelled=!0,this.reset()},this.newInstance=function(){return this.document.newInstance()}},a.extend(s),e.exports=s},{"./Document":93,"./DocumentChange":95,"./DocumentNodeFactory":98,"./data/IncrementalData":122,"lodash/each":313,"lodash/extend":315,"lodash/isFunction":333}],116:[function(t,e,i){"use strict";function s(t){t=o({idAttribute:"id"},t),n.call(this,t),this._el=r.parseXML("<dummy></dummy>")}var n=t("./DOMImporter"),r=t("../ui/DefaultDOMElement"),o=t("lodash/extend");s.Prototype=function(){this.importDocument=function(t){this.reset();var e=r.parseXML(t);this.convertDocument(e);var i=this.generateDocument();return i}},n.extend(s),e.exports=s},{"../ui/DefaultDOMElement":445,"./DOMImporter":91,"lodash/extend":315}],117:[function(t,e,i){"use strict";var s=t("lodash/each"),n=t("lodash/uniq"),r=t("../util/uuid"),o=function(t,e,i){if(i){var n=t.getIndex("annotations"),r=n.get(e.path);s(r,function(s){var n=e.offset,r=s.startOffset,o=s.endOffset,a=r,l=o;(r>n||n===r)&&(a+=i),(o>n||n===o&&!s.isInline())&&(l+=i),a!==r&&t.set([s.id,"startOffset"],a),l!==o&&t.set([s.id,"endOffset"],l)}),n=t.getIndex("container-annotation-anchors");var o=n.get(e.path);s(o,function(s){var n=e.offset,r=s.offset,o=!1;if((r>n||n===r&&!e.after)&&(r+=i,o=!0),o){var a=s.isStart?"startOffset":"endOffset";t.set([s.id,a],r)}})}},a=function(t,e,i,r){if(i!==r){var o=t.getIndex("annotations"),a=o.get(e),l=r-i;s(a,function(e){var s=i,n=r,o=e.startOffset,a=e.endOffset,u=o,c=a;o>=n?(u-=l,c-=l,t.set([e.id,"startOffset"],u),t.set([e.id,"endOffset"],c)):(o>=s&&(u=o-Math.min(n-s,o-s)),a>=s&&(c=a-Math.min(n-s,a-s)),o!==a&&u===c?t["delete"](e.id):(o!==u&&t.set([e.id,"startOffset"],u),a!==c&&t.set([e.id,"endOffset"],c)))}),o=t.getIndex("container-annotation-anchors");var u=o.get(e),c=[];s(u,function(e){c.push(e.id);var s=i,n=r,o=e.offset,a=!1;if(o>=n)o-=l,a=!0;else if(o>=s){var u=o-Math.min(n-s,o-s);o!==u&&(o=u,a=!0)}if(a){var h=e.isStart?"startOffset":"endOffset";t.set([e.id,h],o)}}),s(n(c),function(e){var i=t.get(e),s=i.getSelection();s.isCollapsed()&&(console.log("...deleting container annotation because it has collapsed"+e),t["delete"](e))})}},l=function(t,e,i,o,a){var l=t.getIndex("annotations"),u=l.get(e,i);s(u,function(e){var s,n,l=i>e.startOffset&&i<e.endOffset,u=e.startOffset,c=e.endOffset;if(l){if(e.canSplit()){var h=e.toJSON();h.id=r(e.type+"_"),h.startOffset=a,h.endOffset=a+e.endOffset-i,h.path=o,t.create(h)}s=e.startOffset,n=i,n===s?t["delete"](e.id):(s!==u&&t.set([e.id,"startOffset"],s),n!==c&&t.set([e.id,"endOffset"],n))}else e.startOffset>=i&&(s=a+e.startOffset-i,n=a+e.endOffset-i,t.set([e.id,"path"],o),t.set([e.id,"startOffset"],s),t.set([e.id,"endOffset"],n))}),l=t.getIndex("container-annotation-anchors");var c=l.get(e),h=[];s(c,function(e){h.push(e.id);var s=e.offset;if(s>=i){var n=e.isStart?"startPath":"endPath",r=e.isStart?"startOffset":"endOffset";t.set([e.id,n],o),t.set([e.id,r],a+e.offset-i)}}),s(n(h),function(e){var i=t.get(e),s=i.getSelection();s.isCollapsed()&&(console.log("...deleting container annotation because it has collapsed"+e),t["delete"](e))})};e.exports={insertedText:o,deletedText:a,transferAnnotations:l}},{"../util/uuid":490,"lodash/each":313,"lodash/uniq":359}],118:[function(t,e,i){"use strict";function s(t,e){t.pos===e.pos?e.pos+=1:t.pos<e.pos?e.pos+=1:t.pos+=1}function n(t,e){return t.pos===e.pos?(e.type=h,void(t.type=h)):void(t.pos<e.pos?e.pos-=1:t.pos-=1)}function r(t,e){if(t.type===p){var i=t;t=e,e=i}t.pos<=e.pos?e.pos+=1:t.pos-=1}var o=t("lodash/isNumber"),a=t("lodash/isEqual"),l=t("lodash/cloneDeep"),u=t("./Operation"),c=t("./Conflict"),h="NOP",p="delete",d="insert",f=function(t){if(u.call(this),!t||null==t.type)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.type!==h){if(this.type!==d&&this.type!==p)throw new Error("Illegal type.");if(this.pos=t.pos,this.val=t.val,!o(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}};f.fromJSON=function(t){return new f(t)},f.Prototype=function(){this.apply=function(t){if(this.type===h)return t;if(this.type===d){if(t.length<this.pos)throw new Error("Provided array is too small.");return t.splice(this.pos,0,this.val),t}if(t.length<this.pos)throw new Error("Provided array is too small.");if(!a(t[this.pos],this.val))throw Error("Unexpected value at position "+this.pos+". Expected "+this.val+", found "+t[this.pos]);return t.splice(this.pos,1),t},this.clone=function(){var t={type:this.type,pos:this.pos,val:l(this.val)};return new f(t)},this.invert=function(){var t=this.toJSON();return this.type===h?t.type=h:this.type===d?t.type=p:t.type=d,new f(t)},this.hasConflict=function(t){return f.hasConflict(this,t)},this.toJSON=function(){var t={type:this.type};return this.type===h?t:(t.pos=this.pos,t.val=l(this.val),t)},this.isInsert=function(){return this.type===d},this.isDelete=function(){return this.type===p},this.getOffset=function(){return this.pos},this.getValue=function(){return this.val},this.isNOP=function(){return this.type===h},this.toString=function(){return["(",this.isInsert()?d:p,",",this.getOffset(),",'",this.getValue(),"')"].join("")}},u.extend(f);var m=function(t,e){return t.type===h||e.type===h?!1:t.type===d&&e.type===d?t.pos===e.pos:!1},g=function(t,e,i){if(i=i||{},i["no-conflict"]&&m(t,e))throw new c(t,e);return i.inplace||(t=t.clone(),e=e.clone()),t.type===h||e.type===h||(t.type===d&&e.type===d?s(t,e):t.type===p&&e.type===p?n(t,e):r(t,e)),[t,e]};f.transform=g,f.hasConflict=m,f.Insert=function(t,e){return new f({type:d,pos:t,val:e})},f.Delete=function(t,e){return new f({type:p,pos:t,val:e})},f.NOP=h,f.DELETE=p,f.INSERT=d,e.exports=f},{"./Conflict":119,"./Operation":127,"lodash/cloneDeep":309,"lodash/isEqual":332,"lodash/isNumber":337}],119:[function(t,e,i){"use strict";function s(t,e){Error.call(this,"Conflict: "+JSON.stringify(t)+" vs "+JSON.stringify(e)),this.a=t,this.b=e}s.prototype=Error.prototype,e.exports=s},{}],120:[function(t,e,i){"use strict";function s(t,e){u.call(this),this.schema=t,this.nodes=new l,this.indexes={},this.options=e||{},this.nodeFactory=e.nodeFactory||t.getNodeFactory(),this.__QUEUE_INDEXING__=!1,this.queue=[]}var n=t("lodash/isArray"),r=t("lodash/isString"),o=t("lodash/each"),a=t("lodash/cloneDeep"),l=t("./DataObject"),u=t("../../util/EventEmitter");s.Prototype=function(){this.contains=function(t){return!!this.nodes[t]},this.get=function(t){if(!t)throw new Error("Path or id required");return this.nodes.get(t)},this.getNodes=function(){return this.nodes},this.create=function(t){var e=this.nodeFactory.create(t.type,t);if(!e)throw new Error("Illegal argument: could not create node for data:",t);if(this.contains(e.id))throw new Error("Node already exists: "+e.id);if(!e.id||!e.type)throw new Error("Node id and type are mandatory.");this.nodes[e.id]=e;var i={type:"create",node:e};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),e},this["delete"]=function(t){var e=this.nodes[t];delete this.nodes[t];var i={type:"delete",node:e};return this.__QUEUE_INDEXING__?this.queue.push(i):this._updateIndexes(i),e},this.set=function(t,e){var i=this.get(t[0]),s=this.nodes.get(t);this.nodes.set(t,e);var n={type:"set",node:i,path:t,newValue:e,oldValue:s};return this.__QUEUE_INDEXING__?this.queue.push(n):this._updateIndexes(n),s},this.update=function(t,e){var i,s=this.nodes.get(t);if(e.isOperation)i=e.apply(s);else{var o,a,l,u;if(r(s))if(e["delete"])o=e["delete"].start,a=e["delete"].end,i=s.split("").splice(o,a-o).join("");else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));l=e.insert.offset,u=e.insert.value,i=[s.substring(0,l),u,s.substring(l)].join("")}else{if(!n(s))throw new Error("Diff is not supported:",JSON.stringify(e));if(i=s.slice(0),e["delete"])l=e["delete"].offset,i.splice(l,1);else{if(!e.insert)throw new Error("Diff is not supported:",JSON.stringify(e));l=e.insert.offset,u=e.insert.value,i.splice(l,0,u)}}}this.nodes.set(t,i);var c=this.get(t[0]),h={type:"update",node:c,path:t,newValue:i,oldValue:s};return this.__QUEUE_INDEXING__?this.queue.push(h):this._updateIndexes(h),s},this.toJSON=function(){return{schema:[this.schema.id,this.schema.version],nodes:a(this.nodes)}},this.reset=function(){this.nodes.clear()},this.addIndex=function(t,e){return this.indexes[t]&&console.error("Index with name %s already exists.",t),e.reset(this),this.indexes[t]=e,e},this.getIndex=function(t){return this.indexes[t]},this._updateIndexes=function(t){t&&!this.__QUEUE_INDEXING__&&o(this.indexes,function(e){e.select(t.node)&&(e[t.type]||console.error("Contract: every NodeIndex must implement "+t.type),e[t.type](t.node,t.path,t.newValue,t.oldValue))})},this._stopIndexing=function(){this.__QUEUE_INDEXING__=!0},this._startIndexing=function(){for(this.__QUEUE_INDEXING__=!1;this.queue.length>0;){var t=this.queue.shift();this._updateIndexes(t)}}},u.extend(s),e.exports=s},{"../../util/EventEmitter":477,"./DataObject":121,"lodash/cloneDeep":309,"lodash/each":313,"lodash/isArray":327,"lodash/isString":340}],121:[function(t,e,i){"use strict";function s(t){t&&(this.__root__=t)}var n=t("lodash/isString"),r=t("lodash/isArray"),o=t("lodash/get"),a=t("lodash/setWith"),l=t("lodash/unset"),u=t("../../util/oo");s.Prototype=function(){this.getRoot=function(){return this.__root__?this.__root__:this},this.get=function(t){if(t){if(n(t))return this.getRoot()[t];if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),!r(t))throw new Error("Illegal argument for DataObject.get()");return o(this.getRoot(),t)}},this.set=function(t,e){if(!t)throw new Error("Illegal argument: DataObject.set(>path<, value) - path is mandatory.");n(t)?this.getRoot()[t]=e:a(this.getRoot(),t,e)},this["delete"]=function(t){if(n(t))delete this.getRoot()[t];else if(1===t.length)delete this.getRoot()[t[0]];else{var e=l(this.getRoot(),t);if(!e)throw new Error("Could not delete property at path"+t)}},this.clear=function(){var t=this.getRoot();for(var e in t)t.hasOwnProperty(e)&&delete t[e]}},u.initClass(s),e.exports=s},{"../../util/oo":486,"lodash/get":319,"lodash/isArray":327,"lodash/isString":340,"lodash/setWith":352,"lodash/unset":360}],122:[function(t,e,i){"use strict";var s=t("lodash/isString"),n=t("lodash/isArray"),r=t("lodash/cloneDeep"),o=t("./Data"),a=t("./ObjectOperation"),l=t("./ArrayOperation"),u=t("./TextOperation"),c=function(t,e){c["super"].call(this,t,e)};c.Prototype=function(){this.create=function(t){var e=a.Create([t.id],t);return this.apply(e),e},this["delete"]=function(t){var e=null,i=this.get(t);if(i){var s=i.toJSON();e=a.Delete([t],s),this.apply(e)}return e},this.update=function(t,e){var i=this._getDiffOp(t,e),s=a.Update(t,i);return this.apply(s),s},this.set=function(t,e){var i=this.get(t),s=a.Set(t,i,e);return this.apply(s),s},this.apply=function(t){if(t.type!==a.NOP){if(t.type===a.CREATE)this["super"].create.call(this,r(t.val));else if(t.type===a.DELETE)this["super"]["delete"].call(this,t.val.id);else if(t.type===a.UPDATE){var e=this.get(t.path),i=t.diff;if("array"===t.propertyType)i instanceof l||(i=l.fromJSON(i)),i.apply(e);else{if("string"!==t.propertyType)throw new Error("Unsupported type for operational update.");i instanceof u||(i=u.fromJSON(i));var s=i.apply(e);this["super"].set.call(this,t.path,s)}}else{if(t.type!==a.SET)throw new Error("Illegal state.");this["super"].set.call(this,t.path,t.val)}this.emit("operation:applied",t,this)}},this._getDiffOp=function(t,e){var i=null;if(e.isOperation)i=e;else{var r,o,a,c,h=this.get(t);if(null===h||void 0===h)throw new Error("Property has not been initialized: "+JSON.stringify(t));s(h)?e["delete"]?(r=e["delete"].start,o=e["delete"].end,i=u.Delete(r,h.substring(r,o))):e.insert&&(a=e.insert.offset,c=e.insert.value,i=u.Insert(a,c)):n(h)&&(e["delete"]?(a=e["delete"].offset,i=l.Delete(a,h[a])):e.insert&&(a=e.insert.offset,c=e.insert.value,i=l.Insert(a,c)))}if(!i)throw new Error("Unsupported diff: "+JSON.stringify(e));return i}},o.extend(c),e.exports=c},{"./ArrayOperation":118,"./Data":120,"./ObjectOperation":126,"./TextOperation":130,"lodash/cloneDeep":309,"lodash/isArray":327,"lodash/isString":340}],123:[function(t,e,i){"use strict";function s(t){v.call(this);var e=this.constructor;if(!e["static"].name)throw new Error('Every NodeClass must provide a static property "name".');g(e["static"].schema,function(e,i){var s=void 0!==t[i],n=e.hasOwnProperty("default"),r=e.optional;if(!r&&!n&&!s)throw new Error("Property "+i+" is mandatory for node type "+this.type);s?this[i]=u(e,t[i]):n&&(this[i]=m(u(e,e["default"])))}.bind(this))}function n(t,e){var i=r(e);if(t["static"].schema=a(t,i),t["static"].defaultProps=l(t),!t["static"].hasOwnProperty("addressablePropertyNames")){var s=[];g(t["static"].schema,function(t,e){"string"===t.type&&t.addressable===!0&&s.push(e)}),t["static"].addressablePropertyNames=s}}function r(t){var e={};return g(t,function(t,i){(p(t)||d(t))&&(t={type:t}),t=o(t),t.name=i,e[i]=t}),e}function o(t){var e=t;return d(t.type)&&"array"!==t[0]?t.type=["array",t.type[0]]:"text"===t.type&&(e={type:"string",addressable:!0,"default":""}),e}function a(t,e){for(var i=[e],s=t;s;){var n=Object.getPrototypeOf(s.prototype);if(!n)break;s=n.constructor,s&&s["static"]&&s["static"].schema&&i.unshift(s["static"].schema)}return i.unshift({}),b.apply(null,i)}function l(t){var e=t["static"].unfoldedSchema,i={};return g(e,function(t,e){t.hasOwnProperty("default")&&(i[e]=t["default"])}),i}function u(t,e){var i;if(i=d(t.type)?"array":t.type,null===e){if(t.notNull)throw new Error("Value for property "+t.name+" is null.");return e}if(void 0===e)throw new Error("Value for property "+t.name+" is undefined.");if("string"===i&&!p(e)||"boolean"===i&&!c(e)||"number"===i&&!h(e)||"array"===i&&!d(e)||"id"===i&&!p(e)||"object"===i&&!f(e))throw new Error("Illegal value type for property "+t.name+": expected "+i+", was "+typeof e);return e}var c=t("lodash/isBoolean"),h=t("lodash/isNumber"),p=t("lodash/isString"),d=t("lodash/isArray"),f=t("lodash/isObject"),m=t("lodash/cloneDeep"),g=t("lodash/each"),b=t("lodash/extend"),v=t("../../util/EventEmitter");s.Prototype=function(){this.isInstanceOf=function(t){return s.isInstanceOf(this.constructor,t)},this.getTypeNames=function(){for(var t=[],e=this.constructor["static"];e&&"node"!==e.name;)t.push(e.name),e=Object.getPrototypeOf(e);return t},this.getPropertyType=function(t){var e=this.constructor["static"].schema;return e[t].type},this.toJSON=function(){var t={type:this.constructor["static"].name};return g(this.constructor["static"].schema,function(e,i){t[e.name]=this[i]}.bind(this)),t}},v.extend(s),s["static"].name="node",s["static"].defineSchema=function(t){var e=this.__class__;n(e,t)},s["static"].defineSchema({id:"string"}),Object.defineProperty(s.prototype,"type",{configurable:!1,get:function(){return this.constructor["static"].name},set:function(){throw new Error('Property "type" is read-only.')}}),s.isInstanceOf=function(t,e){for(var i=t["static"];i&&"node"!==i.name;){if(i&&i.name===e)return!0;i=Object.getPrototypeOf(i)}return!1},s["static"].isInstanceOf=s.isInstanceOf,e.exports=s},{"../../util/EventEmitter":477,"lodash/cloneDeep":309,"lodash/each":313,"lodash/extend":315,"lodash/isArray":327,"lodash/isBoolean":330,"lodash/isNumber":337,"lodash/isObject":338,"lodash/isString":340}],124:[function(t,e,i){"use strict";var s=t("../../util/oo"),n=t("lodash/isArray"),r=t("lodash/each"),o=t("lodash/extend"),a=t("../../util/TreeIndex"),l=function(){this.index=new a};l.Prototype=function(){this.get=function(t){return this.index.get(t)||{}},this.getAll=function(t){return this.index.getAll(t)},this.property="id",this.select=function(t){return this.type?t.isInstanceOf(this.type):!0},this.create=function(t){var e=t[this.property];n(e)||(e=[e]),r(e,function(e){this.index.set([e,t.id],t)}.bind(this))},this["delete"]=function(t){var e=t[this.property];n(e)||(e=[e]),r(e,function(e){this.index["delete"]([e,t.id])}.bind(this))},this.update=function(t,e,i,s){if(this.select(t)&&e[1]===this.property){var o=s;n(o)||(o=[o]),r(o,function(e){this.index["delete"]([e,t.id])}.bind(this)),o=i,n(o)||(o=[o]),r(o,function(e){this.index.set([e,t.id],t)}.bind(this))}},this.set=function(t,e,i,s){this.update(t,e,i,s)},this.reset=function(t){this.index.clear(),this._initialize(t)},this.clone=function(){var t=this.constructor,e=new t;return e},this._initialize=function(t){r(t.getNodes(),function(t){this.select(t)&&this.create(t)}.bind(this))}},s.initClass(l),l.create=function(t){var e=o(new l,t);return e.clone=function(){return l.create(t)},e},e.exports=l},{"../../util/TreeIndex":480,"../../util/oo":486,"lodash/each":313,"lodash/extend":315,"lodash/isArray":327}],125:[function(t,e,i){"use strict";function s(){n.call(this)}var n=t("../../util/Registry"),r=t("./Node");s.Prototype=function(){this.register=function(t){var e=t["static"]&&t["static"].name;if("string"!=typeof e||""===e)throw new Error("Node names must be strings and must not be empty");if(!(t.prototype instanceof r))throw new Error("Nodes must be subclasses of Substance.Data.Node");if(this.contains(e))throw new Error("Node class is already registered: "+e);this.add(e,t)}},n.extend(s),e.exports=s},{"../../util/Registry":479,"./Node":123}],126:[function(t,e,i){"use strict";var s=t("lodash/isString"),n=t("lodash/isEqual"),r=t("lodash/cloneDeep"),o=t("./DataObject"),a=t("./Operation"),l=t("./TextOperation"),u=t("./ArrayOperation"),c=t("./Conflict"),h="NOP",p="create",d="delete",f="update",m="set",g=function(t){if(a.call(this),!t)throw new Error("Data of ObjectOperation is missing.");if(!t.type)throw new Error("Invalid data: type is mandatory.");if(this.type=t.type,t.type!==h){if(this.path=t.path,!t.path)throw new Error("Invalid data: path is mandatory.");if(this.type===p||this.type===d){if(!t.val)throw new Error("Invalid data: value is missing.");this.val=t.val}else if(this.type===f){if(!t.diff)throw new Error("Invalid data: diff is mandatory for update operation.");if(this.diff=t.diff,t.diff instanceof l)this.propertyType="string";else{if(!(t.diff instanceof u))throw new Error("Invalid data: diff must be a TextOperation or an ArrayOperation.");this.propertyType="array"}}else{if(this.type!==m)throw new Error("Invalid type: "+t.type);this.val=t.val,this.original=t.original}}};g.fromJSON=function(t){if(t=r(t),"update"===t.type)switch(t.propertyType){case"string":t.diff=l.fromJSON(t.diff);break;case"array":t.diff=u.fromJSON(t.diff);break;default:throw new Error("Unsupported update diff:"+JSON.stringify(t.diff))}var e=new g(t);return e},g.Prototype=function(){this.apply=function(t){if(this.type===h)return t;var e;if(e=t instanceof o?t:new o(t),this.type===p)return e.set(this.path,r(this.val)),t;if(this.type===d)e["delete"](this.path,"strict");else if(this.type===f){var i,s=this.diff,n=e.get(this.path);i=s instanceof u?s.apply(n):s.apply(n),e.set(this.path,i)}else e.set(this.path,r(this.val));return t},this.clone=function(){var t={type:this.type,path:this.path};return this.val&&(t.val=r(this.val)),this.diff&&(t.diff=this.diff.clone()),new g(t)},this.isNOP=function(){return this.type===h?!0:this.type===f?this.diff.isNOP():void 0},this.isCreate=function(){return this.type===p},this.isDelete=function(){return this.type===d},this.isUpdate=function(t){return t?this.type===f&&this.propertyType===t:this.type===f},this.isSet=function(){return this.type===m},this.invert=function(){if(this.type===h)return new g({type:h});var t=new g(this);if(this.type===p)t.type=d;else if(this.type===d)t.type=p;else if(this.type===f){var e;e=this.diff instanceof l?l.fromJSON(this.diff.toJSON()).invert():u.fromJSON(this.diff.toJSON()).invert(),t.diff=e}else t.val=this.original,t.original=this.val;return t},this.hasConflict=function(t){return g.hasConflict(this,t)},this.toJSON=function(){if(this.type===h)return{type:h};var t={type:this.type,path:this.path};return this.type===p||this.type===d?t.val=this.val:this.type===f?(this.diff instanceof u?t.propertyType="array":t.propertyType="string",t.diff=this.diff.toJSON()):(t.val=this.val,t.original=this.original),t},this.getType=function(){return this.type},this.getPath=function(){return this.path},this.getValue=function(){return this.val},this.getOldValue=function(){return this.original},this.getValueOp=function(){return this.diff},this.toString=function(){switch(this.type){case p:return["(+,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case d:return["(-,",JSON.stringify(this.path),JSON.stringify(this.val),")"].join("");case f:return["(>>,",JSON.stringify(this.path),this.propertyType,this.diff.toString(),")"].join("");case m:return["(=,",JSON.stringify(this.path),this.val,this.original,")"].join("")}}},a.extend(g);var b=function(t,e){return t.type===h||e.type===h?!1:n(t.path,e.path)},v=function(t,e){t.type=h,e.type=h},y=function(){throw new Error("Can not transform two concurring creates of the same property")},_=function(){throw new Error("Illegal state: can not create and delete a value at the same time.")},x=function(t,e,i){if(t.type!==d)return x(e,t,!0);var s;s="string"===e.propertyType?l.fromJSON(e.diff):u.fromJSON(e.diff),i?(t.val=s.apply(t.val),e.type=h):(t.type=h,e.type=p,e.val=s.apply(t.val))},C=function(){throw new Error("Can not transform a concurring create and update of the same property")},w=function(t,e){var i,s,n;"string"===e.propertyType?(i=l.fromJSON(t.diff),s=l.fromJSON(e.diff),n=l.transform(i,s,{inplace:!0})):(i=u.fromJSON(t.diff),s=u.fromJSON(e.diff),n=u.transform(i,s,{inplace:!0})),t.diff=n[0],e.diff=n[1]},S=function(){throw new Error("Illegal state: can not create and set a value at the same time.")},T=function(t,e,i){return t.type!==d?T(e,t,!0):void(i?(t.val=e.val,e.type=h):(t.type=h,e.type=p,e.original=void 0))},E=function(){throw new Error("Unresolvable conflict: update + set.")},I=function(t,e){t.type=h,e.original=t.val},O=0,A=1,N=2,k=4,P=8,D={};D[h]=O,D[p]=A,D[d]=N,D[f]=k,D[m]=P;var R=[];R[N|N]=v,R[N|A]=_,R[N|k]=x,R[A|A]=y,R[A|k]=C,R[k|k]=w,R[A|P]=S,R[N|P]=T,R[k|P]=E,R[P|P]=I;var L=function(t,e,i){if(i=i||{},i["no-conflict"]&&b(t,e))throw new c(t,e);if(i.inplace||(t=t.clone(),e=e.clone()),t.isNOP()||e.isNOP())return[t,e];var s=n(t.path,e.path);return s&&R[D[t.type]|D[e.type]](t,e),[t,e]};g.transform=L,g.hasConflict=b,g.Create=function(t,e){var i;return i=s(t)?[t]:t,new g({type:p,path:i,val:e})},g.Delete=function(t,e){var i;return i=s(t)?[t]:t,new g({type:d,path:i,val:e})},g.Update=function(t,e){var i;if(e instanceof l)i="string";else{if(!(e instanceof u))throw new Error("Unsupported type for operational changes");i="array"}return new g({type:f,path:t,diff:e})},g.Set=function(t,e,i){return new g({type:m,path:t,val:r(i),original:r(e)})},g.NOP=h,g.CREATE=p,g.DELETE=d,g.UPDATE=f,g.SET=m,e.exports=g},{"./ArrayOperation":118,"./Conflict":119,"./DataObject":121,"./Operation":127,"./TextOperation":130,"lodash/cloneDeep":309,"lodash/isEqual":332,"lodash/isString":340}],127:[function(t,e,i){"use strict";function s(){}var n=t("../../util/oo");s.Prototype=function(){this.isOperation=!0},n.initClass(s),e.exports=s},{"../../util/oo":486}],128:[function(t,e,i){"use strict";function s(){this.SEPARATOR="	"}function n(t,e){r(arguments[0])?this.tokens=arguments[0]:this.tokens=t.split(e),this.pos=-1}var r=t("lodash/isArray"),o=t("lodash/isNumber"),a=t("lodash/isObject"),l=t("../../util/oo"),u=t("./ObjectOperation"),c=t("./TextOperation"),h=t("./ArrayOperation");s.Prototype=function(){this.serialize=function(t){var e=[];switch(t.type){case"create":e.push("c"),e.push(t.val.id),e.push(t.val);break;case"delete":e.push("d"),e.push(t.val.id),e.push(t.val);break;case"set":e.push("s"),e.push(t.path.join(".")),e.push(t.val),e.push(t.original);break;case"update":e.push("u"),e.push(t.path.join(".")),Array.prototype.push.apply(e,this.serializePrimitiveOp(t.diff));break;default:throw new Error("Unsupported operation type.")}return e},this.serializePrimitiveOp=function(t){var e=[];if(t instanceof c)t.isInsert()?e.push("t+"):t.isDelete()&&e.push("t-"),e.push(t.pos),e.push(t.str);else{if(!(t instanceof h))throw new Error("Unsupported operation type.");t.isInsert()?e.push("a+"):t.isDelete()&&e.push("a-"),e.push(t.pos),e.push(t.val)}return e},this.deserialize=function(t,e){e||(e=new n(t,this.SEPARATOR));var i,s,r,o,a,l=e.getString();switch(l){case"c":s=e.getPath(),r=e.getObject(),i=u.Create(s,r);break;case"d":s=e.getPath(),r=e.getObject(),i=u.Delete(s,r);break;case"s":s=e.getPath(),r=e.getAny(),o=e.getAny(),i=u.Set(s,o,r);break;case"u":s=e.getPath(),a=this.deserializePrimitiveOp(t,e),i=u.Update(s,a)}return i},this.deserializePrimitiveOp=function(t,e){e||(e=new n(t,this.SEPARATOR));var i,s,r,o=e.getString();switch(o){case"t+":s=e.getNumber(),r=e.getString(),i=c.Insert(s,r);break;case"t-":s=e.getNumber(),r=e.getString(),i=c.Delete(s,r);break;case"a+":s=e.getNumber(),r=e.getAny(),i=h.Insert(s,r);break;case"a-":s=e.getNumber(),r=e.getAny(),i=h.Delete(s,r);break;default:throw new Error("Unsupported operation type: "+o)}return i}},l.initClass(s),n.Prototype=function(){this.error=function(t){throw new Error("Parsing error: "+t+"\n"+this.tokens[this.pos])},this.getString=function(){this.pos++;var t=this.tokens[this.pos];return'"'===t[0]&&(t=t.slice(1,-1)),t},this.getNumber=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=o(e)?e:parseInt(this.tokens[this.pos])}catch(i){this.error("expected number")}},this.getObject=function(){this.pos++;var t,e=this.tokens[this.pos];try{return t=a(e)?e:JSON.parse(this.tokens[this.pos])}catch(i){this.error("expected object")}},this.getAny=function(){this.pos++;var t=this.tokens[this.pos];return t},this.getPath=function(){var t=this.getString();return t.split(".")}},l.initClass(n),s.Tokenizer=n,e.exports=s},{"../../util/oo":486,"./ArrayOperation":118,"./ObjectOperation":126,"./TextOperation":130,"lodash/isArray":327,"lodash/isNumber":337,"lodash/isObject":338}],129:[function(t,e,i){"use strict";function s(t,e){this.name=t,this.version=e,this.nodeRegistry=new r,this.tocTypes=[],this.addNodes(this.getBuiltIns())}var n=t("../../util/oo"),r=t("./NodeRegistry"),o=t("./Node");s.Prototype=function(){this.addNodes=function(t){if(t)for(var e=0;e<t.length;e++){var i=t[e];i["static"]?this.addNode(i):console.log("AAAAAAA",i)}},this.addNode=function(t){this.nodeRegistry.register(t),t["static"].tocType&&this.tocTypes.push(t["static"].name)},this.getNodeClass=function(t){return this.nodeRegistry.get(t)},this.getBuiltIns=function(){return[o]},this.isInstanceOf=function(t,e){var i=this.getNodeClass(t);return i?o["static"].isInstanceOf(i,e):!1},this.each=function(){this.nodeRegistry.each.apply(this.nodeRegistry,arguments)},this.getTocTypes=function(){return this.tocTypes},this.getDefaultTextType=function(){throw new Error("Schmema.prototype.getDefaultTextType() must be overridden.")},this.getNodeSchema=function(e){var i=this.getNodeClass(e);return i?t(i):(console.error("Unknown node type ",e),null)};var t=function(t){return t["static"].schema}},n.initClass(s),e.exports=s},{"../../util/oo":486,"./Node":123,"./NodeRegistry":125}],130:[function(t,e,i){"use strict";function s(t){if(c.call(this),!t||void 0===t.type||void 0===t.pos||void 0===t.str)throw new Error("Illegal argument: insufficient data.");if(this.type=t.type,this.pos=t.pos,this.str=t.str,!this.isInsert()&&!this.isDelete())throw new Error("Illegal type.");if(!l(this.str))throw new Error("Illegal argument: expecting string.");if(!u(this.pos)||this.pos<0)throw new Error("Illegal argument: expecting positive number as pos.")}function n(t,e){t.pos===e.pos?e.pos+=t.str.length:t.pos<e.pos?e.pos+=t.str.length:t.pos+=e.str.length}function r(t,e,i){if(t.pos>e.pos)return r(e,t,!i);if(t.pos===e.pos&&t.str.length>e.str.length)return r(e,t,!i);if(e.pos<t.pos+t.str.length){var s=e.pos-t.pos,n=t.str.length-s,o=s+e.str.length;t.str=t.str.slice(0,s)+t.str.slice(o),e.str=e.str.slice(n),e.pos-=s}else e.pos-=t.str.length}function o(t,e){if(t.type===d)return o(e,t);if(t.pos<=e.pos)e.pos+=t.str.length;else if(t.pos>=e.pos+e.str.length)t.pos-=e.str.length;else{var i=t.pos-e.pos;e.str=e.str.slice(0,i)+t.str+e.str.slice(i),t.str=""}}var a,l=t("lodash/isString"),u=t("lodash/isNumber"),c=t("./Operation"),h=t("./Conflict"),p="insert",d="delete";s.fromJSON=function(t){return new s(t)},s.Prototype=function(){this.apply=function(t){if(this.isEmpty())return t;if(this.type===p){if(t.length<this.pos)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,0,this.str):t.slice(0,this.pos).concat(this.str).concat(t.slice(this.pos))}if(t.length<this.pos+this.str.length)throw new Error("Provided string is too short.");return t.splice?t.splice(this.pos,this.str.length):t.slice(0,this.pos).concat(t.slice(this.pos+this.str.length))},this.clone=function(){return new s(this)},this.isNOP=function(){return"NOP"===this.type||0===this.str.length},this.isInsert=function(){return this.type===p},this.isDelete=function(){return this.type===d},this.getLength=function(){return this.str.length},this.invert=function(){var t={type:this.isInsert()?d:p,pos:this.pos,
str:this.str};return new s(t)},this.hasConflict=function(t){return a(this,t)},this.isEmpty=function(){return 0===this.str.length},this.toJSON=function(){return{type:this.type,pos:this.pos,str:this.str}},this.toString=function(){return["(",this.isInsert()?p:d,",",this.pos,",'",this.str,"')"].join("")}},c.extend(s),a=function(t,e){if(t.type===p&&e.type===p)return t.pos===e.pos;if(t.type===d&&e.type===d)return!(t.pos>=e.pos+e.str.length||e.pos>=t.pos+t.str.length);var i,s;return t.type===d?(i=t,s=e):(i=e,s=t),s.pos>=i.pos&&s.pos<i.pos+i.str.length};var f=function(t,e,i){if(i=i||{},i["no-conflict"]&&a(t,e))throw new h(t,e);return i.inplace||(t=t.clone(),e=e.clone()),t.type===p&&e.type===p?n(t,e):t.type===d&&e.type===d?r(t,e,!0):o(t,e),[t,e]};s.transform=function(){return f.apply(null,arguments)},s.Insert=function(t,e){return new s({type:p,pos:t,str:e})},s.Delete=function(t,e){return new s({type:d,pos:t,str:e})},s.INSERT=p,s.DELETE=d,e.exports=s},{"./Conflict":119,"./Operation":127,"lodash/isNumber":337,"lodash/isString":340}],131:[function(t,e,i){"use strict";var s=t("lodash/filter"),n=t("./AnnotationIndex"),r={};r.isContainerAnnotation=function(t,e){var i=t.getSchema();return i.isInstanceOf(e,"container-annotation")},r.getPropertyAnnotationsForSelection=function(t,e,i){if(i=i||{},!e.isPropertySelection())return[];var r=t.getIndex("annotations").get(e.path,e.startOffset,e.endOffset);return i.type&&(r=s(r,n.filterByType(i.type))),r},r.getContainerAnnotationsForSelection=function(t,e,i,n){if(!i)return[];var r;return r=n.type?t.getIndex("type").get(n.type):t.getIndex("container-annotation-anchors").byId,r=s(r,function(t){var i=t.getSelection();return e.overlaps(i)})},r.getAnnotationsForSelection=function(t,e,i,s){var n,o=r.isContainerAnnotation(t,i);if(o){var a=t.get(s);n=r.getContainerAnnotationsForSelection(t,e,a,{type:i})}else n=r.getPropertyAnnotationsForSelection(t,e,{type:i});return n},r.getTextForSelection=function(t,e){var i;if(!e||e.isNull())return"";if(e.isPropertySelection())return i=t.get(e.start.path),i.substring(e.start.offset,e.end.offset);if(e.isContainerSelection()){for(var s=[],n=t.get(e.containerId),r=n.getPathRange(e.startPath,e.endPath),o=0;o<r.length;o++){var a=r[o];i=t.get(a),1===r.length?s.push(i.substring(e.startOffset,e.endOffset)):0===o?s.push(i.substring(e.startOffset)):o===r.length-1?s.push(i.substring(0,e.endOffset)):s.push(i)}return s.join("\n")}},e.exports=r},{"./AnnotationIndex":83,"lodash/filter":316}],132:[function(t,e,i){"use strict";function s(t,e){if(!e.selection)throw new Error("Argument 'selection' is mandatory.");if(!e.containerId)throw new Error("Argument 'containerId' is mandatory.");e.selection.isCollapsed()||(e=o(t,e));var i=e.selection,s=t.get(i.start.path[0]),r=e.editingBehavior;if(s.isInstanceOf("text"))return n(t,e);if(r&&r.canBreak(s.type)){var a=r.getBreaker(s.type);return a.call(a,t,e)}return console.info("Breaking is not supported for node type %s.",s.type),e}function n(t,e){var i=e.selection,s=e.containerId;if(!i.isPropertySelection())throw new Error("Expected property selection.");var n,o=i.path,l=i.startOffset,u=t.get(o[0]),c=u.content,h=t.get(s),p=h.getChildIndex(u),d=r(u.type),f=[d,"content"];return 0===l?(n=t.create({id:d,type:u.type,content:""}),h.show(d,p),i=t.createSelection(o,0)):(n=u.toJSON(),n.id=d,n.content=c.substring(l),l===c.length&&(n.type=t.getSchema().getDefaultTextType()),t.create(n),l<c.length&&(a.transferAnnotations(t,o,l,[d,"content"],0),t.update(o,{"delete":{start:l,end:c.length}})),h.show(d,p+1),i=t.createSelection(f,0)),e.selection=i,e.node=n,e}var r=t("../../util/uuid"),o=t("./deleteSelection"),a=t("../annotationHelpers");e.exports=s},{"../../util/uuid":490,"../annotationHelpers":117,"./deleteSelection":138}],133:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;return i.isNull()?e.doc=null:i.isPropertySelection()||o(i.start.path,i.end.path)?e.doc=n(t,i):i.isContainerSelection()?e.doc=r(t,i):(console.error("Copy is not yet supported for selection type."),e.doc=null),e}function n(t,e){var i=t.newInstance(),s=e.start.path,n=e.start.offset,r=e.end.offset,o=t.get(s),u=i.get(c);u||(u=i.create({type:"container",id:c,nodes:[]})),i.create({type:t.schema.getDefaultTextType(),id:h,content:o.substring(n,r)}),u.show(h);var p=t.getIndex("annotations").get(s,n,r);return l(p,function(t){var e=a(t.toJSON());e.path=[h,"content"],e.startOffset=Math.max(n,t.startOffset)-n,e.endOffset=Math.min(r,t.endOffset)-n,i.create(e)}),i}function r(t,e){var i,s,n=t.newInstance(),r=t.getIndex("annotations"),o=t.get(e.containerId),l=n.create({type:"container",id:c,nodes:[]}),h={},p=o.getAddress(e.start.path),d=o.getAddress(e.end.path);for(i=p[0];i<=d[0];i++){s=o.getChildAt(i);var f=s.id;h[f]||(h[f]=n.create(s.toJSON()),l.show(f)),s.hasChildren();for(var m=o.getPathsForNode(s),g=0;g<m.length;g++)for(var b=r.get(m[g]),v=0;v<b.length;v++)n.create(a(b[v].toJSON()))}var y,_;s=o.getChildAt(p[0]);var x=o.getAddressesForNode(s);for(i=0;i<x.length;i++){if(!x[i].isBefore(p)){e.start.offset>0&&(_=o.getPathForAddress(x[i]),y=t.get(_),n.update(_,{"delete":{start:0,end:e.start.offset}}),u.deletedText(n,_,0,e.start.offset));break}_=o.getPathForAddress(x[i]),n.set(_,"")}for(s=o.getChildAt(d[0]),x=o.getAddressesForNode(s),i=x.length-1;i>=0;i--){if(_=o.getPathForAddress(x[i]),!x[i].isAfter(d)){y=t.get(_),e.end.offset<y.length&&(n.update(_,{"delete":{start:e.end.offset,end:y.length}}),u.deletedText(n,_,e.end.offset,y.length));break}n.set(_,"")}return n}var o=t("lodash/isEqual"),a=t("lodash/cloneDeep"),l=t("lodash/each"),u=t("../annotationHelpers"),c="clipboard_content",h="clipboard_property";s.CLIPBOARD_CONTAINER_ID=c,s.CLIPBOARD_PROPERTY_ID=h,e.exports=s},{"../annotationHelpers":117,"lodash/cloneDeep":309,"lodash/each":313,"lodash/isEqual":332}],134:[function(t,e,i){"use strict";function s(t,e){var i=e.selection,s=e.annotationType,l=e.annotationData,u=e.node,c=e.containerId;if(!u&&s&&(console.warn('DEPRECATED: Use node: {type: "strong"} instead of annotationType: "strong"'),u={type:s},r(u,l)),!i)throw new Error("selection is required.");if(!u)throw new Error("node is required");if(i.isContainerSelection()&&!c)throw new Error("containerId must be provided for container selections");if(e.splitContainerSelections&&i.isContainerSelection())return n(t,e);var h=r({id:o(u.type)},u);if(a.isContainerAnnotation(t,u.type))h.startPath=i.startPath,h.endPath=i.endPath,h.container=c;else{if(!i.isPropertySelection())throw new Error("Illegal state: can not apply ContainerSelection");h.path=i.path}return h.startOffset=i.startOffset,h.endOffset=i.endOffset,e.result=t.create(h),e}function n(t,e){var i,s=e.selection,n=e.node;s.isPropertySelection()?i=[]:s.isContainerSelection()&&(i=s.splitIntoPropertySelections());for(var a=0;a<i.length;a++){var l={id:o(n.type)};r(l,n),l.path=i[a].getPath(),l.startOffset=i[a].startOffset,l.endOffset=i[a].endOffset,t.create(l)}}var r=t("lodash/extend"),o=t("../../util/uuid"),a=t("../documentHelpers");e.exports=s},{"../../util/uuid":490,"../documentHelpers":131,"lodash/extend":315}],135:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var s=n.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=s[0].id;return t["delete"](r),e.result=r,e}var n=t("../documentHelpers");e.exports=s},{"../documentHelpers":131}],136:[function(t,e,i){"use strict";var s=t("lodash/extend"),n=t("./merge"),r=t("./updateAnnotations"),o=function(t,e){var i,o,a=e.selection,l=e.direction;if(!a.isCollapsed())throw new Error('Selection must be collapsed for transformation "deleteCharacter"');var u=t.get(a.path);if(0===a.startOffset&&"left"===l||a.startOffset===u.length&&"right"===l){var c=n(t,s({},e,{selection:a,containerId:e.containerId,path:a.path,direction:l}));a=c.selection}else{i="left"===l?a.startOffset-1:a.startOffset,o=i+1;var h=t.update(a.path,{"delete":{start:i,end:o}});r(t,{op:h}),a=t.createSelection(a.path,i)}return e.selection=a,e};e.exports=o},{"./merge":144,"./updateAnnotations":149,"lodash/extend":315}],137:[function(t,e,i){"use strict";function s(t,e){if(!e.nodeId)throw new Error("Parameter `nodeId` is mandatory.");var i,s=e.nodeId,r=t.getIndex("annotations").get(s);for(i=0;i<r.length;i++)t["delete"](r[i].id);var o=t.getIndex("container-annotation-anchors").get(s);for(i=0;i<o.length;i++){var a=o[i],l=t.get(a.container);if(t.get(a.id)){var u=l.getAddress(a.path),c=u[0];if(a.isStart)if(c<l.getLength()-1){var h=l.getChildAt(c+1),p=l.getFirstAddress(h);t.set([a.id,"startPath"],l.getPath(p)),t.set([a.id,"startOffset"],0)}else t["delete"](a.id);else if(c>0){var d=l.getChildAt(c-1),f=l.getLastAddress(d),m=l.getPath(f),g=t.get(m).length;t.set([a.id,"endPath"],m),t.set([a.id,"endOffset"],g)}else t["delete"](a.id)}}return n(t.getIndex("type").get("container"),function(t){t.hide(s)}),t["delete"](s),e}var n=t("lodash/each");e.exports=s},{"lodash/each":313}],138:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;return e=i.isCollapsed()?h(t,e):i.isPropertySelection()?n(t,e):r(t,e)}function n(t,e){var i=e.selection,s=i.path,n=i.startOffset,r=i.endOffset,o=t.update(s,{"delete":{start:n,end:r}});return f(t,{op:o}),e.selection=t.createSelection(s,n),e}function r(t,e){var i,s,n,r=e.selection,h=r.containerId,f=a(t,r);e.selection=null;for(var m=t.get(h),g=m.getPosition(f[0].node.id),b=f.length-1;b>=0;b--)i=f[b],s=i.node,i.isFully?p(t,l({},e,{nodeId:s.id})):o(t,l({},e,{nodeSel:i}));if(f[0].isFully){e.selection=null;for(var v=1;v<f.length;v++)if(i=f[v],!i.isFully){e.selection=t.createSelection(i.paths[0],0);break}null===e.selection&&(n=t.getSchema().getDefaultTextType(),s={type:n,id:c(n),content:""},t.create(s),m.show(s.id,g),e.selection=t.createSelection([s.id,"content"],0))}else e.selection=t.createSelection(r.startPath,r.startOffset);if(f.length>1){var y=f[0],_=f[f.length-1];if(y.isFully||_.isFully);else{var x=u(_.paths),C=d(t,l({},e,{selection:e.selection,containerId:h,path:x,direction:"left"}));e.selection=C.selection}}return m=t.get(h),0===m.nodes.length&&(n=t.getSchema().getDefaultTextType(),s={type:n,id:c(n),content:""},t.create(s),m.show(s.id,0),e.selection=t.createSelection([s.id,"content"],0)),e}function o(t,e){for(var i=e.nodeSel,s=i.paths,r=s.length,o=0;r>o;o++){var a=s[o],u=0,c=t.get(a).length;0===o&&(u=i.startOffset),o===r-1&&(c=i.endOffset),n(t,l({},e,{selection:t.createSelection(a,u,c)}))}}function a(t,e){for(var i=[],s={},n=t.get(e.containerId),r=n.getAddressRange(n.getAddress(e.startPath),n.getAddress(e.endPath)),o=0;o<r.length;o++){var a=r[o],l=n.getChildAt(a[0]);if(!l)throw new Error("Illegal state: expecting a component to have a proper root node id set.");var u,c=l.id;s[c]||(u={node:l,isFully:!0,addresses:[],paths:[]},s[c]=u,i.push(u)),u=s[c],u.addresses.push(a),u.paths.push(n.getPath(a))}var h=r[0],p=r[r.length-1],d=n.getPreviousAddress(h),f=n.getPreviousAddress(p),m=i[0],g=i[i.length-1],b=t.get(n.getPath(h)).length,v=t.get(n.getPath(p)).length;return(e.startOffset>0||d&&d[0]===h[0])&&(m.isFully=!1,m.startOffset=e.startOffset,1===i.length?m.endOffset=e.endOffset:m.endOffset=b),i.length>1&&(e.endOffset<v||f&&f[0]===p[0])&&(g.isFully=!1,g.startOffset=0,g.endOffset=e.endOffset),i}var l=t("lodash/extend"),u=t("lodash/last"),c=t("../../util/uuid"),h=t("./deleteCharacter"),p=t("./deleteNode"),d=t("./merge"),f=t("./updateAnnotations");e.exports=s},{"../../util/uuid":490,"./deleteCharacter":136,"./deleteNode":137,"./merge":144,"./updateAnnotations":149,"lodash/extend":315,"lodash/last":345}],139:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var s=n.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=s[0],o=r.getSelection(),a=o.expand(i);return r.updateRange(t,a),e.result=r,e}var n=t("../documentHelpers");e.exports=s},{"../documentHelpers":131}],140:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var s=r.getAnnotationsForSelection(t,i,e.annotationType,e.containerId);return n(s,function(t){i=i.expand(t.getSelection())}),n(s,function(e){t["delete"](e.id)}),e.selection=i,e.node={type:e.annotationType},o(t,e)}var n=t("lodash/each"),r=t("../documentHelpers"),o=t("./createAnnotation");e.exports=s},{"../documentHelpers":131,"./createAnnotation":134,"lodash/each":313}],141:[function(t,e,i){"use strict";function s(t,e){var i=n(t,{selection:e.selection,text:"$"}),s=t.createSelection({type:"property",path:i.selection.path,startOffset:i.selection.startOffset-1,endOffset:i.selection.endOffset});return e.node=e.node,e.selection=s,e.containerId=e.containerId,e=r(t,e)}var n=t("./insertText"),r=t("./createAnnotation");e.exports=s},{"./createAnnotation":134,"./insertText":143}],142:[function(t,e,i){"use strict";function s(t,e){var i=e.selection,s=e.node;if(!e.containerId)throw new Error("containerId is mandatory");if(!e.selection)throw new Error("selection is mandatory");if(!e.node)throw new Error("node is mandatory");var o,a=e.containerId,l=t.get(a);i.isCollapsed()||(o=n(t,e),i=o.selection),o=r(t,e),i=o.selection,t.get(s.id)||(s=t.create(s)),s=t.get(s.id);var u=l.getAddress(i.start.path),c=u[0];l.show(s.id,c);var h=l.getFirstPath(s);return h&&(e.selection=t.createSelection({type:"property",path:h,startOffset:0})),e}var n=t("./deleteSelection"),r=t("./breakNode");e.exports=s},{"./breakNode":132,"./deleteSelection":138}],143:[function(t,e,i){"use strict";var s=t("./replaceText"),n=t("./updateAnnotations"),r=function(t,e){var i=e.selection,r=e.text;if(!i)throw new Error("Argument `selection` is mandatory for transformation `insertText`.");if(!r)throw new Error("Argument `text` is mandatory for transformation `insertText`.");if(!i.isPropertySelection()&&!i.isContainerSelection())throw new Error("Selection must be property or container selection.");if(!i.isCollapsed())return s(t,e);void 0===t.get(i.startPath)&&t.set(i.startPath,"");var o=t.update(i.startPath,{insert:{offset:i.startOffset,value:r}});return n(t,{op:o}),e.selection=t.createSelection(i.startPath,i.startOffset+r.length),e};e.exports=r},{"./replaceText":146,"./updateAnnotations":149}],144:[function(t,e,i){"use strict";function s(t,e,i){if(t){if(t.canMerge(e.type,i.type))return t.getMerger(e.type,i.type);if(e.isInstanceOf("text")&&t.canMerge("textish",i.type))return t.getMerger("textish",i.type);if(i.isInstanceOf("text")&&t.canMerge(e.type,"textish"))return t.getMerger(e.type,"textish")}return e.isInstanceOf("text")&&i.isInstanceOf("text")?l:(console.info("No merge behavior defined for %s <- %s",e.type,i.type),null)}var n=t("lodash/extend"),r=t("../annotationHelpers"),o=function(t,e){var i=e.containerId,s=e.path,r=e.direction;if(!i||!s||!r)throw new Error("Insufficient arguments! mandatory fields: `containerId`, `path`, `direction`");var o,l=t.get(i),u=l.getAddress(s);if("right"===r){var c=l.getNextAddress(u);c&&(o=a(t,n({},e,{containerId:i,firstAddress:u,secondAddress:c})),e.selection=o.selection)}else if("left"===r){var h=l.getPreviousAddress(u);h&&(o=a(t,n({},e,{containerId:i,firstAddress:h,secondAddress:u})),e.selection=o.selection)}return e},a=function(t,e){var i,r=t.get(e.containerId),o=e.firstAddress,a=e.secondAddress,l=r.getChildAt(o[0]),u=r.getChildAt(a[0]),c=e.editingBehavior;if(l===u){if(c&&c.canMergeComponents(l.type))return i=c.getComponentMerger(l.type),i.call(this,t,n({},e,{node:l,firstAddress:o,secondAddress:a}))}else if(i=s(e.editingBehavior,l,u))return i.call(this,t,n({},e,{containerId:e.containerId,first:l,second:u}));return e},l=function(t,e){var i,s=e.containerId,n=e.first,o=e.second,a=t.get(s),l=n.getTextPath(),u=n.getText(),c=u.length,h=o.getTextPath(),p=o.getText();return 0===c?(a.hide(l[0]),t["delete"](l[0]),i=t.createSelection({type:"property",path:h,startOffset:0})):(t.update(l,{insert:{offset:c,value:p}}),r.transferAnnotations(t,h,0,l,c),a.hide(h[0]),t["delete"](h[0]),i=t.createSelection({type:"property",path:l,startOffset:c})),e.selection=i,e};e.exports=o},{"../annotationHelpers":117,"lodash/extend":315}],145:[function(t,e,i){"use strict";function s(t,e){var i,s=t.getSchema().getDefaultTextType(),n=e.text.split(/\s*\n\s*\n/),r=t.newInstance(),o=r.create({type:"container",id:f,nodes:[]});if(1===n.length)i=r.create({id:m,type:s,content:n[0]}),o.show(i.id);else for(var a=0;a<n.length;a++)i=r.create({id:u(s),type:s,content:n[a]}),o.show(i.id);return r}function n(t,e){var i=e.doc,s=e.selection,n=i.get(f).nodes,r=[n[0],"content"],o=i.get(r),a=i.getIndex("annotations").get(r),h=s.start.path,p=s.start.offset;return t.update(h,{insert:{offset:p,value:o}}),c.insertedText(t,s.start,o.length),s=t.createSelection({type:"property",path:s.start.path,startOffset:s.start.offset+o.length}),l(a,function(e){var i=e.toJSON();i.path=h.slice(0),i.startOffset+=p,i.endOffset+=p,t.get(i.id)&&(i.id=u(i.type)),t.create(i)}),e.selection=s,e}function r(t,e){var i,s=e.doc,n=e.containerId,r=e.selection,l=t.get(n),c=r.start.path,h=l.getAddress(c),p=l.getNextAddress(h);if(p&&p[0]===h[0]||t.get(c).length!==r.start.offset){var m=d(t,e);r=m.selection,i=h[0]+1}else i=h[0]+1;0>i&&console.error("Could not find insertion position in ContainerNode.");for(var g=s.get(f).nodes,b=s.getIndex("annotations"),v=[],y=0;y<g.length;y++){var _=g[y],x=o(t,s.get(_));l.show(x.id,i++),v.push(x);for(var C=b.get(_),w=0;w<C.length;w++){var S=C[w].toJSON();x.id!==_&&(S.path[0]=x.id),t.get(S.id)&&(S.id=u(S.type)),t.create(S)}}if(0===v.length)return e;var T=l.getLastPath(a(v)),E=t.get(T).length;return r=t.createSelection({type:"property",path:T,startOffset:E}),e.selection=r,e}function o(t,e){var i=e.id,s=e.toJSON();if(t.get(i)&&(s.id=u(e.type)),e.hasChildren())for(var n=e.getChildren(),r=s[e.getChildrenProperty()],a=0;a<n.length;a++){var l=o(t,n[a]);r[a]=l.id}return t.create(s)}var a=t("lodash/last"),l=t("lodash/each"),u=t("../../util/uuid"),c=t("../annotationHelpers"),h=t("./deleteSelection"),p=t("./insertText"),d=t("./breakNode"),f=t("./copySelection").CLIPBOARD_CONTAINER_ID,m=t("./copySelection").CLIPBOARD_PROPERTY_ID,g=function(t,e){if(e.text=e.text||"",e.selection.isNull())return console.error("Can not paste, without selection."),e;var i=!!e.containerId,o=e.doc;if(!o){if(!i)return p(t,e);e.doc=o=s(t,e)}if(!e.selection.isCollapsed()){var a=h(t,e);e.selection=a.selection}var l=o.get(f).nodes,u=t.getSchema();if(l.length>0){var c=o.get(l[0]);u.isInstanceOf(c.type,"text")&&(e=n(t,e),l.shift()),l.length>0&&(e=r(t,e))}return e};e.exports=g},{"../../util/uuid":490,"../annotationHelpers":117,"./breakNode":132,"./copySelection":133,"./deleteSelection":138,"./insertText":143,"lodash/each":313,"lodash/last":345}],146:[function(t,e,i){"use strict";function s(t,e){return n(t,e)}function n(t,e){var i=o(t,r({},e,{direction:"right"})),s=i.selection;if(!s.isPropertySelection())throw new Error("Invalid state.");var n=e.text,l=t.update(s.path,{insert:{offset:s.startOffset,value:n}});return a(t,{op:l}),e.selection=t.createSelection(s.path,s.startOffset+n.length),e}var r=t("lodash/extend"),o=t("./deleteSelection"),a=t("./updateAnnotations");e.exports=s},{"./deleteSelection":138,"./updateAnnotations":149,"lodash/extend":315}],147:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;if(!i.isPropertySelection())return console.error("Selection must be a PropertySelection."),e;var s=i.path,l=s[0],u=e.data,c=t.get(l);if(!c.isInstanceOf("text"))return console.warn("Trying to use switchTextType on a non text node. Skipping."),e;var h=n({id:r(u.type),type:u.type,content:c.content},u),p=[h.id,"content"];t.create(h),o.transferAnnotations(t,s,0,p,0);var d=t.get(e.containerId),f=d.getPosition(l);return f>=0&&(d.hide(l),d.show(h.id,f)),a(t,{nodeId:c.id}),e.selection=t.createSelection(p,i.startOffset,i.endOffset),e}var n=t("lodash/extend"),r=t("../../util/uuid"),o=t("../annotationHelpers"),a=t("./deleteNode");e.exports=s},{"../../util/uuid":490,"../annotationHelpers":117,"./deleteNode":137,"lodash/extend":315}],148:[function(t,e,i){"use strict";function s(t,e){var i=e.selection;if(!i)throw new Error("selection is required.");if(!e.annotationType)throw new Error("annotationType is required");if(i.isContainerSelection()&&!e.containerId)throw new Error("containerId must be provided for container selections");var s=n.getAnnotationsForSelection(t,i,e.annotationType,e.containerId),r=s[0],o=r.getSelection(),a=o.truncate(i);return r.updateRange(t,a),e.result=r,e}var n=t("../documentHelpers");e.exports=s},{"../documentHelpers":131}],149:[function(t,e,i){"use strict";function s(t,e){var i=e.op;if(!i.isUpdate())throw new Error("Only text updates are supported.");var s=i.diff;return s.isInsert()?n(t,e):s.isDelete()?r(t,e):e}function n(t,e){var i=e.op,s=i.diff;return o.insertedText(t,new a(i.path,s.pos),s.getLength(),e.ignoredAnnotations),e}function r(t,e){var i=e.op,s=i.diff;return o.deletedText(t,i.path,s.pos,s.pos+s.getLength(),e.replaceTextSupport),e}var o=t("../annotationHelpers"),a=t("../Coordinate");e.exports=s},{"../Coordinate":88,"../annotationHelpers":117}],150:[function(t,e,i){function s(){}var n=t("./_nativeCreate"),r=Object.prototype;s.prototype=n?n(null):r,e.exports=s},{"./_nativeCreate":287}],151:[function(t,e,i){function s(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=o,this.__views__=[]}var n=t("./_baseCreate"),r=t("./_baseLodash"),o=4294967295;s.prototype=n(r.prototype),s.prototype.constructor=s,e.exports=s},{"./_baseCreate":181,"./_baseLodash":202}],152:[function(t,e,i){function s(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=void 0}var n=t("./_baseCreate"),r=t("./_baseLodash");s.prototype=n(r.prototype),s.prototype.constructor=s,e.exports=s},{"./_baseCreate":181,"./_baseLodash":202}],153:[function(t,e,i){var s=t("./_getNative"),n=t("./_root"),r=s(n,"Map");e.exports=r},{"./_getNative":257,"./_root":292}],154:[function(t,e,i){function s(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}var n=t("./_mapClear"),r=t("./_mapDelete"),o=t("./_mapGet"),a=t("./_mapHas"),l=t("./_mapSet");s.prototype.clear=n,s.prototype["delete"]=r,s.prototype.get=o,s.prototype.has=a,s.prototype.set=l,e.exports=s},{"./_mapClear":279,"./_mapDelete":280,"./_mapGet":281,"./_mapHas":282,"./_mapSet":283}],155:[function(t,e,i){var s=t("./_root"),n=s.Reflect;e.exports=n},{"./_root":292}],156:[function(t,e,i){var s=t("./_getNative"),n=t("./_root"),r=s(n,"Set");e.exports=r},{"./_getNative":257,"./_root":292}],157:[function(t,e,i){function s(t){var e=-1,i=t?t.length:0;for(this.__data__=new n;++e<i;)this.push(t[e])}var n=t("./_MapCache"),r=t("./_cachePush");s.prototype.push=r,e.exports=s},{"./_MapCache":154,"./_cachePush":222}],158:[function(t,e,i){function s(t){var e=-1,i=t?t.length:0;for(this.clear();++e<i;){var s=t[e];this.set(s[0],s[1])}}var n=t("./_stackClear"),r=t("./_stackDelete"),o=t("./_stackGet"),a=t("./_stackHas"),l=t("./_stackSet");s.prototype.clear=n,s.prototype["delete"]=r,s.prototype.get=o,s.prototype.has=a,s.prototype.set=l,e.exports=s},{"./_stackClear":295,"./_stackDelete":296,"./_stackGet":297,"./_stackHas":298,"./_stackSet":299}],159:[function(t,e,i){var s=t("./_root"),n=s.Symbol;e.exports=n},{"./_root":292}],160:[function(t,e,i){var s=t("./_root"),n=s.Uint8Array;e.exports=n},{"./_root":292}],161:[function(t,e,i){var s=t("./_getNative"),n=t("./_root"),r=s(n,"WeakMap");e.exports=r},{"./_getNative":257,"./_root":292}],162:[function(t,e,i){function s(t,e){return t.set(e[0],e[1]),t}e.exports=s},{}],163:[function(t,e,i){function s(t,e){return t.add(e),t}e.exports=s},{}],164:[function(t,e,i){function s(t,e,i){var s=i.length;switch(s){case 0:return t.call(e);case 1:return t.call(e,i[0]);case 2:return t.call(e,i[0],i[1]);case 3:return t.call(e,i[0],i[1],i[2])}return t.apply(e,i)}e.exports=s},{}],165:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length;++i<s&&e(t[i],i,t)!==!1;);return t}e.exports=s},{}],166:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length,n=-1,r=[];++i<s;){var o=t[i];e(o,i,t)&&(r[++n]=o)}return r}e.exports=s},{}],167:[function(t,e,i){function s(t,e){return!!t.length&&n(t,e,0)>-1}var n=t("./_baseIndexOf");e.exports=s},{"./_baseIndexOf":194}],168:[function(t,e,i){function s(t,e,i){for(var s=-1,n=t.length;++s<n;)if(i(e,t[s]))return!0;return!1}e.exports=s},{}],169:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length,n=Array(s);++i<s;)n[i]=e(t[i],i,t);return n}e.exports=s},{}],170:[function(t,e,i){function s(t,e){for(var i=-1,s=e.length,n=t.length;++i<s;)t[n+i]=e[i];return t}e.exports=s},{}],171:[function(t,e,i){function s(t,e,i,s){var n=-1,r=t.length;for(s&&r&&(i=t[++n]);++n<r;)i=e(i,t[n],n,t);return i}e.exports=s},{}],172:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length;++i<s;)if(e(t[i],i,t))return!0;return!1}e.exports=s},{}],173:[function(t,e,i){function s(t,e,i){var s=t[e];(!n(s,i)||n(s,r[e])&&!o.call(t,e)||void 0===i&&!(e in t))&&(t[e]=i)}var n=t("./eq"),r=Object.prototype,o=r.hasOwnProperty;e.exports=s},{"./eq":314}],174:[function(t,e,i){function s(t,e){var i=n(t,e);if(0>i)return!1;var s=t.length-1;return i==s?t.pop():o.call(t,i,1),!0}var n=t("./_assocIndexOf"),r=Array.prototype,o=r.splice;e.exports=s},{"./_assocIndexOf":177}],175:[function(t,e,i){function s(t,e){var i=n(t,e);return 0>i?void 0:t[i][1]}var n=t("./_assocIndexOf");e.exports=s},{"./_assocIndexOf":177}],176:[function(t,e,i){function s(t,e){return n(t,e)>-1}var n=t("./_assocIndexOf");e.exports=s},{"./_assocIndexOf":177}],177:[function(t,e,i){function s(t,e){for(var i=t.length;i--;)if(n(t[i][0],e))return i;return-1}var n=t("./eq");e.exports=s},{"./eq":314}],178:[function(t,e,i){function s(t,e,i){var s=n(t,e);0>s?t.push([e,i]):t[s][1]=i}var n=t("./_assocIndexOf");e.exports=s},{"./_assocIndexOf":177}],179:[function(t,e,i){function s(t,e){return t&&n(e,r(e),t)}var n=t("./_copyObject"),r=t("./keys");e.exports=s},{"./_copyObject":235,"./keys":343}],180:[function(t,e,i){function s(t,e,i,y,_,x){var C;if(i&&(C=_?i(t,y,_,x):i(t)),void 0!==C)return C;if(!b(t))return t;var T=m(t);if(T){if(C=p(t),!e)return u(t,C)}else{var E=h(t),O=E==w||E==S;if(E!=I&&E!=v&&(!O||_))return $[E]?d(t,E,e):_?t:{};if(g(t))return _?t:{};if(C=f(O?{}:t),!e)return c(t,a(C,t))}x||(x=new n);var A=x.get(t);return A?A:(x.set(t,C),(T?r:l)(t,function(n,r){o(C,r,s(n,e,i,r,t,x))}),T?C:c(t,C))}var n=t("./_Stack"),r=t("./_arrayEach"),o=t("./_assignValue"),a=t("./_baseAssign"),l=t("./_baseForOwn"),u=t("./_copyArray"),c=t("./_copySymbols"),h=t("./_getTag"),p=t("./_initCloneArray"),d=t("./_initCloneByTag"),f=t("./_initCloneObject"),m=t("./isArray"),g=t("./_isHostObject"),b=t("./isObject"),v="[object Arguments]",y="[object Array]",_="[object Boolean]",x="[object Date]",C="[object Error]",w="[object Function]",S="[object GeneratorFunction]",T="[object Map]",E="[object Number]",I="[object Object]",O="[object RegExp]",A="[object Set]",N="[object String]",k="[object Symbol]",P="[object WeakMap]",D="[object ArrayBuffer]",R="[object Float32Array]",L="[object Float64Array]",j="[object Int8Array]",M="[object Int16Array]",F="[object Int32Array]",B="[object Uint8Array]",q="[object Uint8ClampedArray]",U="[object Uint16Array]",H="[object Uint32Array]",$={};$[v]=$[y]=$[D]=$[_]=$[x]=$[R]=$[L]=$[j]=$[M]=$[F]=$[T]=$[E]=$[I]=$[O]=$[A]=$[N]=$[k]=$[B]=$[q]=$[U]=$[H]=!0,$[C]=$[w]=$[P]=!1,e.exports=s},{"./_Stack":158,"./_arrayEach":165,"./_assignValue":173,"./_baseAssign":179,"./_baseForOwn":190,"./_copyArray":234,"./_copySymbols":237,"./_getTag":259,"./_initCloneArray":267,"./_initCloneByTag":268,"./_initCloneObject":269,"./_isHostObject":270,"./isArray":327,"./isObject":338}],181:[function(t,e,i){var s=t("./isObject"),n=function(){function t(){}return function(e){if(s(e)){t.prototype=e;var i=new t;t.prototype=void 0}return i||{}}}();e.exports=n},{"./isObject":338}],182:[function(t,e,i){function s(t,e,i){if("function"!=typeof t)throw new TypeError(n);return setTimeout(function(){t.apply(void 0,i)},e)}var n="Expected a function";e.exports=s},{}],183:[function(t,e,i){function s(t,e,i,s){var h=-1,p=r,d=!0,f=t.length,m=[],g=e.length;if(!f)return m;i&&(e=a(e,l(i))),s?(p=o,d=!1):e.length>=c&&(p=u,d=!1,e=new n(e));t:for(;++h<f;){var b=t[h],v=i?i(b):b;if(d&&v===v){for(var y=g;y--;)if(e[y]===v)continue t;m.push(b)}else p(e,v,s)||m.push(b)}return m}var n=t("./_SetCache"),r=t("./_arrayIncludes"),o=t("./_arrayIncludesWith"),a=t("./_arrayMap"),l=t("./_baseUnary"),u=t("./_cacheHas"),c=200;e.exports=s},{"./_SetCache":157,"./_arrayIncludes":167,"./_arrayIncludesWith":168,"./_arrayMap":169,"./_baseUnary":217,"./_cacheHas":221}],184:[function(t,e,i){var s=t("./_baseForOwn"),n=t("./_createBaseEach"),r=n(s);e.exports=r},{"./_baseForOwn":190,"./_createBaseEach":239}],185:[function(t,e,i){function s(t,e){var i=[];return n(t,function(t,s,n){e(t,s,n)&&i.push(t)}),i}var n=t("./_baseEach");e.exports=s},{"./_baseEach":184}],186:[function(t,e,i){function s(t,e,i,s){var n;return i(t,function(t,i,r){return e(t,i,r)?(n=s?i:t,!1):void 0}),n}e.exports=s},{}],187:[function(t,e,i){function s(t,e,i){for(var s=t.length,n=i?s:-1;i?n--:++n<s;)if(e(t[n],n,t))return n;return-1}e.exports=s},{}],188:[function(t,e,i){function s(t,e,i,l){l||(l=[]);for(var u=-1,c=t.length;++u<c;){var h=t[u];a(h)&&(i||o(h)||r(h))?e?s(h,e,i,l):n(l,h):i||(l[l.length]=h)}return l}var n=t("./_arrayPush"),r=t("./isArguments"),o=t("./isArray"),a=t("./isArrayLikeObject");e.exports=s},{"./_arrayPush":170,"./isArguments":326,"./isArray":327,"./isArrayLikeObject":329}],189:[function(t,e,i){var s=t("./_createBaseFor"),n=s();e.exports=n},{"./_createBaseFor":240}],190:[function(t,e,i){function s(t,e){return t&&n(t,e,r)}var n=t("./_baseFor"),r=t("./keys");e.exports=s},{"./_baseFor":189,"./keys":343}],191:[function(t,e,i){function s(t,e){e=r(e,t)?[e+""]:n(e);for(var i=0,s=e.length;null!=t&&s>i;)t=t[e[i++]];return i&&i==s?t:void 0}var n=t("./_baseToPath"),r=t("./_isKey");e.exports=s},{"./_baseToPath":216,"./_isKey":273}],192:[function(t,e,i){function s(t,e){return r.call(t,e)||"object"==typeof t&&e in t&&null===o(t)}var n=Object.prototype,r=n.hasOwnProperty,o=Object.getPrototypeOf;e.exports=s},{}],193:[function(t,e,i){function s(t,e){return e in Object(t)}e.exports=s},{}],194:[function(t,e,i){function s(t,e,i){if(e!==e)return n(t,i);for(var s=i-1,r=t.length;++s<r;)if(t[s]===e)return s;return-1}var n=t("./_indexOfNaN");e.exports=s},{"./_indexOfNaN":266}],195:[function(t,e,i){function s(t,e,i){for(var s=i?o:r,c=t.length,h=c,p=Array(c),d=[];h--;){var f=t[h];h&&e&&(f=a(f,l(e))),p[h]=!i&&(e||f.length>=120)?new n(h&&f):void 0}f=t[0];var m=-1,g=f.length,b=p[0];t:for(;++m<g;){var v=f[m],y=e?e(v):v;if(!(b?u(b,y):s(d,y,i))){for(var h=c;--h;){var _=p[h];if(!(_?u(_,y):s(t[h],y,i)))continue t}b&&b.push(y),d.push(v)}}return d}var n=t("./_SetCache"),r=t("./_arrayIncludes"),o=t("./_arrayIncludesWith"),a=t("./_arrayMap"),l=t("./_baseUnary"),u=t("./_cacheHas");e.exports=s},{"./_SetCache":157,"./_arrayIncludes":167,"./_arrayIncludesWith":168,"./_arrayMap":169,"./_baseUnary":217,"./_cacheHas":221}],196:[function(t,e,i){function s(t,e,i,a,l){return t===e?!0:null==t||null==e||!r(t)&&!o(e)?t!==t&&e!==e:n(t,e,s,i,a,l)}var n=t("./_baseIsEqualDeep"),r=t("./isObject"),o=t("./isObjectLike");e.exports=s},{"./_baseIsEqualDeep":197,"./isObject":338,"./isObjectLike":339}],197:[function(t,e,i){function s(t,e,i,s,g,v){var y=u(t),_=u(e),x=f,C=f;y||(x=l(t),x==d?x=m:x!=m&&(y=h(t))),_||(C=l(e),C==d?C=m:C!=m&&(_=h(e)));var w=x==m&&!c(t),S=C==m&&!c(e),T=x==C;if(T&&!y&&!w)return o(t,e,x,i,s,g);var E=g&p;if(!E){var I=w&&b.call(t,"__wrapped__"),O=S&&b.call(e,"__wrapped__");
if(I||O)return i(I?t.value():t,O?e.value():e,s,g,v)}return T?(v||(v=new n),(y?r:a)(t,e,i,s,g,v)):!1}var n=t("./_Stack"),r=t("./_equalArrays"),o=t("./_equalByTag"),a=t("./_equalObjects"),l=t("./_getTag"),u=t("./isArray"),c=t("./_isHostObject"),h=t("./isTypedArray"),p=2,d="[object Arguments]",f="[object Array]",m="[object Object]",g=Object.prototype,b=g.hasOwnProperty;e.exports=s},{"./_Stack":158,"./_equalArrays":250,"./_equalByTag":251,"./_equalObjects":252,"./_getTag":259,"./_isHostObject":270,"./isArray":327,"./isTypedArray":342}],198:[function(t,e,i){function s(t,e,i,s){var l=i.length,u=l,c=!s;if(null==t)return!u;for(t=Object(t);l--;){var h=i[l];if(c&&h[2]?h[1]!==t[h[0]]:!(h[0]in t))return!1}for(;++l<u;){h=i[l];var p=h[0],d=t[p],f=h[1];if(c&&h[2]){if(void 0===d&&!(p in t))return!1}else{var m=new n,g=s?s(d,f,p,t,e,m):void 0;if(!(void 0===g?r(f,d,s,o|a,m):g))return!1}}return!0}var n=t("./_Stack"),r=t("./_baseIsEqual"),o=1,a=2;e.exports=s},{"./_Stack":158,"./_baseIsEqual":196}],199:[function(t,e,i){function s(t){var e=typeof t;return"function"==e?t:null==t?o:"object"==e?a(t)?r(t[0],t[1]):n(t):l(t)}var n=t("./_baseMatches"),r=t("./_baseMatchesProperty"),o=t("./identity"),a=t("./isArray"),l=t("./property");e.exports=s},{"./_baseMatches":204,"./_baseMatchesProperty":205,"./identity":323,"./isArray":327,"./property":350}],200:[function(t,e,i){function s(t){return n(Object(t))}var n=Object.keys;e.exports=s},{}],201:[function(t,e,i){function s(t){t=null==t?t:Object(t);var e=[];for(var i in t)e.push(i);return e}var n=t("./_Reflect"),r=t("./_iteratorToArray"),o=Object.prototype,a=n?n.enumerate:void 0,l=o.propertyIsEnumerable;a&&!l.call({valueOf:1},"valueOf")&&(s=function(t){return r(a(t))}),e.exports=s},{"./_Reflect":155,"./_iteratorToArray":278}],202:[function(t,e,i){function s(){}e.exports=s},{}],203:[function(t,e,i){function s(t,e){var i=-1,s=r(t)?Array(t.length):[];return n(t,function(t,n,r){s[++i]=e(t,n,r)}),s}var n=t("./_baseEach"),r=t("./isArrayLike");e.exports=s},{"./_baseEach":184,"./isArrayLike":328}],204:[function(t,e,i){function s(t){var e=r(t);if(1==e.length&&e[0][2]){var i=e[0][0],s=e[0][1];return function(t){return null==t?!1:t[i]===s&&(void 0!==s||i in Object(t))}}return function(i){return i===t||n(i,t,e)}}var n=t("./_baseIsMatch"),r=t("./_getMatchData");e.exports=s},{"./_baseIsMatch":198,"./_getMatchData":256}],205:[function(t,e,i){function s(t,e){return function(i){var s=r(i,t);return void 0===s&&s===e?o(i,t):n(e,s,void 0,a|l)}}var n=t("./_baseIsEqual"),r=t("./get"),o=t("./hasIn"),a=1,l=2;e.exports=s},{"./_baseIsEqual":196,"./get":319,"./hasIn":321}],206:[function(t,e,i){function s(t,e,i){var s=-1,u=r;e=n(e.length?e:Array(1),function(t){return u(t)});var c=o(t,function(t,i,r){var o=n(e,function(e){return e(t)});return{criteria:o,index:++s,value:t}});return a(c,function(t,e){return l(t,e,i)})}var n=t("./_arrayMap"),r=t("./_baseIteratee"),o=t("./_baseMap"),a=t("./_baseSortBy"),l=t("./_compareMultiple");e.exports=s},{"./_arrayMap":169,"./_baseIteratee":199,"./_baseMap":203,"./_baseSortBy":213,"./_compareMultiple":231}],207:[function(t,e,i){function s(t,e){return t=Object(t),n(e,function(e,i){return i in t&&(e[i]=t[i]),e},{})}var n=t("./_arrayReduce");e.exports=s},{"./_arrayReduce":171}],208:[function(t,e,i){arguments[4][37][0].apply(i,arguments)},{dup:37}],209:[function(t,e,i){function s(t){return function(e){return n(e,t)}}var n=t("./_baseGet");e.exports=s},{"./_baseGet":191}],210:[function(t,e,i){function s(t,e,i,s){e=a(e,t)?[e+""]:r(e);for(var u=-1,c=e.length,h=c-1,p=t;null!=p&&++u<c;){var d=e[u];if(l(p)){var f=i;if(u!=h){var m=p[d];f=s?s(m,d,p):void 0,void 0===f&&(f=null==m?o(e[u+1])?[]:{}:m)}n(p,d,f)}p=p[d]}return t}var n=t("./_assignValue"),r=t("./_baseToPath"),o=t("./_isIndex"),a=t("./_isKey"),l=t("./isObject");e.exports=s},{"./_assignValue":173,"./_baseToPath":216,"./_isIndex":271,"./_isKey":273,"./isObject":338}],211:[function(t,e,i){var s=t("./identity"),n=t("./_metaMap"),r=n?function(t,e){return n.set(t,e),t}:s;e.exports=r},{"./_metaMap":286,"./identity":323}],212:[function(t,e,i){function s(t,e,i){var s=-1,n=t.length;0>e&&(e=-e>n?0:n+e),i=i>n?n:i,0>i&&(i+=n),n=e>i?0:i-e>>>0,e>>>=0;for(var r=Array(n);++s<n;)r[s]=t[s+e];return r}e.exports=s},{}],213:[function(t,e,i){arguments[4][40][0].apply(i,arguments)},{dup:40}],214:[function(t,e,i){function s(t,e){for(var i=-1,s=Array(t);++i<t;)s[i]=e(i);return s}e.exports=s},{}],215:[function(t,e,i){function s(t,e){return n(e,function(e){return[e,t[e]]})}var n=t("./_arrayMap");e.exports=s},{"./_arrayMap":169}],216:[function(t,e,i){function s(t){return n(t)?t:r(t)}var n=t("./isArray"),r=t("./_stringToPath");e.exports=s},{"./_stringToPath":301,"./isArray":327}],217:[function(t,e,i){function s(t){return function(e){return t(e)}}e.exports=s},{}],218:[function(t,e,i){function s(t,e,i){var s=-1,h=r,p=t.length,d=!0,f=[],m=f;if(i)d=!1,h=o;else if(p>=c){var g=e?null:l(t);if(g)return u(g);d=!1,h=a,m=new n}else m=e?[]:f;t:for(;++s<p;){var b=t[s],v=e?e(b):b;if(d&&v===v){for(var y=m.length;y--;)if(m[y]===v)continue t;e&&m.push(v),f.push(b)}else h(m,v,i)||(m!==f&&m.push(v),f.push(b))}return f}var n=t("./_SetCache"),r=t("./_arrayIncludes"),o=t("./_arrayIncludesWith"),a=t("./_cacheHas"),l=t("./_createSet"),u=t("./_setToArray"),c=200;e.exports=s},{"./_SetCache":157,"./_arrayIncludes":167,"./_arrayIncludesWith":168,"./_cacheHas":221,"./_createSet":248,"./_setToArray":294}],219:[function(t,e,i){function s(t,e){e=o(e,t)?[e+""]:n(e),t=l(t,e);var i=a(e);return null!=t&&r(t,i)?delete t[i]:!0}var n=t("./_baseToPath"),r=t("./has"),o=t("./_isKey"),a=t("./last"),l=t("./_parent");e.exports=s},{"./_baseToPath":216,"./_isKey":273,"./_parent":288,"./has":320,"./last":345}],220:[function(t,e,i){function s(t,e){return n(e,function(e){return t[e]})}var n=t("./_arrayMap");e.exports=s},{"./_arrayMap":169}],221:[function(t,e,i){function s(t,e){var i=t.__data__;if(n(e)){var s=i.__data__,o="string"==typeof e?s.string:s.hash;return o[e]===r}return i.has(e)}var n=t("./_isKeyable"),r="__lodash_hash_undefined__";e.exports=s},{"./_isKeyable":274}],222:[function(t,e,i){function s(t){var e=this.__data__;if(n(t)){var i=e.__data__,s="string"==typeof t?i.string:i.hash;s[t]=r}else e.set(t,r)}var n=t("./_isKeyable"),r="__lodash_hash_undefined__";e.exports=s},{"./_isKeyable":274}],223:[function(t,e,i){function s(t){return t&&t.Object===Object?t:null}e.exports=s},{}],224:[function(t,e,i){function s(t){var e=t.constructor,i=new e(t.byteLength),s=new n(i);return s.set(new n(t)),i}var n=t("./_Uint8Array");e.exports=s},{"./_Uint8Array":160}],225:[function(t,e,i){function s(t){var e=t.constructor;return r(o(t),n,new e)}var n=t("./_addMapEntry"),r=t("./_arrayReduce"),o=t("./_mapToArray");e.exports=s},{"./_addMapEntry":162,"./_arrayReduce":171,"./_mapToArray":284}],226:[function(t,e,i){function s(t){var e=t.constructor,i=new e(t.source,n.exec(t));return i.lastIndex=t.lastIndex,i}var n=/\w*$/;e.exports=s},{}],227:[function(t,e,i){function s(t){var e=t.constructor;return r(o(t),n,new e)}var n=t("./_addSetEntry"),r=t("./_arrayReduce"),o=t("./_setToArray");e.exports=s},{"./_addSetEntry":163,"./_arrayReduce":171,"./_setToArray":294}],228:[function(t,e,i){function s(t){return n?Object(o.call(t)):{}}var n=t("./_Symbol"),r=n?n.prototype:void 0,o=n?r.valueOf:void 0;e.exports=s},{"./_Symbol":159}],229:[function(t,e,i){function s(t,e){var i=t.buffer,s=t.constructor;return new s(e?n(i):i,t.byteOffset,t.length)}var n=t("./_cloneBuffer");e.exports=s},{"./_cloneBuffer":224}],230:[function(t,e,i){function s(t,e){if(t!==e){var i=null===t,s=void 0===t,n=t===t,r=null===e,o=void 0===e,a=e===e;if(t>e&&!r||!n||i&&!o&&a||s&&a)return 1;if(e>t&&!i||!a||r&&!s&&n||o&&n)return-1}return 0}e.exports=s},{}],231:[function(t,e,i){function s(t,e,i){for(var s=-1,r=t.criteria,o=e.criteria,a=r.length,l=i.length;++s<a;){var u=n(r[s],o[s]);if(u){if(s>=l)return u;var c=i[s];return u*("desc"==c?-1:1)}}return t.index-e.index}var n=t("./_compareAscending");e.exports=s},{"./_compareAscending":230}],232:[function(t,e,i){function s(t,e,i){for(var s=i.length,r=-1,o=n(t.length-s,0),a=-1,l=e.length,u=Array(l+o);++a<l;)u[a]=e[a];for(;++r<s;)u[i[r]]=t[r];for(;o--;)u[a++]=t[r++];return u}var n=Math.max;e.exports=s},{}],233:[function(t,e,i){function s(t,e,i){for(var s=-1,r=i.length,o=-1,a=n(t.length-r,0),l=-1,u=e.length,c=Array(a+u);++o<a;)c[o]=t[o];for(var h=o;++l<u;)c[h+l]=e[l];for(;++s<r;)c[h+i[s]]=t[o++];return c}var n=Math.max;e.exports=s},{}],234:[function(t,e,i){function s(t,e){var i=-1,s=t.length;for(e||(e=Array(s));++i<s;)e[i]=t[i];return e}e.exports=s},{}],235:[function(t,e,i){function s(t,e,i){return n(t,e,i)}var n=t("./_copyObjectWith");e.exports=s},{"./_copyObjectWith":236}],236:[function(t,e,i){function s(t,e,i,s){i||(i={});for(var r=-1,o=e.length;++r<o;){var a=e[r],l=s?s(i[a],t[a],a,i,t):t[a];n(i,a,l)}return i}var n=t("./_assignValue");e.exports=s},{"./_assignValue":173}],237:[function(t,e,i){function s(t,e){return n(t,r(t),e)}var n=t("./_copyObject"),r=t("./_getSymbols");e.exports=s},{"./_copyObject":235,"./_getSymbols":258}],238:[function(t,e,i){function s(t){return r(function(e,i){var s=-1,r=i.length,o=r>1?i[r-1]:void 0,a=r>2?i[2]:void 0;for(o="function"==typeof o?(r--,o):void 0,a&&n(i[0],i[1],a)&&(o=3>r?void 0:o,r=1),e=Object(e);++s<r;){var l=i[s];l&&t(e,l,s,o)}return e})}var n=t("./_isIterateeCall"),r=t("./rest");e.exports=s},{"./_isIterateeCall":272,"./rest":351}],239:[function(t,e,i){function s(t,e){return function(i,s){if(null==i)return i;if(!n(i))return t(i,s);for(var r=i.length,o=e?r:-1,a=Object(i);(e?o--:++o<r)&&s(a[o],o,a)!==!1;);return i}}var n=t("./isArrayLike");e.exports=s},{"./isArrayLike":328}],240:[function(t,e,i){function s(t){return function(e,i,s){for(var n=-1,r=Object(e),o=s(e),a=o.length;a--;){var l=o[t?a:++n];if(i(r[l],l,r)===!1)break}return e}}e.exports=s},{}],241:[function(t,e,i){function s(t,e,i){function s(){var e=this&&this!==r&&this instanceof s?l:t;return e.apply(a?i:this,arguments)}var a=e&o,l=n(t);return s}var n=t("./_createCtorWrapper"),r=t("./_root"),o=1;e.exports=s},{"./_createCtorWrapper":243,"./_root":292}],242:[function(t,e,i){function s(t){return function(e){e=r(e);var i=h.test(e)?n(e):void 0,s=i?i[0]:e.charAt(0),o=i?i.slice(1).join(""):e.slice(1);return s[t]()+o}}var n=t("./_stringToArray"),r=t("./toString"),o="\\ud800-\\udfff",a="\\u0300-\\u036f\\ufe20-\\ufe23",l="\\u20d0-\\u20f0",u="\\ufe0e\\ufe0f",c="\\u200d",h=RegExp("["+c+o+a+l+u+"]");e.exports=s},{"./_stringToArray":300,"./toString":357}],243:[function(t,e,i){function s(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var i=n(t.prototype),s=t.apply(i,e);return r(s)?s:i}}var n=t("./_baseCreate"),r=t("./isObject");e.exports=s},{"./_baseCreate":181,"./isObject":338}],244:[function(t,e,i){function s(t,e,i){function s(){for(var r=arguments.length,h=r,p=Array(r),d=this&&this!==u&&this instanceof s?c:t,f=s.placeholder;h--;)p[h]=arguments[h];var m=3>r&&p[0]!==f&&p[r-1]!==f?[]:l(p,f);return r-=m.length,i>r?a(t,e,o,f,void 0,p,m,void 0,void 0,i-r):n(d,this,p)}var c=r(t);return s}var n=t("./_apply"),r=t("./_createCtorWrapper"),o=t("./_createHybridWrapper"),a=t("./_createRecurryWrapper"),l=t("./_replaceHolders"),u=t("./_root");e.exports=s},{"./_apply":164,"./_createCtorWrapper":243,"./_createHybridWrapper":245,"./_createRecurryWrapper":247,"./_replaceHolders":291,"./_root":292}],245:[function(t,e,i){function s(t,e,i,b,v,y,_,x,C,w){function S(){for(var h=arguments.length,p=h,d=Array(h);p--;)d[p]=arguments[p];if(b&&(d=n(d,b,v)),y&&(d=r(d,y,_)),O||A){var f=S.placeholder,m=u(d,f);if(h-=m.length,w>h)return a(t,e,s,f,i,d,m,x,C,w-h)}var g=E?i:this,P=I?g[t]:t;return x?d=l(d,x):N&&d.length>1&&d.reverse(),T&&C<d.length&&(d.length=C),this&&this!==c&&this instanceof S&&(P=k||o(P)),P.apply(g,d)}var T=e&m,E=e&h,I=e&p,O=e&d,A=e&f,N=e&g,k=I?void 0:o(t);return S}var n=t("./_composeArgs"),r=t("./_composeArgsRight"),o=t("./_createCtorWrapper"),a=t("./_createRecurryWrapper"),l=t("./_reorder"),u=t("./_replaceHolders"),c=t("./_root"),h=1,p=2,d=8,f=16,m=128,g=512;e.exports=s},{"./_composeArgs":232,"./_composeArgsRight":233,"./_createCtorWrapper":243,"./_createRecurryWrapper":247,"./_reorder":290,"./_replaceHolders":291,"./_root":292}],246:[function(t,e,i){function s(t,e,i,s){function l(){for(var e=-1,r=arguments.length,a=-1,h=s.length,p=Array(h+r),d=this&&this!==o&&this instanceof l?c:t;++a<h;)p[a]=s[a];for(;r--;)p[a++]=arguments[++e];return n(d,u?i:this,p)}var u=e&a,c=r(t);return l}var n=t("./_apply"),r=t("./_createCtorWrapper"),o=t("./_root"),a=1;e.exports=s},{"./_apply":164,"./_createCtorWrapper":243,"./_root":292}],247:[function(t,e,i){function s(t,e,i,s,d,f,m,g,b,v){var y=e&c,_=g?n(g):void 0,x=y?m:void 0,C=y?void 0:m,w=y?f:void 0,S=y?void 0:f;e|=y?h:p,e&=~(y?p:h),e&u||(e&=~(a|l));var T=[t,e,d,w,x,S,C,_,b,v],E=i.apply(void 0,T);return r(t)&&o(E,T),E.placeholder=s,E}var n=t("./_copyArray"),r=t("./_isLaziable"),o=t("./_setData"),a=1,l=2,u=4,c=8,h=32,p=64;e.exports=s},{"./_copyArray":234,"./_isLaziable":275,"./_setData":293}],248:[function(t,e,i){var s=t("./_Set"),n=t("./noop"),r=s&&2===new s([1,2]).size?function(t){return new s(t)}:n;e.exports=r},{"./_Set":156,"./noop":347}],249:[function(t,e,i){function s(t,e,i,s,x,C,w,S){var T=e&f;if(!T&&"function"!=typeof t)throw new TypeError(y);var E=s?s.length:0;if(E||(e&=~(b|v),s=x=void 0),w=void 0===w?w:_(p(w),0),S=void 0===S?S:p(S),E-=x?x.length:0,e&v){var I=s,O=x;s=x=void 0}var A=T?void 0:u(t),N=[t,e,i,s,x,I,O,C,w,S];if(A&&c(N,A),t=N[0],e=N[1],i=N[2],s=N[3],x=N[4],S=N[9]=null==N[9]?T?0:t.length:_(N[9]-E,0),!S&&e&(m|g)&&(e&=~(m|g)),e&&e!=d)k=e==m||e==g?o(t,e,S):e!=b&&e!=(d|b)||x.length?a.apply(void 0,N):l(t,e,i,s);else var k=r(t,e,i);var P=A?n:h;return P(k,N)}var n=t("./_baseSetData"),r=t("./_createBaseWrapper"),o=t("./_createCurryWrapper"),a=t("./_createHybridWrapper"),l=t("./_createPartialWrapper"),u=t("./_getData"),c=t("./_mergeData"),h=t("./_setData"),p=t("./toInteger"),d=1,f=2,m=8,g=16,b=32,v=64,y="Expected a function",_=Math.max;e.exports=s},{"./_baseSetData":211,"./_createBaseWrapper":241,"./_createCurryWrapper":244,"./_createHybridWrapper":245,"./_createPartialWrapper":246,"./_getData":253,"./_mergeData":285,"./_setData":293,"./toInteger":354}],250:[function(t,e,i){function s(t,e,i,s,a,l){var u=-1,c=a&o,h=a&r,p=t.length,d=e.length;if(p!=d&&!(c&&d>p))return!1;var f=l.get(t);if(f)return f==e;var m=!0;for(l.set(t,e);++u<p;){var g=t[u],b=e[u];if(s)var v=c?s(b,g,u,e,t,l):s(g,b,u,t,e,l);if(void 0!==v){if(v)continue;m=!1;break}if(h){if(!n(e,function(t){return g===t||i(g,t,s,a,l)})){m=!1;break}}else if(g!==b&&!i(g,b,s,a,l)){m=!1;break}}return l["delete"](t),m}var n=t("./_arraySome"),r=1,o=2;e.exports=s},{"./_arraySome":172}],251:[function(t,e,i){function s(t,e,i,s,_,C){switch(i){case y:return t.byteLength==e.byteLength&&s(new r(t),new r(e))?!0:!1;case c:case h:return+t==+e;case p:return t.name==e.name&&t.message==e.message;case f:return t!=+t?e!=+e:t==+e;case m:case b:return t==e+"";case d:var w=o;case g:var S=C&u;return w||(w=a),(S||t.size==e.size)&&s(w(t),w(e),_,C|l);case v:return!!n&&x.call(t)==x.call(e)}return!1}var n=t("./_Symbol"),r=t("./_Uint8Array"),o=t("./_mapToArray"),a=t("./_setToArray"),l=1,u=2,c="[object Boolean]",h="[object Date]",p="[object Error]",d="[object Map]",f="[object Number]",m="[object RegExp]",g="[object Set]",b="[object String]",v="[object Symbol]",y="[object ArrayBuffer]",_=n?n.prototype:void 0,x=n?_.valueOf:void 0;e.exports=s},{"./_Symbol":159,"./_Uint8Array":160,"./_mapToArray":284,"./_setToArray":294}],252:[function(t,e,i){function s(t,e,i,s,a,l){var u=a&o,c=r(t),h=c.length,p=r(e),d=p.length;if(h!=d&&!u)return!1;for(var f=h;f--;){var m=c[f];if(!(u?m in e:n(e,m)))return!1}var g=l.get(t);if(g)return g==e;var b=!0;l.set(t,e);for(var v=u;++f<h;){m=c[f];var y=t[m],_=e[m];if(s)var x=u?s(_,y,m,e,t,l):s(y,_,m,t,e,l);if(!(void 0===x?y===_||i(y,_,s,a,l):x)){b=!1;break}v||(v="constructor"==m)}if(b&&!v){var C=t.constructor,w=e.constructor;C!=w&&"constructor"in t&&"constructor"in e&&!("function"==typeof C&&C instanceof C&&"function"==typeof w&&w instanceof w)&&(b=!1)}return l["delete"](t),b}var n=t("./_baseHas"),r=t("./keys"),o=2;e.exports=s},{"./_baseHas":192,"./keys":343}],253:[function(t,e,i){var s=t("./_metaMap"),n=t("./noop"),r=s?function(t){return s.get(t)}:n;e.exports=r},{"./_metaMap":286,"./noop":347}],254:[function(t,e,i){function s(t){for(var e=t.name+"",i=n[e],s=o.call(n,e)?i.length:0;s--;){var r=i[s],a=r.func;if(null==a||a==t)return r.name}return e}var n=t("./_realNames"),r=Object.prototype,o=r.hasOwnProperty;e.exports=s},{"./_realNames":289}],255:[function(t,e,i){var s=t("./_baseProperty"),n=s("length");e.exports=n},{"./_baseProperty":208}],256:[function(t,e,i){function s(t){for(var e=r(t),i=e.length;i--;)e[i][2]=n(e[i][1]);return e}var n=t("./_isStrictComparable"),r=t("./toPairs");e.exports=s},{"./_isStrictComparable":277,"./toPairs":356}],257:[function(t,e,i){function s(t,e){var i=null==t?void 0:t[e];return n(i)?i:void 0}var n=t("./isNative");e.exports=s},{"./isNative":336}],258:[function(t,e,i){var s=Object.getOwnPropertySymbols,n=s||function(){return[]};e.exports=n},{}],259:[function(t,e,i){function s(t){return h.call(t)}var n=t("./_Map"),r=t("./_Set"),o="[object Map]",a="[object Object]",l="[object Set]",u=Object.prototype,c=Function.prototype.toString,h=u.toString,p=n?c.call(n):"",d=r?c.call(r):"";(n&&s(new n)!=o||r&&s(new r)!=l)&&(s=function(t){var e=h.call(t),i=e==a?t.constructor:null,s="function"==typeof i?c.call(i):"";if(s){if(s==p)return o;if(s==d)return l}return e}),e.exports=s},{"./_Map":153,"./_Set":156}],260:[function(t,e,i){function s(t,e,i){if(null==t)return!1;var s=i(t,e);s||l(e)||(e=n(e),t=p(t,e),null!=t&&(e=h(e),s=i(t,e)));var d=t?t.length:void 0;return s||!!d&&u(d)&&a(e,d)&&(o(t)||c(t)||r(t))}var n=t("./_baseToPath"),r=t("./isArguments"),o=t("./isArray"),a=t("./_isIndex"),l=t("./_isKey"),u=t("./isLength"),c=t("./isString"),h=t("./last"),p=t("./_parent");e.exports=s},{"./_baseToPath":216,"./_isIndex":271,"./_isKey":273,"./_parent":288,"./isArguments":326,"./isArray":327,"./isLength":334,"./isString":340,"./last":345}],261:[function(t,e,i){function s(t,e){return n(t,e)&&delete t[e]}var n=t("./_hashHas");e.exports=s},{"./_hashHas":263}],262:[function(t,e,i){function s(t,e){if(n){var i=t[e];return i===r?void 0:i}return a.call(t,e)?t[e]:void 0}var n=t("./_nativeCreate"),r="__lodash_hash_undefined__",o=Object.prototype,a=o.hasOwnProperty;e.exports=s},{"./_nativeCreate":287}],263:[function(t,e,i){function s(t,e){return n?void 0!==t[e]:o.call(t,e)}var n=t("./_nativeCreate"),r=Object.prototype,o=r.hasOwnProperty;e.exports=s},{"./_nativeCreate":287}],264:[function(t,e,i){function s(t,e,i){t[e]=n&&void 0===i?r:i}var n=t("./_nativeCreate"),r="__lodash_hash_undefined__";e.exports=s},{"./_nativeCreate":287}],265:[function(t,e,i){function s(t){var e=t?t.length:void 0;return a(e)&&(o(t)||l(t)||r(t))?n(e,String):null}var n=t("./_baseTimes"),r=t("./isArguments"),o=t("./isArray"),a=t("./isLength"),l=t("./isString");e.exports=s},{"./_baseTimes":214,"./isArguments":326,"./isArray":327,"./isLength":334,"./isString":340}],266:[function(t,e,i){arguments[4][56][0].apply(i,arguments)},{dup:56}],267:[function(t,e,i){function s(t){var e=t.length,i=t.constructor(e);return e&&"string"==typeof t[0]&&r.call(t,"index")&&(i.index=t.index,i.input=t.input),i}var n=Object.prototype,r=n.hasOwnProperty;e.exports=s},{}],268:[function(t,e,i){function s(t,e,i){var s=t.constructor;switch(e){case v:return n(t);case c:case h:return new s(+t);case y:case _:case x:case C:case w:case S:case T:case E:case I:return u(t,i);case p:return r(t);case d:case g:return new s(t);case f:return o(t);case m:return a(t);case b:return l(t)}}var n=t("./_cloneBuffer"),r=t("./_cloneMap"),o=t("./_cloneRegExp"),a=t("./_cloneSet"),l=t("./_cloneSymbol"),u=t("./_cloneTypedArray"),c="[object Boolean]",h="[object Date]",p="[object Map]",d="[object Number]",f="[object RegExp]",m="[object Set]",g="[object String]",b="[object Symbol]",v="[object ArrayBuffer]",y="[object Float32Array]",_="[object Float64Array]",x="[object Int8Array]",C="[object Int16Array]",w="[object Int32Array]",S="[object Uint8Array]",T="[object Uint8ClampedArray]",E="[object Uint16Array]",I="[object Uint32Array]";e.exports=s},{"./_cloneBuffer":224,"./_cloneMap":225,"./_cloneRegExp":226,"./_cloneSet":227,"./_cloneSymbol":228,"./_cloneTypedArray":229}],269:[function(t,e,i){function s(t){if(o(t))return{};var e=t.constructor;return n(r(e)?e.prototype:void 0)}var n=t("./_baseCreate"),r=t("./isFunction"),o=t("./_isPrototype");e.exports=s},{"./_baseCreate":181,"./_isPrototype":276,"./isFunction":333}],270:[function(t,e,i){function s(t){var e=!1;if(null!=t&&"function"!=typeof t.toString)try{e=!!(t+"")}catch(i){}return e}e.exports=s},{}],271:[function(t,e,i){function s(t,e){return t="number"==typeof t||r.test(t)?+t:-1,e=null==e?n:e,t>-1&&t%1==0&&e>t}var n=9007199254740991,r=/^(?:0|[1-9]\d*)$/;e.exports=s},{}],272:[function(t,e,i){function s(t,e,i){if(!a(i))return!1;var s=typeof e;return("number"==s?r(i)&&o(e,i.length):"string"==s&&e in i)?n(i[e],t):!1}var n=t("./eq"),r=t("./isArrayLike"),o=t("./_isIndex"),a=t("./isObject");e.exports=s},{"./_isIndex":271,"./eq":314,"./isArrayLike":328,"./isObject":338}],273:[function(t,e,i){function s(t,e){return"number"==typeof t?!0:!n(t)&&(o.test(t)||!r.test(t)||null!=e&&t in Object(e))}var n=t("./isArray"),r=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,o=/^\w*$/;e.exports=s},{"./isArray":327}],274:[function(t,e,i){function s(t){var e=typeof t;return"number"==e||"boolean"==e||"string"==e&&"__proto__"!==t||null==t}e.exports=s},{}],275:[function(t,e,i){function s(t){var e=o(t),i=a[e];if("function"!=typeof i||!(e in n.prototype))return!1;if(t===i)return!0;var s=r(i);return!!s&&t===s[0]}var n=t("./_LazyWrapper"),r=t("./_getData"),o=t("./_getFuncName"),a=t("./wrapperLodash");e.exports=s},{"./_LazyWrapper":151,"./_getData":253,"./_getFuncName":254,"./wrapperLodash":364}],276:[function(t,e,i){function s(t){var e=t&&t.constructor,i="function"==typeof e&&e.prototype||n;return t===i}var n=Object.prototype;e.exports=s},{}],277:[function(t,e,i){function s(t){return t===t&&!n(t)}var n=t("./isObject");e.exports=s},{"./isObject":338}],278:[function(t,e,i){function s(t){for(var e,i=[];!(e=t.next()).done;)i.push(e.value);return i}e.exports=s},{}],279:[function(t,e,i){function s(){this.__data__={hash:new n,map:r?new r:[],string:new n}}var n=t("./_Hash"),r=t("./_Map");e.exports=s},{"./_Hash":150,"./_Map":153}],280:[function(t,e,i){function s(t){var e=this.__data__;return a(t)?o("string"==typeof t?e.string:e.hash,t):n?e.map["delete"](t):r(e.map,t)}var n=t("./_Map"),r=t("./_assocDelete"),o=t("./_hashDelete"),a=t("./_isKeyable");e.exports=s},{"./_Map":153,"./_assocDelete":174,"./_hashDelete":261,"./_isKeyable":274}],281:[function(t,e,i){function s(t){var e=this.__data__;return a(t)?o("string"==typeof t?e.string:e.hash,t):n?e.map.get(t):r(e.map,t)}var n=t("./_Map"),r=t("./_assocGet"),o=t("./_hashGet"),a=t("./_isKeyable");e.exports=s},{"./_Map":153,"./_assocGet":175,"./_hashGet":262,"./_isKeyable":274}],282:[function(t,e,i){function s(t){var e=this.__data__;return a(t)?o("string"==typeof t?e.string:e.hash,t):n?e.map.has(t):r(e.map,t)}var n=t("./_Map"),r=t("./_assocHas"),o=t("./_hashHas"),a=t("./_isKeyable");e.exports=s},{"./_Map":153,"./_assocHas":176,"./_hashHas":263,"./_isKeyable":274}],283:[function(t,e,i){function s(t,e){var i=this.__data__;return a(t)?o("string"==typeof t?i.string:i.hash,t,e):n?i.map.set(t,e):r(i.map,t,e),this}var n=t("./_Map"),r=t("./_assocSet"),o=t("./_hashSet"),a=t("./_isKeyable");e.exports=s},{"./_Map":153,"./_assocSet":178,"./_hashSet":264,"./_isKeyable":274}],284:[function(t,e,i){function s(t){var e=-1,i=Array(t.size);return t.forEach(function(t,s){i[++e]=[s,t]}),i}e.exports=s},{}],285:[function(t,e,i){function s(t,e){var i=t[1],s=e[1],g=i|s,b=(l|u|p)>g,v=s==p&&i==h||s==p&&i==d&&t[7].length<=e[8]||s==(p|d)&&e[7].length<=e[8]&&i==h;if(!b&&!v)return t;s&l&&(t[2]=e[2],g|=i&l?0:c);var y=e[3];if(y){var _=t[3];t[3]=_?n(_,y,e[4]):o(y),t[4]=_?a(t[3],f):o(e[4])}return y=e[5],y&&(_=t[5],t[5]=_?r(_,y,e[6]):o(y),t[6]=_?a(t[5],f):o(e[6])),y=e[7],y&&(t[7]=o(y)),s&p&&(t[8]=null==t[8]?e[8]:m(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=g,t}var n=t("./_composeArgs"),r=t("./_composeArgsRight"),o=t("./_copyArray"),a=t("./_replaceHolders"),l=1,u=2,c=4,h=8,p=128,d=256,f="__lodash_placeholder__",m=Math.min;e.exports=s},{"./_composeArgs":232,"./_composeArgsRight":233,"./_copyArray":234,"./_replaceHolders":291}],286:[function(t,e,i){var s=t("./_WeakMap"),n=s&&new s;e.exports=n},{"./_WeakMap":161}],287:[function(t,e,i){var s=t("./_getNative"),n=s(Object,"create");e.exports=n},{"./_getNative":257}],288:[function(t,e,i){function s(t,e){return 1==e.length?t:r(t,n(e,0,-1))}var n=t("./_baseSlice"),r=t("./get");e.exports=s},{"./_baseSlice":212,"./get":319}],289:[function(t,e,i){var s={};e.exports=s},{}],290:[function(t,e,i){function s(t,e){for(var i=t.length,s=o(e.length,i),a=n(t);s--;){var l=e[s];t[s]=r(l,i)?a[l]:void 0}return t}var n=t("./_copyArray"),r=t("./_isIndex"),o=Math.min;e.exports=s},{"./_copyArray":234,"./_isIndex":271}],291:[function(t,e,i){function s(t,e){for(var i=-1,s=t.length,r=-1,o=[];++i<s;)t[i]===e&&(t[i]=n,o[++r]=i);return o}var n="__lodash_placeholder__";e.exports=s},{}],292:[function(t,e,i){(function(s){var n=t("./_checkGlobal"),r={"function":!0,object:!0},o=r[typeof i]&&i&&!i.nodeType?i:null,a=r[typeof e]&&e&&!e.nodeType?e:null,l=n(o&&a&&"object"==typeof s&&s),u=n(r[typeof self]&&self),c=n(r[typeof window]&&window),h=n(r[typeof this]&&this),p=l||c!==(h&&h.window)&&c||u||h||Function("return this")();e.exports=p}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./_checkGlobal":223}],293:[function(t,e,i){var s=t("./_baseSetData"),n=t("./now"),r=150,o=16,a=function(){var t=0,e=0;return function(i,a){var l=n(),u=o-(l-e);if(e=l,u>0){if(++t>=r)return i}else t=0;return s(i,a)}}();e.exports=a},{"./_baseSetData":211,"./now":348}],294:[function(t,e,i){function s(t){var e=-1,i=Array(t.size);return t.forEach(function(t){i[++e]=t}),i}e.exports=s},{}],295:[function(t,e,i){function s(){this.__data__={array:[],map:null}}e.exports=s},{}],296:[function(t,e,i){function s(t){var e=this.__data__,i=e.array;return i?n(i,t):e.map["delete"](t)}var n=t("./_assocDelete");e.exports=s},{"./_assocDelete":174}],297:[function(t,e,i){function s(t){var e=this.__data__,i=e.array;return i?n(i,t):e.map.get(t)}var n=t("./_assocGet");e.exports=s},{"./_assocGet":175}],298:[function(t,e,i){function s(t){var e=this.__data__,i=e.array;return i?n(i,t):e.map.has(t)}var n=t("./_assocHas");e.exports=s},{"./_assocHas":176}],299:[function(t,e,i){function s(t,e){var i=this.__data__,s=i.array;s&&(s.length<o-1?r(s,t,e):(i.array=null,i.map=new n(s)));var a=i.map;return a&&a.set(t,e),this}var n=t("./_MapCache"),r=t("./_assocSet"),o=200;e.exports=s},{"./_MapCache":154,"./_assocSet":178}],300:[function(t,e,i){function s(t){return t.match(x)}var n="\\ud800-\\udfff",r="\\u0300-\\u036f\\ufe20-\\ufe23",o="\\u20d0-\\u20f0",a="\\ufe0e\\ufe0f",l="["+n+"]",u="["+r+o+"]",c="\\ud83c[\\udffb-\\udfff]",h="(?:"+u+"|"+c+")",p="[^"+n+"]",d="(?:\\ud83c[\\udde6-\\uddff]){2}",f="[\\ud800-\\udbff][\\udc00-\\udfff]",m="\\u200d",g=h+"?",b="["+a+"]?",v="(?:"+m+"(?:"+[p,d,f].join("|")+")"+b+g+")*",y=b+g+v,_="(?:"+[p+u+"?",u,d,f,l].join("|")+")",x=RegExp(c+"(?="+c+")|"+_+y,"g");e.exports=s},{}],301:[function(t,e,i){function s(t){var e=[];return n(t).replace(r,function(t,i,s,n){e.push(s?n.replace(o,"$1"):i||t)}),e}var n=t("./toString"),r=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]/g,o=/\\(\\)?/g;e.exports=s},{"./toString":357}],302:[function(t,e,i){function s(t){return n(t)?t:[]}var n=t("./isArrayLikeObject");e.exports=s},{"./isArrayLikeObject":329}],303:[function(t,e,i){function s(t){return"function"==typeof t?t:n}var n=t("./identity");e.exports=s},{"./identity":323}],304:[function(t,e,i){function s(t){if(t instanceof n)return t.clone();var e=new r(t.__wrapped__,t.__chain__);return e.__actions__=o(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}var n=t("./_LazyWrapper"),r=t("./_LodashWrapper"),o=t("./_copyArray");e.exports=s},{"./_LazyWrapper":151,"./_LodashWrapper":152,"./_copyArray":234}],305:[function(t,e,i){var s=t("./_copyObject"),n=t("./_createAssigner"),r=t("./keysIn"),o=n(function(t,e){s(e,r(e),t)});e.exports=o},{"./_copyObject":235,"./_createAssigner":238,"./keysIn":344}],306:[function(t,e,i){var s=t("./_createWrapper"),n=t("./_replaceHolders"),r=t("./rest"),o=1,a=32,l=r(function(t,e,i){var r=o;if(i.length){var u=l.placeholder,c=n(i,u);r|=a}return s(t,r,e,i,c)});e.exports=l},{"./_createWrapper":249,"./_replaceHolders":291,"./rest":351}],307:[function(t,e,i){function s(t){return r(n(t).toLowerCase())}var n=t("./toString"),r=t("./upperFirst");e.exports=s},{"./toString":357,"./upperFirst":361}],308:[function(t,e,i){function s(t){return n(t)}var n=t("./_baseClone");e.exports=s},{"./_baseClone":180}],309:[function(t,e,i){function s(t){return n(t,!0)}var n=t("./_baseClone");e.exports=s},{"./_baseClone":180}],310:[function(t,e,i){arguments[4][13][0].apply(i,arguments)},{dup:13}],311:[function(t,e,i){function s(t,e,i){function s(){y&&clearTimeout(y),m&&clearTimeout(m),x=0,f=m=v=y=_=void 0}function u(e,i){i&&clearTimeout(i),m=y=_=void 0,e&&(x=r(),g=t.apply(v,f),y||m||(f=v=void 0))}function c(){var t=e-(r()-b);0>=t||t>e?u(_,m):y=setTimeout(c,t)}function h(){return(y&&_||m&&S)&&(g=t.apply(v,f)),s(),g}function p(){u(S,y)}function d(){if(f=arguments,b=r(),v=this,_=S&&(y||!C),w===!1)var i=C&&!y;else{m||C||(x=b);var s=w-(b-x),n=0>=s||s>w;n?(m&&(m=clearTimeout(m)),x=b,g=t.apply(v,f)):m||(m=setTimeout(p,s))}return n&&y?y=clearTimeout(y):y||e===w||(y=setTimeout(c,e)),i&&(n=!0,g=t.apply(v,f)),!n||y||m||(f=v=void 0),g}var f,m,g,b,v,y,_,x=0,C=!1,w=!1,S=!0;if("function"!=typeof t)throw new TypeError(a);return e=o(e)||0,n(i)&&(C=!!i.leading,w="maxWait"in i&&l(o(i.maxWait)||0,e),S="trailing"in i?!!i.trailing:S),d.cancel=s,d.flush=h,d}var n=t("./isObject"),r=t("./now"),o=t("./toNumber"),a="Expected a function",l=Math.max;e.exports=s},{"./isObject":338,"./now":348,"./toNumber":355}],312:[function(t,e,i){var s=t("./_baseDelay"),n=t("./rest"),r=t("./toNumber"),o=n(function(t,e,i){return s(t,r(e)||0,i)});e.exports=o},{"./_baseDelay":182,"./rest":351,"./toNumber":355}],313:[function(t,e,i){e.exports=t("./forEach")},{"./forEach":318}],314:[function(t,e,i){function s(t,e){return t===e||t!==t&&e!==e}e.exports=s},{}],315:[function(t,e,i){e.exports=t("./assignIn")},{"./assignIn":305}],316:[function(t,e,i){function s(t,e){var i=a(t)?n:r;return i(t,o(e,3))}var n=t("./_arrayFilter"),r=t("./_baseFilter"),o=t("./_baseIteratee"),a=t("./isArray");e.exports=s},{"./_arrayFilter":166,"./_baseFilter":185,"./_baseIteratee":199,"./isArray":327}],317:[function(t,e,i){function s(t,e){if(e=a(e,3),l(t)){var i=o(t,e);return i>-1?t[i]:void 0}return r(t,e,n)}var n=t("./_baseEach"),r=t("./_baseFind"),o=t("./_baseFindIndex"),a=t("./_baseIteratee"),l=t("./isArray");e.exports=s},{"./_baseEach":184,"./_baseFind":186,"./_baseFindIndex":187,"./_baseIteratee":199,"./isArray":327}],318:[function(t,e,i){function s(t,e){return"function"==typeof e&&o(t)?n(t,e):r(t,a(e))}var n=t("./_arrayEach"),r=t("./_baseEach"),o=t("./isArray"),a=t("./_toFunction");e.exports=s},{"./_arrayEach":165,"./_baseEach":184,"./_toFunction":303,"./isArray":327}],319:[function(t,e,i){function s(t,e,i){var s=null==t?void 0:n(t,e);return void 0===s?i:s}var n=t("./_baseGet");e.exports=s},{"./_baseGet":191}],320:[function(t,e,i){function s(t,e){return r(t,e,n)}var n=t("./_baseHas"),r=t("./_hasPath");
e.exports=s},{"./_baseHas":192,"./_hasPath":260}],321:[function(t,e,i){function s(t,e){return r(t,e,n)}var n=t("./_baseHasIn"),r=t("./_hasPath");e.exports=s},{"./_baseHasIn":193,"./_hasPath":260}],322:[function(t,e,i){function s(t){return t?t[0]:void 0}e.exports=s},{}],323:[function(t,e,i){function s(t){return t}e.exports=s},{}],324:[function(t,e,i){function s(t,e,i,s){t=r(t)?t:l(t),i=i&&!s?a(i):0;var c=t.length;return 0>i&&(i=u(c+i,0)),o(t)?c>=i&&t.indexOf(e,i)>-1:!!c&&n(t,e,i)>-1}var n=t("./_baseIndexOf"),r=t("./isArrayLike"),o=t("./isString"),a=t("./toInteger"),l=t("./values"),u=Math.max;e.exports=s},{"./_baseIndexOf":194,"./isArrayLike":328,"./isString":340,"./toInteger":354,"./values":362}],325:[function(t,e,i){var s=t("./_arrayMap"),n=t("./_baseIntersection"),r=t("./rest"),o=t("./_toArrayLikeObject"),a=r(function(t){var e=s(t,o);return e.length&&e[0]===t[0]?n(e):[]});e.exports=a},{"./_arrayMap":169,"./_baseIntersection":195,"./_toArrayLikeObject":302,"./rest":351}],326:[function(t,e,i){function s(t){return n(t)&&a.call(t,"callee")&&(!u.call(t,"callee")||l.call(t)==r)}var n=t("./isArrayLikeObject"),r="[object Arguments]",o=Object.prototype,a=o.hasOwnProperty,l=o.toString,u=o.propertyIsEnumerable;e.exports=s},{"./isArrayLikeObject":329}],327:[function(t,e,i){var s=Array.isArray;e.exports=s},{}],328:[function(t,e,i){function s(t){return null!=t&&!("function"==typeof t&&r(t))&&o(n(t))}var n=t("./_getLength"),r=t("./isFunction"),o=t("./isLength");e.exports=s},{"./_getLength":255,"./isFunction":333,"./isLength":334}],329:[function(t,e,i){function s(t){return r(t)&&n(t)}var n=t("./isArrayLike"),r=t("./isObjectLike");e.exports=s},{"./isArrayLike":328,"./isObjectLike":339}],330:[function(t,e,i){function s(t){return t===!0||t===!1||n(t)&&a.call(t)==r}var n=t("./isObjectLike"),r="[object Boolean]",o=Object.prototype,a=o.toString;e.exports=s},{"./isObjectLike":339}],331:[function(t,e,i){function s(t){if(o(t)&&(r(t)||l(t)||a(t.splice)||n(t)))return!t.length;for(var e in t)if(c.call(t,e))return!1;return!0}var n=t("./isArguments"),r=t("./isArray"),o=t("./isArrayLike"),a=t("./isFunction"),l=t("./isString"),u=Object.prototype,c=u.hasOwnProperty;e.exports=s},{"./isArguments":326,"./isArray":327,"./isArrayLike":328,"./isFunction":333,"./isString":340}],332:[function(t,e,i){function s(t,e){return n(t,e)}var n=t("./_baseIsEqual");e.exports=s},{"./_baseIsEqual":196}],333:[function(t,e,i){function s(t){var e=n(t)?l.call(t):"";return e==r||e==o}var n=t("./isObject"),r="[object Function]",o="[object GeneratorFunction]",a=Object.prototype,l=a.toString;e.exports=s},{"./isObject":338}],334:[function(t,e,i){function s(t){return"number"==typeof t&&t>-1&&t%1==0&&n>=t}var n=9007199254740991;e.exports=s},{}],335:[function(t,e,i){function s(t,e){return t===e||n(t,e,r(e))}var n=t("./_baseIsMatch"),r=t("./_getMatchData");e.exports=s},{"./_baseIsMatch":198,"./_getMatchData":256}],336:[function(t,e,i){function s(t){return null==t?!1:n(t)?p.test(c.call(t)):o(t)&&(r(t)?p:l).test(t)}var n=t("./isFunction"),r=t("./_isHostObject"),o=t("./isObjectLike"),a=/[\\^$.*+?()[\]{}|]/g,l=/^\[object .+?Constructor\]$/,u=Object.prototype,c=Function.prototype.toString,h=u.hasOwnProperty,p=RegExp("^"+c.call(h).replace(a,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");e.exports=s},{"./_isHostObject":270,"./isFunction":333,"./isObjectLike":339}],337:[function(t,e,i){function s(t){return"number"==typeof t||n(t)&&a.call(t)==r}var n=t("./isObjectLike"),r="[object Number]",o=Object.prototype,a=o.toString;e.exports=s},{"./isObjectLike":339}],338:[function(t,e,i){function s(t){var e=typeof t;return!!t&&("object"==e||"function"==e)}e.exports=s},{}],339:[function(t,e,i){function s(t){return!!t&&"object"==typeof t}e.exports=s},{}],340:[function(t,e,i){function s(t){return"string"==typeof t||!n(t)&&r(t)&&l.call(t)==o}var n=t("./isArray"),r=t("./isObjectLike"),o="[object String]",a=Object.prototype,l=a.toString;e.exports=s},{"./isArray":327,"./isObjectLike":339}],341:[function(t,e,i){function s(t){return"symbol"==typeof t||n(t)&&a.call(t)==r}var n=t("./isObjectLike"),r="[object Symbol]",o=Object.prototype,a=o.toString;e.exports=s},{"./isObjectLike":339}],342:[function(t,e,i){function s(t){return r(t)&&n(t.length)&&!!A[k.call(t)]}var n=t("./isLength"),r=t("./isObjectLike"),o="[object Arguments]",a="[object Array]",l="[object Boolean]",u="[object Date]",c="[object Error]",h="[object Function]",p="[object Map]",d="[object Number]",f="[object Object]",m="[object RegExp]",g="[object Set]",b="[object String]",v="[object WeakMap]",y="[object ArrayBuffer]",_="[object Float32Array]",x="[object Float64Array]",C="[object Int8Array]",w="[object Int16Array]",S="[object Int32Array]",T="[object Uint8Array]",E="[object Uint8ClampedArray]",I="[object Uint16Array]",O="[object Uint32Array]",A={};A[_]=A[x]=A[C]=A[w]=A[S]=A[T]=A[E]=A[I]=A[O]=!0,A[o]=A[a]=A[y]=A[l]=A[u]=A[c]=A[h]=A[p]=A[d]=A[f]=A[m]=A[g]=A[b]=A[v]=!1;var N=Object.prototype,k=N.toString;e.exports=s},{"./isLength":334,"./isObjectLike":339}],343:[function(t,e,i){function s(t){var e=u(t);if(!e&&!a(t))return r(t);var i=o(t),s=!!i,c=i||[],h=c.length;for(var p in t)!n(t,p)||s&&("length"==p||l(p,h))||e&&"constructor"==p||c.push(p);return c}var n=t("./_baseHas"),r=t("./_baseKeys"),o=t("./_indexKeys"),a=t("./isArrayLike"),l=t("./_isIndex"),u=t("./_isPrototype");e.exports=s},{"./_baseHas":192,"./_baseKeys":200,"./_indexKeys":265,"./_isIndex":271,"./_isPrototype":276,"./isArrayLike":328}],344:[function(t,e,i){function s(t){for(var e=-1,i=a(t),s=n(t),l=s.length,c=r(t),h=!!c,p=c||[],d=p.length;++e<l;){var f=s[e];h&&("length"==f||o(f,d))||"constructor"==f&&(i||!u.call(t,f))||p.push(f)}return p}var n=t("./_baseKeysIn"),r=t("./_indexKeys"),o=t("./_isIndex"),a=t("./_isPrototype"),l=Object.prototype,u=l.hasOwnProperty;e.exports=s},{"./_baseKeysIn":201,"./_indexKeys":265,"./_isIndex":271,"./_isPrototype":276}],345:[function(t,e,i){arguments[4][14][0].apply(i,arguments)},{dup:14}],346:[function(t,e,i){function s(t,e){var i=a(t)?n:o;return i(t,r(e,3))}var n=t("./_arrayMap"),r=t("./_baseIteratee"),o=t("./_baseMap"),a=t("./isArray");e.exports=s},{"./_arrayMap":169,"./_baseIteratee":199,"./_baseMap":203,"./isArray":327}],347:[function(t,e,i){function s(){}e.exports=s},{}],348:[function(t,e,i){var s=Date.now;e.exports=s},{}],349:[function(t,e,i){var s=t("./_arrayMap"),n=t("./_baseDifference"),r=t("./_baseFlatten"),o=t("./_basePick"),a=t("./keysIn"),l=t("./rest"),u=l(function(t,e){return null==t?{}:(e=s(r(e),String),o(t,n(a(t),e)))});e.exports=u},{"./_arrayMap":169,"./_baseDifference":183,"./_baseFlatten":188,"./_basePick":207,"./keysIn":344,"./rest":351}],350:[function(t,e,i){function s(t){return o(t)?n(t):r(t)}var n=t("./_baseProperty"),r=t("./_basePropertyDeep"),o=t("./_isKey");e.exports=s},{"./_baseProperty":208,"./_basePropertyDeep":209,"./_isKey":273}],351:[function(t,e,i){function s(t,e){if("function"!=typeof t)throw new TypeError(o);return e=a(void 0===e?t.length-1:r(e),0),function(){for(var i=arguments,s=-1,r=a(i.length-e,0),o=Array(r);++s<r;)o[s]=i[e+s];switch(e){case 0:return t.call(this,o);case 1:return t.call(this,i[0],o);case 2:return t.call(this,i[0],i[1],o)}var l=Array(e+1);for(s=-1;++s<e;)l[s]=i[s];return l[e]=o,n(t,this,l)}}var n=t("./_apply"),r=t("./toInteger"),o="Expected a function",a=Math.max;e.exports=s},{"./_apply":164,"./toInteger":354}],352:[function(t,e,i){function s(t,e,i,s){return s="function"==typeof s?s:void 0,null==t?t:n(t,e,i,s)}var n=t("./_baseSet");e.exports=s},{"./_baseSet":210}],353:[function(t,e,i){var s=t("./_baseFlatten"),n=t("./_baseOrderBy"),r=t("./_isIterateeCall"),o=t("./rest"),a=o(function(t,e){if(null==t)return[];var i=e.length;return i>1&&r(t,e[0],e[1])?e=[]:i>2&&r(e[0],e[1],e[2])&&(e.length=1),n(t,s(e),[])});e.exports=a},{"./_baseFlatten":188,"./_baseOrderBy":206,"./_isIterateeCall":272,"./rest":351}],354:[function(t,e,i){function s(t){if(!t)return 0===t?t:0;if(t=n(t),t===r||t===-r){var e=0>t?-1:1;return e*o}var i=t%1;return t===t?i?t-i:t:0}var n=t("./toNumber"),r=1/0,o=1.7976931348623157e308;e.exports=s},{"./toNumber":355}],355:[function(t,e,i){function s(t){if(r(t)){var e=n(t.valueOf)?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var i=u.test(t);return i||c.test(t)?h(t.slice(2),i?2:8):l.test(t)?o:+t}var n=t("./isFunction"),r=t("./isObject"),o=NaN,a=/^\s+|\s+$/g,l=/^[-+]0x[0-9a-f]+$/i,u=/^0b[01]+$/i,c=/^0o[0-7]+$/i,h=parseInt;e.exports=s},{"./isFunction":333,"./isObject":338}],356:[function(t,e,i){function s(t){return n(t,r(t))}var n=t("./_baseToPairs"),r=t("./keys");e.exports=s},{"./_baseToPairs":215,"./keys":343}],357:[function(t,e,i){function s(t){if("string"==typeof t)return t;if(null==t)return"";if(r(t))return n?l.call(t):"";var e=t+"";return"0"==e&&1/t==-o?"-0":e}var n=t("./_Symbol"),r=t("./isSymbol"),o=1/0,a=n?n.prototype:void 0,l=n?a.toString:void 0;e.exports=s},{"./_Symbol":159,"./isSymbol":341}],358:[function(t,e,i){var s=t("./_baseFlatten"),n=t("./_baseUniq"),r=t("./rest"),o=r(function(t){return n(s(t,!1,!0))});e.exports=o},{"./_baseFlatten":188,"./_baseUniq":218,"./rest":351}],359:[function(t,e,i){function s(t){return t&&t.length?n(t):[]}var n=t("./_baseUniq");e.exports=s},{"./_baseUniq":218}],360:[function(t,e,i){function s(t,e){return null==t?!0:n(t,e)}var n=t("./_baseUnset");e.exports=s},{"./_baseUnset":219}],361:[function(t,e,i){var s=t("./_createCaseFirst"),n=s("toUpperCase");e.exports=n},{"./_createCaseFirst":242}],362:[function(t,e,i){function s(t){return t?n(t,r(t)):[]}var n=t("./_baseValues"),r=t("./keys");e.exports=s},{"./_baseValues":220,"./keys":343}],363:[function(t,e,i){var s=t("./_baseDifference"),n=t("./isArrayLikeObject"),r=t("./rest"),o=r(function(t,e){return n(t)?s(t,e):[]});e.exports=o},{"./_baseDifference":183,"./isArrayLikeObject":329,"./rest":351}],364:[function(t,e,i){function s(t){if(l(t)&&!a(t)&&!(t instanceof n)){if(t instanceof r)return t;if(h.call(t,"__wrapped__"))return u(t)}return new r(t)}var n=t("./_LazyWrapper"),r=t("./_LodashWrapper"),o=t("./_baseLodash"),a=t("./isArray"),l=t("./isObjectLike"),u=t("./_wrapperClone"),c=Object.prototype,h=c.hasOwnProperty;s.prototype=o.prototype,e.exports=s},{"./_LazyWrapper":151,"./_LodashWrapper":152,"./_baseLodash":202,"./_wrapperClone":304,"./isArray":327,"./isObjectLike":339}],365:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/TextBlock");n.extend(s),s["static"].name="blockquote",e.exports=s},{"../../model/TextBlock":113}],366:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$,o=t("../../ui/TextPropertyComponent");s.Prototype=function(){this.getClassNames=function(){return"sc-blockquote"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},n.extend(s),e.exports=s},{"../../ui/Component":437,"../../ui/TextPropertyComponent":466}],367:[function(t,e,i){"use strict";e.exports={type:"blockquote",tagName:"blockquote","import":function(t,e,i){e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.append(i.annotatedText([t.id,"content"]))}}},{}],368:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation");n.extend(s),s["static"].name="code",e.exports=s},{"../../model/PropertyAnnotation":109}],369:[function(t,e,i){"use strict";var s=t("../../ui/AnnotationCommand"),n=s.extend();n["static"].name="code",n["static"].annotationType="code",e.exports=n},{"../../ui/AnnotationCommand":430}],370:[function(t,e,i){"use strict";e.exports={type:"code",tagName:"code"}},{}],371:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/SurfaceTool");n.extend(s),s["static"].name="code",s["static"].command="code",e.exports=s},{"../../ui/SurfaceTool":462}],372:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/TextBlock");n.extend(s),s["static"].name="codeblock",e.exports=s},{"../../model/TextBlock":113}],373:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$,o=t("../../ui/TextPropertyComponent");s.Prototype=function(){this.getClassNames=function(){return"sc-codeblock"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},n.extend(s),e.exports=s},{"../../ui/Component":437,"../../ui/TextPropertyComponent":466}],374:[function(t,e,i){"use strict";e.exports={type:"codeblock",tagName:"pre","import":function(t,e,i){var s=t.find("code");s&&(e.content=i.annotatedText(s,[e.id,"content"],{preserveWhitespace:!0}))},"export":function(t,e,i){var s=i.$$;e.append(s("code").append(i.annotatedText([t.id,"content"])))}}},{}],375:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/BlockNode");n.extend(s),s["static"].name="embed",s["static"].defineSchema({src:"string",html:{type:"string","volatile":!0}}),e.exports=s},{"../../model/BlockNode":84}],376:[function(t,e,i){"use strict";var s=t("../../util/uuid"),n=t("../../ui/SurfaceCommand"),r=n.extend({"static":{name:"embed"},getCommandState:function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},execute:function(t){var e=this.getCommandState(),i=this.getSurface();return e.disabled?void 0:(i.transaction(function(e,n){var r=e.create({id:s("embed"),type:"embed",src:t.src,html:t.html}),o={id:s("image-figure"),type:"image-figure",content:r.id,title:"Enter title",caption:"Enter caption"};return i.insertNode(e,{selection:n.selection,node:o})}),{status:"embed-created"})}});e.exports=r},{"../../ui/SurfaceCommand":461,"../../util/uuid":490}],377:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$;s.Prototype=function(){this.getClassNames=function(){return"content-node sc-embed"},this.render=function(){var t,e=this.props.node;return t=e.src&&e.html?r("div").html(e.html):r("div").append(r("input").attr({type:"text",value:"http://"}).ref("src")),r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(t)}},n.extend(s),e.exports=s},{"../../ui/Component":437}],378:[function(t,e,i){"use strict";var s=t("lodash/extend"),n=t("lodash/capitalize"),r=t("../../ui/SurfaceTool"),o=t("../../ui/Component"),a=o.$$,l=o.extend({onSave:function(t){t.preventDefault(),this.props.tool.createEmbed(this.refs.url.$el.val())},render:function(){var t=a("div").addClass("se-prompt");return t.append([a("div").addClass("se-prompt-title").append(this.i18n.t("embed-src")),a("input").attr({type:"text",placeholder:"https://vimeo.com/...",value:""}).ref("url").on("change",this.onSave)]),t}}),u=r.extend({"static":{name:"embed",command:"embed"},onClick:function(){var t=s({},this.state,{showPrompt:!this.state.showPrompt});this.setState(t)},createEmbed:function(t){var e=this.getSurface(),i=this.constructor["static"].command,s=this.context.embedResolver;s(t,function(s,n){e.executeCommand(i,{src:t,html:n})})},render:function(){var t=this.props.title||n(this.getName());this.state.mode&&(t=[n(this.state.mode),t].join(" "));var e=a("div").addClass("sc-embed-tool se-tool");this.state.disabled&&e.addClass("sm-disabled");var i=a("button").addClass("button").attr("title",t).on("click",this.onClick);if(i.append(this.props.children),e.append(i),this.state.showPrompt){var s=a(l,{tool:this});e.append(s)}return e}});e.exports=u},{"../../ui/Component":437,"../../ui/SurfaceTool":462,"lodash/capitalize":307,"lodash/extend":315}],379:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");n.extend(s),s["static"].name="emphasis",s["static"].fragmentation=r.ANY,e.exports=s},{"../../model/Fragmenter":102,"../../model/PropertyAnnotation":109}],380:[function(t,e,i){"use strict";var s=t("../../ui/AnnotationCommand"),n=s.extend({"static":{name:"emphasis",annotationType:"emphasis"}});e.exports=n},{"../../ui/AnnotationCommand":430}],381:[function(t,e,i){"use strict";e.exports={type:"emphasis",tagName:"em",matchElement:function(t){return t.is("em, i")}}},{}],382:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/AnnotationTool");n.extend(s),s["static"].name="emphasis",s["static"].command="emphasis",e.exports=s},{"../../ui/AnnotationTool":432}],383:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.guid=this.id}var n=t("../../model/DocumentNode");n.extend(s,function(){this.setLabel=function(t){this.label=t,this.emit("label:changed",t)},this.setText=function(t){this.text=t},this.getContentNode=function(){return this.document.get(this.content)}}),s["static"].name="figure",s["static"].defineSchema({title:"text",content:"id",caption:"text",guid:{type:"id",optional:!0}}),e.exports=s},{"../../model/DocumentNode":97}],384:[function(t,e,i){"use strict";function s(){n.apply(this,arguments),this.props.node.connect(this,{"label:changed":this.onLabelChanged})}var n=t("../../ui/Component"),r=t("../../ui/TextPropertyComponent"),o=n.$$;s.Prototype=function(){this.dispose=function(){this.props.node.disconnect(this)},this.onLabelChanged=function(){this.rerender()},this.render=function(){var t=this.context.componentRegistry,e=this.props.node.getContentNode(),i=t.get(e.type),s=o("div").addClass("sc-figure").attr("data-id",this.props.node.id);return s.append(o("div").addClass("se-label").attr("contenteditable",!1).append(this.props.node.label)),s.append(o(r,{tagName:"div",path:[this.props.node.id,"title"]}).addClass("se-title")),s.append(o("div").addClass("se-figure-content").attr("contenteditable",!1).append(o(i,{doc:this.props.doc,node:e}))),s.append(o("div").addClass("se-description").append(o(r,{tagName:"div",path:[this.props.node.id,"caption"]}).addClass("se-caption"))),s}},n.extend(s),e.exports=s},{"../../ui/Component":437,"../../ui/TextPropertyComponent":466}],385:[function(t,e,i){"use strict";var s=t("lodash/each");e.exports={type:"figure",tagName:"figure","import":function(t,e,i){s(t.children,function(t){var s=t.tagName;switch(s){case"title":case"caption":e[s]=i.annotatedText(t,[e.id,s])}})},"export":function(t,e,i){var s=i.$$;return e.append(s("title").append(i.annotatedText([t.id,"title"]))),e.append(i.convertNode(t.getContentNode())),e.append(s("caption").append(i.annotatedText([t.id,"caption"]))),e}}},{"lodash/each":313}],386:[function(t,e,i){"use strict";var s=t("../../util/uuid"),n=t("../../ui/SurfaceCommand"),r=t("../../util/jquery"),o=n.extend({"static":{name:"insertFigure"},getCommandState:function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},execute:function(){var t=this.getCommandState(),e=this.getSurface(),i=e.getController();if(!t.disabled){var n=e.$el,o=r('<input type="file" id="file_input" style="opacity: 0;">');return n.append(o),o.click(),o.on("change",function(){var t=o[0].files[0];o.remove(),i.uploadFile(t,function(t,i){var n={selection:e.getSelection()};e.transaction(n,function(t,n){var r=t.create({id:s("image"),type:"image",src:i,previewSrc:i}),o={id:s("image-figure"),type:"image-figure",content:r.id,title:"Enter title",caption:"Enter caption"};return e.insertNode(t,{selection:n.selection,node:o})})})}.bind(this)),{status:"file-upload-process-started"}}}});e.exports=o},{"../../ui/SurfaceCommand":461,"../../util/jquery":484,"../../util/uuid":490}],387:[function(t,e,i){var s=t("../../ui/SurfaceTool"),n=s.extend({"static":{name:"insertFigure",command:"insertFigure"}});e.exports=n},{"../../ui/SurfaceTool":462}],388:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/TextBlock");n.extend(s),s["static"].name="heading",s["static"].defineSchema({level:{type:"number","default":1}}),e.exports=s},{"../../model/TextBlock":113}],389:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$,o=t("../../ui/TextPropertyComponent");s.Prototype=function(){this.render=function(){return r("div").addClass("sc-heading sm-level-"+this.props.node.level).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},n.extend(s),e.exports=s},{"../../ui/Component":437,"../../ui/TextPropertyComponent":466}],390:[function(t,e,i){"use strict";e.exports={type:"heading",matchElement:function(t){return/^h\d$/.exec(t.tagName)},"import":function(t,e,i){e.level=parseInt(""+t.tagName[1],10),e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){return e=e.withTagName("h"+t.level),e.append(i.annotatedText([t.id,"content"])),e}}},{}],391:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/DocumentNode");n.extend(s),s["static"].name="image",s["static"].defineSchema({src:{type:"string","default":"http://"},previewSrc:{type:"string",optional:!0}}),e.exports=s},{"../../model/DocumentNode":97}],392:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$;s.Prototype=function(){this.initialize=function(){var t=this.props.doc;t.on("document:changed",this.handleDocumentChange,this)},this.dispose=function(){var t=this.props.doc;t.off(this)},this.render=function(){return r("img").addClass("sc-image").attr({"data-id":this.props.node.id,contentEditable:!1,src:this.props.node.src})},this.handleDocumentChange=function(t){t.isAffected([this.props.node.id,"src"])&&this.rerender()}},n.extend(s),e.exports=s},{"../../ui/Component":437}],393:[function(t,e,i){"use strict";e.exports={type:"image",tagName:"image","import":function(t,e){e.src=t.attr("src"),e.previewSrc=t.attr("preview-src")},"export":function(t,e){e.attr("src",t.src).attr("preview-src",t.previewSrc)}}},{}],394:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");n.extend(s),s["static"].name="link",s["static"].defineSchema({title:{type:"string",optional:!0},url:{type:"string","default":"http://"}}),s["static"].fragmentation=r.SHOULD_NOT_SPLIT,e.exports=s},{"../../model/Fragmenter":102,"../../model/PropertyAnnotation":109}],395:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/AnnotationCommand");s.Prototype=function(){this.getAnnotationData=function(){return{url:"",title:""}},this.canEdit=function(t,e){return 1===t.length}},n.extend(s),s["static"].name="link",s["static"].annotationType="link",e.exports=s},{"../../ui/AnnotationCommand":430}],396:[function(t,e,i){"use strict";e.exports={type:"link",tagName:"a","import":function(t,e){e.url=t.attr("href"),e.title=t.attr("title")},"export":function(t,e){e.attr({href:t.url,title:t.title})}}},{}],397:[function(t,e,i){"use strict";function s(){u.apply(this,arguments)}function n(){a.apply(this,arguments)}var r=t("lodash/extend"),o=t("lodash/includes"),a=t("../../ui/Component"),l=a.$$,u=t("../../ui/SurfaceTool");s.Prototype=function(){var t=Object.getPrototypeOf(this);this.didMount=function(){var t=this.getController();t.on("command:executed",this.onCommandExecuted,this)},this.dispose=function(){var t=this.getController();t.off(this)},this.render=function(){var e=t.render.apply(this,arguments);if(e.addClass("sc-link-tool"),"edit"===this.state.mode&&e.addClass("sm-active"),"edit"===this.state.mode&&this.state.showPrompt){var i=this.getLink(),s=l(n,{link:i,tool:this});e.append(s)}return e},this.onCommandExecuted=function(t,e){e===this.constructor["static"].command&&o(["edit","create"],t.mode)&&this.togglePrompt()},this.togglePrompt=function(){var t=r({},this.state,{showPrompt:!this.state.showPrompt});this.setState(t)},this.updateLink=function(t){var e=this.getLink();this.getSurface().transaction(function(i){i.set([e.id,"url"],t.url),i.set([e.id,"title"],t.title)})},this.deleteLink=function(){var t=this.getLink();this.getSurface().transaction(function(e){e["delete"](t.id)}),this.togglePrompt()},this.getLink=function(){return this.getDocument().get(this.state.annotationId)}},u.extend(s),s["static"].name="link",s["static"].command="link",n.Prototype=function(){this.didMount=function(){var t=this.refs.url;setTimeout(function(){t.focus()})},this.render=function(){var t=this.props.link,e=l("div").addClass("se-prompt");return e.append([l("div").addClass("se-prompt-title").append(this.i18n.t("hyperlink")),l("input").attr({type:"text",placeholder:"http://your-website.com",value:t.url}).ref("url").htmlProp("autofocus",!0).on("change",this.onSave),l("a").attr({href:"#"}).addClass("se-delete-link").append(this.i18n.t("delete")).on("click",this.onDelete)]),e},this.onSave=function(t){t.preventDefault(),this.props.tool.updateLink({url:this.refs.url.$el.val()})},this.onDelete=function(t){t.preventDefault(),this.props.tool.deleteLink()}},a.extend(n),e.exports=s},{"../../ui/Component":437,"../../ui/SurfaceTool":462,"lodash/extend":315,"lodash/includes":324}],398:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/BlockNode"),r=t("../../model/ParentNodeMixin");n.extend(s,r,function(){this.getChildrenProperty=function(){return"items"},this.removeItem=function(t){var e=this.getDocument(),i=this.items.indexOf(t);if(!(i>=0))throw new Error("List item is not a child of this list: "+t);e.update([this.id,"items"],{"delete":{offset:i}})},this.insertItemAt=function(t,e){var i=this.getDocument();i.update([this.id,"items"],{insert:{offset:t,value:e}})}}),s["static"].name="list",s["static"].defineSchema({ordered:{type:"boolean","default":!1},items:{type:["id"],defaut:[]}}),e.exports=s},{"../../model/BlockNode":84,"../../model/ParentNodeMixin":107}],399:[function(t,e,i){"use strict";var s=t("lodash/each"),n=t("lodash/isArray"),r=t("lodash/last"),o=t("../../ui/DefaultDOMElement"),a={type:"list",matchElement:function(t){return t.is("ul, ol")},"import":function(t,e,i){e.items=[];var s={level:0,types:[],list:e};this._importList(s,t,i)},"export":function(t,e,i){var s=i.$$;return this.render(t,{createListElement:function(t){var e=t.ordered?"ol":"ul";return s(e).attr("data-id",t.id)},renderListItem:function(t){return s("li").attr("data-id",t.id).append(i.annotatedText([t.id,"content"]))}})},render:function(t,e){for(var i,s=t.getChildren(),n=e.createListElement(t),r=n,o=[r],a=1,l=0;l<s.length;l++){var u=s[l];if(u.level===a);else if(u.level>a)for(i=a;i<u.level;i++){var c=e.createListElement(u);r.append(c),r=c,o.push(r),a++}else{for(i=a;i>u.level;i--)o.pop(),a--;r=o[o.length-1]}r.append(e.renderListItem(u))}return n},_importList:function(t,e,i){t.level++,t.types.push(e.tagName),s(e.children,function(e){var s=e.tagName;"li"===s?this._importListItem(t,e,i):("ol"==s||"ul"===s)&&this._importList(t,e,i)}),t.level--,t.types.pop()},_normalizeListItem:function(t,e){var i=[[]],r=i[0];return s(e.childNodes,function(t){var e=t.tagName;if("ol"===e||"ul"===e)r=t,i.push(r);else{if(/^\s*$/.exec(t.textContent))return;n(r)||(r=[],i.push(r)),r.push(t)}}),i},_importListItem:function(t,e,i){for(var s="ol"===r(t.types),a=this._normalizeListItem(t,e,i),l=0;l<a.length;l++){var u=a[l];if(n(u)){var c=o.create("span").append(u);i.trimTextContent(c);var h=i.convertElement(c);h.ordered=s,h.level=t.level,t.list.items.push(h.id)}else this._importList(t,u,i)}}};e.exports=a},{"../../ui/DefaultDOMElement":445,"lodash/each":313,"lodash/isArray":327,"lodash/last":345}],400:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/DocumentNode");n.extend(s),s["static"].name="list-item",s["static"].defineSchema({parent:"id",level:{type:"number","default":1},ordered:{type:"bool","default":!1},content:"text"}),e.exports=s},{"../../model/DocumentNode":97}],401:[function(t,e,i){"use strict";e.exports={type:"list-item",tagName:"li","import":function(t,e,i){e.level=t.attr("data-level")||1,e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.attr("data-level",t.level).append(i.annotatedText([t.id,"content"]))}}},{}],402:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/TextBlock");n.extend(s),s["static"].name="paragraph",e.exports=s},{"../../model/TextBlock":113}],403:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("../../ui/Component"),r=n.$$,o=t("../../ui/TextPropertyComponent");s.Prototype=function(){this.getClassNames=function(){return"sc-paragraph"},this.render=function(){return r("div").addClass(this.getClassNames()).attr("data-id",this.props.node.id).append(r(o,{path:[this.props.node.id,"content"]}))}},n.extend(s),e.exports=s},{"../../ui/Component":437,"../../ui/TextPropertyComponent":466}],404:[function(t,e,i){"use strict";e.exports={type:"paragraph",tagName:"p","import":function(t,e,i){e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){e.append(i.annotatedText([t.id,"content"]))}}},{}],405:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");n.extend(s),s["static"].name="strong",s["static"].fragmentation=r.ANY,e.exports=s},{"../../model/Fragmenter":102,"../../model/PropertyAnnotation":109}],406:[function(t,e,i){"use strict";var s=t("../../ui/AnnotationCommand"),n=s.extend();n["static"].name="strong",n["static"].annotationType="strong",e.exports=n},{"../../ui/AnnotationCommand":430}],407:[function(t,e,i){"use strict";e.exports={type:"strong",tagName:"strong",matchElement:function(t){return t.is("strong, b")}}},{}],408:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/SurfaceTool");n.extend(s),s["static"].name="strong",s["static"].command="strong",e.exports=s},{"../../ui/SurfaceTool":462}],409:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");n.extend(s),s["static"].name="subscript",s["static"].fragmentation=r.ANY,e.exports=s},{"../../model/Fragmenter":102,"../../model/PropertyAnnotation":109}],410:[function(t,e,i){"use strict";var s=t("../../ui/AnnotationCommand"),n=s.extend();n["static"].name="subscript",n["static"].annotationType="subscript",e.exports=n},{"../../ui/AnnotationCommand":430}],411:[function(t,e,i){"use strict";e.exports={type:"subscript",tagName:"sub"}},{}],412:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/SurfaceTool");n.extend(s),s["static"].name="subscript",s["static"].command="subscript",e.exports=s},{"../../ui/SurfaceTool":462}],413:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/PropertyAnnotation"),r=t("../../model/Fragmenter");n.extend(s),s["static"].name="superscript",s["static"].fragmentation=r.ANY,e.exports=s},{"../../model/Fragmenter":102,"../../model/PropertyAnnotation":109}],414:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/AnnotationCommand"),s=n.extend();s["static"].name="superscript",s["static"].annotationType="superscript",e.exports=s},{"../../ui/AnnotationCommand":430}],415:[function(t,e,i){"use strict";e.exports={type:"superscript",tagName:"sup"}},{}],416:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../ui/SurfaceTool");n.extend(s),s["static"].name="superscript",s["static"].command="superscript",e.exports=s},{"../../ui/SurfaceTool":462}],417:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.matrix=null}var n=t("../../util/oo"),r=t("lodash/extend"),o=t("../../model/BlockNode"),a=t("../../model/ParentNodeMixin"),l=t("./TableMatrix"),u=t("./TableCellIterator"),c=t("../../util/uuid");s.Prototype=function(){r(this,a),this.getChildrenProperty=function(){return"sections";
},this.getSections=function(){return this.getChildren()},this.getSectionAt=function(t){return this.getChildAt(t)},this.getMatrix=function(){return this.matrix||(this.matrix=new l(this),this.matrix.update()),this.matrix},this.getIterator=function(){return new u(this)},this.getSize=function(t){var e=this.matrix.getSize();return"row"===t?e[0]:"col"===t?e[1]:e},this.toTSV=function(){var t,e=[],i=[],s=this.getIterator();for(s.onNewRow=function(){i=[],e.push(i)};t=s.next();)i.push(t.content);return e.map(function(t){return t.join("	")}).join("\n")}},n.inherit(s,o),s["static"].name="table",s["static"].defineSchema({sections:{type:["id"],"default":[]}}),s.fromTSV=function(t,e,i){i=i||"	";for(var s=e.split(/\n/),n=c("table"),r={type:"table-section",id:n+"-body",sectionType:"tbody",rows:[],parent:n},o=0;o<s.length;o++){for(var a={type:"table-row",id:n+"-row"+o,cells:[],parent:r.id},l=s[o].split(i),u=0;u<l.length;u++){var h=l[u],p={type:"table-cell",id:a.id+"-col"+u,cellType:"td",content:h,parent:a.id},d=t.create(p);a.cells.push(d.id)}var f=t.create(a);r.rows.push(f.id)}var m=t.create(r);return t.create({type:"table",id:n,sections:[m.id]})},e.exports=s},{"../../model/BlockNode":84,"../../model/ParentNodeMixin":107,"../../util/oo":486,"../../util/uuid":490,"./TableCellIterator":420,"./TableMatrix":422,"lodash/extend":315}],418:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/DocumentNode");n.extend(s,function(){this.getSpan=function(t){return"col"===t?this.colspan||1:"row"===t?this.rowspan||1:void 0},this.isData=function(){return"data"===this.cellType}}),s["static"].name="table-cell",s["static"].defineSchema({parent:"id",cellType:{type:"string","default":"td"},colspan:{type:"number",optional:!0},rowspan:{type:"number",optional:!0},content:"text"}),e.exports=s},{"../../model/DocumentNode":97}],419:[function(t,e,i){"use strict";e.exports={type:"table-cell",matchElement:function(t){return t.is("th, td")},"import":function(t,e,i){t.is("th")?e.cellType="head":e.cellType="data";var s=t.attr("colspan");s&&(e.colspan=parseInt(s,10));var n=t.attr("rowspan");n&&(e.rowspan=parseInt(n,10)),e.content=i.annotatedText(t,[e.id,"content"])},"export":function(t,e,i){var s="head"===t.cellType?"th":"td";return e=e.withTagName(s),e.append(i.annotatedText([t.id,"content"])),e}}},{}],420:[function(t,e,i){"use strict";function s(t){this.table=t,this.__it={sectionIndex:-1,rowIndex:-1,rowNode:null,cellIndex:-1,cellNode:null,sectionNode:null,finished:!1},this.onNewSection=function(){},this.onNewRow=function(){}}var n=t("../../util/oo");s.Prototype=function(){this.next=function(){if(this.__it.finished)throw new Error("TableCellIterator has no more cells left.");return this.nextCell(this.__it),this.__it.finished?null:this.__it.cellNode},this.nextSection=function(t){t.sectionIndex++,t.sectionIndex<this.table.getChildCount()?t.sectionNode=this.table.getSectionAt(t.sectionIndex):t.sectionNode=null,t.sectionNode?(t.rowIndex=0,t.rowNode=t.sectionNode.getRowAt(0),this.onNewSection(t.sectionNode)):t.finished=!0},this.nextRow=function(t){for(t.rowIndex++,t.sectionNode&&(t.rowIndex<t.sectionNode.getChildCount()?t.rowNode=t.sectionNode.getRowAt(t.rowIndex):t.rowNode=null);!t.rowNode&&!t.finished;)this.nextSection(t);t.rowNode&&(t.cellIndex=0,t.cellNode=t.rowNode.getCellAt(0),this.onNewRow(t.rowNode))},this.nextCell=function(t){for(t.cellNode&&(t.cellIndex++,t.cellIndex<t.rowNode.getChildCount()?t.cellNode=t.rowNode.getCellAt(t.cellIndex):t.cellNode=null);!t.cellNode&&!t.finished;)this.nextRow(t)}},n.initClass(s),e.exports=s},{"../../util/oo":486}],421:[function(t,e,i){"use strict";var s=t("lodash/each");e.exports={type:"table",tagName:"table","import":function(t,e,i){if(e.sections=[],s(["thead","tbody","tfoot"],function(s){var n=t.find(s);if(n){var r=i.convertElement(n);r.parent=e.id,e.sections.push(r.id)}}),0===e.sections.length){var n={id:i.nextId("tbody"),parent:e.id,type:"table-section",sectionType:"body",rows:[]};s(t.findAll("tr"),function(t){var e=i.convertElement(t);e.parent=n.id,n.rows.push(e.id)}),i.createNode(n),e.sections.push(n.id)}},"export":function(t,e,i){s(t.getSections(),function(t){e.append(i.convertNode(t))})}}},{"lodash/each":313}],422:[function(t,e,i){"use strict";function s(t){this.tableNode=t,this._matrix=null,this._rowNodes=null}var n=t("../../util/oo");s.Prototype=function(){this.invalidate=function(){this._matrix=null,this._rowNodes=null},this.update=function(){var t,e,i,n,r,o,a,l,u=[],c=[],h=this.tableNode.getIterator(),p=-1,d=-1;for(h.onNewRow=function(t){p++,d=-1,u[p]=u[p]||[],c.push(t)};null!==(t=h.next());){for(d++;u[p][d];)d++;if(e=new s.Cell(t,p,d),t.rowIdx=p,t.colIdx=d,u[p][d]=e,i=t.getSpan("row"),n=t.getSpan("col"),1!==i||1!==n)for(r=0;i>r;r++)for(o=0;n>o;o++)(0!==r||0!==o)&&(a=p+r,l=d+o,u[a]=u[a]||[],u[a][l]=new s.Placeholder(e,a,l))}this._matrix=u,this._rowNodes=c},this.getCell=function(t,e){var i=this.getMatrix();return i[t][e]},this.getColumn=function(t){var e,i,s=this.getMatrix();for(e=[],i=0;i<s.length;i++)e.push(s[i][t]);return e},this.getRow=function(t){var e=this.getMatrix();return e[t]},this.getRowNode=function(t){var e=this.getRowNodes();return e[t]},this.getMatrix=function(){return this._matrix||this.update(),this._matrix},this.getRowNodes=function(){return this._rowNodes||this.update(),this._rowNodes},this.getRectangle=function(t,e){var i,n,r,o,a,l;return(i=this.lookupCell(t))?(n=t===e?i:this.lookupCell(e),r=Math.min(i.row,n.row),o=Math.max(i.row,n.row),a=Math.min(i.col,n.col),l=Math.max(i.col,n.col),new s.Rectangle(r,a,o,l)):null},this.getCellsForRectangle=function(t){var e,i,s,n,r;for(s=[],n={},e=t.start.row;e<=t.end.row;e++)for(i=t.start.col;i<=t.end.col;i++)r=this.getCell(e,i),"placeholder"===r.type&&(r=r.owner),n[r.key]||(s.push(r),n[r.key]=!0);return s},this.getBoundingRectangle=function(t){var e,i,n;if(t=s.Rectangle.copy(t),e=this.getCellsForRectangle(t),!e||0===e.length)return null;for(n=0;n<e.length;n++)i=e[n],t.start.row=Math.min(t.start.row,i.row),t.start.col=Math.min(t.start.col,i.col),t.end.row=Math.max(t.end.row,i.row+i.node.getSpan("row")-1),t.end.col=Math.max(t.end.col,i.col+i.node.getSpan("col")-1);return t},this.getSize=function(){var t=this.getMatrix();return 0===t.length?{rows:0,cols:0}:{rows:t.length,cols:t[0].length}},this.lookupCell=function(t){var e,i,s,n,r=this.getMatrix(),o=this.getRowNodes();if(e=o.indexOf(t.parent),0>e)return null;for(s=null,n=r[e],i=0;i<n.length&&(s=n[i],s.node!==t);i++);return s},this.findClosestCell=function(t){var e,i,s=this.getMatrix();for(i=s[t.row],e=t.col;e>=0;e--)if("cell"===i[e].type)return i[e];for(e=t.col+1;e<i.length;e++)if("cell"===i[e].type)return i[e];return null}},n.initClass(s),s.Cell=function(t,e,i){this.type="cell",this.node=t,this.row=e,this.col=i,this.key=e+"_"+i},n.initClass(s.Cell),s.Cell.sortDescending=function(t,e){return t.row!==e.row?e.row-t.row:e.col-t.col},s.Placeholder=function(t,e,i){s.Cell.call(this,t.node,e,i),this.type="placeholder",this.owner=t},s.Cell.extend(s.Placeholder),s.Rectangle=function(t,e,i,s){this.start={row:t,col:e},this.end={row:i,col:s}},s.Rectangle.copy=function(t){return new s.Rectangle(t.start.row,t.start.col,t.end.row,t.end.col)},e.exports=s},{"../../util/oo":486}],423:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/DocumentNode"),r=t("../../model/ParentNodeMixin");n.extend(s,r,function(){this.getChildrenProperty=function(){return"cells"},this.getCells=function(){return this.getChildren()},this.getCellAt=function(t){return this.getChildAt(t)}}),s["static"].name="table-row",s["static"].defineSchema({parent:"id",cells:{type:["id"],"default":[]}}),e.exports=s},{"../../model/DocumentNode":97,"../../model/ParentNodeMixin":107}],424:[function(t,e,i){"use strict";var s=t("lodash/each");e.exports={type:"table-row",tagName:"tr","import":function(t,e,i){e.cells=[],s(t.findAll("th,td"),function(t){var s=i.convertElement(t);s.parent=e.id,e.cells.push(s.id)})},"export":function(t,e,i){s(t.getCells(),function(t){e.append(i.convertNode(t))})}}},{"lodash/each":313}],425:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../../model/DocumentNode"),r=t("../../model/ParentNodeMixin");n.extend(s,r,function(){this.getChildrenProperty=function(){return"rows"},this.getRows=function(){return this.getChildren()},this.getRowAt=function(t){return this.getChildAt(t)}}),s["static"].name="table-section",s["static"].defineSchema({parent:"id",rows:{type:["id"],"default":[]},sectionType:{type:"string","default":"tbody"}}),e.exports=s},{"../../model/DocumentNode":97,"../../model/ParentNodeMixin":107}],426:[function(t,e,i){"use strict";var s=t("lodash/each");e.exports={type:"table-section",matchElement:function(t){return t.is("thead, tbody, tfoot")},"import":function(t,e,i){var n=t.tagName,r=n.substring(1);e.sectionType=r,e.rows=[],s(t.findAll("tr"),function(t){var s=i.convertElement(t);s.parent=e.id,e.rows.push(s.id)})},"export":function(t,e,i){return e=e.withTagName("t"+t.sectionType),s(t.getRows(),function(t){e.append(i.convertNode(t))}),e}}},{"lodash/each":313}],427:[function(t,e,i){"use strict";var s=t("../../ui/SurfaceCommand"),n=t("lodash/isMatch"),r=t("lodash/find"),o=t("lodash/clone"),a=function(t){s.call(this,t)};a.Prototype=function(){this.getSelection=function(){return this.getSurface().getSelection()},this.getTextTypes=function(){var t=this.getSurface();return t.isContainerEditor()?t.getTextTypes():[]},this.getTextType=function(t){var e=this.getTextTypes();return r(e,function(e){return e.name===t})},this.getCurrentTextType=function(t){var e,i=this.getTextTypes();return i.forEach(function(i){var s=o(i.data);delete s.type,n(t,s)&&t.type===i.data.type&&(e=i)}),e},this.getCommandState=function(){var t=this.getSelection(),e=this.getSurface(),i={disabled:!1,sel:t,textTypes:this.getTextTypes()};if(!e.isEnabled()||t.isNull())i.disabled=!0;else if(t.isContainerSelection())i.disabled=!0,i.currentTextType={name:"container-selection"};else{var s=this.getDocument(),n=t.getPath(),r=s.get(n[0]);r&&(r.isText()&&r.isBlock()&&(i.currentTextType=this.getCurrentTextType(r)),i.currentTextType||(i.currentTextType={name:[r.type,n[1]].join(".")},i.disabled=!0))}return i},this.execute=function(t){var e=this.getTextType(t),i=e.data,s=this.getSurface();return s.transaction(function(t,e){return e.data=i,s.switchType(t,e)}),i}},s.extend(a),a["static"].name="switch-text-type",e.exports=a},{"../../ui/SurfaceCommand":461,"lodash/clone":308,"lodash/find":317,"lodash/isMatch":335}],428:[function(t,e,i){"use strict";function s(){a.apply(this,arguments),this._navIdx=-1}var n=t("lodash/each"),r=t("../../ui/Component"),o=r.$$,a=t("../../ui/SurfaceTool"),l=t("../../util/keys");s.Prototype=function(){this.getInitialState=function(){var t=this.context.toolManager.getCommandState(this);return t},this.dispose=function(){this.context.toolManager.unregisterTool(this)},this.render=function(){var t="No selection";this.state.currentTextType&&(t=this.state.currentTextType.name);var e=o("div").addClass("sc-switch-text-type"),i=o("button").ref("toggle").addClass("se-toggle").attr("title",this.i18n.t("switch_text")).append(this.i18n.t(t)).on("click",this.toggleAvailableTextTypes);if(this.state.disabled?(e.addClass("sm-disabled"),i.attr("tabindex",-1)):i.attr("tabindex",1),e.append(i),this.state.open){e.addClass("sm-open");var s=o("div").addClass("se-options").ref("options");n(this.state.textTypes,function(t){var e=o("button").addClass("se-option sm-"+t.name).attr("data-type",t.name).append(this.i18n.t(t.name)).on("click",this.handleClick);s.append(e)}.bind(this)),e.append(s),e.on("keydown",this.onKeydown)}return e},this.didRender=function(){this.state.open&&this.refs.toggle.focus()},this.executeCommand=function(t){this.getSurface().executeCommand("switch-text-type",t)},this.getTextCommands=function(){var t=this.getSurface();return!this.textCommands&&t&&(this.textCommands=t.getTextCommands()),this.textCommands||{}},this.handleClick=function(t){t.preventDefault(),this.executeCommand(t.currentTarget.dataset.type)},this.onKeydown=function(t){var e=!1;switch(t.keyCode){case l.UP:this._nav(-1),e=!0;break;case l.DOWN:this._nav(1),e=!0;break;case l.ESCAPE:this.toggleDropdown(),e=!0}e&&(t.preventDefault(),t.stopPropagation())},this.toggleAvailableTextTypes=function(t){t.preventDefault(),t.stopPropagation(),this.state.disabled||this.toggleDropdown()},this.toggleDropdown=function(){this._navIdx=-1,this.extendState({open:!this.state.open})},this._nav=function(t){if(this._navIdx+=t,this._navIdx=Math.max(0,this._navIdx),this._navIdx=Math.min(this._getOptionsCount()-1,this._navIdx),this._navIdx>=0){var e=this.refs.options.children[this._navIdx];e.focus()}},this._getOptionsCount=function(){return this.refs.options.children.length}},a.extend(s),s["static"].name="switch-text-type",s["static"].command="switch-text-type",e.exports=s},{"../../ui/Component":437,"../../ui/SurfaceTool":462,"../../util/keys":485,"lodash/each":313}],429:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.fragmenter=new o({onText:this._renderTextNode.bind(this),onEnter:this._renderFragment.bind(this),onExit:this._finishFragment.bind(this)})}var n=t("./Component"),r=n.$$,o=t("../model/Fragmenter"),a=t("./AnnotationComponent");s.Prototype=function(){this.render=function(){var t=this._renderContent().addClass("sc-annotated-text").css({whiteSpace:"pre-wrap"});return t},this.getText=function(){return this.props.text},this.getAnnotations=function(){return this.props.annotations||[]},this._renderContent=function(){var t=this.getText(),e=this.getAnnotations(),i=r(this.props.tagName||"span");return this.fragmenter.start(i,t,e),i},this._renderTextNode=function(t,e){e&&e.length>0&&t.append(e)},this._renderFragment=function(t){var e=this.getDocument(),i=this.getComponentRegistry(),s=t.node;if("container-annotation-fragment"===s.type)return r(a,{doc:e,node:s}).addClass("se-annotation-fragment").addClass(s.anno.getTypeNames().join(" ").replace(/_/g,"-"));if("container-annotation-anchor"===s.type)return r(a,{doc:e,node:s}).addClass("se-anchor").addClass(s.anno.getTypeNames().join(" ").replace(/_/g,"-")).addClass(s.isStart?"start-anchor":"end-anchor");var n=i.get(s.type)||a,o=r(n,{doc:e,node:s});return o},this._finishFragment=function(t,e,i){i.append(e)},this.getDocument=function(){return this.props.doc||this.context.doc},this.getComponentRegistry=function(){return this.props.componentRegistry||this.context.componentRegistry}},n.extend(s),e.exports=s},{"../model/Fragmenter":102,"./AnnotationComponent":431,"./Component":437}],430:[function(t,e,i){"use strict";var s=t("./SurfaceCommand"),n=t("../model/documentHelpers"),r=t("../model/transform/createAnnotation"),o=t("../model/transform/fuseAnnotation"),a=t("../model/transform/expandAnnotation"),l=t("../model/transform/truncateAnnotation"),u=t("../model/transform/deleteAnnotation"),c=function(t){s.call(this,t)};c.Prototype=function(){this.getAnnotationType=function(){if(this.constructor["static"].annotationType)return this.constructor["static"].annotationType;throw new Error("Contract: AnnotationCommand.static.annotationType should be associated to a document annotation type.")},this.getAnnotationData=function(){return{}},this.isDisabled=function(t,e){if(e.isNull())return!0;var i=this.getAnnotationType(),s=this.getDocument();return!n.isContainerAnnotation(s,i)&&!e.isPropertySelection()},this.canEdit=function(){return!1},this.canCreate=function(t,e){return 0===t.length&&!e.isCollapsed()},this.canFuse=function(t,e){return t.length>=2&&!e.isCollapsed()},this.canDelete=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();return e.isInsideOf(i)},this.canExpand=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();return e.overlaps(i)&&!e.isInsideOf(i)},this.canTruncate=function(t,e){if(1!==t.length)return!1;var i=t[0].getSelection();return(e.isLeftAlignedWith(i)||e.isRightAlignedWith(i))&&!e.contains(i)&&!e.isCollapsed()},this.getAnnotationsForSelection=function(){var t,e=this.getSelection(),i=this.getDocument(),s=this.getSurface();s.isContainerEditor()&&(t=s.getContainerId());var r=this.getAnnotationType(),o=n.getAnnotationsForSelection(i,e,r,t);return o},this.execute=function(){var t=this.getAnnotationsForSelection(),e=this.getSelection();return this.isDisabled(t,e)?!1:this.canCreate(t,e)?this.executeCreate():this.canFuse(t,e)?this.executeFuse():this.canTruncate(t,e)?this.executeTruncate():this.canExpand(t,e)?this.executeExpand():this.canEdit(t,e)?this.executeEdit(t,e):this.canDelete(t,e)?this.executeDelete():!1},this.getCommandState=function(){var t=this.getSelection(),e=this.getAnnotationsForSelection(),i={disabled:!1,active:!1,mode:null};return this.isDisabled(e,t)?i.disabled=!0:this.canCreate(e,t)?i.mode="create":this.canFuse(e,t)?i.mode="fusion":this.canTruncate(e,t)?(i.active=!0,i.mode="truncate"):this.canExpand(e,t)?i.mode="expand":this.canEdit(e,t)?(i.mode="edit",i.annotationId=e[0].id,i.active=!0):this.canDelete(e,t)?(i.active=!0,i.mode="delete"):i.disabled=!0,i},this.applyTransform=function(t){var e,i=this.getSurface(),s=this.getSelection();return s.isNull()?void 0:(i.transaction(function(s,n){return n.annotationType=this.getAnnotationType(),n.node=this.getAnnotationData(),n.node.type||(n.node.type=this.getAnnotationType()),n.splitContainerSelections=!1,i.isContainerEditor()&&(n.containerId=i.getContainerId()),n=t(s,n),e=n.result,n}.bind(this)),e)},this.executeEdit=function(){var t=this.getAnnotationsForSelection();return{mode:"edit",anno:t[0],readyOnly:!0}},this.executeCreate=function(){var t=this.applyTransform(r);return{mode:"create",anno:t}},this.executeFuse=function(){var t=this.applyTransform(o);return{mode:"fuse",anno:t}},this.executeTruncate=function(){var t=this.applyTransform(l);return{mode:"truncate",anno:t}},this.executeExpand=function(){var t=this.applyTransform(a);return{mode:"expand",anno:t}},this.executeDelete=function(){var t=this.applyTransform(u);return{mode:"delete",annoId:t}}},s.extend(c),e.exports=c},{"../model/documentHelpers":131,"../model/transform/createAnnotation":134,"../model/transform/deleteAnnotation":135,"../model/transform/expandAnnotation":139,"../model/transform/fuseAnnotation":140,"../model/transform/truncateAnnotation":148,"./SurfaceCommand":461}],431:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Component"),r=n.$$;s.Prototype=function(){this.render=function(){var t=r("span").attr("data-id",this.props.node.id).addClass(this.getClassNames());return this.props.node.highlighted&&t.addClass("sm-highlighted"),t.append(this.props.children),t},this.getClassNames=function(){return"sc-"+this.props.node.type},this.didMount=function(){var t=this.props.node;t.on("highlighted",this.onHighlightedChanged,this)},this.dispose=function(){var t=this.props.node;t.off(this)},this.onHighlightedChanged=function(){this.props.node.highlighted?this.$el.addClass("sm-highlighted"):this.$el.removeClass("sm-highlighted")}},n.extend(s),e.exports=s},{"./Component":437}],432:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./SurfaceTool");s.Prototype=function(){},n.extend(s),e.exports=s},{"./SurfaceTool":462}],433:[function(t,e,i){"use strict";var s=t("../util/oo"),n=t("../model/documentHelpers"),r=t("./ClipboardImporter"),o=t("./ClipboardExporter"),a=t("../util/substanceGlobals"),l=t("./DefaultDOMElement"),u=function(t){this.surface=t;var e=t.getDocument(),i=e.getSchema();this.htmlImporter=new r({schema:i,DocumentClass:e.constructor}),this.htmlExporter=new o,this.onCopy=this.onCopy.bind(this),this.onCut=this.onCut.bind(this),this.isIe=-1!=window.navigator.userAgent.toLowerCase().indexOf("msie")||-1!=window.navigator.userAgent.toLowerCase().indexOf("trident"),this.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,this.isIe?(this.onBeforePasteShim=this.onBeforePasteShim.bind(this),this.onPasteShim=this.onPasteShim.bind(this)):this.onPaste=this.onPaste.bind(this)};u.Prototype=function(){this.getSurface=function(){return this.surface},this.attach=function(t){t.addEventListener("copy",null,this.onCopy,this),t.addEventListener("cut",null,this.onCut,this),this.isIe?(t.addEventListener("beforepaste",null,this.onBeforePasteShim,this),t.addEventListener("paste",null,this.onPasteShim,this)):t.addEventListener("paste",null,this.onPaste,this)},this.didMount=function(){var t=new l(this.surface.el);if(!u._sharedPasteElement){var e=t.getRoot(),i=e.find("body");if(i){var s=i.createElement("div").attr("contenteditable",!0).attr("tabindex",-1).css({position:"fixed",opacity:"0.0",bottom:"-1000px",width:"0px"});u._sharedPasteElement=s,i.append(s)}}this.el=u._sharedPasteElement},this.detach=function(t){t.off("copy",this.onCopy),t.off("cut",this.onCut),this.isIe?(t.off("beforepaste",this.onBeforePasteShim),t.off("paste",this.onPasteShim)):t.off("paste",this.onPaste)},this.onCopy=function(t){var e=this._copy();u.clipboardData=e,a.clipboardData=e,t.clipboardData&&e.doc&&(t.preventDefault(),t.clipboardData.setData("text/plain",e.text),t.clipboardData.setData("text/html",e.html))},this.onCut=function(t){t.preventDefault(),this.onCopy(t);var e=this.getSurface();e&&e.transaction(function(t,i){return e["delete"](t,i)})},this.onPaste=function(t){for(var e=t.clipboardData,i={},s=0;s<e.types.length;s++)i[e.types[s]]=!0;t.preventDefault(),t.stopPropagation();var n,r;return i["text/plain"]&&(n=e.getData("text/plain")),i["text/html"]&&(r=e.getData("text/html")),a.clipboardData={text:n,html:r},this.isFF&&!r?void this._pastePlainText(n):void(r&&this._pasteHtml(r,n)||this._pastePlainText(n))},this._pastePlainText=function(t){var e=this.getSurface();e.transaction(function(i,s){return s.text=t,e.paste(i,s)})},this.onBeforePasteShim=function(){var t=this.getSurface();if(t){var e=this._getNativeElement();e.focus();var i=document.createRange();i.selectNodeContents(e);var s=window.getSelection();s.removeAllRanges(),s.addRange(i)}},this.onPasteShim=function(){var t=this._getNativeElement;t.innerHTML="";var e=this.surface.getSelection();window.setTimeout(function(){this.surface.selection=e;var i=t.innerHTML,s=t.textContent;return t.innerHTML="",a.clipboardData={text:s,html:i},this._pasteHtml(i,t.textContent)}.bind(this))},this._copy=function(){var t=this.getSurface(),e=t.getSelection(),i=t.getDocument(),s=null,r="",o="";return e.isCollapsed()||(r=n.getTextForSelection(i,e),s=t.copy(i,e),o=this.htmlExporter.exportDocument(s)),{doc:s,html:o,text:r}},this._pasteHtml=function(t,e){var i=this.getSurface();if(i){var s=null;try{s=this.htmlImporter.importDocument(t)}catch(n){return!1}return s?(i.transaction(function(t,n){return n.text=e,n.doc=s,i.paste(t,n)}),!0):void 0}},this._getNativeElement=function(){return this.el.el}},s.initClass(u),u.clipboardData={doc:null,html:"",text:""},e.exports=u},{"../model/documentHelpers":131,"../util/oo":486,"../util/substanceGlobals":489,"./ClipboardExporter":434,"./ClipboardImporter":435,"./DefaultDOMElement":445}],434:[function(t,e,i){"use strict";function s(){s["super"].call(this,{converters:o})}var n=t("../model/HTMLExporter"),r=t("./ClipboardImporter"),o=r.converters,a=r.CLIPBOARD_CONTAINER_ID,l=r.CLIPBOARD_PROPERTY_ID,u=t("../model/JSONConverter");s.Prototype=function(){this.exportDocument=function(t){var e,i=this.convertDocument(t);e=1===i.length&&i[0].attr("data-id")===l?i[0].innerHTML:i.map(function(t){return t.outerHTML}).join("");var s=new u,n=["<meta name='substance' content='",JSON.stringify(s.exportDocument(t)),"'>"].join("");return"<html><head>"+n+"</head><body>"+e+"</body></html>"},this.convertDocument=function(t){var e=t.get(a);if(!e)throw new Error('Illegal clipboard document: could not find container "'+a+'"');return this.convertContainer(e)}},n.extend(s),s.CLIPBOARD_CONTAINER_ID=a,e.exports=s},{"../model/HTMLExporter":103,"../model/JSONConverter":106,"./ClipboardImporter":435}],435:[function(t,e,i){"use strict";function s(t){if(!t.schema)throw new Error("Missing argument: config.schema is required.");this.IGNORE_DEFAULT_WARNINGS=!0,r(t,{trimWhitespaces:!0,REMOVE_INNER_WS:!0,converters:h}),s["super"].call(this,t),this._isWindows=navigator&&navigator.appVersion&&-1!==navigator.appVersion.indexOf("Win")}var n=t("lodash/isArray"),r=t("lodash/extend"),o=t("../model/HTMLImporter"),a=t("./DefaultDOMElement"),l=t("../model/JSONConverter"),u=t("../model/transform/copySelection").CLIPBOARD_CONTAINER_ID,c=t("../model/transform/copySelection").CLIPBOARD_PROPERTY_ID,h=[t("../packages/paragraph/ParagraphHTMLConverter"),t("../packages/heading/HeadingHTMLConverter"),t("../packages/emphasis/EmphasisHTMLConverter"),t("../packages/strong/StrongHTMLConverter"),t("../packages/code/CodeHTMLConverter"),t("../packages/superscript/SuperscriptHTMLConverter"),t("../packages/subscript/SubscriptHTMLConverter"),t("../packages/link/LinkHTMLConverter"),t("../packages/table/TableHTMLConverter"),t("../packages/table/TableSectionHTMLConverter"),t("../packages/table/TableRowHTMLConverter"),t("../packages/table/TableCellHTMLConverter"),t("../packages/list/ListHTMLConverter"),t("../packages/list/ListItemHTMLConverter")];s.Prototype=function(){function t(t){if(t){var e=t.find("b");return e&&/^docs-internal/.exec(e.id)?e:t}}this.importDocument=function(e){var i,s;if(this._isWindows){var r=/<!--StartFragment\-->(.*)<!--EndFragment-->/.exec(e);r&&(e=r[1])}if(e.search(/meta name=.substance./)>=0){s=a.parseHTML(e);var o=s.find('meta[name="substance"]');if(o){var l=o.attr("content");try{return this.importFromJSON(l)}catch(u){console.error(u)}}}if(s=a.parseHTML(e),n(s)?(i=this._createElement("body"),i.append(s)):i=s.find("body"),i||(i=this._createElement("body"),i.append(s)),i=t(i),!i)return console.warn("Invalid HTML."),null;this.reset(),this.convertBody(i);var c=this.generateDocument();return c},this.importFromJSON=function(t){var e=this.createDocument(),i=JSON.parse(t),s=new l;return s.importDocument(e,i),e},this.convertBody=function(t){this.convertContainer(t.childNodes,u)},this._wrapInlineElementsIntoBlockElement=function(t){for(var e=this._createElement("p");t.hasNext();){var i=t.next(),s=this._getConverterForElement(i,"block");if(s){t.back();break}e.append(i.clone())}e.attr("data-id",c);var n=this.defaultConverter(e,this);if(n){if(!n.type)throw new Error("Contract: Html.defaultConverter() must return a node with type.");this._createAndShow(n)}return n},this.createDocument=function(){var t=this._createDocument();return t.get(u)||t.create({type:"container",id:u,nodes:[]}),t}},o.extend(s),s.converters=h,s.CLIPBOARD_CONTAINER_ID=u,s.CLIPBOARD_PROPERTY_ID=c,e.exports=s},{"../model/HTMLImporter":104,"../model/JSONConverter":106,"../model/transform/copySelection":133,"../packages/code/CodeHTMLConverter":370,"../packages/emphasis/EmphasisHTMLConverter":381,"../packages/heading/HeadingHTMLConverter":390,"../packages/link/LinkHTMLConverter":396,"../packages/list/ListHTMLConverter":399,"../packages/list/ListItemHTMLConverter":401,"../packages/paragraph/ParagraphHTMLConverter":404,"../packages/strong/StrongHTMLConverter":407,"../packages/subscript/SubscriptHTMLConverter":411,"../packages/superscript/SuperscriptHTMLConverter":415,"../packages/table/TableCellHTMLConverter":419,"../packages/table/TableHTMLConverter":421,"../packages/table/TableRowHTMLConverter":424,"../packages/table/TableSectionHTMLConverter":426,"./DefaultDOMElement":445,"lodash/extend":315,"lodash/isArray":327}],436:[function(t,e,i){"use strict";var s=t("../util/oo"),n=function(){};n.Prototype=function(){this.execute=function(){throw new Error("execute must be implemented by custom commands")}},s.initClass(n),e.exports=n},{"../util/oo":486}],437:[function(t,e,i){"use strict";function s(t,e){if(f.call(this),!t&&"root"!==t)throw new Error("Contract: every component needs to have a parent.");this.__id__=_++,this.$el=null,this.el=null,e=e||{},this._virtualEl=e,this.refs={},this._preserved={},this._ref=e._ref,this.parent=t,this.children=[],this.context=this._getContext(),this._isOnRoute=e._isOnRoute,"root"===t&&(this._isOnRoute=!0),this._htmlParams=o(e),this._setProps(e.props),this._setState(this._getInitialState()),this.actionHandlers={},this._data={attributes:{},style:{},handlers:{},props:{},children:[]},this.didInitialize&&(console.warn("Component.didInitialize() has been deprecated. Use Component.initialize() instead."),this.didInitialize(this.props,this.state)),this.initialize()}function n(t){C=t,w.push(t)}function r(){C=w.pop()}var o,a=t("../util/jquery"),l=t("lodash/isFunction"),u=t("lodash/isString"),l=t("lodash/isFunction"),c=t("lodash/isEqual"),h=t("lodash/extend"),p=t("lodash/each"),d=t("./i18n"),f=t("../util/EventEmitter"),m=t("./DOMElement"),g=t("./DefaultDOMElement"),b=t("./VirtualDOMElement"),v=b.VirtualTextNode,y=t("./DelegatedEvent"),_=0,x="undefined"!=typeof window;s.Prototype=function(){function t(){throw new Error("Not supported.")}function e(t){var e=[t.getState()];if("root"===t.parent)return e;if(!t._isOnRoute)return!1;for(var i=t.getParent(),s=t;i&&"root"!==i;){if(i.route){if(i.route!==s)return console.error("Route is broken!"),!1;e.unshift(i.getState()),s=i}i=i.getParent()}return e}h(this,f.prototype),this.getInitialContext=function(){return{}},this.getChildContext=function(){return this.childContext||{}},this.initialize=function(t,e){},this.getInitialState=function(){return{}},this.getParent=function(){return"root"!==this.parent?this.parent:null},this.render=function(){return s.$$("div")},this.shouldRerender=function(t,e){return!0},this.rerender=function(){n(this);var t=this.render();r(),this._render(t,null,"force")},this.triggerDidMount=function(t){t||(t=s.isMounted(this)),t&&(this.children.forEach(function(t){t.triggerDidMount(!0)}),this.__didMountTriggered__||(this.didMount(),this.__didMountTriggered__=!0))},this.didMount=function(){},this.unmount=function(){return this.triggerDispose(),this.$el.remove(),this.__didMountTriggered__=!1,this},this.isMounted=function(){return s.isMounted(this)},this.triggerDispose=function(){p(this.children,function(t){t.triggerDispose()}),this.dispose()},this.dispose=function(){},this.send=function(t){for(var e=this;e;){if(e.actionHandlers[t])return e.actionHandlers[t].apply(e,Array.prototype.slice.call(arguments,1)),!0;e=e.getParent()}return console.warn("Action",t,"was not handled."),!1},this.handleActions=function(t){return p(t,function(t,e){this.handleAction(e,t)}.bind(this)),this},this.actions=function(t){return console.log("DEPRECATED: Use 'this.handleActions(actions)' instead."),this.handleActions(t)},this.handleAction=function(t,e){if(!t||!e||!l(e))throw new Error("Illegal arguments.");e=e.bind(this),this.actionHandlers[t]=e},this.setState=function(t){var i=this.shouldRerender(this.getProps(),t);this.willUpdateState(t),this._setState(t),this.didUpdateState();var s=this.context.router;if(s&&s.isActive()&&s.truncateState(this),i&&this.rerender(),s&&s.isActive()){var n=e(this);n&&s.updateState(n)}},this.extendState=function(t){t=h({},this.state,t),this.setState(t)},this.willUpdateState=function(t){},this.didUpdateState=function(){},this.setProps=function(t){var e=this.shouldRerender(t,this.getState());this.willReceiveProps(t),this._setProps(t),e&&this.rerender(),this.didReceiveProps()},this.extendProps=function(t){var e=h({},this.props,t);this.setProps(e)},this.getProps=function(){return this.props},this.getState=function(){return this.state},this.willReceiveProps=function(t){},this.didReceiveProps=function(){},this.willRender=function(){},this.didRender=function(){},this._getInitialState=function(){if(this.context.router){var t=this.context.router.getInitialState(this);if(t)return t}return this.getInitialState()},this.hasClass=function(t){return this.$el?this.$el.hasClass(t):!1},this.addClass=function(t){return this._data.addClass(t),this.$el&&this.$el.addClass(t),this},this.removeClass=function(t){return this._data.removeClass(t),this.$el&&this.$el.removeClass(t),this},this.attr=g.prototype.attr,this.removeAttr=function(){return this._data.removeAttr.apply(this._data,arguments),
this.$el&&this.$el.removeAttr.apply(this.$el,arguments),this},this.getAttribute=function(t){return this.$el.attr(t)},this.setAttribute=function(t,e){return this._data.attr(t,e),this.$el&&this.$el.attr(t,e),this},this.getTagName=g.prototype.getTagName,this.setTagName=function(){throw new Error("Not supported.")},this.getId=g.prototype.getId,this.setId=function(t){return this._data.setId(t),this.el.id=t,this},this.getTextContent=function(){return this.$el?this.$el.text():""},this.setTextContent=function(t){return this.empty(),this.append(t),this},this.getInnerHtml=function(){return this.$el?this.$el.html():""},this.setInnerHtml=function(){throw new Error("Not supported.")},this.getOuterHtml=g.prototype.getOuterHtml,this.getValue=g.prototype.getValue,this.setValue=function(t){return this._data.val(t),this.$el&&this.$el.val(t),this},this.getStyle=g.prototype.getStyle,this.setStyle=function(t,e){this._data.setStyle(t,e),this.$el.css(t,e)},this.addEventListener=g.prototype.addEventListener,this.removeEventListener=g.prototype.removeEventListener,this.focus=g.prototype.focus,this.isTextNode=g.prototype.isTextNode,this.isElementNode=g.prototype.isElementNode,this.isCommentNode=g.prototype.isCommentNode,this.isDocumentNode=g.prototype.isDocumentNode,this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children},this.getChildNodeIterator=g.prototype.getChildNodeIterator,this.createElement=function(){throw new Error("Not supported yet.")},this.clone=function(){throw new Error("Not supported yet.")},this.is=function(t){if(this.$el)return this.$el.is(t);throw new Error("Invalid state: you can use this after the component has been rendered.")},this.getRoot=function(){for(var t=this,e=t;e;)t=e,e=t.getParent();return t},this.find=t,this.findAll=t,this.append=function(t){u(t)&&(t=new v(t));var e=this._compileComponent(t);return this._data.append(t),this.$el.append(e.$el),this.children.push(e),e.triggerDidMount(),this},this.insertAt=function(t,e){var i=this._compileComponent(e);return this._data.insertAt(t,e),t>this.children.length-1?(this.$el.append(i.$el),this.children.push(i)):(i.$el.insertBefore(this.children[t].$el),this.children.splice(t,0,i)),i.triggerDidMount(),this},this.removeAt=function(t){return this._data.removeAt(t),this.children[t].unmount(),this.children.splice(t,1),this},this.empty=function(){this._data.children=[],this.$el.empty();for(var t=0;t<this.children.length;t++)this.children[t].unmount();return this.children=[],this},this.remove=function(){this.unmount()},this.htmlProp=function(){return 1===arguments.length&&u(arguments[0])?this.$el.prop(arguments[0]):(this._data.htmlProp.apply(this._data,arguments),this.$el&&this.$el.prop.apply(this.$el,arguments),this)},this.removeHtmlProp=function(){return this._data.removeHtmlProp.apply(this._data,arguments),this.$el&&this.$el.removeProp.apply(this.$el,arguments),this};var i=function(t){for(var e={},i=0;i<t.length;i++){var s=t[i],n=s._ref;n&&(e[n]=s)}return e};this._createElement=function(t){var e=a("<"+t.tagName+">");return e.addClass(this._htmlParams.classNames),e.addClass(t.classNames),e.attr(this._htmlParams.attributes),e.attr(t.attributes),e.prop(this._htmlParams.htmlProps),e.prop(t.htmlProps),e.css(this._htmlParams.style),t.style&&e.css(t.style),"component"===this._virtualEl.type&&p(this._virtualEl.handlers,function(t,i){this._bindHandler(e[0],this._virtualEl._owner,i,t)}.bind(this)),p(t.handlers,function(i,s){this._bindHandler(e[0],t._owner,s,i)}.bind(this)),e},this._updateElement=function(t,e){var i=this.$el,s=this.el,n=e.classNames,r=t.classNames;n!==r&&(i.removeClass(n),i.addClass(r));var o=e.attributes,a=t.attributes;if(!c(o,a)){var l=Object.keys(o);i.removeAttr(l.join(" ")),i.attr(a)}var u=e.htmlProps,h=t.htmlProps;if(!c(u,h)){var d=Object.keys(u);i.removeProp(d.join(" ")),i.prop(h)}return c(e.style,t.style)||t.style&&i.css(t.style),p(e.handlers,function(t,e){s.removeEventListener?s.removeEventListener(e,t.handler):i.off(e)}),p(t.handlers,function(e,i){this._bindHandler(s,t._owner,i,e)}.bind(this)),i},this._render=function(t,e,n){function r(t,e){t.triggerDispose(),t.$el.replaceWith(e.$el[0])}function l(t,i){if(t instanceof s.Container)t._render(i,e);else{var n=o(i);t._updateElement(n,t._htmlParams),t._htmlParams=n,t.setProps(i.props)}}if(this.willRender(),!t)throw new Error("Nothing to render. Make sure your render method returns a virtual element: "+this.displayName);if("element"!==t.type){if(t instanceof a)throw new Error("Your render() method accidently return a jQuery instance instead of a VirtualComponent created $$.");throw new Error("Component.render() must return one html element: e.g., $$('div')")}e={owner:e?e.owner:this,parent:this};var u=this._data;if(!this.$el)return this.$el=this._createElement(t,e),this.el=this.$el[0],void this._renderFromScratch(t,e);if(this._updateElement(t,u,e),0===Object.keys(this._preserved).length)return void this._renderFromScratch(t,e);var h=this.$el[0],p=s.isMounted(this),d=u.children,f=t.children;if(!n&&c(d,f))return void(this._data=t);for(var m=i(u.children,"old"),g=i(t.children),b=0,v=0,y=0,_=this.children,x=[];v<d.length||y<f.length;){var C=h.childNodes[b],w=d[v],S=f[y],T=null,E=_[v];if(!w){for(var I=y;I<f.length;I++)T=this._compileComponent(f[I],e),this.$el.append(T.$el),x.push(T),T.triggerDidMount(p);break}if(!S){for(var O=v;O<d.length;O++)_[O].unmount();break}if(C!==E.$el[0])throw new Error("Assertion failed: DOM structure is not as expected.");var A=S._ref,N=w._ref;if(N&&A)if(N===A)S._quasiEquals(w)?(T=E,l(T,S)):(T=this._compileComponent(S,e),r(E,T),T.triggerDidMount(p)),b++,v++,y++;else if(!m[A]&&g[N])T=this._compileComponent(S,e),T.$el.insertBefore(C),T.triggerDidMount(p),b++,y++;else{if(m[A]||g[N]){if(m[A]&&!g[N]){E.unmount(),v++;continue}throw m[A]&&g[N]?new Error("Swapping positions of persisted components not supported!"):new Error("Assertion failed: should not reach this statement.")}T=this._compileComponent(S,e),r(E,T),T.triggerDidMount(p),b++,y++,v++}else if(A){if(m[A]){E.unmount(),v++;continue}T=this._compileComponent(S,e),r(E,T),T.triggerDidMount(p),b++,v++,y++}else N?(T=this._compileComponent(S,e),g[N]?T.$el.insertBefore(C):(r(E,T),v++),T.triggerDidMount(p),b++,y++):("text"===S.type&&"text"===w.type&&S.props.text===w.props.text?T=E:(T=this._compileComponent(S,e),r(E,T),T.triggerDidMount(p)),b++,v++,y++);if(T._ref){var k=T._data;k._owner?k._owner.refs[T._ref]=T:console.warn("FIXME: owner is unknown."),this._preserved[T._ref]=T}T._isOnRoute&&(e.owner.route&&console.warn("Route is already defined in this scope. In every render() implementation there must be only one routed component."),e.owner.route=T),x.push(T)}this.children=x,this._data=t,this.didRender()},this._renderFromScratch=function(t,e){for(var i=0;i<this.children.length;i++)this.children[i].unmount();this.$el.empty();for(var n=s.isMounted(this),r=[],o=0;o<t.children.length;o++)if(t.children[o]instanceof b.RawHtml)this.$el.html(t.children[o].html),r=[];else{var a=this._compileComponent(t.children[o],e);this.$el.append(a.$el),r.push(a),a.triggerDidMount(n)}this.children=r,this._data=t,this.didRender()},this._compileComponent=function(t,e){return e=e||{owner:this,parent:this},s._render(t,e)},this._getContext=function(){var t=this.getParent(),e=this.getInitialContext();return t?(e=h({},t.context,e),t.getChildContext?h(e,t.getChildContext()):e):e},this._setProps=function(t){this.props=t||{},Object.freeze(this.props)},this._setState=function(t){this.state=t||{},Object.freeze(this.state)},this._bindHandler=function(t,e,i,s){var n=s.handler;if(n=s.context?n.bind(s.context):n.bind(e),s.handler=n,s.selector){var r=n,o=this;n=function(e){for(var i=e.target;i;){if(a(i).is(s.selector)){r(new y(o,i,e));break}if(i===t)break;i=i.parentNode}}}t.addEventListener?t.addEventListener(i,n):a(t).on(i,n)}},m.extend(s),d.mixin(s),o=function(t){return{classNames:t.classNames||"",attributes:t.attributes||{},htmlProps:t.htmlProps||{},style:t.style||{}}},s.Root=function(t){s.call(this,"root",t)},s.extend(s.Root),s.Container=function(t,e){s.call(this,t,e)},s.extend(s.Container),s.HTMLElement=function(t,e,i){this.tagName=e,s.Container.call(this,t,i)},s.Container.extend(s.HTMLElement),s.Text=function(t,e){s.call(this,t),this._text=e},s.Text.Prototype=function(){this._render=function(){this.$el?this.$el.text(this._text):(x?this.el=window.document.createTextNode(this._text):this.el=a._createTextNode(this._text),this.$el=a(this.el))}},s.extend(s.Text);var C=null,w=[];s.createElement=function(){if(!C)throw new Error("Component.createElement can not be used outside of the Component rendering lifecycle.");var t=b.createElement.apply(null,arguments);return t._owner=C,t},s.$$=s.createElement,s._render=function(t,e){var i;e=e||{owner:null,parent:null};var o=e.parent||"root";switch(t.type){case"text":i=new s.Text(o,t.props.text),i._render();break;case"element":i=new s.HTMLElement(o,t.tagName,t),i._render(t,e);break;case"component":i=new t.ComponentClass(o,t),n(i);var a=i.render();r(),i._render(a);break;case"html":throw new Error("$$.html() can not be used in combination with other composition methods.");default:throw new Error("Unsupported component type: "+t.type)}return t._ref&&(t._owner?t._owner.refs[t._ref]=i:console.warn("FIXME: owner is unknown."),e.parent&&(e.parent._preserved[t._ref]=i)),t._isOnRoute&&e.owner&&(e.owner.route&&console.warn("Route is already defined in this scope. Only one route is allowed in each render() implementation."),e.owner.route=i),i},s.render=function(t,e){if(e=e||{},!l(t))throw new Error("Unsupported arguments for Component.render");var i=t;i.prototype instanceof s||(i=function(){s.apply(this,arguments)},s.extend(i,{render:t})),t=new i("root",{props:e}),n(t);var o=t.render();return r(),t._render(o),t},s.mount=function(t,e,i){if(2===arguments.length&&(i=arguments[1],e={}),t instanceof s);else if(t instanceof b)console.warn("DEPRECATED: use Component.mount(MyComponent, {...}, el) instead."),t=s._render(t);else{if(!(arguments[0].prototype instanceof s))throw new Error("component must be of type Component or VirtualComponent");t=s.render(t,e)}if(u(i)&&(i=window.document.querySelector(i)),i.length&&(console.warn("DEPRECATED: we will drop jquery support."),i=i[0]),!i)throw new Error("An element is needed for mounting.");return i.appendChild(t.el),t.triggerDidMount(),t},s["static"].mount=function(t,e){var i=this.__class__;return s.mount(i,t,e)},s.isMounted=function(t){var e;if(!t.$el)return!1;for(e=t.$el[0];e;){if(9===e.nodeType)return!0;e=e.parentNode}return!1},e.exports=s},{"../util/EventEmitter":477,"../util/jquery":484,"./DOMElement":443,"./DefaultDOMElement":445,"./DelegatedEvent":446,"./VirtualDOMElement":475,"./i18n":476,"lodash/each":313,"lodash/extend":315,"lodash/isEqual":332,"lodash/isFunction":333,"lodash/isString":340}],438:[function(t,e,i){"use strict";function s(){o.apply(this,arguments)}var n=t("lodash/each"),r=t("./Component"),o=t("./ContainerEditor"),a=r.$$;s.Prototype=function(){this.render=function(){var t=this.getDocument(),e=t.get(this.props.containerId),i=a("div").addClass("surface container-node "+e.id).attr({spellCheck:!1,"data-id":e.id,contenteditable:!1});return n(e.nodes,function(t){i.append(this._renderNode(t))}.bind(this)),i}},o.extend(s),e.exports=s},{"./Component":437,"./ContainerEditor":439,"lodash/each":313}],439:[function(t,e,i){"use strict";function s(){if(m.apply(this,arguments),this.containerId=this.props.containerId,!n(this.props.containerId))throw new Error("Illegal argument: Expecting containerId.");var t=this.getDocument();if(this.container=t.get(this.containerId),!this.container)throw new Error("Container with id "+this.containerId+" does not exist.");this.editingBehavior=new a}var n=t("lodash/isString"),r=t("lodash/each"),o=t("../util/uuid"),a=t("../model/EditingBehavior"),l=t("../model/transform/insertText"),u=t("../model/transform/copySelection"),c=t("../model/transform/deleteSelection"),h=t("../model/transform/breakNode"),p=t("../model/transform/insertNode"),d=t("../model/transform/switchTextType"),f=t("../model/transform/paste"),m=t("./Surface"),g=t("./Component"),b=g.$$;s.Prototype=function(){var t=Object.getPrototypeOf(this);this.render=function(){var t=m.prototype.render.call(this),e=this.getDocument(),i=this.props.containerId,s=e.get(this.props.containerId);s||console.warn("No container node found for ",this.props.containerId);var n=this.isEditable();return t.addClass("sc-container-editor container-node "+i).attr({spellCheck:!1,"data-id":i,contenteditable:n}),this.isEmpty()?t.append(b("a").attr("href","#").append("Start writing").on("click",this.onCreateText)):r(s.nodes,function(e){t.append(this._renderNode(e))}.bind(this)),t},this.isContainerEditor=function(){return!0},this.getContainerId=function(){return this.props.containerId},this.getContainer=function(){return this.getDocument().get(this.getContainerId())},this.isEmpty=function(){var t=this.getDocument(),e=t.get(this.props.containerId);return e&&0===e.nodes.length},this.isEditable=function(){return t.isEditable.call(this)&&!this.isEmpty()},this.extendBehavior=function(t){t.register(this.editingBehavior)},this.getTextTypes=function(){return this.textTypes||[]},this.getTextCommands=function(){var t={};return this.commandRegistry.each(function(e){e.constructor["static"].textTypeName&&(t[e.constructor["static"].name]=e)}),t},this.enable=function(){this.attr("contentEditable",!0),this.enabled=!0},this.disable=function(){this.removeAttr("contentEditable"),this.enabled=!1},this["delete"]=function(t,e){return this._prepareArgs(e),c(t,e)},this["break"]=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?h(t,e):void 0},this.insertNode=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?p(t,e):void 0},this.switchType=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()?d(t,e):void 0},this.selectAll=function(){var t=this.getDocument(),e=t.get(this.getContainerId()),i=e.getFirstPath(),s=e.getLastPath(),n=t.get(s),r=t.createSelection({type:"container",containerId:e.id,startPath:i,startOffset:0,endPath:s,endOffset:n.length});console.log("###",r.toString()),this.setSelection(r)},this.paste=function(t,e){return this._prepareArgs(e),e.selection.isPropertySelection()||e.selection.isContainerSelection()?f(t,e):void 0},this.insertText=function(t,e){return e.selection.isPropertySelection()||e.selection.isContainerSelection()?l(t,e):void 0},this.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},this.copy=function(t,e){var i=u(t,{selection:e});return i.doc},this.onDocumentChange=function(e){if(e.isAffected([this.props.containerId,"nodes"]))for(var i=0;i<e.ops.length;i++){var s=e.ops[i];if("update"===s.type&&s.path[0]===this.props.containerId){var n=s.diff;if("insert"===n.type){var r=this._renderNode(n.getValue());this.insertAt(n.getOffset(),r)}else"delete"===n.type&&this.removeAt(n.getOffset())}}t.onDocumentChange.apply(this,arguments)},this.onCreateText=function(t){t.preventDefault();var e;this.transaction(function(t){var i=t.get(this.props.containerId),s=t.getSchema().getDefaultTextType(),n=t.create({id:o(s),type:s,content:""});i.show(n.id),e=t.createSelection({type:"property",path:[n.id,"content"],startOffset:0,endOffset:0})}.bind(this)),this.rerender(),this.setSelection(e)},this._prepareArgs=function(t){t.containerId=this.getContainerId(),t.editingBehavior=this.editingBehavior}},m.extend(s),e.exports=s},{"../model/EditingBehavior":101,"../model/transform/breakNode":132,"../model/transform/copySelection":133,"../model/transform/deleteSelection":138,"../model/transform/insertNode":142,"../model/transform/insertText":143,"../model/transform/paste":145,"../model/transform/switchTextType":147,"../util/uuid":490,"./Component":437,"./Surface":460,"lodash/each":313,"lodash/isString":340}],440:[function(t,e,i){"use strict";function s(){if(o.apply(this,arguments),this.props.documentSession)this.documentSession=this.props.documentSession,this.doc=this.props.documentSession.doc;else if(this.props.doc)console.warn("Deprecated: Please pass a DocumentSession instance instead."),this.documentSession=new h(this.props.doc),this.doc=this.props.doc;else if(!this.props.doc)throw new Error("Controller requires a Substance document instance");this.surfaces={},this.stack=[],this.logger=new u;var t=this.getConfig();this._initializeComponentRegistry(t.controller.components),this._initializeCommandRegistry(t.controller.commands),t.i18n&&p.instance.load(t.i18n),this.toolManager=new a(this),this._initialize(this.props),this.handleStateUpdate(this.state)}var n=t("lodash/each"),r=t("lodash/extend"),o=t("./Component"),a=t("./ToolManager"),l=t("../util/Registry"),u=t("../util/Logger"),c=t("../model/Selection"),h=t("../model/DocumentSession"),p=t("./i18n");p.instance.load(t("../i18n/en")),s.Prototype=function(){this._initialize=function(){var t=this.doc;t.on("document:changed",this.onDocumentChanged,this,{priority:-20}),t.on("transaction:started",this.onTransactionStarted,this)},this.dispose=function(){this.doc.off(this)},this.getChildContext=function(){return{config:this.getConfig(),doc:this.doc,documentSession:this.documentSession,controller:this,componentRegistry:this.componentRegistry,toolManager:this.toolManager,i18n:p.instance}},this.getInitialState=function(){return{}},this.getConfig=function(){return this.constructor["static"].config||this.props.config||{controller:{components:[],commands:[]}}},this.willReceiveProps=function(t){this.doc&&t.doc!==this.doc&&(this._dispose(),this.empty(),this._initialize(t))},this.render=function(){var t=o.$$;return t("div").addClass("sc-controller").on("keydown",this.handleApplicationKeyCombos)},this.getToolManager=function(){return this.toolManager},this._initializeComponentRegistry=function(t){var e=new l;n(t,function(t,i){e.add(i,t)}),this.componentRegistry=e},this._initializeCommandRegistry=function(t){var e=new l;n(t,function(t){var i=r({},this.context,this.getChildContext()),s=new t(i);e.add(t["static"].name,s)}.bind(this)),this.commandRegistry=e},this.getCommand=function(t){return this.commandRegistry.get(t)},this.executeCommand=function(t){var e=this.getCommand(t);if(!e)return void console.warn("command",t,"not registered on controller");var i=e.execute();i?this.emit("command:executed",i,t,e):void 0===i&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled")},this.getLogger=function(){return this.logger},this.getDocument=function(){return this.doc},this.getDocumentSession=function(){return this.documentSession},this.getSurface=function(t){return t?this.surfaces[t]:(console.warn("Deprecated: Use getFocusedSurface. Always provide a name for getSurface otherwise."),this.getFocusedSurface())},this.getFocusedSurface=function(){var t=this.documentSession.selection.surfaceId;return t?this.surfaces[t]:null},this.getSelection=function(){var t=this.getSurface();return t?t.getSelection():c.nullSelection},this.getContainerId=function(){var t=this.getSurface();return t?t.getContainerId():void 0},this.registerSurface=function(t){t.on("selection:changed",this._onSelectionChanged,this),t.on("command:executed",this._onCommandExecuted,this),this.surfaces[t.getName()]=t},this.unregisterSurface=function(t){t.off(this),delete this.surfaces[t.getName()],t&&this.focusedSurface===t&&(this.focusedSurface=null)},this.hasSurfaces=function(){return Object.keys(this.surfaces).length>0},this.didFocus=function(){},this.transaction=function(){var t=this.getFocusedSurface();t?t.transaction.apply(t,arguments):this.documentSession.transaction.apply(this.documentSession,arguments)},this.onTransactionStarted=function(t){},this.handleApplicationKeyCombos=function(t){var e=!1;return 27===t.keyCode?(this.setState(this.getInitialState()),e=!0):83===t.keyCode&&(t.metaKey||t.ctrlKey)&&(this.executeCommand("save"),e=!0),e?(t.preventDefault(),t.stopPropagation(),!0):void 0},this.handleStateUpdate=function(){},this.willUpdateState=function(t){this.handleStateUpdate(t)},this.onDocumentChanged=function(t,e){e.replay&&t.after.state&&this.setState(t.after.state);var i=this.getDocument();i.__dirty=!0;var s=this.getLogger();s.info("Unsaved changes")},this.onSelectionChanged=function(t,e){},this.onCommandExecuted=function(t,e,i){},this._onSelectionChanged=function(t,e){this.emit("selection:changed",t,e),this.onSelectionChanged(t,e)},this._onCommandExecuted=function(t,e,i){this.emit("command:executed",t,e,i),this.onCommandExecuted(t,e,i)},this.uploadFile=function(t,e){if(this.props.onUploadFile)return this.props.onUploadFile(t,e);var i=window.URL.createObjectURL(t);e(null,i)},this.pushState=function(){var t={surface:this.focusedSurface,selection:null};this.focusedSurface&&(t.selection=this.focusedSurface.getSelection()),this.focusedSurface=null,this.stack.push(t)},this.popState=function(){var t=this.stack.pop();t&&t.surface&&(t.surface.setFocused(!0),t.surface.setSelection(t.selection))},this.saveDocument=function(){var t=this.getDocument(),e=this.getLogger();if(t.__dirty&&!t.__isSaving)if(e.info("Saving ..."),t.__isSaving=!0,this.props.onSave){var i=[];this.props.onSave(t,i,function(i){t.__isSaving=!1,i?e.error(i.message||i.toString()):(t.__dirty=!1,this.emit("document:saved"),e.info("No changes"))}.bind(this))}else e.error("Document saving is not handled at the moment. Make sure onSave is passed in the props")}},o.extend(s),e.exports=s},{"../i18n/en":80,"../model/DocumentSession":100,"../model/Selection":112,"../util/Logger":478,"../util/Registry":479,"./Component":437,"./ToolManager":469,"./i18n":476,"lodash/each":313,"lodash/extend":315}],441:[function(t,e,i){"use strict";var s=t("./Command"),n=function(t){this.context=t,this.controller=t.controller};n.Prototype=function(){this.getController=function(){return this.controller},this.getDocument=function(){return this.controller.getDocument()},this.getDocumentSession=function(){return this.controller.getDocumentSession()},this.execute=function(){throw new Error("execute must be implemented by custom commands")}},s.extend(n),e.exports=n},{"./Command":436}],442:[function(t,e,i){"use strict";function s(){if(n.apply(this,arguments),!this.context.controller)throw new Error("No controller context found.")}var n=t("./Tool");s.Prototype=function(){this.getDocument=function(){return this.context.controller.getDocument()},this.performAction=function(){var t=this.getController();t.executeCommand(this.constructor["static"].command)}},n.extend(s),e.exports=s},{"./Tool":468}],443:[function(t,e,i){"use strict";function s(){}var n=t("../util/oo"),r=t("lodash/isFunction"),o=t("lodash/isObject"),a=t("lodash/isString"),l=t("lodash/each");s.Prototype=function(){this.hasClass=function(t){throw new Error("This method is abstract.")},this.addClass=function(t){throw new Error("This method is abstract.")},this.removeClass=function(t){throw new Error("This method is abstract.")},this.attr=function(){if(1===arguments.length){if(a(arguments[0]))return this.getAttribute(arguments[0]);o(arguments[0])&&l(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this))}else 2===arguments.length&&this.setAttribute(arguments[0],arguments[1]);return this},this.removeAttr=function(t){throw new Error("This method is abstract.")},this.getAttribute=function(t){throw new Error("This method is abstract.")},this.setAttribute=function(t,e){throw new Error("This method is abstract.")},this.getTagName=function(){throw new Error("This method is abstract.")},this.setTagName=function(t){throw new Error("This method is abstract.")},this.getId=function(){throw new Error("This method is abstract.")},this.setId=function(t){throw new Error("This method is abstract.")},this.text=function(t){return 0===arguments.length?this.getTextContent():this.setTextContent(t)},this.getTextContent=function(){throw new Error("This method is abstract.")},this.setTextContent=function(t){throw new Error("This method is abstract.")},this.html=function(t){return 0===arguments.length?this.getInnerHtml():this.setInnerHtml(t)},this.getInnerHtml=function(){throw new Error("This method is abstract.")},this.setInnerHtml=function(t){throw new Error("This method is abstract.")},this.getOuterHtml=function(){throw new Error("This method is abstract.")},this.val=function(t){return 0===arguments.length?this.getValue():(this.setValue(t),this)},this.getValue=function(){throw new Error("This method is abstract.")},this.setValue=function(t){throw new Error("This method is abstract.")},this.css=function(){if(1===arguments.length){if(a(arguments[0]))return this.getStyle(arguments[0]);if(!o(arguments[0]))throw new Error("Illegal arguments.");l(arguments[0],function(t,e){this.setStyle(e,t)}.bind(this))}else{if(2!==arguments.length)throw new Error("Illegal arguments.");this.setStyle(arguments[0],arguments[1])}return this},this.getStyle=function(t){throw new Error("This method is abstract.")},this.setStyle=function(t,e){throw new Error("This method is abstract.")},this.on=function(t,e,i){if(!a(t))throw new Error('Illegal argument: "event" must be a String.');if(2===arguments.length&&(i=arguments[1],e=null),e&&!a(e))throw new Error("Illegal argument: selector must be a string.");if(!i||!r(i))throw new Error("Illegal argument: invalid handler function for event "+t);return this.addEventListener(t,e,i),this},this.off=function(t){return this.removeEventListener(t),this},this.addEventListener=function(t,e,i,s){throw new Error("This method is abstract.")},this.removeEventListener=function(t){throw new Error("This method is abstract.")},this.focus=function(){},this.getNodeType=function(){if(this.isTextNode())return"text";if(this.isCommentNode())return"comment";if(this.isElementNode())return"element";if(this.isDocumentNode())return"document";throw new Error("Unsupported node type")},this.getChildNodes=function(){throw new Error("This method is abstract.")},this.getChildren=function(){throw new Error("This method is abstract.")},this.isTextNode=function(){throw new Error("This method is abstract.")},this.isElementNode=function(){throw new Error("This method is abstract.")},this.isCommentNode=function(){throw new Error("This method is abstract.")},this.isDocumentNode=function(){throw new Error("This method is abstract.")},this.clone=function(){throw new Error("This method is abstract.")},this.createElement=function(t){throw new Error("This method is abstract.")},this.is=function(t){throw new Error("This method is abstract.")},this.getParent=function(){throw new Error("This method is abstract.")},this.getRoot=function(){throw new Error("This method is abstract.")},this.find=function(t){throw new Error("This method is abstract.")},this.findAll=function(t){throw new Error("This method is abstract.")},this.append=function(t){throw new Error("This method is abstract.")},this.insertAt=function(t,e){throw new Error("This method is abstract.")},this.removeAt=function(t){throw new Error("This method is abstract.")},this.empty=function(){throw new Error("This method is abstract.")},this.remove=function(){throw new Error("This method is abstract.")},this.serialize=function(){return this.outerHTML}},n.initClass(s),Object.defineProperties(s.prototype,{id:{configurable:!0,get:function(){return this.getId()},set:function(t){this.setId(t)}},textContent:{configurable:!0,get:function(){return this.getTextContent()},set:function(t){this.setTextContent(t)}},innerHTML:{configurable:!0,get:function(){return this.getInnerHtml()},set:function(t){this.setInnerHtml(t)}},outerHTML:{configurable:!0,get:function(){return this.getOuterHtml()},set:function(){throw new Error("ui/DOMElement#outerHTML is readonly.")}},nodeType:{configurable:!0,get:function(){return this.getNodeType()},set:function(){throw new Error("ui/DOMElement#nodeType is readonly.")}},childNodes:{configurable:!0,get:function(){return this.getChildNodes()},set:function(){throw new Error("ui/DOMElement#childNodes is readonly.")}}}),s.parseHTML=function(e){var i=t("./DefaultDOMElement");return i.parseHTML(e)},s.parseXML=function(e){var i=t("./DefaultDOMElement");return i.parseXML(e)},e.exports=s},{"../util/oo":486,"./DefaultDOMElement":445,"lodash/each":313,"lodash/isFunction":333,"lodash/isObject":338,"lodash/isString":340}],444:[function(t,e,i){"use strict";function s(t){this.surface=t}var n=t("../util/jquery"),r=t("../util/oo"),o=t("../model/Coordinate"),a=t("../model/Range"),l=t("./TextPropertyComponent");s.Prototype=function(){function t(t,e){var i=t.compareDocumentPosition(e);return i&window.document.DOCUMENT_POSITION_FOLLOWING?-1:i&window.document.DOCUMENT_POSITION_PRECEDING?1:0}function e(t,e,i,s){if(i&&t){r||(r=window.document.createRange(),u=window.document.createRange()),r.setStart(t,e),u.setStart(i,s);var n=r.compareBoundaryPoints(window.Range.START_TO_START,u);if(1===n)return!0}return!1}function i(t){return t&&t.dataset&&t.dataset.path?t.dataset.path.split("."):void 0}function s(t,e,i,s){if(i){var n=t;t=e,e=n}return new a(t,e,i,s)}this.getSelection=function(t){var e=this.mapDOMSelection(t),i=this.surface.getDocument();return i.createSelection(e)},this.setSelection=function(t){var e=window.getSelection();if(t.isNull()||t.isTableSelection())return void this.clear();var i=this.surface._getTextPropertyComponent(t.startPath);if(!i)return console.warn("FIXME: selection seems to be invalid."),void this.clear();var s,n=i.getDOMCoordinate(t.startOffset);if(t.isCollapsed())s=n;else{var r=this.surface._getTextPropertyComponent(t.endPath);if(!r)return console.warn("FIXME: selection seems to be invalid."),void this.clear();s=r.getDOMCoordinate(t.endOffset)}e.removeAllRanges();var o=window.document.createRange();if(t.isCollapsed())o.setStart(n.container,n.offset),e.addRange(o);else{if(t.isReverse()){var a=n;n=s,s=a}o.setStart(n.container,n.offset),e.addRange(o),e.extend(s.container,s.offset)}},this.mapDOMRange=function(t){return this._getRange(t.startContainer,t.startOffset,t.endContainer,t.endOffset)},this.mapDOMSelection=function(t){var e,i=window.getSelection();if(0===i.rangeCount)return null;if(i.isCollapsed){var r=this._getCoordinate(i.anchorNode,i.anchorOffset,t);e=s(r,r,!1,this.getContainerId())}return e=n(i.anchorNode).is(".surface")?this._getEnclosingRange(i.getRangeAt(0)):this._getRange(i.anchorNode,i.anchorOffset,i.focusNode,i.focusOffset)},this.clear=function(){window.getSelection().removeAllRanges()},this.getContainerId=function(){return this.surface.isContainerEditor()?this.surface.getContainerId():null},this._getRange=function(t,i,n,r){var o,a=this._getCoordinate(t,i);o=t===n&&i===r?a:this._getCoordinate(n,r);var l=e(t,i,n,r);return a&&o?s(a,o,l,this.getContainerId()):null},this._getCoordinate=function(t,e,i){var s=l.getCoordinate(this.surface.el,t,e);return s||(s=this._searchForCoordinate(t,e,i)),s},this._searchForCoordinate=function(e,s,n){n=n||{};var r,a,l,u,c,h=this.surface.el.querySelectorAll("*[data-path]");for(a=0,l=h.length-1,u=t(h[a],e),c=t(h[l],e);;){var p=l-a+1;if(0>c){r=l;break}if(u>0){r=a;break}if(2>=p){r=l;break}var d=a+Math.floor(p/2),f=t(h[d],e);0>f?(a=d,u=f):(l=d,c=f)}var m,g=this.surface.getDocument(),b=i(h[r]),v=g.get(b);return"left"===n.direction?0===r?m=0:(b=i(h[r-1]),v=g.get(b),m=v.length):m=0>c?v.length:0,new o(b,m)},this._getEnclosingRange=function(t){var e=t.cloneContents(),s=e.querySelectorAll("*[data-path]");if(0===s.length)return null;var n,r=this.surface.getDocument(),l=s[0],u=s[s.length-1],c=i(l);if(l===u)return n=r.get(c),new a(new o(c,0),new o(c,n.length),!1);var h=i(u);return n=r.get(h),new a(new o(c,0),new o(h,n.length),!1)};var r,u},r.initClass(s),e.exports=s},{"../model/Coordinate":88,"../model/Range":111,"../util/jquery":484,"../util/oo":486,"./TextPropertyComponent":466}],445:[function(t,e,i){"use strict";function s(t){if(!t)throw new Error("Illegal argument: el is null");this.el=t,this.$el=o(t),this._handlers={},Object.freeze(this)}function n(t,e){var i,n=[];if(!t)return i=p?"xml"===e?(new window.DOMParser).parseFromString("<dummy/>","text/xml"):(new window.DOMParser).parseFromString("<html></html>","text/html"):"xml"===e?o.parseXML(""):o.parseHTML(""),
new s(i);if(p){var r,a=new window.DOMParser;if("html"===e?(r=t.search(/<\s*html/i)>=0,i=a.parseFromString(t,"text/html")):"xml"===e&&(i=a.parseFromString(t,"text/xml")),i)if("html"===e)if(r)n=[i.querySelector("html")];else{var l=i.querySelector("body");n=l.childNodes}else"xml"===e&&(n=i.childNodes);else"html"===e?r?(i=o.parseXML(t),n=i.childNodes):n=o.parseHTML(t):"xml"===e&&(i=o.parseXML(t),n=i.childNodes)}else n=o.parseXML(t);for(var u=[],c=0;c<n.length;c++)u.push(new s(n[c]));return 1===u.length?u[0]:u}var r=t("../util/oo"),o=t("../util/jquery"),a=t("lodash/isString"),l=t("lodash/isArray"),u=t("lodash/extend"),c=t("lodash/each"),h=t("lodash/map"),p="undefined"!=typeof window,d=t("./DOMElement");s.Prototype=function(){this.hasClass=function(t){return p?this.el.classList.contains(t):this.$el.hasClass(t)},this.addClass=function(t){if(p){var e=this.el.classList,i=t.split(/\s+/);1===i.length?e.add(t):i.forEach(function(t){t&&e.add(t)})}else this.$el.addClass(t);return this},this.removeClass=function(t){if(p){var e=this.el.classList,i=t.split(/\s+/);1===i.length?e.remove(t):i.forEach(function(t){t&&e.remove(t)})}else this.$el.removeClass(t);return this},this.attr=function(t,e){return 1===arguments.length?a(arguments[0])?this.getAttribute(t):(c(arguments[0],function(t,e){this.setAttribute(e,t)}.bind(this)),this):(this.setAttribute(t,e),this)},this.removeAttr=function(t){return p?this.el.removeAttribute(t):delete this.el.attribs[t],this},this.removeAttribute=this.removeAttr,this.getAttribute=function(t){return p?this.el.hasAttribute(t)?this.el.getAttribute(t):void 0:this.el.attribs[t]},this.setAttribute=function(t,e){return p?this.el.setAttribute(t,e):this.el.attribs[t]=e,this},this.getTagName=function(){return p?this.el.tagName?this.el.tagName.toLowerCase():"":"tag"!==this.el.type?"":this.el.name.toLowerCase()},this.setTagName=function(){throw new Error("tagName is readonly.")},this.withTagName=function(t){if(p){var e=this._createNativeElement("div"),i=this.getTagName(),n=this.el.outerHTML;return n=n.replace(new RegExp("^s*<s*"+i),"<"+t),n=n.replace(new RegExp(i+"s*>s*$"),t+">"),e.innerHTML=n,new s(e.firstChild)}var r=this.createElement(t);return r.innerHTML=this.innerHTML,r.el.attribs=u({},this.el.attribs),r},this.getId=function(){return this.el.id},this.setId=function(t){return this.el.id=t,this},this.getTextContent=function(){return p?this.el.textContent:this.$el.text()},this.setTextContent=function(t){return p?this.el.textContent=t:this.$el.text(t),this},this.getInnerHtml=function(){return p?this.el.innerHTML:this.$el.html()},this.setInnerHtml=function(t){p?this.el.innerHTML=t:this.$el.html(t)},this.getOuterHtml=function(){return p?this.el.outerHTML:o._serialize(this.el)},this.getValue=function(){return this.$el.val()},this.setValue=function(t){return this.$el.val(t),this},this.getStyle=function(t){return p?this.el.style[t]:this.$el.css(t)},this.setStyle=function(t,e){return p?this.el.style[t]=e:this.$el.css(t,e),this},this.addEventListener=function(t,e,i,s){if(this._handlers[t])throw new Error('Handler for event "'+t+'" has already been registered.');if(p){if(s&&(i=i.bind(s)),e){var n=i;i=function(t){o(t.target).is(e)&&n(t)}}this.addEventListener(t,e,i),this._handlers[t]=i}},this.removeEventListener=function(t){var e=this._handlers[t];e&&(delete this._handlers[t],p&&this.el.removeEventListener(t,e))},this.focus=function(){p&&this.$el.focus()},this.isTextNode=function(){return p?this.el.nodeType===window.Node.TEXT_NODE:"text"===this.el.type},this.isElementNode=function(){return p?this.el.nodeType===window.Node.ELEMENT_NODE:"tag"===this.el.type},this.isCommentNode=function(){return p?this.el.nodeType===window.Node.COMMENT_NODE:"comment"===this.el.type},this.isDocumentNode=function(){return p?this.el.nodeType===window.Node.DOCUMENT_NODE:this.el===this.el.root},this.getChildNodes=function(){for(var t=[],e=this.getChildNodeIterator();e.hasNext();)t.push(e.next());return t},this.getChildren=function(){var t=this.$el.children();return h(t,function(t){return new s(t)})},this.getChildNodeIterator=function(){var t;return t=p?this.el.childNodes:this.el.children,new s.NodeIterator(t)},this._createNativeElement=function(t){var e;return e=p?this.el.ownerDocument.createElement(t):o._createElement(t,this.el.root)},this.createElement=function(t){var e=this._createNativeElement(t);return new s(e)},this.clone=function(){var t;return t=p?this.el.cloneNode(!0):this.$el.clone()[0],new s(t)},this.is=function(t){return this.$el.is(t)},this.getParent=function(){var t;return t=p?this.el.parentNode:this.el.parent,t?new s(t):null},this.getRoot=function(){for(var t=this.el,e=t;e;)t=e,e=p?t.parentNode:t.parent;return new s(t)},this.find=function(t){var e=null;return e=p&&this.el.querySelector?this.el.querySelector(t):this.$el.find(t)[0],e?new s(e):null},this.findAll=function(t){var e;return e=p&&this.el.querySelectorAll?this.el.querySelectorAll(t):this.$el.find(t),h(e,function(t){return new s(t)})},this.append=function(t){return l(t)?t.forEach(function(t){this.append(t)}.bind(this)):t instanceof s?this.$el.append(t.el):this.$el.append(t),this},this.insertAt=function(t,e){var i=this.children;return t>i.length-1?this.append(e):this.$el.insertBefore(i[t].$el),this},this.removeAt=function(t){return this.children[t].$el.remove(),this},this.empty=function(){return p?this.el.innerHTML="":this.$el.empty(),this},this.remove=function(){this.$el.remove()}},d.extend(s),Object.defineProperties(s.prototype,{tagName:{configurable:!0,get:function(){return this.getTagName()},set:function(t){this.setTagName(t)}},children:{configurable:!0,get:function(){return this.getChildren()},set:function(){throw new Error("ui/DOMElement#children is readonly.")}}}),s.createTextNode=function(t){var e;return e=p?window.document.createTextNode(t):o._createTextNode(t),new s(e)},s.NodeIterator=function(t){this.nodes=t,this.length=this.nodes.length,this.pos=-1},s.NodeIterator.Prototype=function(){this.hasNext=function(){return this.pos<this.length-1},this.next=function(){this.pos+=1;var t=this.nodes[this.pos];return t instanceof s?t:new s(t)},this.back=function(){return this.pos>=0&&(this.pos-=1),this}},r.initClass(s.NodeIterator),s.parseHTML=function(t){return n(t,"html")},s.parseXML=function(t){return n(t,"xml")},e.exports=s},{"../util/jquery":484,"../util/oo":486,"./DOMElement":443,"lodash/each":313,"lodash/extend":315,"lodash/isArray":327,"lodash/isString":340,"lodash/map":346}],446:[function(t,e,i){"use strict";function s(t,e,i){this.owner=t,this.target=e,this.originalEvent=i}e.exports=s},{}],447:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Component"),r=n.$$,o=t("./FontAwesomeIcon");s.Prototype=function(){this.render=function(){return r("div").addClass("sc-dialog-header").append(r("a").addClass("se-back").attr("href","#").on("click",this.handleCancel).append(r(o,{icon:"fa-chevron-left"})),r("div").addClass("se-label").append(this.props.label))},this.handleCancel=function(t){t.preventDefault(),this.send("closeDialog")}},n.extend(s),e.exports=s},{"./Component":437,"./FontAwesomeIcon":448}],448:[function(t,e,i){"use strict";function s(){n.Container.apply(this,arguments)}var n=t("./Component"),r=n.$$;s.Prototype=function(){this.render=function(){return r("i").addClass("fa "+this.props.icon)}},n.Container.extend(s),e.exports=s},{"./Component":437}],449:[function(t,e,i){"use strict";var s=t("../util/EventEmitter"),n=t("lodash/each"),r=t("lodash/without"),o=function(t){s.apply(this,arguments),this.doc=t,this._highlights={}};o.Prototype=function(){this.get=function(){return this._highlights},this.set=function(t){var e=this._highlights,i=this.doc;n(t,function(t,s){var o=e[s]||[],a=r(o,t),l=r(t,o);n(a,function(t){var e=i.get(t);e&&e.setHighlighted(!1,s)}.bind(this)),n(l,function(t){var e=i.get(t);e.setHighlighted(!0,s)}.bind(this))}.bind(this)),this._highlights=t,this.emit("highlights:updated",t)}},s.extend(o),e.exports=o},{"../util/EventEmitter":477,"lodash/each":313,"lodash/without":363}],450:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./AnnotationComponent"),r=t("./Component"),o=r.$$;s.Prototype=function(){this.render=function(){return o("span").attr({"data-inline":1,contentEditable:!1})}},n.extend(s),e.exports=s},{"./AnnotationComponent":431,"./Component":437}],451:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerCommand");s.Prototype=function(){this.getCommandState=function(){var t=this.getDocumentSession();return{disabled:!t.canRedo(),active:!1}},this.execute=function(){var t=this.getDocumentSession();return t.canRedo()?(t.redo(),!0):!1}},n.extend(s),s["static"].name="redo",e.exports=s},{"./ControllerCommand":441}],452:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerTool");n.extend(s),s["static"].name="redo",s["static"].command="redo",e.exports=s},{"./ControllerTool":442}],453:[function(t,e,i){"use strict";var s=t("../util/oo"),n=t("lodash/each"),r=t("../util/jquery"),o=function(t){this.app=t,this.state=[],this.loadState();var e=this;r(window).on("hashchange",function(){e.onHashChange()})};o.Prototype=function(){this.loadState=function(){var t=window.location.hash.slice(1);if(t){var e=this.getStateFromRoute(t);e&&(this.state=e)}},this.getInitialState=function(t){if(!t._isOnRoute)return null;var e=this.getRouteIndex(t),i=this.state[e];return console.log("Router: getInitialState",t,e,i),i},this.truncateState=function(t){if(!this.__disabled__){var e=this.getRouteIndex(t);this.state=this.state.slice(0,e)}},this.getRouteIndex=function(t){for(var e=-1;t&&"root"!==t;)t._isOnRoute&&e++,t=t.getParent();return e},this.updateState=function(t){if(!this.__disabled__){this.state=t.slice(0);var e=this.getRouteFromState(this.state,"state");window.history.pushState({},"","#"+e)}},this.getStateFromRoute=function(t){var e=[],i=t.split(";");return n(i,function(t){var i=t.split(","),s={};n(i,function(t){var e=t.split("=");s[e[0]]=e[1]}),e.push(s)}),e},this.getRouteFromState=function(t){var e=[];return n(t,function(t){var i=[];n(t,function(t,e){"object"!=typeof t&&i.push(e+"="+t)}),e.push(i.join(","))}),e.join(";")},this.onHashChange=function(){var t=window.location.hash.slice(1);this.state=[],t&&(this.state=this.getStateFromRoute(t)||[]),this.__disabled__=!0;for(var e=this.app,i=0;i<this.state.length;i++){var s=this.state[i];if(e.setState(s),e=e.route,!e)break}this.__disabled__=!1},this.isActive=function(){return!this.__disabled__}},s.initClass(o),e.exports=o},{"../util/jquery":484,"../util/oo":486,"lodash/each":313}],454:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerCommand");s.Prototype=function(){this.getCommandState=function(){var t=this.getDocument();return{disabled:!t.__dirty,active:!1}},this.execute=function(){return this.getController().saveDocument(),{status:"saving-process-started"}}},n.extend(s),s["static"].name="save",e.exports=s},{"./ControllerCommand":441}],455:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerTool");n.extend(s),s["static"].name="save",s["static"].command="save",e.exports=s},{"./ControllerTool":442}],456:[function(t,e,i){"use strict";function s(){o.apply(this,arguments),this.props.highlights&&this.props.highlights.on("highlights:updated",this.onHighlightsUpdated,this)}var n=t("../util/jquery"),r=t("../util/platform"),o=t("./Component"),a=t("./Scrollbar"),l=o.$$;s.Prototype=function(){this.didMount=function(){this.refs.scrollbar&&this.context.doc.on("document:changed",this.onDocumentChange,this,{priority:-1})},this.dispose=function(){this.props.highlights&&this.props.highlights.off(this),this.context.doc.off(this)},this.onDocumentChange=function(){this.refs.scrollbar.updatePositions()},this.onHighlightsUpdated=function(t){this.refs.scrollbar.extendProps({highlights:t})},this.render=function(){var t=l("div").addClass("sc-scroll-pane");return r.isFF&&t.addClass("sm-firefox"),"substance"===this.props.scrollbarType&&(t.addClass("sm-substance-scrollbar"),t.addClass("sm-scrollbar-position-"+this.props.scrollbarPosition),t.append(l(a,{scrollPane:this}).ref("scrollbar").attr("id","content-scrollbar")),t.append(l("div").ref("scanline").addClass("se-scanline"))),t.append(l("div").ref("scrollable").addClass("se-scrollable").append(l("div").ref("content").addClass("se-content").append(this.props.children)).on("scroll",this.onScroll)),t},this.onScroll=function(){this.props.onScroll&&this.props.onScroll(this.getScrollPosition(),this.refs.scrollable),this.props.toc&&this.context.toc.markActiveEntry(this)},this.getHeight=function(){var t=this.getScrollableElement();return n(t).height()},this.getContentHeight=function(){var t=0,e=this.refs.content.el;return n(e).children().each(function(){t+=n(this).outerHeight()}),t},this.getContentElement=function(){return this.refs.content.el},this.getScrollableElement=function(){return this.refs.scrollable.el},this.getScrollPosition=function(){var t=this.getScrollableElement();return Math.floor(n(t).scrollTop()+1)},this.getPanelOffsetForElement=function(t){function e(t){var s=t.parentNode;!n(t).hasClass("se-content")&&s&&(("absolute"===n(t).css("position")||"relative"===n(t).css("position"))&&(i+=n(t).position().top),e(s))}var i=n(t).position().top;return e(t.parentNode),i},this.scrollTo=function(t){var e=this.getScrollableElement(),i=n(e).find('*[data-id="'+t+'"]')[0];if(i){var s=this.getPanelOffsetForElement(i);n(e).scrollTop(s)}else console.warn(t,"not found in scrollable container")}},o.extend(s),e.exports=s},{"../util/jquery":484,"../util/platform":487,"./Component":437,"./Scrollbar":457}],457:[function(t,e,i){"use strict";function s(){r.apply(this,arguments),this.onMouseUp=this.onMouseUp.bind(this),this.onMouseMove=this.onMouseMove.bind(this)}var n=t("../util/jquery"),r=t("./Component"),o=r.$$,a=t("lodash/each");s.Prototype=function(){this.didMount=function(){setTimeout(function(){this.updatePositions()}.bind(this)),n(window).on("resize",this.rerender.bind(this));var t=this.props.scrollPane,e=t.getScrollableElement();n(e).on("scroll",this.onScroll.bind(this))},this.dispose=function(){n(window).off("resize")},this.didRender=function(){this.isMounted()&&this.updatePositions()},this.render=function(){var t=o("div").addClass("sc-scrollbar").on("mousedown",this.onMouseDown);if(this.props.highlights){var e=[];a(this.props.highlights,function(t,i){a(t,function(t){e.push(o("div").ref(t).addClass("se-highlight sm-"+i))})}),t.append(o("div").ref("highlights").addClass("se-highlights").append(e))}return t.append(o("div").ref("thumb").addClass("se-thumb")),t},this.onScroll=function(){this.updatePositions()},this.updatePositions=function(){var t=this.props.scrollPane,e=t.getScrollableElement(),i=t.getContentHeight(),r=t.getHeight(),o=t.getScrollPosition();this.factor=i/r,this.refs.thumb.css({top:o/this.factor,height:r/this.factor}),this.props.highlights&&a(this.props.highlights,function(t){a(t,function(t){var i=n(e).find('*[data-id="'+t+'"]');if(i.length){var r=i.position().top/this.factor,o=i.outerHeight(!0)/this.factor;o<s.overlayMinHeight&&(o=s.overlayMinHeight);var a=this.refs[t];a?this.refs[t].css({top:r,height:o}):console.warn("no ref found for highlight",t)}}.bind(this))}.bind(this))},this.onMouseDown=function(t){t.stopPropagation(),t.preventDefault(),this._mouseDown=!0,n(window).on("mousemove",this.onMouseMove),n(window).on("mouseup",this.onMouseUp);var e=this.$el.offset().top,i=t.pageY-e,s=this.refs.thumb.$el;t.target!==s[0]?(this.offset=s.height()/2,this.onMouseMove(t)):this.offset=i-s.position().top},this.onMouseUp=function(){this._mouseDown=!1,n(window).off("mousemove",this.onMouseMove),n(window).off("mouseup",this.onMouseUp)},this.onMouseMove=function(t){if(this._mouseDown){var e=this.props.scrollPane,i=e.getScrollableElement(),s=this.$el.offset().top,r=t.pageY-s,o=(r-this.offset)*this.factor;this.scrollTop=n(i).scrollTop(o)}}},r.extend(s),s.overlayMinHeight=2,e.exports=s},{"../util/jquery":484,"./Component":437,"lodash/each":313}],458:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Component"),r=n.$$;s.Prototype=function(){this.getSizedStyle=function(t){return t&&"inherit"!==t?"horizontal"===this.props.splitType?{height:t}:{width:t}:{}},this.render=function(){if(2!==this.props.children.length)throw new Error("SplitPane only works with exactly two child elements");var t=r("div").addClass("sc-split-pane");"horizontal"===this.props.splitType?t.addClass("sm-horizontal"):t.addClass("sm-vertical");var e=this.props.children[0],i=this.props.children[1];return this.props.sizeB?(i.addClass("se-pane sm-sized"),i.css(this.getSizedStyle(this.props.sizeB)),e.addClass("se-pane sm-auto-fill")):(e.addClass("se-pane sm-sized"),e.css(this.getSizedStyle(this.props.sizeA)),i.addClass("se-pane sm-auto-fill")),t.append(e,i),t}},n.extend(s),e.exports=s},{"./Component":437}],459:[function(t,e,i){"use strict";function s(){n.apply(this,arguments);var t=this.context.controller,e=t.getLogger();e.on("messages:updated",this.handleStatusUpdate,this)}var n=t("./Component"),r=n.$$,o={error:"fa-exclamation-circle",info:"fa-info",progress:"fa-exchange",success:"fa-check-circle"};s.Prototype=function(){this.dispose=function(){var t=this.context.controller,e=t.getLogger();e.off(this)},this.render=function(){var t=this.props.doc.getDocumentMeta(),e=t?t.title:this.i18n.t("untitled"),i=this.state.message,s=r("div").addClass("status-bar-component fill-light");return s.append(r("div").addClass("document-status").append(e)),i&&(s.addClass(i.type),s.append(r("div").addClass("notifications").append(r("div").addClass("icon").append(r("i").addClass("fa "+o[i.type]))),r("div").addClass("message").append(i.message))),s},this.handleStatusUpdate=function(t){var e=t.pop();this.setState({message:e})}},n.extend(s),e.exports=s},{"./Component":437}],460:[function(t,e,i){"use strict";function s(){if(s["super"].apply(this,arguments),this.controller=this.context.controller||this.props.controller,!this.controller)throw new Error("Surface needs a valid controller");if(this.documentSession=this.controller.getDocumentSession(),this.name=this.props.name,!this.name)throw new Error("No id provided");this.clipboard=new m(this);var t=this.documentSession.getDocument();this.domSelection=null,this.onDomMutations=this.onDomMutations.bind(this),this.domObserver=new window.MutationObserver(this.onDomMutations),this.domObserverConfig={subtree:!0,characterData:!0},this.skipNextObservation=!1,this.$document=n(window.document),this.onMouseUp=this.onMouseUp.bind(this),this.enabled=!0,this.undoEnabled=!0,this.textTypes=this.props.textTypes,this._initializeCommandRegistry(this.props.commands),this.controller.registerSurface(this),this._textProperties={},this._annotations={},t.on("document:changed",this.onDocumentChange,this),this.documentSession.on("selection:changed:explicitly",this.onSelectionChange,this),this.documentSession.on("collaborators:changed",this.onCollaboratorsChange,this)}var n=t("../util/jquery"),r=t("lodash/isEqual"),o=t("lodash/each"),a=t("lodash/extend"),l=t("../util/platform"),u=t("../util/Registry"),c=t("../model/Selection"),h=t("../model/transform/copySelection"),p=t("../model/transform/insertText"),d=t("../model/transform/deleteSelection"),f=t("./DOMSelection"),m=t("./Clipboard"),g=t("./Component"),b=g.$$,v=t("./UnsupportedNode"),y=t("../util/keys");s.Prototype=function(){this.render=function(){var t=this.props.tagName||"div",e=b(t).addClass("sc-surface").attr("spellCheck",!1).attr("tabindex",2);return this.isEditable()&&(e.on("keydown",this.onKeyDown),l.isIE||e.on("compositionstart",this.onCompositionStart),window.TextEvent&&!l.isIE?e.on("textInput",this.onTextInput):e.on("keypress",this.onTextInputShim)),this.isReadonly()||(e.on("mousedown",this.onMouseDown),e.on("dragstart",this.onDragStart),e.on("focus",this.onNativeFocus),e.on("blur",this.onNativeBlur),this.clipboard.attach(e)),e},this.didMount=function(){this.isReadonly()||(this.domSelection=new f(this),this.clipboard.didMount(),this.domObserver.observe(this.el,this.domObserverConfig),this._rerenderSelection())},this.dispose=function(){var t=this.getDocument();t.off(this),this.domSelection=null,this.domObserver.disconnect(),this.getController().unregisterSurface(this)},this.getChildContext=function(){return{surface:this,doc:this.getDocument()}},this.getName=function(){return this.name},this.isEditable=function(){return"full"===this.props.editing||void 0===this.props.editing},this.isSelectable=function(){return"selection"===this.props.editing||"full"===this.props.editing},this.isReadonly=function(){return"readonly"===this.props.editing},this.getCommand=function(t){return this.commandRegistry.get(t)},this.executeCommand=function(t,e){var i=this.getCommand(t);if(!i)return void console.warn("command",t,"not registered on controller");var s=i.execute(e);s?this.emit("command:executed",s,t,i):void 0===s&&console.warn("command ",t,"must return either an info object or true when handled or false when not handled")},this.getElement=function(){return this.el},this.getController=function(){return this.controller},this.getDocument=function(){return this.documentSession.getDocument()},this.getDocumentSession=function(){return this.documentSession},this.enable=function(){console.log("TODO: enable all contained TextProperties"),this.enabled=!0},this.disable=function(){console.log("TODO: disable all contained TextProperties"),this.enabled=!1},this.isEnabled=function(){return this.enabled},this.isContainerEditor=function(){return!1},this.transaction=function(t){var e=this.documentSession,i=this.getName();e.transaction(function(e,s){return e.before.surfaceId=i,t(e,s)})},this.setFocused=function(){console.log("DEPRECATED: this is should not be necessary anymore."),console.log("Maybe you want the native focus? then you can try surface.focus()")},this.getSelection=function(){return this.documentSession.getSelection()},this.setSelection=function(t){t.isNull()||(t.surfaceId=this.name),this._setSelection(t)},this.setSelectionFromEvent=function(t){if(this.domSelection){this.skipNextFocusEvent=!0;var e=s.getDOMRangeFromEvent(t),i=this.domSelection.getSelectionFromDOMRange(e),n=this.getDocument().createSelection(i);this.setSelection(n)}},this.rerenderDomSelection=function(){if(this.domSelection){var t=this.domSelection,e=this.getSelection();t.setSelection(e)}},this.getDomNodeForId=function(t){return this.getElement().querySelector('*[data-id="'+t+'"]')},this.selectAll=function(){var t=this.getDocument(),e=this.getSelection();if(e.isPropertySelection()){var i=e.path,s=t.get(i);e=t.createSelection({type:"property",path:i,startOffset:0,endOffset:s.length}),this.setSelection(e)}},this.insertText=function(t,e){var i=e.selection;return i.isPropertySelection()||i.isContainerSelection()?p(t,e):void 0},this["delete"]=function(t,e){return d(t,e)},this["break"]=function(t,e){return this.softBreak(t,e)},this.softBreak=function(t,e){return e.text="\n",this.insertText(t,e)},this.copy=function(t,e){var i=h(t,{selection:e});return i.doc},this.paste=function(t,e){return e.text?this.insertText(t,e):void 0},this.onDocumentChange=function(t,e){var i=this._updateSelectionFragments();t.updated.forEach(function(t,e){i[e]=!0}),this._updateTextProperties(i),this.domSelection&&!e.remote&&t.after.surfaceId===this.getName()&&(this.isNativeFocused||(this.skipNextFocusEvent=!0,this.focus()),this.rerenderDomSelection()),this.emit("selection:changed",this.getSelection(),this)},this._rerenderSelection=function(){var t=this._updateSelectionFragments();this._updateTextProperties(t),this.domSelection&&this.isNativeFocused&&this.rerenderDomSelection()},this.onSelectionChange=function(){this._rerenderSelection(),this.emit("selection:changed",this.getSelection(),this)},this.onCollaboratorsChange=function(){this._rerenderSelection()},this.onKeyDown=function(t){if(229!==t.which){switch(t.keyCode){case y.LEFT:case y.RIGHT:return this._handleLeftOrRightArrowKey(t);case y.UP:case y.DOWN:return this._handleUpOrDownArrowKey(t);case y.ENTER:return this._handleEnterKey(t);case y.SPACE:return this._handleSpaceKey(t);case y.BACKSPACE:case y.DELETE:return this._handleDeleteKey(t)}var e=!1;(t.ctrlKey||t.metaKey)&&65===t.keyCode?(this.selectAll(),e=!0):this.undoEnabled&&90===t.keyCode&&(t.metaKey||t.ctrlKey)?(t.shiftKey?this.getController().executeCommand("redo"):this.getController().executeCommand("undo"),e=!0):66===t.keyCode&&(t.metaKey||t.ctrlKey)?(this.executeCommand("strong"),e=!0):73===t.keyCode&&(t.metaKey||t.ctrlKey)?(this.executeCommand("emphasis"),e=!0):76===t.keyCode&&(t.metaKey||t.ctrlKey)&&(this.executeCommand("link"),e=!0),e&&(t.preventDefault(),t.stopPropagation())}},this.onTextInput=function(t){t.data&&(t.preventDefault(),t.stopPropagation(),this.skipNextObservation=!0,this.transaction(function(e,i){return this.domSelection&&this.domSelection.clear(),i.text=t.data,this.insertText(e,i)}.bind(this)))},this.onCompositionStart=function(){this.skipNextObservation=!0},this.onTextInputShim=function(t){if(!(0===t.which||0===t.charCode||t.keyCode===y.TAB||t.keyCode===y.ESCAPE||t.metaKey||!!t.ctrlKey^!!t.altKey)){var e=String.fromCharCode(t.which);return this.skipNextObservation=!0,t.shiftKey||(e=e.toLowerCase()),e.length>0?(this.transaction(function(t,i){return this.domSelection&&this.domSelection.clear(),i.text=e,this.insertText(t,i)}.bind(this)),t.preventDefault(),void t.stopPropagation()):(t.preventDefault(),void t.stopPropagation())}},this.onMouseDown=function(t){if(!(l.isIE&&l.version<12)&&t.detail>=3){var e=this.getSelection();if(e.isPropertySelection())return this._selectProperty(e.path),t.preventDefault(),void t.stopPropagation();if(e.isContainerSelection())return this._selectProperty(e.startPath),t.preventDefault(),void t.stopPropagation()}1===t.which&&(this.skipNextFocusEvent=!0,this.$document.one("mouseup",this.onMouseUp))},this.onMouseUp=function(){setTimeout(function(){if(this.domSelection){var t=this.domSelection.getSelection();this.setSelection(t)}}.bind(this))},this.onDomMutations=function(){return this.skipNextObservation?void(this.skipNextObservation=!1):void console.info("We want to enable a DOM MutationObserver which catches all changes made by native interfaces (such as spell corrections, etc). Lookout for this message and try to set Surface.skipNextObservation=true when you know that you will mutate the DOM.")},this.onDragStart=function(t){t.preventDefault(),t.stopPropagation()},this.onNativeBlur=function(){this.isNativeFocused=!1,this.skipNextFocusEvent=!1;var t=this.getSelection();t&&t.isCollapsed()&&this._rerenderSelection()},this.onNativeFocus=function(){if(this.isNativeFocused=!0,this.skipNextFocusEvent)return void(this.skipNextFocusEvent=!1);var t=this.getSelection();if(!t||t.isNull()||t.surfaceId!==this.getName()){var e=this.el.querySelector("*[data-path]");if(e){var i=e.dataset.path.split(".");this.setSelection(c.create(i,0))}else console.error("FIXME: can not set selection after focus.")}else this._rerenderSelection()},this._initializeCommandRegistry=function(t){var e=new u;o(t,function(t){var i=a({},this.context,this.getChildContext()),s=new t(i);e.add(t["static"].name,s)}.bind(this)),this.commandRegistry=e},this._handleLeftOrRightArrowKey=function(t){var e=this;window.setTimeout(function(){if(!e._isDisposed()){var i={direction:t.keyCode===y.LEFT?"left":"right"};e._updateModelSelection(i)}})},this._handleUpOrDownArrowKey=function(t){var e=this;window.setTimeout(function(){if(!e._isDisposed()){var i={direction:t.keyCode===y.UP?"left":"right"};e._updateModelSelection(i)}})},this._isDisposed=function(){return!this.domSelection},this._handleSpaceKey=function(t){t.preventDefault(),t.stopPropagation(),this.transaction(function(t,e){return this.domSelection.clear(),e.text=" ",this.insertText(t,e)}.bind(this))},this._handleEnterKey=function(t){t.preventDefault(),t.shiftKey?this.transaction(function(t,e){return this.softBreak(t,e)}.bind(this)):this.transaction(function(t,e){return this["break"](t,e)}.bind(this))},this._handleDeleteKey=function(t){t.preventDefault();var e=t.keyCode===y.BACKSPACE?"left":"right";this.transaction(function(t,i){return i.direction=e,this["delete"](t,i)}.bind(this))},this._setSelection=function(t){this.documentSession.setSelection(t),l.isFF&&!t.isNull()&&this.el&&!this.isNativeFocused&&(this.skipNextFocusEvent=!0,this.el.focus())},this._updateModelSelection=function(t){var e=this.domSelection.getSelection(t);this.setSelection(e)},this._selectProperty=function(t){var e=this.getDocument(),i=e.get(t);this.setSelection(e.createSelection(t,0,i.length))},this.getBoundingRectangleForSelection=function(){var t=window.getSelection();if(t.rangeCount>0){var e=t.getRangeAt(0);if(e.collapsed){var i=document.createElement("span");this.skipNextObservation=!0,i.appendChild(window.document.createTextNode("")),e.insertNode(i);var s=i.getBoundingClientRect(),n=i.parentNode;return n.removeChild(i),n.normalize(),s}return e.getBoundingClientRect()}var r=this.getSelection();if(r.isNull())return{};if(r.isCollapsed()){var o=this.el.querySelector(".se-cursor");return o?o.getBoundingClientRect():(console.log("FIXME: there should be a rendered cursor element."),{})}var a=this.el.querySelectorAll(".se-selection-fragment");if(a.length>0){var l=0,u=0,c=0,h=0;a.forEach(function(t){var e=t.getBoundingClientRect();l=Math.max(e.bottom,l),u=Math.min(e.top,u),h=Math.min(e.left,h),c=Math.max(e.right,c)});var p=l-u,d=c-h;return{top:u,bottom:l,left:h,right:c,width:d,height:p}}console.log("FIXME: there should be a rendered selection fragments element.")},this._registerTextProperty=function(t,e){this._textProperties[t]=e},this._unregisterTextProperty=function(t){delete this._textProperties[t],o(this._annotations,function(e,i){r(t,e)&&delete this._annotations[i]}.bind(this))},this._getTextPropertyComponent=function(t){return this._textProperties[t]},this._getFragments=function(t){var e=[];if(this._selectionFragments){var i=this._selectionFragments[t];i&&(e=e.concat(i))}return e},this._computeSelectionFragments=function(t,e,i){if(e=e||{},t&&!t.isNull()){var s=t.getFragments();s.forEach(function(t){var s=t.path.toString(),n=e[s];n||(n=[],e[s]=n),t.collaborator=i,n.push(t)})}return e},this._updateSelectionFragments=function(){var t={},e=this._selectionFragments,i={},s=this.getSelection();this.isNativeFocused&&s.isCollapsed()||this._computeSelectionFragments(s,i);var n=this.getDocumentSession().getCollaborators();return n&&o(n,function(t){this._computeSelectionFragments(t.selection,i,t)}.bind(this)),this._selectionFragments=i,o(e,function(e,i){t[i]=!0}),o(i,function(e,i){t[i]=!0}),t},this._updateTextProperties=function(t){o(t,function(t,e){var i=this._textProperties[e];i&&i.rerender()}.bind(this))},this._renderNode=function(t){var e=this.getDocument(),i=e.get(t),s=this.context.componentRegistry||this.props.componentRegistry,n=s.get(i.type);return n||(console.error("Could not resolve a component for type: "+i.type),n=v),b(n,{doc:e,node:i})}},g.extend(s),s.getDOMRangeFromEvent=function(t){var e,i=t.clientX,s=t.clientY;if(document.body.createTextRange)e=document.body.createTextRange(),e.moveToPoint(i,s);else if("undefined"!=typeof document.createRange)if("undefined"!=typeof t.rangeParent)e=document.createRange(),e.setStart(t.rangeParent,t.rangeOffset),e.collapse(!0);else if(document.caretPositionFromPoint){var n=document.caretPositionFromPoint(i,s);e=document.createRange(),e.setStart(n.offsetNode,n.offset),e.collapse(!0)}else document.caretRangeFromPoint&&(e=document.caretRangeFromPoint(i,s));return e},e.exports=s},{"../model/Selection":112,"../model/transform/copySelection":133,"../model/transform/deleteSelection":138,"../model/transform/insertText":143,"../util/Registry":479,"../util/jquery":484,"../util/keys":485,"../util/platform":487,"./Clipboard":433,"./Component":437,"./DOMSelection":444,"./UnsupportedNode":474,"lodash/each":313,"lodash/extend":315,"lodash/isEqual":332}],461:[function(t,e,i){
"use strict";var s=t("./Command"),n=function(t){this.context=t,this.surface=t.surface};n.Prototype=function(){this.getSurface=function(){return this.surface},this.getSelection=function(){var t=this.getSurface();return t.getSelection()},this.getContainerId=function(){var t=this.getSurface();return console.warn("Deprecated: Use Surface API directly"),t.isContainerEditor()?t.getContainerId():null},this.getDocument=function(){var t=this.getSurface();return t.getDocument()},this.execute=function(){throw new Error("execute must be implemented by custom commands")}},s.extend(n),e.exports=n},{"./Command":436}],462:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./Tool");s.Prototype=function(){var t=Object.getPrototypeOf(this);this.getCommand=function(){var t=this.getController(),e=t.getFocusedSurface();if(e){var i=this.constructor["static"].command;if(i)return e.getCommand(i);throw new Error("Contract: AnnotationTool.static.command should be associated to a supported command.")}},this.dispose=function(){t.dispose.call(this);var e=this.getController();e.off(this)},this.getSurface=function(){return this.getController().getFocusedSurface()},this.getDocument=function(){return this.getController().getDocument()},this.getContainer=function(){var t=this.getSurface();return t?t.getContainer():void 0},this.performAction=function(){var t=this.getSurface();t.executeCommand(this.constructor["static"].command)}},n.extend(s),e.exports=s},{"./Tool":468}],463:[function(t,e,i){"use strict";function s(t){a.apply(this,arguments),this.controller=t,this.entries=this.computeEntries(),this.entries.length>0?this.activeEntry=this.entries[0].id:this.activeEntry=null;var e=this.getDocument();e.connect(this,{"document:changed":this.handleDocumentChange})}var n=t("lodash/each"),r=t("lodash/includes"),o=t("lodash/head"),a=t("../util/EventEmitter"),l=t("../util/jquery");s.Prototype=function(){this.dispose=function(){var t=this.getDocument();t.disconnect(this)},this.handleDocumentChange=function(t){for(var e=this.getDocument(),i=!1,s=this.constructor["static"].tocTypes,n=0;n<t.ops.length;n++){var o,a=t.ops[n];if(a.isCreate()||a.isDelete()){var l=a.getValue();if(o=l.type,r(s,o)){i=!0;break}}else{var u=a.path[0],c=e.get(u);if(c&&r(s,c.type)){i=!0;break}}}i&&(this.entries=this.computeEntries(),this.emit("toc:updated"))},this.computeEntries=function(){var t=this.getDocument(),e=this.controller.getConfig(),i=[],s=t.get(e.containerId).nodes;return n(s,function(e){var s=t.get(e);"heading"===s.type&&i.push({id:s.id,name:s.content,level:s.level,node:s})}),i},this.getEntries=function(){return this.entries},this.getDocument=function(){return this.controller.getDocument()},this.getConfig=function(){return this.controller.getConfig()},this.markActiveEntry=function(t){var e=l(t.getContentElement()),i=t.getContentHeight(),s=t.getHeight(),n=t.getScrollPosition(),r=n+s,a=n,u=2*r-i,c=Math.max(a,u),h=this.computeEntries();if(0!==h.length){var p=o(h).id;h.forEach(function(i){var s=e.find('[data-id="'+i.id+'"]')[0];if(!s)return void console.warn("Not found in Content panel",i.id);var n=t.getPanelOffsetForElement(s);c>=n&&(p=i.id)}.bind(this)),this.activeEntry!==p&&(this.activeEntry=p,this.emit("toc:updated"))}}},a.extend(s),s["static"].tocTypes=["heading"],e.exports=s},{"../util/EventEmitter":477,"../util/jquery":484,"lodash/each":313,"lodash/head":322,"lodash/includes":324}],464:[function(t,e,i){"use strict";function s(){r.apply(this,arguments);var t=this.context.toc;t.connect(this,{"toc:updated":this.onTOCUpdated})}var n=t("lodash/each"),r=t("./Component"),o=t("./ScrollPane"),a=r.$$,l=t("./FontAwesomeIcon");s.Prototype=function(){this.getDocument=function(){return this.context.doc},this.onTOCUpdated=function(){this.rerender()},this.dispose=function(){var t=this.context.toc;t.disconnect(this)},this.render=function(){var t=this.context.toc,e=t.activeEntry,i=a("div").addClass("se-toc-entries").ref("tocEntries");n(t.getEntries(),function(t){var s=t.level,n=a("a").addClass("se-toc-entry").addClass("sm-level-"+s).attr({href:"#","data-id":t.id}).ref(t.id).on("click",this.handleClick).append(a(l,{icon:"fa-caret-right"}),t.name);e===t.id&&n.addClass("sm-active"),i.append(n)}.bind(this));var s=a("div").addClass("sc-toc-panel").append(a(o).ref("panelEl").append(i));return s},this.handleClick=function(t){var e=t.currentTarget.dataset.id;t.preventDefault(),this.send("tocEntrySelected",e)}},r.extend(s),e.exports=s},{"./Component":437,"./FontAwesomeIcon":448,"./ScrollPane":456,"lodash/each":313}],465:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Component"),r=t("lodash/each"),o=n.$$;s.Prototype=function(){this.render=function(){var t=o("div").addClass("sc-tabbed-pane"),e=o("div").addClass("se-tabs");return r(this.props.tabs,function(t){var i=o("a").addClass("se-tab").attr({href:"#","data-id":t.id}).on("click",this.onTabClicked);t.id===this.props.activeTab&&i.addClass("sm-active"),i.append(o("span").addClass("label").append(t.name)),e.append(i)}.bind(this)),t.append(e),t.append(o("div").addClass("se-tab-content").ref("tabContent").append(this.props.children)),t},this.onTabClicked=function(t){t.preventDefault();var e=t.currentTarget.dataset.id;this.send("switchTab",e)}},n.extend(s),e.exports=s},{"./Component":437,"lodash/each":313}],466:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}function n(t,e,i){for(var s={el:null,path:null,node:e,offset:i};;){if(!e||e===t)return null;if(1===e.nodeType){if(e.dataset&&e.dataset.path)return s.el=e,s.path=e.dataset.path.split("."),s;e.dataset&&e.dataset.inline&&(s.node=e,i>0&&(s.offset=1))}e=e.parentNode}return null}function r(t,e){var i,s,n=e;if(i=t.parentNode,3===t.nodeType)t===i.firstChild?n=i.dataset.path?e:i.dataset.offset?parseInt(i.dataset.offset,10)+e:r(i,0)+e:(s=Array.prototype.indexOf.call(i.childNodes,t),n=r(i,s)+e);else{if(1!==t.nodeType)return null;var a=t.dataset;a&&a.path?n=o(t,e):a&&a.offset?(s=Array.prototype.indexOf.call(i.childNodes,t),n=parseInt(a.offset,10)+o(t,e)):(s=Array.prototype.indexOf.call(i.childNodes,t),n=r(i,s)+o(t,e))}return n}function o(t,e){var i=0;if(t.dataset&&t.dataset.inline)return 0===e?0:1;var s=t.childNodes.length;1===arguments.length&&(e=s),e=Math.min(s,e);for(var n=0,r=t.firstChild;e>n;r=r.nextSibling,n++)if(3===r.nodeType)i+=r.length;else if(1===r.nodeType){var a=r.dataset;i+=a&&a.inline?1:a&&a.length?parseInt(a.length,10):o(r)}return i}var a=t("lodash/isNumber"),l=t("./AnnotatedTextComponent"),u=t("./Component"),c=u.$$,h=t("../model/Coordinate");s.Prototype=function(){var t=Object.getPrototypeOf(this);this.render=function(){var t=this.props.path,e=this._renderContent().addClass("sc-text-property").attr({"data-path":t.join("."),spellCheck:!1}).css({whiteSpace:"pre-wrap"});return e.append(c("br")),e},this._renderFragment=function(e){var i,s=e.node,n=s.id;return"cursor"===s.type||"selection-fragment"===s.type?(i=c("span").addClass("se-"+s.type),s.collaborator?i.addClass("sm-collaborator-"+s.collaborator.colorIndex):i.addClass("sm-local-user")):(i=t._renderFragment.call(this,e),s.constructor["static"].isInline&&i.attr({contentEditable:!1,"data-inline":"1","data-length":1}),this.context.config&&this.context.config.preservativeTextPropertyRendering&&i.ref(n+"@"+e.counter)),i.attr("data-offset",e.pos),i},this._finishFragment=function(t,e,i){e.attr("data-length",t.length),i.append(e)},this.didMount=function(){var t=this.getSurface();t&&t._registerTextProperty(this.props.path,this)},this.dispose=function(){t.dispose.call(this);var e=this.getSurface();e&&e._unregisterTextProperty(this.props.path,this)},this.getText=function(){return this.getDocument().get(this.props.path)},this.getAnnotations=function(){var t=this.getDocument().getIndex("annotations").get(this.props.path),e=this.getSurface();if(e){var i=e._getFragments(this.props.path);i&&(t=t.concat(i))}return t},this.setFragments=function(){this.children[0].extendProps({annotations:this.getAnnotations()})},this.getDocument=function(){return this.props.doc||this.context.doc},this.getController=function(){return this.props.controller||this.context.controller},this.getSurface=function(){return this.props.surface||this.context.surface},this.isEditable=function(){return this.getSurface().isEditable()},this.isReadonly=function(){return this.getSurface().isReadonly()},this.getDOMCoordinate=function(t){return this._getDOMCoordinate(this.el,t)},this._getDOMCoordinate=function(t,e){var i,s=0;if(0===e)return{container:t,offset:0};for(var n=t.firstChild;n;n=n.nextSibling,s++)if(3===n.nodeType){if(i=n.length,i>=e)return{container:n,offset:e};e-=i}else if(1===n.nodeType){if(!n.dataset||!n.dataset.length)return console.error("FIXME: Can not map to DOM coordinates."),null;if(i=parseInt(n.dataset.length,10),i>=e)return this._getDOMCoordinate(n,e,s);e-=i}}},l.extend(s),s.getCoordinate=function(t,e,i){var s=n(t,e,i);if(!s)return null;e=s.node,i=s.offset;var o=r(s.node,s.offset);return a(o)?new h(s.path,o):null},e.exports=s},{"../model/Coordinate":88,"./AnnotatedTextComponent":429,"./Component":437,"lodash/isNumber":337}],467:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Surface"),r=t("./Component"),o=t("./TextPropertyComponent"),a=r.$$;s.Prototype=function(){this.render=function(){var t=n.prototype.render.call(this);return t.addClass("sc-text-property-editor"),t.append(a(o,{tagName:"div",path:this.props.path})),this.isEditable()&&t.attr("contenteditable",!0),t},this.selectAll=function(){var t=this.getDocument(),e=this.props.path,i=t.get(e),s=t.createSelection({type:"property",path:e,startOffset:0,endOffset:i.length});this.setSelection(s)}},n.extend(s),e.exports=s},{"./Component":437,"./Surface":460,"./TextPropertyComponent":466}],468:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./Component"),r=t("lodash/capitalize"),o=n.$$;s.Prototype=function(){this.getInitialState=function(){return this.context.toolManager.getCommandState(this)},this.didMount=function(){this.context.toolManager.registerTool(this)},this.dispose=function(){this.context.toolManager.unregisterTool(this)},this.render=function(){var t=o("div").addClass("se-tool"),e=this.getTitle();e&&(t.attr("title",e),t.attr("aria-label",e));var i=o("button").on("click",this.onClick).append(this.props.children);return t.append(i),this.state.disabled?(t.addClass("sm-disabled"),i.attr("tabindex",-1)):i.attr("tabindex",1),this.state.active&&t.addClass("sm-active"),this.state.mode&&t.addClass(this.state.mode),t},this.getTitle=function(){var t=this.props.title||this.i18n.t(this.getName());return this.state.mode&&(t=[r(this.state.mode),t].join(" ")),t},this.getController=function(){return this.context.controller},this.getName=function(){var t=this.constructor["static"].name;if(t)return t;throw new Error("Contract: Tool.static.name must have a value")},this.onClick=function(t){t.preventDefault(),t.stopPropagation(),this.state.disabled||this.performAction()}},n.extend(s),e.exports=s},{"./Component":437,"lodash/capitalize":307}],469:[function(t,e,i){"use strict";function s(t){if(!t)throw new Error("Illegal arguments: controller is mandatory.");this.controller=t,this.tools=[];var e=this.controller.getDocumentSession();e.on("selection:changed",this.updateTools,this),this.controller.on("document:saved",this.updateTools,this)}var n=t("../util/oo"),r=t("./ControllerTool"),o=t("./SurfaceTool"),a=t("lodash/without"),l={disabled:!0,active:!1};s.Prototype=function(){this.dispose=function(){var t=this.controller.getDocumentSession();t.off(this),this.controller.off(this)},this.getCommandState=function(t){var e=this.getCommand(t);return e?e.getCommandState():l},this.registerTool=function(t){this.tools.push(t)},this.unregisterTool=function(t){this.tools=a(this.tools,t)},this.getCommand=function(t){var e=t.constructor["static"].command;if(t instanceof o){var i=this.controller.getFocusedSurface();return i?i.getCommand(e):!1}return t instanceof r?this.controller.getCommand(e):void 0},this.updateTools=function(){this.tools.forEach(function(t){var e=this.getCommandState(t);t.setState(e)}.bind(this))}},n.initClass(s),e.exports=s},{"../util/oo":486,"./ControllerTool":442,"./SurfaceTool":462,"lodash/without":363}],470:[function(t,e,i){"use strict";function s(){o.apply(this,arguments)}function n(){o.apply(this,arguments)}function r(){o.apply(this,arguments)}var o=t("./Component"),a=o.$$,l=t("../util/jquery");s.Prototype=function(){this.render=function(){var t=a("div").addClass("sc-toolbar");return t.append(this.props.children),t}},o.extend(s),n.Prototype=function(){this.getInitialState=function(){return{open:!1}},this.render=function(){var t=a("div").addClass("se-toolbar-dropdown");return this.state.open&&t.addClass("sm-open"),t.append(a("button").ref("toggle").addClass("se-toggle").attr("title",this.props.title).append(this.props.label).on("click",this.handleDropdownToggle),a("div").ref("options").addClass("se-options").append(this.props.children)),t},this.handleClick=function(t){t.preventDefault()},this.handleDropdownToggle=function(t){t.preventDefault();var e=this.state.open,i=this;e||(this.setState({open:!this.state.open}),setTimeout(function(){l(window).one("click",function(t){i.close()})},0))},this.close=function(){this.setState({open:!1})}},o.extend(n),r.Prototype=function(){this.render=function(){var t=a("div").addClass("se-toolbar-group");return t.append(this.props.children),t}},o.extend(r),s.Group=r,s.Dropdown=n,e.exports=s},{"../util/jquery":484,"./Component":437}],471:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments),this.toc=new u(this),this.contentHighlights=new c(this.getDocument()),this.handleApplicationKeyCombos=this.handleApplicationKeyCombos.bind(this),this.handleActions({switchState:this.switchState,switchTab:this.switchContext,switchContext:this.switchContext,tocEntrySelected:this.tocEntrySelected,closeDialog:this.closeDialog})}var n=t("lodash/extend"),r=t("lodash/omit"),o=t("./Controller"),a=t("./Component"),l=a.$$,u=t("./TOC"),c=t("./Highlights"),h=t("./TabbedPane"),p=t("./SplitPane"),d=t("./StatusBar"),f=t("./Toolbar"),m=t("./ScrollPane"),g=t("./ContainerEditor"),b=t("./i18n");b.instance.load(t("../i18n/en")),s.Prototype=function(){var t=Object.getPrototypeOf(this);this.getChildContext=function(){var e=t.getChildContext.call(this);return n(e,{toc:this.toc,i18n:b.instance})},this.getInitialState=function(){return{contextId:"toc"}},this.getContentPanel=function(){throw new Error("This method is abstract.")},this.didMount=function(){this.state.nodeId&&"toc"===this.state.contextId&&this.getContentPanel().scrollTo(this.state.nodeId)},this.didUpdateState=function(){this.state.nodeId&&"toc"===this.state.contextId&&this.getContentPanel().scrollTo(this.state.nodeId)},this.render=function(){return t.render.call(this).append(l(p,{splitType:"horizontal",sizeB:"inherit"}).append(l(p,{splitType:"vertical",sizeA:"60%"}).append(this._renderMainSection(),this._renderContextSection()).ref("splitPane"),l(d,{doc:this.getDocument()}).ref("statusBar")).ref("workspaceSplitPane"))},this._renderToolbar=function(){return l(f).ref("toolbar")},this._renderMainSection=function(){return l("div").ref("main").addClass("se-main-section").append(l(p,{splitType:"horizontal"}).append(this._renderToolbar(),l(m,{scrollbarType:"substance",scrollbarPosition:"left",toc:this.toc,highlights:this.contentHighlights}).ref("contentPanel").append(this._renderContentPanel())).ref("mainSectionSplitPane"))},this._renderContentPanel=function(){var t=this.getConfig(),e=t.containerId,i=t[e];return l("div").ref("main").addClass("document-content").append(l(g,{name:"main",containerId:e,commands:i.commands,textTypes:i.textTypes}).ref("mainEditor"))},this._renderContextSection=function(){var t=this.getConfig(),e=this._panelPropsFromState(),i=this.state.contextId,s=t.panels||{},n=s[this.state.contextId]||{},r=t.tabOrder||[],o=this.componentRegistry.get(i),a=r.map(function(t){return{id:t,name:this.i18n.t(t)}}.bind(this)),u=l("div").addClass("se-context-section").ref("contextSection"),c=l(o,e).ref(i);return n.isDialog?u.append(c):u.append(l(h,{activeTab:i,tabs:a}).ref(this.state.contextId).append(c)),u},this.switchState=function(t,e){e=e||{},this.setState(t),e.restoreSelection&&this.restoreSelection()},this.switchContext=function(t,e){e=e||{},this.setState({contextId:t}),e.restoreSelection&&this.restoreSelection()},this.tocEntrySelected=function(t){this.extendState({nodeId:t})},this.closeDialog=function(){this.setState({contextId:"toc"})},this.restoreSelection=function(){var t=this.getSurface("body");t.rerenderDomSelection()},this.uploadFile=function(t,e){if(this.props.onUploadFile)return this.props.onUploadFile(t,e);var i=window.URL.createObjectURL(t);e(null,i)},this.handleStateUpdate=function(t){},this._panelPropsFromState=function(){var t=r(this.state,"contextId");return t.doc=this.getDocument(),t}},o.extend(s),e.exports=s},{"../i18n/en":80,"./Component":437,"./ContainerEditor":439,"./Controller":440,"./Highlights":449,"./ScrollPane":456,"./SplitPane":458,"./StatusBar":459,"./TOC":463,"./TabbedPane":465,"./Toolbar":470,"./i18n":476,"lodash/extend":315,"lodash/omit":349}],472:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerCommand");s.Prototype=function(){this.getCommandState=function(){var t=this.getDocumentSession();return{disabled:!t.canUndo(),active:!1}},this.execute=function(){var t=this.getDocumentSession();return t.canUndo()?(t.undo(),!0):!1}},n.extend(s),n["static"].name="undo",e.exports=s},{"./ControllerCommand":441}],473:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("./ControllerTool");n.extend(s),s["static"].name="undo",s["static"].command="undo",e.exports=s},{"./ControllerTool":442}],474:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("./Component"),r=n.$$;s.Prototype=function(){this.render=function(){return r("pre").addClass("content-node unsupported").attr({"data-id":this.props.node.id,contentEditable:!1}).append(JSON.stringify(this.props.node.properties,null,2))}},n.extend(s),e.exports=s},{"./Component":437}],475:[function(t,e,i){function s(){this.attributes={},this.htmlProps={},this.style={},this.handlers={},this.children=[],this._ref=null,this._isOnRoute=!1,this.props={children:this.children},this._owner=null}function n(t){s.call(this),this.type="element",this.tagName=t}function r(t){s.call(this),this.type="component",this.ComponentClass=t}function o(t){s.call(this),this.type="text",this.props={text:t}}function a(t){this.type="html",this.html=t}function l(t,e){this.virtualEl=t,this.name=e,Object.freeze(this)}var u=t("lodash/isFunction"),c=t("lodash/isString"),h=t("lodash/isArray"),p=t("lodash/cloneDeep"),d=t("lodash/extend"),f=t("lodash/omit"),m=t("lodash/without"),g=t("./DOMElement");s.Prototype=function(){this.ref=function(t){if(!this._owner)throw new Error("$$().ref() can only be used during Component rendering.");return this._ref=t,this},this.key=function(t){return console.info("DEPRECATED: Use ref instead. Note that when you assign a ref, the component do incremental rerendering."),this.ref(t)},this.setProps=function(t){return this.props=t,this.props.children=this.props.children||this.children,this},this.extendProps=function(t){return d(this.props,t),this.props.children=this.props.children||this.children,this},this.addProps=function(t){return console.log("DEPRECATED: Use setProps() or extendProps()"),d(this.props,t),this.props.children=this.props.children||this.children,this},this.route=function(){return this._isOnRoute=!0,this},this.hasClass=function(t){return!!new RegExp("\\b"+t+"\\b").exec(this.classNames)},this.addClass=function(t){return this.classNames||(this.classNames=""),this.classNames+=" "+t,this},this.removeClass=function(t){this.classNames||(this.classNames="");var e=this.classNames.split(/\s+/);return e=m(e,t),this.classNames=e.join(" "),this},this.removeAttr=function(t){return c(t)?delete this.attributes[t]:this.attributes=f(this.attributes,t),this},this.getAttribute=function(t){return this.attributes[t]},this.setAttribute=function(t,e){return this.attributes[t]=e,this},this.getId=function(){return this.getAttribute("id")},this.setId=function(t){return this.setAttribute("id",t)},this.getTextContent=function(){var t=this._compile();return t.text()},this.setTextContent=function(t){return this.children=[],this.children.push(new o(t)),this},this.getInnerHtml=function(){var t=this._compile();return t.html()},this.setInnerHtml=function(t){return this.children=[],this.children.push(new a(t)),this},this.getOuterHtml=function(){var t=this._compile();return t.outerHTML},this.getValue=function(){return this.htmlProps.value},this.setValue=function(t){return this.htmlProps.value=t,this},this.getChildNodes=function(){return this.children},this.getChildren=function(){return this.children.filter(function(t){return"text"!==t.getNodeType()})},this.isTextNode=function(){return!1},this.isElementNode=function(){return!1},this.isCommentNode=function(){return!1},this.isDocumentNode=function(){return!1},this.createElement=function(t){return s.createElement(t)},this.clone=function(){var t=this._clone();return t.attributes=p(this.attributes),t.htmlProps=p(this.htmlProps),t.style=p(this.style),t.handlers=p(this.handlers),t.children=this.children.map(function(t){return t.clone()}),t._ref=this._ref,t._isOnRoute=this._isOnRoute,t.props=p(this.props),t},this.append=function(){return this._append(this.children,arguments),this},this._append=function(t,e){var i;if(e.length>1)i=Array.prototype.slice.call(e,0),s.prepareChildren(i),Array.prototype.push.apply(t,i);else{var n=e[0];h(n)?(i=n,s.prepareChildren(i),Array.prototype.push.apply(t,i)):c(n)?t.push(new o(n)):t.push(n)}},this.insertAt=function(t,e){return this.children.splice(t,0,e),this},this.removeAt=function(t){return this.children.splice(t,1),this},this.empty=function(){return this.children=[],this},this.htmlProp=function(t){return 2===arguments.length?this.htmlProps[arguments[0]]=arguments[1]:d(this.htmlProps,t),this},this.removeHtmlProp=function(){return c(arguments[0])?delete this.htmlProps[arguments[0]]:this.htmlProps=f(this.htmlProps,arguments[0]),this},this.getStyle=function(t){return this.style?this.style[t]:void 0},this.setStyle=function(t,e){this.style||(this.style={}),this.style[t]=e},this.addEventListener=function(t,e,i,s){if(this.handlers[t])throw new Error('Handler for event "'+t+'" has already been registered.');this.handlers[t]={handler:i,context:s,selector:e}},this.removeEventListener=function(t){delete this.handlers[t]},this.outlet=function(t){return new l(this,t)},this._compile=function(){var e=t("./Component");return e._render(this)},this._render=this._compile},g.extend(s),n.Prototype=function(){this.getTagName=function(){return this.tagName},this.setTagName=function(t){return this.tagName=t,this},this.getNodeType=function(){return"element"},this.isElementNode=function(){return!0},this._clone=function(){return new n(this.tagName)},this._quasiEquals=function(t){return this.type===t.type&&this.tagName===t.tagName}},s.extend(n),r.Prototype=function(){this.getChildren=function(){return this.props.children},this.getNodeType=function(){return"component"},this.isElementNode=function(){return!0},this._clone=function(){return new r(this.ComponentClass)},this._quasiEquals=function(t){return this.type===t.type&&this.ComponentClass===t.ComponentClass}},s.extend(r),Object.defineProperties(r.prototype,{}),o.Prototype=function(){this.getTextContent=function(){return this.props.text},this.setTextContent=function(t){return this.props.text=t,this},this.getInnerHtml=this.getTextContent,this.setInnerHtml=this.setTextContent,this.getOuterHtml=this.getTextContent,this.getNodeType=function(){return"text"},this.isTextNode=function(){return!0},this._clone=function(){return new o(this.props.text)},this._quasiEquals=function(t){return this.type===t.type&&this.props.text===t.props.text}},s.extend(o),a.Prototype=function(){this.getNodeType=function(){return"rawHtml"},this.getOuterHtml=function(){return this.html},this._clone=function(){return new a(this.html)},this._quasiEquals=function(t){return this.type===t.type&&this.html===t.html}},s.extend(a),s.prepareChildren=function(t){for(var e=0;e<t.length;e++)if(c(t[e])&&(t[e]=new o(t[e])),!t[e])throw new Error("Illegal child element",t,e)},s.createElement=function(){var e=t("./Component"),i=null;if(c(arguments[0])){if(1!==arguments.length)throw new Error("Illegal usage of Component.$$.");i=new n(arguments[0])}else{if(!(u(arguments[0])&&arguments[0].prototype instanceof e))throw void 0===arguments[0]?new Error("Provided Component was undefined."):new Error("Illegal usage of Component.$$.");if(arguments.length<1||arguments.length>2)throw new Error("Illegal usage of Component.$$.");i=new r(arguments[0]),2===arguments.length&&i.setProps(arguments[1])}return i},s.$$=s.createElement,s.VirtualTextNode=o,s.RawHtml=a,l.prototype._getOutlet=function(){var t=this.virtualEl.props[this.name];return t||(t=[],this.virtualEl.props[this.name]=t),t},l.prototype.append=function(){var t=this._getOutlet();return this.virtualEl._append(t,arguments),this},l.prototype.empty=function(){this.virtualEl.props[this.name]=[]},e.exports=s},{"./Component":437,"./DOMElement":443,"lodash/cloneDeep":309,"lodash/extend":315,"lodash/isArray":327,"lodash/isFunction":333,"lodash/isString":340,"lodash/omit":349,"lodash/without":363}],476:[function(t,e,i){"use strict";function s(){this.map={}}var n=t("lodash/extend"),r=t("../util/oo");s.Prototype=function(){this.t=function(t){return this.map[t]?this.map[t]:t},this.load=function(t){n(this.map,t)}},r.initClass(s),s.mixin=function(t){Object.defineProperty(t.prototype,"i18n",{get:function(){return this.context&&this.context.i18n?this.context.i18n:s.instance}})},s.instance=new s,e.exports=s},{"../util/oo":486,"lodash/extend":315}],477:[function(t,e,i){"use strict";function s(){this.__events__={}}var n=t("./oo"),r=t("lodash/each"),o=t("lodash/isObject"),a=!1;s.Prototype=function(){function t(t,e){return e.priority-t.priority}function e(t,e){if("string"==typeof t){if(void 0===e||null===e)throw new Error('Method name "'+t+'" has no context.');if(!(t in e))throw new Error('Method not found: "'+t+'"');if("function"!=typeof e[t])throw new Error('Property "'+t+'" is not a function')}else if("function"!=typeof t)throw new Error("Invalid callback. Function or method name expected.")}function i(t,i,s,n){var r;return e(i,s),r=this.__events__.hasOwnProperty(t)?this.__events__[t]:this.__events__[t]=[],r.push({method:i,context:s||null,priority:n}),this}function s(t,i,s){var n,r;if(1===arguments.length)return delete this.__events__[t],this;if(e(i,s),!(t in this.__events__&&this.__events__[t].length))return this;for(arguments.length<3&&(s=null),r=this.__events__[t],n=r.length;n--;)r[n].method===i&&r[n].context===s&&r.splice(n,1);return 0===r.length&&delete this.__events__[t],this}function n(e,s,n){var r=0;3===arguments.length&&(r=n.priority||r);for(var o in s){var a=s[o];i.call(this,o,a,e,r)}return this.__events__[o].sort(t),this}function l(t){var e,i,n;for(i in this.__events__)for(n=this.__events__[i],e=n.length;e--;)n[e]&&n[e].context===t&&s.call(this,i,n[e].method,t);return this}this.emit=function(t){if(t in this.__events__){a&&console.log("Emitting event %s (%d listeners) on",t,Object.keys(this.__events__[t]).length,this);for(var e=this.__events__[t].slice(),i=Array.prototype.slice.call(arguments,1),s=0,n=e.length;n>s;s++){var r=e[s];r.method.apply(r.context,i)}return!0}return!1},this.connect=function(t,e,i){return console.warn("DEPRECATED: Use EventEmitter.on(event, method, context) instead."),n.apply(this,arguments)},this.disconnect=function(t){return console.warn("DEPRECATED: Use EventEmitter.off(listener) instead."),l.call(this,t)},this.on=function(e,s,n,r){var o=0;4===arguments.length&&(o=r.priority||o),i.call(this,e,s,n,o),this.__events__[e].sort(t)},this.off=function(t,e,i){1===arguments.length&&o(arguments[0])?l.call(this,arguments[0]):s.apply(this,arguments)},this._debugEvents=function(){console.log("### EventEmitter: ",this),r(this.__events__,function(t,e){console.log("- %s listeners for %s: ",t.length,e,t)}.bind(this))}},n.initClass(s),e.exports=s},{"./oo":486,"lodash/each":313,"lodash/isObject":338}],478:[function(t,e,i){"use strict";var s=t("./EventEmitter"),n=function(){s.call(this),this.messages=[]};n.Prototype=function(){this.addMessage=function(t){this.messages.push(t),this.emit("messages:updated",this.messages)},this.log=function(t){this.addMessage({type:"info",message:t})},this.error=function(t){this.addMessage({type:"error",message:t})},this.warn=this.log,this.info=this.log,this.clearMessages=function(){this.messages=[],this.emit("messages:updated",this.messages)}},s.extend(n),e.exports=n},{"./EventEmitter":477}],479:[function(t,e,i){"use strict";function s(){this.entries={},this.names=[]}var n=t("./oo"),r={};s.Prototype=function(){this.contains=function(t){return this.entries.hasOwnProperty(t)},this.add=function(t,e){if(r[t])throw new Error('Illegal key: "'+t+'" is a property of Object which is thus not allowed as a key.');this.contains(t)&&this.remove(t),this.entries[t]=e,this.names.push(t)},this.remove=function(t){var e=this.names.indexOf(t);e>=0&&this.names.splice(e,1),delete this.entries[t]},this.clear=function(){this.names=[],this.entries={}},this.get=function(t){return this.entries[t]},this.each=function(t,e){for(var i=0;i<this.names.length;i++){var s=this.names[i],n=t.call(e,this.entries[s],s);if(n===!1)break}}},n.initClass(s),e.exports=s},{"./oo":486}],480:[function(t,e,i){"use strict";function s(){}function n(){}var r=t("lodash/isString"),o=t("lodash/isArray"),a=t("lodash/get"),l=t("lodash/setWith"),u=t("./oo"),c=t("./deleteFromArray");n.Prototype=function(){this.get=function(t){return arguments.length>1&&(t=Array.prototype.slice(arguments,0)),r(t)&&(t=[t]),a(this,t)},this.getAll=function(t){if(arguments.length>1&&(t=Array.prototype.slice(arguments,0)),r(t)&&(t=[t]),!o(t))throw new Error("Illegal argument for TreeIndex.get()");var e=a(this,t);return this._collectValues(e)},this.set=function(t,e){r(t)&&(t=[t]),l(this,t,e,function(t){return t?void 0:new s})},this["delete"]=function(t){if(r(t))delete this[t];else if(1===t.length)delete this[t[0]];else{var e=t[t.length-1];t=t.slice(0,-1);var i=a(this,t);i&&delete i[e]}},this.clear=function(){var t=this;for(var e in t)t.hasOwnProperty(e)&&delete t[e]},this.traverse=function(t){this._traverse(this,[],t)},this.forEach=this.traverse,this._traverse=function(t,e,i){var n;for(n in t)if(t.hasOwnProperty(n)){var r=t[n],o=e.concat([n]);r instanceof s?this._traverse(r,o,i):i(r,o)}},this._collectValues=function(t){var e={};return this._traverse(t,[],function(t,i){var s=i[i.length-1];e[s]=t}),e}},u.initClass(n),n.Arrays=function(){},n.Arrays.Prototype=function(){var t=Object.getPrototypeOf(this);this.get=function(e){var i=t.get.call(this,e);return i instanceof s&&(i=i.__values__||[]),i},this.set=function(){throw new Error("TreeIndex.set() is not supported for array type.")},this.add=function(t,e){if(r(t)&&(t=[t]),!o(t))throw new Error("Illegal arguments.");var i;l(this,t.concat(["__values__","__dummy__"]),void 0,function(t,e){if("__values__"===e){if(!t)return i=[];i=t}else if(!t)return new s}),delete i.__dummy__,i.push(e)},this.remove=function(t,e){var i=a(this,t);i instanceof s&&c(i.__values__,e)},this._collectValues=function(t){var e=[];return this._traverse(t,[],function(t){e.push(t)}),e=Array.prototype.concat.apply([],e)}},n.extend(n.Arrays),e.exports=n},{"./deleteFromArray":481,"./oo":486,"lodash/get":319,"lodash/isArray":327,"lodash/isString":340,"lodash/setWith":352}],481:[function(t,e,i){"use strict";function s(t,e){for(var i=0;i<t.length;i++)t[i]===e&&(t.splice(i,1),i--)}e.exports=s},{}],482:[function(t,e,i){"use strict";var s={},n=t("./jquery"),r=t("./deleteFromArray");s.isEqual=t("lodash/isEqual"),s.isObject=t("lodash/isObject"),
s.isArray=t("lodash/isArray"),s.isString=t("lodash/isString"),s.isNumber=t("lodash/isNumber"),s.isBoolean=t("lodash/isBoolean"),s.isFunction=t("lodash/isFunction"),s.cloneDeep=t("lodash/cloneDeep"),s.clone=t("lodash/clone"),s.isEmpty=t("lodash/isEmpty"),s.bind=t("lodash/bind"),s.delay=t("lodash/delay"),s.debounce=t("lodash/debounce"),s.extend=t("lodash/extend"),s.omit=t("lodash/omit"),s.values=t("lodash/values"),s.last=t("lodash/last"),s.first=t("lodash/head"),s.compact=t("lodash/compact"),s.uniq=t("lodash/uniq"),s.intersection=t("lodash/intersection"),s.union=t("lodash/union"),s.without=t("lodash/without"),s.each=t("lodash/forEach"),s.filter=t("lodash/filter"),s.includes=t("lodash/includes"),s.find=t("lodash/find"),s.map=t("lodash/map"),s.sortBy=t("lodash/sortBy"),s.capitalize=t("lodash/capitalize"),s.isArrayEqual=function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0},s.deleteFromArray=r,s.deepclone=function(t){return null===t||void 0===t?t:s.isFunction(t.clone)?t.clone():s.deepclone(t)},s.deepclone=s.cloneDeep,s.getRelativeOffset=function(t,e){var i=t.offset(),s=e.offset();return i.left-=s.left,i.top-=s.top,i},s.uuid=t("./uuid"),s.serializeDOMElement=function(t){var e=n("<div>");return e.append(t.clone()),e.html()},s.request=function(t,e,i,s){var r={type:t,url:e,contentType:"application/json; charset=UTF-8",success:function(t){s(null,t)},error:function(t){console.error(t),s(t.responseText)}};i&&(r.data=JSON.stringify(i)),n.ajax(r)},e.exports=s},{"./deleteFromArray":481,"./jquery":484,"./uuid":490,"lodash/bind":306,"lodash/capitalize":307,"lodash/clone":308,"lodash/cloneDeep":309,"lodash/compact":310,"lodash/debounce":311,"lodash/delay":312,"lodash/extend":315,"lodash/filter":316,"lodash/find":317,"lodash/forEach":318,"lodash/head":322,"lodash/includes":324,"lodash/intersection":325,"lodash/isArray":327,"lodash/isBoolean":330,"lodash/isEmpty":331,"lodash/isEqual":332,"lodash/isFunction":333,"lodash/isNumber":337,"lodash/isObject":338,"lodash/isString":340,"lodash/last":345,"lodash/map":346,"lodash/omit":349,"lodash/sortBy":353,"lodash/union":358,"lodash/uniq":359,"lodash/values":362,"lodash/without":363}],483:[function(t,e,i){"use strict";e.exports=function(t,e){if(t===e)return!0;if(null===t||null===e)return!1;if(t.length!=e.length)return!1;for(var i=0;i<t.length;++i)if(t[i]!==e[i])return!1;return!0}},{}],484:[function(t,e,i){var s="undefined"!=typeof window,n=null;if(s)e.exports=t("jquery");else{if(!n){var r=t("cheerio");r.prototype.prop=r.prototype.attr,r.prototype.removeProp=r.prototype.removeAttr,r.prototype.on=function(){},r.prototype.off=function(){},n=r.load("",{decodeEntities:!1}),n._createElement=function(t,e){return{type:"tag",name:t,attribs:{},children:[],parent:null,root:e,options:e.options,next:null,prev:null}},n._createTextNode=function(t){return{data:t,type:"text",parent:null,prev:null,next:null,children:[]}};var o=function(t,e){var i=n.load(t,e),s=i.root()[0];return s.options||(s.options=e),s.children.slice()};n.parseHTML=function(t){return o(t,{xmlMode:!1})},n.parseXML=function(t){return o(t,{xmlMode:!0})},n._serialize=function(e){var i=t("dom-serializer"),s=e.options||e.root.options;return i(e,s)}}e.exports=n}},{cheerio:11,"dom-serializer":11,jquery:12}],485:[function(t,e,i){e.exports={UNDEFINED:0,BACKSPACE:8,DELETE:46,LEFT:37,RIGHT:39,UP:38,DOWN:40,ENTER:13,END:35,HOME:36,TAB:9,PAGEUP:33,PAGEDOWN:34,ESCAPE:27,SHIFT:16,SPACE:32}},{}],486:[function(t,e,i){"use strict";function s(t){if(!t.__is_initialized__){!t.Prototype||t.prototype instanceof t.Prototype||(t.prototype=new t.Prototype,t.prototype.constructor=t);var e=u();t["static"]=t["static"]||new e(t),t.__is_initialized__=!0}}function n(t,e){if(t.prototype instanceof e)throw new Error("Target already inherits from origin");var i=t.Prototype;t["super"]=e,i?(i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t):t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),t.prototype["super"]=e.prototype;var s=u();e["static"]&&(s.prototype=e["static"]),t["static"]=new s(t),t["static"]._makeExtendFunction?t.extend=t["static"]._makeExtendFunction(t):l(t)}function r(t){var e=t.prototype;for(var i in e)"constructor"!==i&&"__class__"!==i&&e.hasOwnProperty(i)&&("static"!==i||c(t["static"],e["static"]))}function o(t){function e(){t.apply(this,arguments)}var i,s=Array.prototype.slice.call(arguments,1),r=[],o=0;for(p(s[0])?(i=s[0],o++):i=e;o<s.length;o++){if(p(s[o])){if(o!==s.length-1)throw new Error("Illegal use of Class.extend(): Prototype function must be last argument.");if(i.hasOwnProperty("Prototype"))throw new Error("Class "+i.name+" has defined "+i.name+".Prototype which would be overwritten by Class.extend().\nYou provided a prototype function when calling Class.extend().");i.Prototype=s[o];break}if(!h(s[o]))throw new Error("Illegal use of Class.extend");r.push(s[o])}n(i,t);for(var l=r.length-1;l>=0;l--)a(i,r[l]);return i}function a(t,e){var i=t.prototype;for(var s in e)if(e.hasOwnProperty(s)){if("static"===s){c(t["static"],e["static"]);continue}i.hasOwnProperty(s)||(i[s]=e[s])}}function l(t){t["static"]||f.initClass(t),t["static"]._makeExtendFunction=function(e){return d(o,t,e)},t.extend=t["static"]._makeExtendFunction(t)}function u(){return function(t){this.__class__=t}}function c(t,e){for(var i in e)"constructor"!==i&&"__class__"!==i&&e.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=e[i])}var h=t("lodash/isObject"),p=t("lodash/isFunction"),d=t("lodash/bind"),f={};f.initClass=function(t){s(t),l(t)},f.inherit=function(t,e){t.__is_initialized__||f.initClass(t),n(t,e),r(t)},f.mixin=function(t,e){t.__is_initialized__||f.initClass(t),a(t,e)},f.makeExtensible=l,e.exports=f},{"lodash/bind":306,"lodash/isFunction":333,"lodash/isObject":338}],487:[function(t,e,i){var s={isIE:!1,isFF:!1,isWebkit:!1,version:-1};if("undefined"!=typeof window){var n=window.navigator.userAgent,r=n.indexOf("MSIE "),o=n.indexOf("Trident/"),a=n.indexOf("Edge/");r>0?(s.isIE=!0,s.version=10):o>0?(s.isIE=!0,s.version=11):a>0&&(s.isIE=!0,s.version=12,parseInt(n.substring(a+5,n.indexOf(".",a)),10)),s.isFF=window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1,s.isWebkit=!s.isFF&&!s.isIE}e.exports=s},{}],488:[function(t,e,i){var s=t("lodash/map");e.exports=function(t,e){return s(t,function(t){return t[e]})}},{"lodash/map":346}],489:[function(t,e,i){(function(t){var i={};if(t.hasOwnProperty("Substance"))throw new Error("global.Substance is already defined.");t.Substance=i,e.exports=i}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],490:[function(t,e,i){e.exports=function(t,e){t&&"-"!==t[t.length-1]&&(t=t.concat("-"));var i,s="0123456789abcdefghijklmnopqrstuvwxyz".split(""),n=[],r=16;if(e=e||32)for(i=0;e>i;i++)n[i]=s[0|Math.random()*r];else{var o;for(n[8]=n[13]=n[18]=n[23]="-",n[14]="4",i=0;36>i;i++)n[i]||(o=0|16*Math.random(),n[i]=s[19==i?3&o|8:o])}return(t?t:"")+n.join("")}},{}],491:[function(t,e,i){"use strict";function s(){r.apply(this,arguments),this.actions({toggleBibItem:this.toggleBibItem})}var n=t("substance/util/helpers"),r=t("substance/ui/Component"),o=r.$$,a=t("./BibItemComponent"),l=t("substance/ui/DialogHeader"),u=t("substance/ui/ScrollPane");s.Prototype=function(){this.toggleBibItem=function(t){this.toggleItem(t.id)},this.didMount=function(){var t=this.$el.find("input");t.val(this.state.searchResult.searchStr).focus()},this.handleCancel=function(t){t.preventDefault(),this.send("switchContext","bib-items")},this.getInitialState=function(){return{searchResult:{searchStr:"",items:[]},runningQueries:[]}},this.render=function(){return o("div").addClass("sc-add-bib-items-panel").append(o(l,{label:this.i18n.t("add-bib-entries"),exitContext:"bib-items"}),o(u).ref("scrollPane").append(o("div").addClass("se-search-form").append(o("input").attr({type:"text",placeholder:this.i18n.t("enter_search_term"),value:this.state.searchResult.searchStr}).ref("searchStr").on("keypress",this.onKeyPress.bind(this)),o("button").addClass("button float-right").append("Search").on("click",this.startSearch.bind(this))),this.renderSearchResult()))},this.isAdded=function(t){return!!this.props.doc.get(t.data.DOI)},this.getLabel=function(t){var e="";if(t){var i=this.props.doc.get(t);i&&i.label&&(e=i.label)}return e},this.renderSearchResult=function(){var t=o("div").addClass("se-search-results"),e=this.state.searchResult.items;return n.each(e,function(e){var i=this.getLabel(e.data.DOI),s=e.text,n=this.isAdded(e);t.append(o(a,{node:{id:e.data.DOI,label:i,text:s},toggleName:this.i18n.t(n?"Remove":"Add"),highlighted:n}))},this),t},this.onKeyPress=function(t){13==t.which&&this.startSearch()},this.toggleItem=function(t){var e=this.props.doc;e.get(t)?this.removeItem(t):this.addItem(t)},this.getItem=function(t){return n.find(this.state.searchResult.items,function(e){return e.data.DOI===t})},this.addItem=function(t){var e=this.getItem(t),i=this.props.doc;i.transaction({},{},function(t){var i={id:e.data.DOI,type:"bib-item",data:e.data,format:"citeproc"};t.create(i)}),this.rerender()},this.removeItem=function(t){this.props.doc.transaction({},{},function(e){e["delete"](t)}),this.rerender()},this.startSearch=function(){var t;t=this.refs.searchStr?this.refs.scrollPane.val():this.refs.scrollPane.refs.searchStr.val();var e=this,i=this.props.doc,s=i.getCiteprocCompiler(),r=this.state.runningQueries;n.each(r,function(t){t.reject()}),r=[],n.each(this.context.bibSearchEngines,function(i){var n=i.find(t);n.progress(function(t){e.state.searchResult.items.push({data:t,label:"",text:s.renderReference(t)}),e.rerender()}),n.done(function(){var t=r.indexOf(n);t>=0&&r.splice(t,1)}),r.push(n)});var o=this.state.searchResult;o.searchStr=t,o.items=[],this.setState({searchResult:o,runningQueries:r})}},r.extend(s),e.exports=s},{"./BibItemComponent":497,"substance/ui/Component":437,"substance/ui/DialogHeader":447,"substance/ui/ScrollPane":456,"substance/util/helpers":482}],492:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/model/DocumentNode");s.Prototype=function(){this.setLabel=function(t){this.label=t,this.emit("label",t)},this.setText=function(t){this.text=t},this.updateCollection=function(t){var e=t.getCollection(this.type);e&&e.update()}},n.extend(s),s["static"].name="bib-item",s["static"].defineSchema({format:"string",data:"object"}),s["static"].citationType="bib-item-citation",e.exports=s},{"substance/model/DocumentNode":97}],493:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../citations/Citation");s.Prototype=function(){this.getItemType=function(){return"bib-item"}},n.extend(s),s["static"].name="bib-item-citation",e.exports=s},{"../citations/Citation":511}],494:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../citations/CitationCommand");n.extend(s),s["static"].name="bibItemCitation",s["static"].annotationType="bib-item-citation",e.exports=s},{"../citations/CitationCommand":512}],495:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/AnnotationTool");n.extend(s),s["static"].name="bibItemCitation",s["static"].command="bibItemCitation",e.exports=s},{"substance/ui/AnnotationTool":432}],496:[function(t,e,i){"use strict";var s=t("../citations/CitationXMLConverter");e.exports={type:"bib-item-citation",tagName:"cite",matchElement:function(t){return t.is("cite")&&"bib"===t.attr("rtype")},"import":function(t,e){s["import"](t,e)},"export":function(t,e){s["export"](t,e),e.attr("rtype","bib")}}},{"../citations/CitationXMLConverter":514}],497:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("substance/ui/Component"),r=n.$$,o=t("substance/ui/FontAwesomeIcon");s.Prototype=function(){this.toggleFocus=function(){this.send("toggleBibItem",this.props.node)},this.render=function(){var t=r("div").addClass("sc-bib-item").attr("data-id",this.props.node.id);return this.props.highlighted&&t.addClass("se-highlighted"),t.append(r("div").addClass("se-label").append(this.props.node.label)),t.append(r("button").addClass("se-focus-toggle").append(r(o,{icon:"fa-eye"}),[" ",this.props.toggleName].join("")).on("click",this.toggleFocus)),t.append(r("div").addClass("se-text").append(this.props.node.text)),t}},n.extend(s),e.exports=s},{"substance/ui/Component":437,"substance/ui/FontAwesomeIcon":448}],498:[function(t,e,i){"use strict";function s(){r.apply(this,arguments),this.props.node.connect(this,{label:this.onLabelChanged})}var n=t("substance/util/oo"),r=t("substance/ui/Component"),o=r.$$;s.Prototype=function(){this.dispose=function(){this.props.node.disconnect(this)},this.render=function(){var t=o("div").addClass("bib-item border-bottom pad item small clearfix").attr("data-id",this.props.node.id);return t.on("click",this.onClick),t.on("mousedown",this.onMouseDown),this.props.active&&t.addClass("active"),this.props.node.label&&t.append(o("div").addClass("label").append(this.props.node.label)),t.append(o("div").addClass("text").append(this.props.node.text)),t},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onMouseDown=function(t){t.preventDefault(),this.props.handleSelection(this.props.node.id)},this.onLabelChanged=function(){this.rerender()}},n.inherit(s,r),e.exports=s},{"substance/ui/Component":437,"substance/util/oo":486}],499:[function(t,e,i){"use strict";e.exports={type:"bib-item",tagName:"bib","import":function(t,e){e.data=JSON.parse(t.text()),e.id=e.data.DOI,e.format="citeproc"},"export":function(t,e){e.attr("format","citeproc").text(JSON.stringify(t.data))}}},{}],500:[function(t,e,i){"use strict";function s(){n.apply(this,arguments);var t=this.props.doc;this.bibliography=t.getCollection("bib-item"),this.bibliography.connect(this,{"bibliography:updated":this.rerender})}var n=t("substance/ui/Component"),r=t("substance/ui/ScrollPane"),o=t("./BibItemComponent"),a=t("./BibliographySummary"),l=n.$$;s.Prototype=function(){this.dispose=function(){this.bibliography.disconnect(this)},this.didMount=function(){this._scrollToTarget()},this.didReceiveProps=function(){this._scrollToTarget()},this._scrollToTarget=function(){var t=this.getFirstActiveBibItemId();t&&this.refs.scrollPane.scrollTo(t)},this.getFirstActiveBibItemId=function(){var t=this.props.doc;if(this.props.bibItemId)return this.props.bibItemId;if(this.props.citationId){var e=t.get(this.props.citationId);return e.targets[0]}},this.isHighlighted=function(t){var e=this.props.doc;if(this.props.bibItemId===t.id)return!0;if(this.props.citationId){var i=e.get(this.props.citationId);if(i.targets&&i.targets.indexOf(t.id)>=0)return!0}return!1},this.render=function(){var t=this.bibliography.getItems(),e=l("div").addClass("se-bib-items").ref("bibItems");e.append(l(a,{bibItems:t})),t.forEach(function(t){e.append(l(o,{node:t,toggleName:this.i18n.t("focus"),highlighted:this.isHighlighted(t)}))}.bind(this));var i=l("div").addClass("sc-bib-items-panel").append(l(r,{doc:this.props.doc}).append(e).ref("scrollPane"));return i}},n.extend(s),e.exports=s},{"./BibItemComponent":497,"./BibliographySummary":503,"substance/ui/Component":437,"substance/ui/ScrollPane":456}],501:[function(t,e,i){"use strict";function s(t,e){r.call(this),this.doc=t,this.containerId=e,this.bibitemsByGuid={},this._compileDebounced=n.debounce(this.compile.bind(this),50),this.doc.connect(this,{"document:changed":this.onDocumentChanged})}var n=t("substance/util/helpers"),r=t("substance/util/EventEmitter"),o=t("lodash/collection/sortBy");s.Prototype=function(){this.onDocumentChanged=function(t){var e=this.doc,i=!1;n.each(t.ops,function(t){if(t.isCreate()||t.isSet()||t.isUpdate()){var s=t.path[0],n=e.get(s);if(!n)return;t.isCreate()?("bib-item"===n.type||"bib-item-citation"===n.type)&&(i=!0):"bib-item"===n.type?i=!0:"bib-item-citation"===n.type&&"targets"===t.path[1]&&(i=!0)}else if(t.isDelete()){var r=t.val;("bib-item-citation"===r.type||"bib-item"===r.type)&&(console.log("bib-item-(citation) deleted"),i=!0)}}),i&&this.update()},this.dispose=function(){this.doc.disconnect(this)},this.getDocument=function(){return this.doc},this.getCompiler=function(){return this.getDocument().getCiteprocCompiler()},this.compile=function(){var t=this.getDocument(),e=this.getCompiler(),i=t.get(this.containerId);e.clear();var s=t.getIndex("type").get("bib-item");this.bibitemsByGuid={},n.each(s,function(t){if("citeproc"!==t.format)throw new Error("Only 'citeproc' bibliographic items are supported right now.");var i=t.data;i.id=t.id,e.addRecord(i),this.bibitemsByGuid[t.guid]=t}.bind(this));var r=t.getIndex("type").get("bib-item-citation"),a=n.map(r,function(t){var e=i.getAddress(t.path);return{citation:t,address:e}});o(a,"address"),n.each(a,function(t){var e=t.citation;if(e.targets.length>0){var i=n.filter(e.targets,function(t){var e=!!s[t];return e||console.error("No Bibitem found with id",t),e}),r=this.getCompiler().addCitation(i);e.setLabel(r.label)}else e.setLabel("???")}.bind(this));var l=this.getCompiler().makeBibliography();l=n.sortBy(l,"rank"),this.sortedBibItems=n.map(l,function(t){var e=s[t.id];return e.setLabel(t.label),e.setText(t.content),e}.bind(this)),this.emit("bibliography:updated")},this.update=function(){this._compileDebounced()},this.makeBibliography=function(){return this.getCompiler().makeBibliography()},this.getBibItems=function(){for(var t=[],e=this.getCompiler().getSortedIds(),i=0;i<e.length;i++)t.push(this.doc.get(e[i]));return t},this.getCompiledItems=function(){return this.sortedBibItems||this.compile(),this.sortedBibItems},this.getItems=function(){return this.getCompiledItems()}},r.extend(s),e.exports=s},{"lodash/collection/sortBy":16,"substance/util/EventEmitter":477,"substance/util/helpers":482}],502:[function(t,e,i){"use strict";function s(){o.apply(this,arguments)}var n=t("substance/util/helpers"),r=t("substance/util/oo"),o=t("substance/ui/Component"),a=o.$$;s.Prototype=function(){this.getDocument=function(){return this.context.controller.getDocument()},this.render=function(){var t=this.state;if(t.bibItems){var e=[a("div").addClass("content-node heading level-1").append("References")];return n.each(t.bibItems,function(t){t.label&&e.push(a("div").addClass("bib-item clearfix").append(a("div").addClass("label csl-left-margin").append(t.label),a("div").addClass("text csl-right-inline").append(t.text)))}),a("div").addClass("bibliography-component bib-items").append(e)}return a("div")},this.didMount=function(){var t=this.getDocument();this.bibliography=t.getCollection("bib-item"),this.bibliography.connect(this,{"bibliography:updated":this.update})},this.update=function(){var t=this.bibliography.getItems();this.setState({bibItems:t})}},r.inherit(s,o),e.exports=s},{"substance/ui/Component":437,"substance/util/helpers":482,"substance/util/oo":486}],503:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/Component"),r=n.$$;s.Prototype=function(){this.handleAddBibItems=function(t){t.preventDefault(),this.send("switchContext","add-bib-items")},this.render=function(){var t=r("div").addClass("se-bibliography-summary");t.append(r("p").append("Your bibliography has ",r("strong").append(this.props.bibItems.length.toString()," references")," in total."));var e=this.context.config;return e.isEditable&&t.append(r("p").append(r("a").attr({href:"#"}).on("click",this.handleAddBibItems).append("Add references"))),t}},n.extend(s),e.exports=s},{"substance/ui/Component":437}],504:[function(t,e,i){"use strict";function s(t){this.config=t||new a,this.style=this.config.style,this.clear()}var n=t("substance/util/helpers"),r=t("substance/util/jquery"),o=t("./citeproc/citeproc").CSL,a=t("./CiteprocDefaultConfig");s.prototype.setStyle=function(t){this.style=t,this.clear()},s.prototype.clear=function(){this.engine=new o.Engine(this,this.style),this.data={},this.citationLabels={},this.count=0},s.prototype.addRecord=function(t){return t.id=t.id||"ITEM_"+this.count++,this.sanitizeData(t),this.data[t.id]=t,t.id},s.prototype.addCitation=function(t){n.isArray(t)||(t=[t]);for(var e={citationItems:[],properties:{}},i=0;i<t.length;i++)e.citationItems.push({id:t[i]});var s=this.engine.appendCitationCluster(e),r=s[0][0];e=this.engine.registry.citationreg.citationByIndex[r];var o=e.citationID,a=s[0][1];for(this.citationLabels[o]=a,i=1;i<s.length;i++)this.citationLabels[s[i][0]]=s[i][1];return{id:o,label:a}},s.prototype.getCitationCount=function(t){var e=this.engine.registry.citationreg.citationsByItemId[t];return e?e.length:0},s.prototype.makeBibliography=function(){var t,e,i,s,n,r,o,a={},l=[],u=this.engine.registry.citationreg.citationByIndex,c=[];for(e=0;e<u.length;e+=1)s=u[e],c.push([""+s.citationID,s.properties.noteIndex]);for(t=this.engine.registry.getSortedIds(),i=0;i<t.length;i++)o=t[i],n=this.engine.previewCitationCluster({citationItems:[{id:o}],properties:{}},c,[],"html"),r=this.renderReference(this.data[o]),a[o]={id:o,rank:i,citeCount:this.getCitationCount(o),label:n,content:r},l.push(a[o]);for(o in this.data)a[o]||(i+=1,r=this.renderReference(this.data[o]),a[o]={id:o,rank:i,citeCount:0,label:null,content:r},l.push(a[o]));return a},s.prototype.getSortedIds=function(){var t,e,i,s;for(t=this.engine.registry.getSortedIds(),e={},i=0;i<t.length;i++)e[t[i]]=!0;for(s in this.data)e[s]||(t.push(s),e[s]=!0);return t},s.prototype.renderReference=function(t){function e(t){if(t.search("csl-right-inline")>=0){var e=r("<div>").append(r(t)).find(".csl-right-inline");return e.html()}return t}function i(){a.sanitizeData(t);var e=new o.Engine({retrieveItem:function(){return t},retrieveLocale:function(t){return a.config.locale[t]}},a.style),i={citationItems:[{id:t.id}],properties:{}};e.appendCitationCluster(i);try{return e.makeBibliography()[1][0]}catch(s){return console.error(s),"Error: invalid citation data."}}var n,a=this;if(this.data[t.id])try{n=s.getBibliographyEntry.call(this.engine,t.id)}catch(l){n=i()}else n=i();return e(n)},s.getBibliographyEntry=function(t){var e,i,s,n,r,a,l;if(this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,this.tmp.disambig_override=!0,this.tmp.just_looking=!0,e=this.retrieveItem(t),this.parallel.StartCitation([[{id:""+e.id},e]]),this.tmp.term_predecessor=!1,o.getCite.call(this,e),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(n||!this.output.queue[0].blobs[0].blobs[0].strings?(i=this.output.queue[0].blobs,n=!1):i=this.output.queue[0].blobs[0].blobs,r=i.length-1;r>-1;r+=-1)if(i[r].blobs&&0!==i[r].blobs.length){var u,c=this.tmp.cite_locales[this.tmp.cite_locales.length-1];u=this.tmp.cite_affixes[this.tmp.area][c]?this.tmp.cite_affixes[this.tmp.area][c].suffix:this.bibliography.opt.layout_suffix,l=u.slice(0,1),l&&i[r].strings.suffix.slice(-1)===l&&(i[r].strings.suffix=i[r].strings.suffix.slice(0,-1)),i[r].strings.suffix+=u;break}i[0].strings.prefix=this.bibliography.opt.layout_prefix+i[0].strings.prefix}for(r=0,a=this.output.queue.length;a>r;r+=1)o.Output.Queue.purgeEmptyBlobs(this.output.queue[r]);for(r=0,a=this.output.queue.length;a>r;r+=1)this.output.adjust.upward(this.output.queue[r]),this.output.adjust.leftward(this.output.queue[r]),this.output.adjust.downward(this.output.queue[r],!0),this.output.adjust.fix(this.output.queue[r]);return s=this.output.string(this,this.output.queue)[0],s||(s="\n[CSL STYLE ERROR: reference with no printed form.]\n"),this.tmp.disambig_override=!1,this.tmp.just_looking=!1,s},s.prototype.retrieveItem=function(t){return this.data[t]},s.prototype.retrieveLocale=function(t){return this.config.locale[t]},s.prototype.sanitizeData=function(t){t["container-title"]=t["container-title"]||"",t.title=t.title||""},e.exports=s},{"./CiteprocDefaultConfig":505,"./citeproc/citeproc":507,"substance/util/helpers":482,"substance/util/jquery":484}],505:[function(t,e,i){"use strict";function s(t){t=t||{},this.style=t.style||s.defaultStyle,this.locale=t.locale||s.defaultLocale}s.defaultStyleName="PLOS",s.defaultStyle='<?xml version="1.0" encoding="utf-8"?><style xmlns="http://purl.org/net/xbiblio/csl" class="in-text" version="1.0" demote-non-dropping-particle="sort-only" page-range-format="expanded" default-locale="en-US">  <info>    <title>Public Library of Science</title>    <title-short>PLOS</title-short>    <id>http://www.zotero.org/styles/plos</id>    <link href="http://www.zotero.org/styles/plos" rel="self"/>    <link href="http://journals.plos.org/plosbiology/guidelines.php" rel="documentation"/>    <author>      <name>Julian Onions</name>      <email>julian.onions@gmail.com</email>    </author>    <category citation-format="numeric"/>    <category field="science"/>    <summary>Public Library of Science Journal style.</summary>    <updated>2012-09-27T22:06:38+00:00</updated>    <rights license="http://creativecommons.org/licenses/by-sa/3.0/">This work is licensed under a Creative Commons Attribution-ShareAlike 3.0 License</rights>  </info>  <macro name="editor">    <names variable="editor" delimiter=", ">      <name name-as-sort-order="all" sort-separator=" " initialize-with="" delimiter=", " delimiter-precedes-last="always"/>      <label form="long" prefix=", "/>    </names>  </macro>  <macro name="author">    <names variable="author">      <name name-as-sort-order="all" sort-separator=" " initialize-with="" delimiter=", " delimiter-precedes-last="always"/>      <label form="long" prefix=", "/>      <substitute>        <names variable="editor"/>        <text variable="title"/>      </substitute>    </names>  </macro>  <macro name="access">    <group>      <choose>        <if variable="URL">          <text variable="URL" prefix="Available: " suffix="."/>          <group prefix=" " suffix=".">            <text term="accessed" text-case="capitalize-first" suffix=" "/>            <date variable="accessed">              <date-part name="day" suffix=" "/>              <date-part name="month" suffix=" "/>              <date-part name="year"/>            </date>          </group>        </if>        <else>          <text variable="DOI" prefix="doi:"/>        </else>      </choose>    </group>  </macro>  <macro name="publisher">    <group delimiter=": ">      <text variable="publisher-place"/>      <text variable="publisher"/>    </group>  </macro>  <macro name="year-date">    <choose>      <if variable="issued">        <date variable="issued">          <date-part name="year"/>        </date>      </if>      <else>        <text term="no date" form="short"/>      </else>    </choose>  </macro>  <macro name="edition">    <choose>      <if is-numeric="edition">        <group delimiter=" ">          <number variable="edition" form="ordinal"/>          <text term="edition" form="short"/>        </group>      </if>      <else>        <text variable="edition" suffix="."/>      </else>    </choose>  </macro>  <citation collapse="citation-number">    <sort>      <key variable="citation-number"/>    </sort>    <layout prefix="[" suffix="]" delimiter=",">      <text variable="citation-number"/>    </layout>  </citation>  <bibliography et-al-min="6" et-al-use-first="5" second-field-align="flush">    <layout suffix=".">      <text variable="citation-number" suffix=". "/>      <group delimiter=" ">        <text macro="author"/>        <text macro="year-date" prefix="(" suffix=")"/>        <text variable="title"/>      </group>      <choose>        <if type="book report" match="any">          <text variable="genre" prefix=". "/>          <group delimiter=" " prefix=". ">            <text macro="edition"/>            <text macro="editor"/>            <text macro="publisher" suffix="."/>            <group delimiter=" ">              <text variable="number-of-pages"/>              <text term="page" form="short" strip-periods="true"/>            </group>          </group>        </if>        <else-if type="chapter paper-conference" match="any">          <group prefix=". " delimiter=". " suffix=".">            <group delimiter=" ">              <text term="in" text-case="capitalize-first" suffix=":"/>              <text macro="editor"/>            </group>            <text variable="container-title"/>            <text variable="collection-title"/>          </group>          <group prefix=" " suffix="." delimiter=", ">            <text macro="publisher"/>            <text variable="volume" prefix="Vol. "/>          </group>          <group prefix=" ">            <label variable="page" suffix=" " form="short"/>            <text variable="page"/>          </group>        </else-if>        <else-if type="thesis">          <group delimiter=" " prefix=" ">            <text variable="genre" prefix="[" suffix="]."/>            <text macro="publisher"/>          </group>        </else-if>        <else>          <group delimiter=" " prefix=". ">            <text variable="container-title" form="short" strip-periods="true"/>            <text variable="volume"/>          </group>          <text variable="page" prefix=": "/>        </else>      </choose>      <text macro="access" prefix=". "/>    </layout>  </bibliography></style>',s.defaultLocale={"en-US":'<locale xml:lang="en" xmlns="http://purl.org/net/xbiblio/csl">  <style-options punctuation-in-quote="true"/>  <date form="text">    <date-part name="month" suffix=" "/>    <date-part name="day" suffix=", "/>    <date-part name="year"/>  </date>  <date form="numeric">    <date-part name="year"/>    <date-part name="month" form="numeric" prefix="-" range-delimiter="/"/>    <date-part name="day" prefix="-" range-delimiter="/"/>  </date>  <terms>    <term name="document-number-label">No.</term>    <term name="document-number-authority-suffix">Doc.</term>    <term name="un-sales-number-label">U.N. Sales No.</term>    <term name="collection-number-label">No.</term>    <term name="open-quote"></term>    <term name="close-quote"></term>    <term name="open-inner-quote"></term>    <term name="close-inner-quote"></term>    <term name="ordinal-01">st</term>    <term name="ordinal-02">nd</term>    <term name="ordinal-03">rd</term>    <term name="ordinal-04">th</term>    <term name="long-ordinal-01">first</term>    <term name="long-ordinal-02">second</term>    <term name="long-ordinal-03">third</term>    <term name="long-ordinal-04">fourth</term>    <term name="long-ordinal-05">fifth</term>    <term name="long-ordinal-06">sixth</term>    <term name="long-ordinal-07">seventh</term>    <term name="long-ordinal-08">eighth</term>    <term name="long-ordinal-09">ninth</term>    <term name="long-ordinal-10">tenth</term>    <term name="at">at</term>    <term name="in">in</term>    <term name="ibid">ibid</term>    <term name="accessed">accessed</term>    <term name="retrieved">retrieved</term>    <term name="from">from</term>    <term name="forthcoming">forthcoming</term>    <term name="references">      <single>reference</single>      <multiple>references</multiple>    </term>    <term name="references" form="short">      <single>ref</single>      <multiple>refs</multiple>    </term>    <term name="no date">n.d.</term>    <term name="and">and</term>    <term name="et-al">et al.</term>    <term name="interview">interview</term>    <term name="letter">letter</term>    <term name="anonymous">anonymous</term>    <term name="anonymous" form="short">anon.</term>    <term name="and others">and others</term>    <term name="in press">in press</term>    <term name="online">online</term>    <term name="cited">cited</term>    <term name="internet">internet</term>    <term name="presented at">presented at the</term>    <term name="ad">AD</term>    <term name="bc">BC</term>    <term name="season-01">Spring</term>    <term name="season-02">Summer</term>    <term name="season-03">Autumn</term>    <term name="season-04">Winter</term>    <term name="with">with</term>        <!-- CATEGORIES -->    <term name="anthropology">anthropology</term>    <term name="astronomy">astronomy</term>    <term name="biology">biology</term>    <term name="botany">botany</term>    <term name="chemistry">chemistry</term>    <term name="engineering">engineering</term>    <term name="generic-base">generic base</term>    <term name="geography">geography</term>    <term name="geology">geology</term>    <term name="history">history</term>    <term name="humanities">humanities</term>    <term name="literature">literature</term>    <term name="math">math</term>    <term name="medicine">medicine</term>    <term name="philosophy">philosophy</term>    <term name="physics">physics</term>    <term name="psychology">psychology</term>    <term name="sociology">sociology</term>    <term name="science">science</term>    <term name="political_science">political science</term>    <term name="social_science">social science</term>    <term name="theology">theology</term>    <term name="zoology">zoology</term>        <!-- LONG LOCATOR FORMS -->    <term name="book">      <single>book</single>      <multiple>books</multiple>    </term>    <term name="chapter">      <single>chapter</single>      <multiple>chapters</multiple>    </term>    <term name="column">      <single>column</single>      <multiple>columns</multiple>    </term>    <term name="figure">      <single>figure</single>      <multiple>figures</multiple>    </term>    <term name="folio">      <single>folio</single>      <multiple>folios</multiple>    </term>    <term name="issue">      <single>number</single>      <multiple>numbers</multiple>    </term>    <term name="line">      <single>line</single>      <multiple>lines</multiple>    </term>    <term name="note">      <single>note</single>      <multiple>notes</multiple>    </term>    <term name="opus">      <single>opus</single>      <multiple>opera</multiple>    </term>    <term name="page">      <single>page</single>      <multiple>pages</multiple>    </term>    <term name="paragraph">      <single>paragraph</single>      <multiple>paragraph</multiple>    </term>    <term name="part">      <single>part</single>      <multiple>parts</multiple>    </term>    <term name="section">      <single>section</single>      <multiple>sections</multiple>    </term>    <term name="volume">      <single>volume</single>      <multiple>volumes</multiple>    </term>    <term name="edition">      <single>edition</single>      <multiple>editions</multiple>    </term>    <term name="verse">      <single>verse</single>      <multiple>verses</multiple>    </term>    <term name="sub verbo">      <single>sub verbo</single>      <multiple>s.vv</multiple>    </term>        <!-- SHORT LOCATOR FORMS -->    <term name="book" form="short">bk.</term>    <term name="chapter" form="short">chap.</term>    <term name="column" form="short">col.</term>    <term name="figure" form="short">fig.</term>    <term name="folio" form="short">f.</term>    <term name="issue" form="short">no.</term>    <term name="opus" form="short">op.</term>    <term name="page" form="short">      <single>p.</single>      <multiple>pp.</multiple>    </term>    <term name="paragraph" form="short">para.</term>    <term name="part" form="short">pt.</term>    <term name="section" form="short">sec.</term>    <term name="sub verbo" form="short">      <single>s.v.</single>      <multiple>s.vv.</multiple>    </term>    <term name="verse" form="short">      <single>v.</single>      <multiple>vv.</multiple>    </term>    <term name="volume" form="short">     <single>vol.</single>     <multiple>vols.</multiple>    </term>    <term name="edition">edition</term>    <term name="edition" form="short">ed.</term>        <!-- SYMBOL LOCATOR FORMS -->    <term name="paragraph" form="symbol">      <single></single>      <multiple></multiple>    </term>    <term name="section" form="symbol">      <single></single>      <multiple></multiple>    </term>        <!-- LONG ROLE FORMS -->    <term name="author">      <single></single>      <multiple></multiple>    </term>    <term name="editor">      <single>editor</single>      <multiple>editors</multiple>    </term>    <term name="translator">      <single>translator</single>      <multiple>translators</multiple>    </term>        <!-- SHORT ROLE FORMS -->    <term name="author" form="short">      <single></single>      <multiple></multiple>    </term>    <term name="editor" form="short">      <single>ed.</single>      <multiple>eds.</multiple>    </term>    <term name="translator" form="short">      <single>tran.</single>      <multiple>trans.</multiple>    </term>        <!-- VERB ROLE FORMS -->    <term name="editor" form="verb">edited by</term>    <term name="translator" form="verb">translated by</term>    <term name="recipient" form="verb">to</term>    <term name="interviewer" form="verb">interview by</term>        <!-- SHORT VERB ROLE FORMS -->    <term name="editor" form="verb-short">ed.</term>    <term name="translator" form="verb-short">trans.</term>        <!-- LONG MONTH FORMS -->    <term name="month-01">January</term>    <term name="month-02">February</term>    <term name="month-03">March</term>    <term name="month-04">April</term>    <term name="month-05">May</term>    <term name="month-06">June</term>    <term name="month-07">July</term>    <term name="month-08">August</term>    <term name="month-09">September</term>    <term name="month-10">October</term>    <term name="month-11">November</term>    <term name="month-12">December</term>        <!-- SHORT MONTH FORMS -->    <term name="month-01" form="short">Jan.</term>    <term name="month-02" form="short">Feb.</term>    <term name="month-03" form="short">Mar.</term>    <term name="month-04" form="short">Apr.</term> <term name="month-05" form="short">May</term>    <term name="month-06" form="short">Jun.</term>    <term name="month-07" form="short">Jul.</term>    <term name="month-08" form="short">Aug.</term>    <term name="month-09" form="short">Sep.</term>    <term name="month-10" form="short">Oct.</term>    <term name="month-11" form="short">Nov.</term>    <term name="month-12" form="short">Dec.</term>  </terms></locale>'
},e.exports=s},{}],506:[function(t,e,i){"use strict";function s(){this.lastSearch="",this.lastResult=[],this.name="crossref",this.label="CrossRef"}var n=t("substance/util/jquery");s.resolveDOI=function(t){var e=n.Deferred();return/^http:/.exec(t)||(t="http://dx.doi.org/"+t),n.ajax(t,{type:"GET",crossDomain:!0,cache:!1,headers:{Accept:"application/citeproc+json"},success:function(t){e.resolve(t)},error:function(t,i,s){window.console.error("Could not retrieve data from cross-ref",i,s),e.rejectWith(null,s)}}),e},s.prototype.find=function(t,e){var i,r,o,a,l=n.Deferred(),u=this;return this.lastSearch===t?(a=this.lastResult,window.setTimeout(function(){a.forEach(function(t){l.notifyWith(e,[t])}),l.resolveWith(e)},0)):(this.lastSearch="",this.lastSearch=[],a=[],i=t.trim().toLowerCase().split(/\s+/),r=i.join("+"),o=0,n.ajax("http://search.crossref.org/dois",{data:{q:r,sort:"score"},success:function(i){function n(){if(o<i.length){var r=i[o++],c=s.resolveDOI(r.doi);c.done(function(t){"pending"===l.state()&&(a.push(t),l.notifyWith(e,[t]))}).always(function(){"pending"===l.state()&&n()})}else u.lastSearch=t,u.lastResult=a,l.resolveWith(e)}n()},error:function(t,i,s){l.rejectWith(e,[s])}})),l},e.exports=s},{"substance/util/jquery":484}],507:[function(t,e,s){Array.indexOf||(Array.prototype.indexOf=function(t){var e,i;for(e=0,i=this.length;i>e;e+=1)if(this[e]===t)return e;return-1});var n={PROCESSOR_VERSION:"1.0.542",CONDITION_LEVEL_TOP:1,CONDITION_LEVEL_BOTTOM:2,PLAIN_HYPHEN_REGEX:/(?:[^\\]-|\u2013)/,LOCATOR_LABELS_REGEXP:new RegExp("^((art|ch|Ch|subch|col|fig|l|n|no|op|p|pp|para|subpara|pt|r|sec|subsec|Sec|sv|sch|tit|vrs|vol)\\.)\\s+(.*)"),STATUTE_SUBDIV_GROUPED_REGEX:/((?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/g,STATUTE_SUBDIV_PLAIN_REGEX:/(?:(?:^| )(?:art|ch|Ch|subch|p|pp|para|subpara|pt|r|sec|subsec|Sec|sch|tit)\.)/,STATUTE_SUBDIV_STRINGS:{"art.":"article","bk.":"book","ch.":"chapter","Ch.":"Chapter","subch.":"subchapter","p.":"page","pp.":"page","para.":"paragraph","subpara.":"subparagraph","pt.":"part","r.":"rule","sec.":"section","subsec.":"subsection","Sec.":"Section","sch.":"schedule","tit.":"title","col.":"column","fig.":"figure","fol.":"folio","l.":"line","n.":"note","no.":"issue","op.":"opus","sv.":"sub-verbo","vrs.":"verse","vol.":"volume"},STATUTE_SUBDIV_STRINGS_REVERSE:{article:"art.",book:"bk.",chapter:"ch.",Chapter:"Ch.",subchapter:"subch.",page:"p.",paragraph:"para.",subparagraph:"subpara.",part:"pt.",rule:"r.",section:"sec.",subsection:"subsec.",Section:"Sec.",schedule:"sch.",title:"tit.",column:"col.",figure:"fig.",folio:"fol.",line:"l.",note:"n.",issue:"no.",opus:"op.","sub-verbo":"sv.","sub verbo":"sv.",verse:"vrs.",volume:"vol."},LOCATOR_LABELS_MAP:{art:"article",bk:"book",ch:"chapter",Ch:"Chapter",subch:"subchapter",col:"column",fig:"figure",fol:"folio",l:"line",n:"note",no:"issue",op:"opus",p:"page",pp:"page",para:"paragraph",subpara:"subparagraph",pt:"part",r:"rule",sec:"section",subsec:"subsection",Sec:"Section",sv:"sub-verbo",sch:"schedule",tit:"title",vrs:"verse",vol:"volume"},NestedBraces:[["(","["],[")","]"]],checkNestedBraceOpen:new RegExp(".*\\("),checkNestedBraceClose:new RegExp(".*\\)"),LangPrefsMap:{title:"titles","title-short":"titles","container-title":"journals","collection-title":"journals",publisher:"publishers",authority:"publishers","publisher-place":"places","event-place":"places",number:"number",edition:"number",issue:"number",volume:"number"},AbbreviationSegments:function(){this["container-title"]={},this["collection-title"]={},this["institution-entire"]={},this["institution-part"]={},this.nickname={},this.number={},this.title={},this.place={},this.hereinafter={},this.classic={},this["container-phrase"]={},this["title-phrase"]={}},GENDERS:["masculine","feminine"],ERROR_NO_RENDERED_FORM:1,PREVIEW:"Just for laughs.",ASSUME_ALL_ITEMS_REGISTERED:2,START:0,END:1,SINGLETON:2,SEEN:6,SUCCESSOR:3,SUCCESSOR_OF_SUCCESSOR:4,SUPPRESS:5,SINGULAR:0,PLURAL:1,LITERAL:!0,BEFORE:1,AFTER:2,DESCENDING:1,ASCENDING:2,ONLY_FIRST:1,ALWAYS:2,ONLY_LAST:3,FINISH:1,POSITION_FIRST:0,POSITION_SUBSEQUENT:1,POSITION_IBID:2,POSITION_IBID_WITH_LOCATOR:3,MARK_TRAILING_NAMES:!0,POSITION_TEST_VARS:["position","first-reference-note-number","near-note"],AREAS:["citation","citation_sort","bibliography","bibliography_sort"],MULTI_FIELDS:["event","publisher","publisher-place","event-place","title","container-title","collection-title","authority","edition","genre","title-short","medium","jurisdiction","archive","archive-place"],CITE_FIELDS:["first-reference-note-number","locator","locator-revision"],MINIMAL_NAME_FIELDS:["literal","family"],SWAPPING_PUNCTUATION:[".","!","?",":",","],TERMINAL_PUNCTUATION:[":",".",";","!","?"," "],NONE:0,NUMERIC:1,POSITION:2,COLLAPSE_VALUES:["citation-number","year","year-suffix"],DATE_PARTS:["year","month","day"],DATE_PARTS_ALL:["year","month","day","season"],DATE_PARTS_INTERNAL:["year","month","day","year_end","month_end","day_end"],NAME_PARTS:["family","given","dropping-particle","non-dropping-particle","suffix","literal"],DECORABLE_NAME_PARTS:["given","family","suffix"],DISAMBIGUATE_OPTIONS:["disambiguate-add-names","disambiguate-add-givenname","disambiguate-add-year-suffix"],GIVENNAME_DISAMBIGUATION_RULES:["all-names","all-names-with-initials","primary-name","primary-name-with-initials","by-cite"],NAME_ATTRIBUTES:["and","delimiter-precedes-last","delimiter-precedes-et-al","initialize-with","initialize","name-as-sort-order","sort-separator","et-al-min","et-al-use-first","et-al-subsequent-min","et-al-subsequent-use-first","form","prefix","suffix","delimiter"],PARALLEL_MATCH_VARS:["container-title"],PARALLEL_TYPES:["bill","gazette","regulation","legislation","legal_case","treaty","article-magazine","article-journal"],PARALLEL_COLLAPSING_MID_VARSET:["volume","issue","container-title","section","collection-number"],LOOSE:0,STRICT:1,TOLERANT:2,PREFIX_PUNCTUATION:/[.;:]\s*$/,SUFFIX_PUNCTUATION:/^\s*[.;:,\(\)]/,NUMBER_REGEXP:/(?:^\d+|\d+$)/,NAME_INITIAL_REGEXP:/^([A-Z\u0590-\u05ff\u0080-\u017f\u0400-\u042f\u0600-\u06ff\u0370\u0372\u0376\u0386\u0388-\u03ab\u03e2\u03e4\u03e6\u03e8\u03ea\u03ec\u03ee\u03f4\u03f7\u03fd-\u03ff])([a-zA-Z\u0080-\u017f\u0400-\u052f\u0600-\u06ff\u0370-\u03ff\u1f00-\u1fff]*|)/,ROMANESQUE_REGEXP:/[-0-9a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ROMANESQUE_NOT_REGEXP:/[^a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/g,STARTSWITH_ROMANESQUE_REGEXP:/^[&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]/,ENDSWITH_ROMANESQUE_REGEXP:/[.;:&a-zA-Z\u0590-\u05d4\u05d6-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]$/,ALL_ROMANESQUE_REGEXP:/^[a-zA-Z\u0590-\u05ff\u0080-\u017f\u0400-\u052f\u0370-\u03ff\u1f00-\u1fff\u0600-\u06ff\u200c\u200d\u200e\u0218\u0219\u021a\u021b\u202a-\u202e]+$/,VIETNAMESE_SPECIALS:/[\u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]/,VIETNAMESE_NAMES:/^(?:(?:[.AaBbCcDdEeGgHhIiKkLlMmNnOoPpQqRrSsTtUuVvXxYy \u00c0-\u00c3\u00c8-\u00ca\u00cc\u00cd\u00d2-\u00d5\u00d9\u00da\u00dd\u00e0-\u00e3\u00e8-\u00ea\u00ec\u00ed\u00f2-\u00f5\u00f9\u00fa\u00fd\u0101\u0103\u0110\u0111\u0128\u0129\u0168\u0169\u01a0\u01a1\u01af\u01b0\u1ea0-\u1ef9]{2,6})(\s+|$))+$/,NOTE_FIELDS_REGEXP:/\{:(?:[\-_a-z]+|[A-Z]+):[^\}]+\}/g,NOTE_FIELD_REGEXP:/\{:([\-_a-z]+|[A-Z]+):\s*([^\}]+)\}/,DISPLAY_CLASSES:["block","left-margin","right-inline","indent"],NAME_VARIABLES:["author","editor","translator","contributor","collection-editor","composer","container-author","director","editorial-director","interviewer","original-author","recipient"],NUMERIC_VARIABLES:["call-number","chapter-number","collection-number","edition","page","issue","locator","number","number-of-pages","number-of-volumes","volume","citation-number"],DATE_VARIABLES:["locator-date","issued","event-date","accessed","container","original-date","publication-date","original-date","available-date","submitted"],TAG_ESCAPE:function(t){var e,i,s,n,r;for(e=t.match(/((?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),i=t.split(/(?:(?:\"|\')|(?:(?:<span\s+class=\"no(?:case|decor)\">).*?(?:<\/span>|<\/?(?:i|sc|b)>)))/g),r=[i[0]],n=1,s=i.length;s>n;n+=1)r.push(e[n-1]),r.push(i[n]);return i=r.slice()},TAG_USEALL:function(t){var e,i,s,n;for(e=[""],i=t.indexOf("<"),s=t.indexOf(">");i>-1&&s>-1;)n=i>s?i+1:s+1,s>i&&-1===t.slice(i+1,s).indexOf("<")?(e[e.length-1]+=t.slice(0,i),e.push(t.slice(i,s+1)),e.push(""),t=t.slice(n)):(e[e.length-1]+=t.slice(0,s+1),t=t.slice(n)),i=t.indexOf("<"),s=t.indexOf(">");return e[e.length-1]+=t,e},SKIP_WORDS:["about","above","across","afore","after","against","along","alongside","amid","amidst","among","amongst","anenst","apropos","apud","around","as","aside","astride","at","athwart","atop","barring","before","behind","below","beneath","beside","besides","between","beyond","but","by","circa","despite","down","during","except","for","forenenst","from","given","in","inside","into","lest","like","modulo","near","next","notwithstanding","of","off","on","onto","out","over","per","plus","pro","qua","sans","since","than","through"," thru","throughout","thruout","till","to","toward","towards","under","underneath","until","unto","up","upon","versus","vs.","v.","vs","v","via","vis- -vis","with","within","without","according to","ahead of","apart from","as for","as of","as per","as regards","aside from","back to","because of","close to","due to","except for","far from","inside of","instead of","near to","next to","on to","out from","out of","outside of","prior to","pursuant to","rather than","regardless of","such as","that of","up to","where as","or","yet","so","for","and","nor","a","an","the","de","d'","von","van","c","et","ca"],FORMAT_KEY_SEQUENCE:["@strip-periods","@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align","@quotes"],INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"],SUFFIX_CHARS:"a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z",ROMAN_NUMERALS:[["","i","ii","iii","iv","v","vi","vii","viii","ix"],["","x","xx","xxx","xl","l","lx","lxx","lxxx","xc"],["","c","cc","ccc","cd","d","dc","dcc","dccc","cm"],["","m","mm","mmm","mmmm","mmmmm"]],CREATORS:["author","editor","contributor","translator","recipient","interviewer","composer","original-author","container-author","collection-editor"],LANGS:{"af-ZA":"Afrikaans","ar-AR":"Arabic","bg-BG":"Bulgarian","ca-AD":"Catalan","cs-CZ":"Czech","da-DK":"Danish","de-AT":"Austrian","de-CH":"German (CH)","de-DE":"German (DE)","el-GR":"Greek","en-GB":"English (GB)","en-US":"English (US)","es-ES":"Spanish","et-EE":"Estonian",eu:"European","fa-IR":"Persian","fi-FI":"Finnish","fr-CA":"French (CA)","fr-FR":"French (FR)","he-IL":"Hebrew","hr-HR":"Croatian","hu-HU":"Hungarian","is-IS":"Icelandic","it-IT":"Italian","ja-JP":"Japanese","km-KH":"Khmer","ko-KR":"Korean","lt-LT":"Lithuanian","lv-LV":"Latvian","mn-MN":"Mongolian","nb-NO":"Norwegian (Bokml)","nl-NL":"Dutch","nn-NO":"Norwegian (Nynorsk)","pl-PL":"Polish","pt-BR":"Portuguese (BR)","pt-PT":"Portuguese (PT)","ro-RO":"Romanian","ru-RU":"Russian","sk-SK":"Slovak","sl-SI":"Slovenian","sr-RS":"Serbian","sv-SE":"Swedish","th-TH":"Thai","tr-TR":"Turkish","uk-UA":"Ukranian","vi-VN":"Vietnamese","zh-CN":"Chinese (CN)","zh-TW":"Chinese (TW)"},LANG_BASES:{af:"af_ZA",ar:"ar_AR",bg:"bg_BG",ca:"ca_AD",cs:"cs_CZ",da:"da_DK",de:"de_DE",el:"el_GR",en:"en_US",es:"es_ES",et:"et_EE",eu:"eu",fa:"fa_IR",fi:"fi_FI",fr:"fr_FR",he:"he_IL",hu:"hu_HU",is:"is_IS",it:"it_IT",ja:"ja_JP",km:"km_KH",ko:"ko_KR",lt:"lt_LT",mn:"mn_MN",nb:"nb_NO",nl:"nl_NL",nn:"nn-NO",pl:"pl_PL",pt:"pt_PT",ro:"ro_RO",ru:"ru_RU",sk:"sk_SK",sl:"sl_SI",sr:"sr_RS",sv:"sv_SE",th:"th_TH",tr:"tr_TR",uk:"uk_UA",vi:"vi_VN",zh:"zh_CN"},SUPERSCRIPTS:{"":"a","":"2","":"3","":"1","":"o","":"h","":"","":"j","":"r","":"","":"","":"","":"w","":"y","":"","":"l","":"s","":"x","":"","":"A","":"","":"B","":"D","":"E","":"","":"G","":"H","":"I","":"J","":"K","":"L","":"M","":"N","":"O","":"","":"P","":"R","":"T","":"U","":"W","":"a","":"","":"","":"","":"b","":"d","":"e","":"","":"","":"","":"g","":"k","":"m","":"","":"o","":"","":"","":"","":"p","":"t","":"u","":"","":"","":"v","":"","":"","":"","":"","":"","":"","":"0","":"i","":"4","":"5","":"6","":"7","":"8","":"9","":"+","":"","":"=","":"(","":")","":"n","":"SM","":"TM","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""},SUPERSCRIPTS_REGEXP:new RegExp("[]","g"),locale:{},locale_opts:{},locale_dates:{}};if("undefined"!=typeof t&&"undefined"!=typeof e&&"exports"in e){var r=!0,o=t("./csl_nodejs_jsdom").CSL_NODEJS_JSDOM;s.CSL=n}n.TERMINAL_PUNCTUATION_REGEXP=new RegExp("^(["+n.TERMINAL_PUNCTUATION.slice(0,-1).join("")+"])(.*)"),n.CLOSURES=new RegExp(".*[\\]\\)]"),"object"==typeof console&&"function"==typeof console.log?(n.debug=function(t){console.log("CSL: "+t)},n.error=function(t){console.log("CSL error: "+t)}):(n.debug=function(){},n.error=function(t){throw"CSL error: "+t});var a;a="undefined"!=typeof r?o:"undefined"!=typeof CSL_E4X?CSL_E4X:"undefined"!=typeof CSL_JSON?CSL_JSON:CSL_CHROME,n.System={},n.System.Xml={Parsing:a},n.getSortCompare=function(t){if(n.stringCompare)return n.stringCompare;var e,i={sensitivity:"base",ignorePunctuation:!0,numeric:!0};t||(t="en-US"),e=function(e,s){return e.toLocaleLowerCase().localeCompare(s.toLocaleLowerCase(),t,i)};var s=function(t){return t.replace(/^[\[\]\'\"]*/g,"")},r=function(){return e("[x","x")?function(t,i){return e(s(t),s(i))}:!1},o=r(),a=function(t,i){return o?o(t,i):e(t,i)};return a},n.ambigConfigDiff=function(t,e){var i,s,n,r;if(t.names.length!==e.names.length)return 1;for(i=0,s=t.names.length;s>i;i+=1){if(t.names[i]!==e.names[i])return 1;for(n=0,r=t.givens[i];r>n;n+=1)if(t.givens[i][n]!==e.givens[i][n])return 1}return t.disambiguate!=e.disambiguate?1:t.year_suffix!==e.year_suffix?1:0},n.cloneAmbigConfig=function(t,e,i){var s,n,r,o,a,l={};for(l.names=[],l.givens=[],l.year_suffix=!1,l.disambiguate=!1,s=0,n=t.names.length;n>s;s+=1)a=t.names[s],l.names[s]=a;for(s=0,n=t.givens.length;n>s;s+=1){for(a=[],r=0,o=t.givens[s].length;o>r;r+=1)a.push(t.givens[s][r]);l.givens.push(a)}return e?(l.year_suffix=e.year_suffix,l.disambiguate=e.disambiguate):(l.year_suffix=t.year_suffix,l.disambiguate=t.disambiguate),l},n.getAmbigConfig=function(){var t,e;return t=this.tmp.disambig_request,t||(t=this.tmp.disambig_settings),e=n.cloneAmbigConfig(t)},n.getMaxVals=function(){return this.tmp.names_max.mystack.slice()},n.getMinVal=function(){return this.tmp["et-al-min"]},n.tokenExec=function(t,e,i){var s,n,r,o,a,l;l=!1,s=t.next,n=!1;var u=function(e){return e?(this.tmp.jump.replace("succeed"),t.succeed):(this.tmp.jump.replace("fail"),t.fail)};for(t.test&&(s=u.call(this,t.test(e,i))),a=t.execs.length,o=0;a>o;o+=1)r=t.execs[o],n=r.call(t,this,e,i),n&&(s=n);return s},n.expandMacro=function(t){var e,i,s,r;if(e=t.postponed_macro,this.build.macro_stack.indexOf(e)>-1)throw'CSL processor error: call to macro "'+e+'" would cause an infinite loop';this.build.macro_stack.push(e);var o=!1,a=!1;if(i=this.sys.xml.getNodesByName(this.cslXml,"macro",e),i.length&&(a=this.sys.xml.getAttributeValue(i[0],"cslid"),o=this.sys.xml.getAttributeValue(i[0],"macro-has-date")),o&&(r=function(t,e){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!0)},t.execs.push(r)),t.tokentype=n.START,t.cslid=a,n.Node.group.build.call(t,this,this[this.build.area].tokens,!0),!this.sys.xml.getNodeValue(i))throw'CSL style error: undefined macro "'+e+'"';var l=n.makeBuilder(this);l(i[0]),s=new n.Token("group",n.END),t.decorations&&(s.decorations=t.decorations.slice()),o&&(r=function(t,e){t.tmp.extension&&(t.tmp["doing-macro-with-date"]=!1)},s.execs.push(r)),n.Node.group.build.call(s,this,this[this.build.area].tokens,!0),this.build.macro_stack.pop()},n.XmlToToken=function(t,e){var i,s,r,o,a,l,u,c;if(i=t.sys.xml.nodename(this),!t.build.skip||t.build.skip===i){if(!i)return s=t.sys.xml.content(this),void(s&&(t.build.text=s));if(!n.Node[t.sys.xml.nodename(this)])throw'Undefined node name "'+i+'".';if(r=[],o=t.sys.xml.attributes(this),a=n.setDecorations.call(this,t,o),l=new n.Token(i,e),e!==n.END||"if"===i||"else-if"===i||"layout"===i){for(u in o)if(o.hasOwnProperty(u)){if(e===n.END&&"@language"!==u&&"@locale"!==u)continue;if(o.hasOwnProperty(u))if(n.Attributes[u])try{n.Attributes[u].call(l,t,""+o[u])}catch(h){throw n.error(h),"CSL processor error, "+u+" attribute: "+h}else n.debug('warning: undefined attribute "'+u+'" in style')}l.decorations=a}else e===n.END&&o["@variable"]&&(l.hasVariable=!0);c=t[t.build.area].tokens,n.Node[i].build.call(l,t,c)}},n.DateParser=function(){var t,e,i,s,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x,C,w,S,T;for(t=[["",1867],["",1911],["",1925],["",1988]],e={},w=t.length,a=0;w>a;a+=1)l=t[a][0],u=t[a][1],e[l]=u;for(S=[],a=0;w>a;a+=1)u=t[a][0],S.push(u);for(S=S.join("|"),i="(?:"+S+")(?:[0-9]+)",i=new RegExp(i),T="(?:"+S+")(?:[0-9]+)",T=new RegExp(T,"g"),r=/(\u6708|\u5E74)/g,s=/\u65E5/,o=/\u301c/g,c="(?:[?0-9]{1,2}%%NUMD%%){0,2}[?0-9]{4}(?![0-9])",h="[?0-9]{4}(?:%%NUMD%%[?0-9]{1,2}){0,2}(?![0-9])",p="[?0-9]{1,3}",d="[%%DATED%%]",f="[?~]",m="[a-zA-Z]+",g="("+h+"|"+c+"|"+p+"|"+d+"|"+f+"|"+m+")",b=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"-")),v=new RegExp(g.replace(/%%NUMD%%/g,"-").replace(/%%DATED%%/g,"/")),y=new RegExp(g.replace(/%%NUMD%%/g,"/").replace(/%%DATED%%/g,"-")),_=[],x=[],w=_.length,a=0;w>a;a+=1)C=new RegExp(_[a]+".*"),x.push(C);this.mstrings="january february march april may june july august september october november december spring summer fall winter spring summer",this.mstrings=this.mstrings.split(" "),this.setOrderDayMonth=function(){this.monthguess=1,this.dayguess=0},this.setOrderMonthDay=function(){this.monthguess=0,this.dayguess=1},this.setOrderMonthDay(),this.resetMonths=function(){var t,e,i,s;for(this.msets=[],t=0,e=this.mstrings.length;e>t;t+=1)this.msets.push([this.mstrings[t]]);for(this.mabbrevs=[],t=0,e=this.msets.length;e>t;t+=1)for(this.mabbrevs.push([]),i=0,s=this.msets[t].length;s>i;i+=1)this.mabbrevs[t].push(this.msets[t][0].slice(0,3));for(this.mrexes=[],t=0,e=this.mabbrevs.length;e>t;t+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[t].join("|")+")"))},this.resetMonths(),this.addMonths=function(t){var e,i,s,r,o,a,l,u;if("string"==typeof t&&(t=t.split(/\s+/)),12!==t.length&&16!==t.length)return void n.debug("month [+season] list of "+t.length+", expected 12 or 16. Ignoring.");for(e=0,i=t.length;i>e;e+=1){var c=!1,h=!1,p=3,d={};for(s=0,r=this.mabbrevs.length;r>s;s+=1){if(d[s]={},s===e){for(o=0,a=this.mabbrevs[e].length;a>o;o+=1)if(this.mabbrevs[e][o]===t[e].slice(0,this.mabbrevs[e][o].length)){h=!0;break}}else for(o=0,a=this.mabbrevs[s].length;a>o;o+=1)if(c=this.mabbrevs[s][o].length,this.mabbrevs[s][o]===t[e].slice(0,c)){for(;this.msets[s][o].slice(0,c)===t[e].slice(0,c);){if(c>t[e].length||c>this.msets[s][o].length){n.debug("unable to disambiguate month string in date parser: "+t[e]);break}c+=1}p=c,d[s][o]=c}for(l in d)if(d.hasOwnProperty(l))for(u in d[l])d[l].hasOwnProperty(u)&&(c=d[l][u],l=parseInt(l,10),u=parseInt(u,10),this.mabbrevs[l][u]=this.msets[l][u].slice(0,c))}h||(this.msets[e].push(t[e]),this.mabbrevs[e].push(t[e].slice(0,p)))}for(this.mrexes=[],e=0,i=this.mabbrevs.length;i>e;e+=1)this.mrexes.push(new RegExp("(?:"+this.mabbrevs[e].join("|")+")"))},this.parse=function(t){var l,u,c,h,p,d,f,m,g,_,C,S,E,I,O,A,N,k,P,D,R,L,j,M,F,B,q,U,H,$;if(t&&(t=""+t,t=t.replace(/\s*[0-9]{2}:[0-9]{2}(?::[0-9]+)/,""),p=t.match(r))){if(t=t.replace(/\s+/,"","g"),t=t.replace(s,"","g"),t=t.replace(r,"-","g"),t=t.replace(o,"/","g"),t=t.replace("-/","/","g"),t=t.replace(/-$/,"","g"),j=t.split(i),c=[],L=t.match(T)){var z=[];for(a=0,w=L.length;w>a;a+=1)z=z.concat(L[a].match(/([^0-9]+)([0-9]+)/).slice(1));for(a=0,w=j.length;w>a;a+=1)c.push(j[a]),a!==w-1&&(M=2*a,c.push(z[M]),c.push(z[M+1]))}else c=j;for(h=c.length,a=1;h>a;a+=3)c[a+1]=e[c[a]]+parseInt(c[a+1],10),c[a]="";t=c.join(""),t=t.replace(/\s*-\s*$/,"").replace(/\s*-\s*\//,"/"),t=t.replace(/\.\s*$/,""),t=t.replace(/\.(?! )/,""),l=t.indexOf("/"),u=t.indexOf("-")}if(t=t.replace(/([A-Za-z])\./g,"$1"),d="",f="",m={},'"'===t.slice(0,1)&&'"'===t.slice(-1))return m.literal=t.slice(1,-1),m;for(l>-1&&u>-1?(g=t.split("/"),g.length>3?(_="-",C="/",c=t.split(y)):(_="/",C="-",c=t.split(v))):(t=t.replace("/","-"),_="-",C="-",c=t.split(b)),S=[],w=c.length,a=0;w>a;a+=1)P=c[a],p=P.match(/^\s*([\-\/]|[a-zA-Z]+|[\-~?0-9]+)\s*$/),p&&S.push(p[1]);for(E=S.indexOf(_),I=[],O=!1,E>-1?(I.push([0,E]),I.push([E+1,S.length]),O=!0):I.push([0,S.length]),A="",F=0,B=I.length;B>F;F+=1){for(D=I[F],N=S.slice(D[0],D[1]),q=0,U=N.length;U>q;q+=1)if(R=N[q],R.indexOf(C)>-1)this.parseNumericDate(m,C,A,R);else if(R.match(/[0-9]{4}/))m["year"+A]=R.replace(/^0*/,"");else{for(k=!1,H=0,$=this.mrexes.length;$>H;H+=1){if(R.toLocaleLowerCase().match(this.mrexes[H])){m["month"+A]=""+(parseInt(H,10)+1),k=!0;break}k||(R.match(/^[0-9]+$/)&&(d=parseInt(R,10)),R.toLocaleLowerCase().match(/^bc/)&&d?(m["year"+A]=""+-1*d,d=""):R.toLocaleLowerCase().match(/^ad/)&&d&&(m["year"+A]=""+d,d=""))}for(k=!1,H=0,$=x.length;$>H;H+=1)if(R.toLocaleLowerCase().match(x[H])){m["season"+A]=""+(parseInt(H,10)+1),k=!0;break}k||("~"===R||"?"===R||"c"===R||R.match(/^cir/)?m.circa="1":!R.toLocaleLowerCase().match(/(?:mic|tri|hil|eas)/)||m["season"+A]||(f=R))}d&&(m["day"+A]=d,d=""),f&&!m["season"+A]&&(m["season"+A]=f,f=""),A="_end"}if(O)for(q=0,U=n.DATE_PARTS_ALL.length;U>q;q+=1)P=n.DATE_PARTS_ALL[q],m[P]&&!m[P+"_end"]?m[P+"_end"]=m[P]:!m[P]&&m[P+"_end"]&&(m[P]=m[P+"_end"]);return m.year||(m={literal:t}),this.use_array&&this.toArray(m),m},this.returnAsArray=function(){this.use_array=!0},this.returnAsKeys=function(){this.use_array=!1},this.toArray=function(t){var e,i,s;t["date-parts"]=[],t["date-parts"].push([]);var n=0;for(e=0,i=3;i>e&&(s=["year","month","day"][e],t[s]);e+=1)n+=1,t["date-parts"][0].push(t[s]),delete t[s];for(t["date-parts"].push([]),e=0,i=n;i>e&&(s=["year_end","month_end","day_end"][e],t[s]);e+=1)t["date-parts"][1].push(t[s]),delete t[s];t["date-parts"][0].length!==t["date-parts"][1].length&&t["date-parts"].pop()},this.parseNumericDate=function(t,e,i,s){var n,r,o;for(n=s.split(e),r=0,o=n.length;o>r;r+=1)if(4===n[r].length){t["year"+i]=n[r].replace(/^0*/,""),n=r?n.slice(0,r):n.slice(1);break}for(r=0,o=n.length;o>r;r+=1)n[r]=parseInt(n[r],10);1===n.length||2===n.length&&!n[1]?t["month"+i]=""+n[0]:2===n.length&&(n[this.monthguess]>12?(t["month"+i]=""+n[this.dayguess],t["day"+i]=""+n[this.monthguess]):(t["month"+i]=""+n[this.monthguess],t["day"+i]=""+n[this.dayguess]))}},n.Engine=function(t,e,i,s){function r(t){var t=t.slice(),e=new RegExp("((?:[?!:]*\\s+|-|^)(?:"+t.join("|")+")(?=[!?:]*\\s+|-|$))");return e}var o,a;this.processor_version=n.PROCESSOR_VERSION,this.csl_version="1.0",this.sys=t,t.variableWrapper&&(n.VARIABLE_WRAPPER_PREPUNCT_REX=new RegExp("^(["+[" "].concat(n.SWAPPING_PUNCTUATION).join("")+"]*)(.*)")),this.sys.xml=new n.System.Xml.Parsing,"undefined"==typeof CSL_JSON&&"string"!=typeof e&&(e=""),n.getAbbreviation&&(this.sys.getAbbreviation=n.getAbbreviation),this.sys.stringCompare&&(n.stringCompare=this.sys.stringCompare),this.sys.AbbreviationSegments=n.AbbreviationSegments,this.parallel=new n.Parallel(this),this.transform=new n.Transform(this),this.setParseNames=function(t){this.opt["parse-names"]=t},this.opt=new n.Engine.Opt,this.tmp=new n.Engine.Tmp,this.build=new n.Engine.Build,this.fun=new n.Engine.Fun(this),this.configure=new n.Engine.Configure,this.citation_sort=new n.Engine.CitationSort,this.bibliography_sort=new n.Engine.BibliographySort,this.citation=new n.Engine.Citation(this),this.bibliography=new n.Engine.Bibliography,this.output=new n.Output.Queue(this),this.dateput=new n.Output.Queue(this),this.cslXml=this.sys.xml.makeXml(e),(this.opt.development_extensions.csl_reverse_lookup_support||this.sys.csl_reverse_lookup_support)&&(this.build.cslNodeId=0,this.setCslNodeIds=function(t,e){var i=this.sys.xml.children(t);this.sys.xml.setAttribute(t,"cslid",this.build.cslNodeId),this.opt.nodenames.push(e),this.build.cslNodeId+=1;for(var s=0,n=this.sys.xml.numberofnodes(i);n>s;s+=1)e=this.sys.xml.nodename(i[s]),e&&this.setCslNodeIds(i[s],e)},this.setCslNodeIds(this.cslXml,"style")),this.sys.xml.addMissingNameNodes(this.cslXml),this.sys.xml.addInstitutionNodes(this.cslXml),this.sys.xml.insertPublisherAndPlace(this.cslXml),this.sys.xml.flagDateMacros(this.cslXml),o=this.sys.xml.attributes(this.cslXml),"undefined"==typeof o["@sort-separator"]&&this.sys.xml.setAttribute(this.cslXml,"sort-separator",", "),this.opt["initialize-with-hyphen"]=!0,this.setStyleAttributes(),this.opt.xclass=t.xml.getAttributeValue(this.cslXml,"class"),this.opt.styleID=this.sys.xml.getStyleId(this.cslXml),this.opt.styleName=this.sys.xml.getStyleId(this.cslXml,!0),n.getSuppressJurisdictions&&(this.opt.suppressJurisdictions=n.getSuppressJurisdictions(this.opt.styleID)),i&&(i=i.replace("_","-")),this.opt["default-locale"][0]&&(this.opt["default-locale"][0]=this.opt["default-locale"][0].replace("_","-")),i&&s&&(this.opt["default-locale"]=[i]),i&&!s&&this.opt["default-locale"][0]&&(i=this.opt["default-locale"][0]),0===this.opt["default-locale"].length&&(i||(i="en-US"),this.opt["default-locale"].push("en-US")),i||(i=this.opt["default-locale"][0]),a=n.localeResolve(i),this.opt.lang=a.best,this.opt["default-locale"][0]=a.best,this.locale={},this.opt["default-locale-sort"]||(this.opt["default-locale-sort"]=this.opt["default-locale"][0]),this.localeConfigure(a),this.locale[this.opt.lang].opts["skip-words-regexp"]=r(this.locale[this.opt.lang].opts["skip-words"]),this.output.adjust=new n.Output.Queue.adjust(this.getOpt("punctuation-in-quote")),this.registry=new n.Registry(this),this.buildTokenLists("citation"),this.buildTokenLists("bibliography"),this.configureTokenLists(),this.disambiguate=new n.Disambiguation(this),this.splice_delimiter=!1,this.fun.dateparser=new n.DateParser,this.fun.flipflopper=new n.Util.FlipFlopper(this),this.setCloseQuotesArray(),this.fun.ordinalizer.init(this),this.fun.long_ordinalizer.init(this),this.fun.page_mangler=n.Util.PageRangeMangler.getFunction(this,"page"),this.fun.year_mangler=n.Util.PageRangeMangler.getFunction(this,"year"),this.setOutputFormat("html")},n.Engine.prototype.setCloseQuotesArray=function(){var t;t=[],t.push(this.getTerm("close-quote")),t.push(this.getTerm("close-inner-quote")),t.push('"'),t.push("'"),this.opt.close_quotes_array=t},n.makeBuilder=function(t){function e(e){n.XmlToToken.call(e,t,n.START)}function i(e){n.XmlToToken.call(e,t,n.END)}function s(e){n.XmlToToken.call(e,t,n.SINGLETON)}function r(o){var a;if(t.sys.xml.numberofnodes(t.sys.xml.children(o))){a=o,e(a);for(var l=0;l<t.sys.xml.numberofnodes(t.sys.xml.children(a));l+=1)o=t.sys.xml.children(a)[l],null!==t.sys.xml.nodename(o)&&("date"===t.sys.xml.nodename(o)&&(n.Util.fixDateNode.call(t,a,l,o),o=t.sys.xml.children(a)[l]),r(o,e,i,s));i(a)}else s(o)}return r},n.Engine.prototype.buildTokenLists=function(t){var e,i=n.makeBuilder(this);if(e=this.sys.xml.getNodesByName(this.cslXml,t),this.sys.xml.getNodeValue(e)){this.build.area=t;var s=e[0];i(s)}},n.Engine.prototype.setStyleAttributes=function(){var t,e,i;t={};var s=this.cslXml,r=this.cslXml.tagName?(""+this.cslXml.tagName).toLowerCase():"";if("style"!==r&&"cslstyle"!==r&&this.cslXml.getElementsByTagName)var s=this.cslXml.getElementsByTagName("style")[0];t.name=this.sys.xml.nodename(s),e=this.sys.xml.attributes(s);for(i in e)e.hasOwnProperty(i)&&n.Attributes[i].call(t,this,e[i])},n.Engine.prototype.getTerm=function(t,e,i,s,r,o){t&&t.match(/[A-Z]/)&&t===t.toUpperCase()&&(n.debug("Warning: term key is in uppercase form: "+t),t=t.toLowerCase());var a;a=o?this.opt["default-locale"][0]:this.opt.lang;var l=n.Engine.getField(n.LOOSE,this.locale[a].terms,t,e,i,s);if(l||"range-delimiter"!==t||(l=""),"undefined"==typeof l){if(r===n.STRICT)throw'Error in getTerm: term "'+t+'" does not exist.';r===n.TOLERANT&&(l="")}return l&&(this.tmp.cite_renders_content=!0),l},n.Engine.prototype.getDate=function(t,e){var i;return i=e?this.opt["default-locale"]:this.opt.lang,this.locale[i].dates[t]?this.locale[i].dates[t]:!1},n.Engine.prototype.getOpt=function(t){return"undefined"!=typeof this.locale[this.opt.lang].opts[t]?this.locale[this.opt.lang].opts[t]:!1},n.Engine.prototype.getVariable=function(t,e,i,s){return n.Engine.getField(n.LOOSE,t,e,i,s)},n.Engine.prototype.getDateNum=function(t,e){return"undefined"==typeof t?0:t[e]},n.Engine.getField=function(t,e,i,s,r,o){var a,l,u,c,h,p;a="";{if("undefined"!=typeof e[i]){for(p=o&&e[i][o]?e[i][o]:e[i],l=[],"symbol"===s?l=["symbol","short"]:"verb-short"===s?l=["verb-short","verb"]:"long"!==s&&(l=[s]),l=l.concat(["long"]),h=l.length,c=0;h>c;c+=1)if(u=l[c],"string"==typeof p||"number"==typeof p)a=p;else if("undefined"!=typeof p[u]){a="string"==typeof p[u]||"number"==typeof p[u]?p[u]:"number"==typeof r?p[u][r]:p[u][0];break}return a}if(t===n.STRICT)throw'Error in getField: term "'+i+'" does not exist.'}},n.Engine.prototype.configureTokenLists=function(){var t,e,i,s,r,o,a,l,u,c,h;for(t=["year","month","day"],u=n.AREAS.length,i=0;u>i;i+=1)for(e=n.AREAS[i],c=this[e].tokens.length-1,a=c;a>-1;a+=-1){if(s=this[e].tokens[a],"date"===s.name&&n.END===s.tokentype&&(r=[]),"date-part"===s.name&&s.strings.name)for(h=t.length,l=0;h>l;l+=1)o=t[l],o===s.strings.name&&r.push(s.strings.name);"date"===s.name&&n.START===s.tokentype&&(r.reverse(),s.dateparts=r),s.next=a+1,s.name&&n.Node[s.name].configure&&n.Node[s.name].configure.call(s,this,a)}return this.version=n.version,this.state},n.Engine.prototype.retrieveItems=function(t){var e;e=[];for(var i=0,s=t.length;s>i;i+=1)e.push(this.retrieveItem(""+t[i]));return e},n.ITERATION=0,n.Engine.prototype.retrieveItem=function(t){var e,i,s,r,o;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&"boolean"==typeof this.opt.development_extensions.normalize_lang_keys_to_lowercase){for(var a=0,l=this.opt["default-locale"].length;l>a;a+=1)this.opt["default-locale"][a]=this.opt["default-locale"][a].toLowerCase();for(var a=0,l=this.opt["locale-translit"].length;l>a;a+=1)this.opt["locale-translit"][a]=this.opt["locale-translit"][a].toLowerCase();for(var a=0,l=this.opt["locale-translat"].length;l>a;a+=1)this.opt["locale-translat"][a]=this.opt["locale-translat"][a].toLowerCase();this.opt.development_extensions.normalize_lang_keys_to_lowercase=100}if(n.ITERATION+=1,e=this.sys.retrieveItem(""+t),this.opt.development_extensions.normalize_lang_keys_to_lowercase){if(e.multi){if(e.multi._keys)for(var u in e.multi._keys)for(var c in e.multi._keys[u])c!==c.toLowerCase()&&(e.multi._keys[u][c.toLowerCase()]=e.multi._keys[u][c],delete e.multi._keys[u][c]);if(e.multi.main)for(var u in e.multi.main)e.multi.main[u]=e.multi.main[u].toLowerCase()}for(var a=0,l=n.CREATORS.length;a>l;a+=1){var h=n.CREATORS[a];if(e[h]&&e[h].multi)for(var p=0,d=e[h].length;d>p;p+=1){var f=e[h][p];if(f.multi){if(f.multi._key)for(var c in f.multi._key)c!==c.toLowerCase()&&(f.multi._key[c.toLowerCase()]=f.multi._key[c],delete f.multi._key[c]);f.multi.main&&(f.multi.main=f.multi.main.toLowerCase())}}}}if(e.page){e["page-first"]=e.page;var m=""+e.page;i=m.split(/\s*(?:&|,|-|\u2013)\s*/),"\\"!==i[0].slice(-1)&&(e["page-first"]=i[0]);
}if(this.opt.development_extensions.field_hack&&e.note&&(i=e.note.match(n.NOTE_FIELDS_REGEXP))){for(s=0,r=i.length;r>s;s+=1){if(o=i[s].match(n.NOTE_FIELD_REGEXP),!e[o[1]]&&n.DATE_VARIABLES.indexOf(o[1])>-1)e[o[1]]={raw:o[2]};else if(!e[o[1]]&&n.NAME_VARIABLES.indexOf(o[1])>-1){e[o[1]]||(e[o[1]]=[]);var g=o[2].split(/\s*\|\|\s*/);1===g.length?e[o[1]].push({family:g[0],isInstitution:!0}):2===g.length&&e[o[1]].push({family:g[0],given:g[1]})}else e[o[1]]&&"type"!==o[1]||(e[o[1]]=o[2].replace(/^\s+/,"").replace(/\s+$/,""));e.note.replace(n.NOTE_FIELD_REGEXP,"")}}for(var a=1,l=n.DATE_VARIABLES.length;l>a;a+=1){var b=e[n.DATE_VARIABLES[a]];b&&(this.opt.development_extensions.raw_date_parsing&&b.raw&&(b=this.fun.dateparser.parse(b.raw)),e[n.DATE_VARIABLES[a]]=this.dateParseArray(b))}if(this.opt.development_extensions.static_statute_locator&&e.type&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){var v,y=["type","title","jurisdiction","genre","volume","container-title"],_=[];for(a=0,l=y.length;l>a;a+=1)v=y[a],e[v]&&_.push(e[v]);for(y=["original-date","issued"],a=0,y.length;l>a;a+=1)if(v=y[a],e[v]&&e[v].year){var x=e[v].year;_.push(x);break}e.legislation_id=_.join("::")}if(e["title-short"]||(e["title-short"]=e.shortTitle),this.opt.development_extensions.main_title_from_short_title&&(e["title-main"]=e.title,e["title-sub"]=!1,e.title&&e["title-short"])){var C=e["title-short"];offset=C.length,e.title.slice(0,offset)===C&&e.title.slice(offset).match(/^\s*:/)&&(e["title-main"]=e.title.slice(0,offset).replace(/\s+$/,""),e["title-sub"]=e.title.slice(offset).replace(/^\s*:\s*/,""))}var w=["legal_case","legislation","gazette","regulation"].indexOf(e.type)>-1;if(!w&&e.title&&this.sys.getAbbreviation){var S=!1;e.jurisdiction||(S=!0);var T=this.transform.loadAbbreviation(e.jurisdiction,"title",e.title,e.type,!0);this.transform.abbrevs[T].title&&this.transform.abbrevs[T].title[e.title]&&(e["title-short"]=this.transform.abbrevs[T].title[e.title])}if(e["container-title-short"]=e.journalAbbreviation,e["container-title"]&&this.sys.getAbbreviation){var T=this.transform.loadAbbreviation(e.jurisdiction,"container-title",e["container-title"]);this.transform.abbrevs[T]["container-title"]&&this.transform.abbrevs[T]["container-title"][e["container-title"]]&&(e["container-title-short"]=this.transform.abbrevs[T]["container-title"][e["container-title"]])}return e},n.Engine.prototype.setOpt=function(t,e,i){"style"===t.name||"cslstyle"===t.name?this.opt[e]=i:["citation","bibliography"].indexOf(t.name)>-1?this[t.name].opt[e]=i:-1===["name-form","name-delimiter","names-delimiter"].indexOf(e)&&(t.strings[e]=i)},n.Engine.prototype.fixOpt=function(t,e,i){["citation","bibliography"].indexOf(t.name)>-1&&(this[t.name].opt[e]||"undefined"==typeof this.opt[e]||(this[t.name].opt[e]=this.opt[e])),("name"===t.name||"names"===t.name)&&"undefined"==typeof t.strings[i]&&"undefined"!=typeof this[this.build.root].opt[e]&&(t.strings[i]=this[this.build.root].opt[e])},n.Engine.prototype.remapSectionVariable=function(t){for(var e=0,i=t.length;i>e;e+=1){var s=t[e][0],r=t[e][1],o=!1;if(["bill","gazette","legislation","treaty"].indexOf(s.type)>-1){r.force_pluralism=0,r.label||(r.label="page");var a=["section","","",""];if(this.opt.development_extensions.static_statute_locator&&s.section?(l=s.section.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/),n.STATUTE_SUBDIV_STRINGS[l[0]]?(a[0]=" "+l[0]+" ",a[1]=l.slice(1).join(" ")):(a[0]=" sec. ",a[1]=l.slice(0).join(" "))):this.opt.development_extensions.clobber_locator_if_no_statute_section&&(r.locator=void 0,r.label=void 0),r.locator){var l=r.locator.replace(/^\s+/,"").replace(/\s+$/,"").split(/\s+/);n.STATUTE_SUBDIV_STRINGS[l[0]]?(a[2]=" "+l[0]+" ",a[3]=l.slice(1).join(" ")):r.label?(a[2]=" "+n.STATUTE_SUBDIV_STRINGS_REVERSE[r.label]+" ",a[3]=l.slice(0).join(" ")):a[3]=l.join(" "),a[3]&&"&"===a[3].slice(0,1)&&(a[3]=" "+a[3])}if(a[2]||(a[2]=a[0]),a[3]){if(a[3].match(/^[^0-9a-zA-Z]/)){var u=a[3].split(/\s+/);a[0]===a[2]&&u[1]&&!n.STATUTE_SUBDIV_STRINGS[u[1].replace(/\s+/,"").replace(/\s+/,"")]&&(r.force_pluralism=1),a[2]=""}}else a[2]="";a[1]||(a[0]="");var o=a.join("");if(o=o.replace(/^\s+/,"").replace(/\s+$/,""))if(l=o.split(/\s+/),n.STATUTE_SUBDIV_STRINGS[l[0]]){for(var c=l.length-2;c>0;c+=-2)l[c]===l[0]&&(r.force_pluralism=1,l=l.slice(0,c).concat(l.slice(c+1)));r.label=n.STATUTE_SUBDIV_STRINGS[l[0]],r.locator=l.slice(1).join(" "),0===r.force_pluralism&&delete r.force_pluralism}else r.locator=l.slice(0).join(" ")}}},n.Engine.prototype.setNumberLabels=function(t){if(t.number&&["bill","gazette","legislation","treaty"].indexOf(t.type)>-1&&this.opt.development_extensions.static_statute_locator&&!this.tmp.shadow_numbers.number){this.tmp.shadow_numbers.number={},this.tmp.shadow_numbers.number.values=[],this.tmp.shadow_numbers.number.plural=0,this.tmp.shadow_numbers.number.numeric=!1,this.tmp.shadow_numbers.number.label=!1;var e=""+t.number;e=e.replace("\\","","g");var i=e.split(/\s/)[0],s=n.STATUTE_SUBDIV_STRINGS[i];if(s){var r=e.match(n.STATUTE_SUBDIV_GROUPED_REGEX),o=e.split(n.STATUTE_SUBDIV_PLAIN_REGEX);if(o.length>1){for(var a=[],l=1,u=o.length;u>l;l+=1){var c=r[l-1].replace(/^\s*/,"");a.push(c.replace("sec.","Sec.").replace("ch.","Ch.")),a.push(o[l].replace(/\s*$/,"").replace(/^\s*/,""))}e=a.join(" ")}else e=o[0];this.tmp.shadow_numbers.number.values.push(["Blob",e,!1]),this.tmp.shadow_numbers.number.numeric=!1}else this.tmp.shadow_numbers.number.values.push(["Blob",e,!1]),this.tmp.shadow_numbers.number.numeric=!0}},n.substituteOne=function(t){return function(e,i){return i?t.replace("%%STRING%%",i):""}},n.substituteTwo=function(t){return function(e){var i=t.replace("%%PARAM%%",e);return function(t,e){return e?i.replace("%%STRING%%",e):""}}},n.Mode=function(t){var e,i,s,r,o,a;e={},i=n.Output.Formats[t];for(s in i)if("@"===s.slice(0,1)){if(r=!1,o=i[s],a=s.split("/"),"string"==typeof o&&o.indexOf("%%STRING%%")>-1)r=o.indexOf("%%PARAM%%")>-1?n.substituteTwo(o):n.substituteOne(o);else if("boolean"!=typeof o||o){if("function"!=typeof o)throw"CSL.Compiler: Bad "+t+" config entry for "+s+": "+o;r=o}else r=n.Output.Formatters.passthrough;1===a.length?e[a[0]]=r:2===a.length&&(e[a[0]]||(e[a[0]]={}),e[a[0]][a[1]]=r)}else e[s]=i[s];return e},n.setDecorations=function(t,e){var i,s,r;i=[];for(r in n.FORMAT_KEY_SEQUENCE)s=n.FORMAT_KEY_SEQUENCE[r],e[s]&&(i.push([s,e[s]]),delete e[s]);return i},n.Engine.prototype.normalDecorIsOrphan=function(t,e){if("normal"===e[1]){var i,s=!1;i="citation"===this.tmp.area?[this.citation.opt.layout_decorations].concat(t.alldecor):t.alldecor;for(var n=i.length-1;n>-1;n+=-1)for(var r=i[n].length-1;r>-1;r+=-1)i[n][r][0]===e[0]&&"normal"!==i[n][r][1]&&(s=!0);if(!s)return!0}return!1},n.Engine.prototype.getCitationLabel=function(t){var e="",i=this.getTrigraphParams(),s=i[0],r=this.getTerm("reference","short",0);"undefined"==typeof r&&(r="reference"),r=r.replace(".",""),r=r.slice(0,1).toUpperCase()+r.slice(1);for(var o=0,a=n.CREATORS.length;a>o;o+=1){var l=n.CREATORS[o];if(t[l]){var u=t[l];s=u.length>i.length?i[i.length-1]:i[u.length-1];for(var c=0,h=u.length;h>c&&c!==s.authors.length;c+=1){var p=this.nameOutput.getName(u[c],"locale-translit",!0),d=p.name;d&&d.family?(r=d.family,r=r.replace(/^([ \'\u2019a-z]+\s+)/,"")):d&&d.literal&&(r=d.literal);var f=r.toLowerCase().match(/^(a\s+|the\s+|an\s+)/);if(f&&(r=r.slice(f[1].length)),r=r.replace(n.ROMANESQUE_NOT_REGEXP,"","g"),!r)break;r=r.slice(0,s.authors[c]),r.length>1?r=r.slice(0,1).toUpperCase()+r.slice(1).toLowerCase():1===r.length&&(r=r.toUpperCase()),e+=r}break}}var m="0000";return t.issued&&t.issued.year&&(m=""+t.issued.year),m=m.slice(-1*s.year),e+=m},n.Engine.prototype.getTrigraphParams=function(){var t=[],e=this.opt.trigraph.split(":");if(!this.opt.trigraph||"A"!==this.opt.trigraph.slice(0,1))throw"Bad trigraph definition: "+this.opt.trigraph;for(var i=0,s=e.length;s>i;i+=1){for(var n=e[i],r={authors:[],year:0},o=0,a=n.length;a>o;o+=1)switch(n.slice(o,o+1)){case"A":r.authors.push(1);break;case"a":r.authors[r.authors.length-1]+=1;break;case"0":r.year+=1;break;default:throw"Invalid character in trigraph definition: "+this.opt.trigraph}t.push(r)}return t},n.Engine.prototype.setOutputFormat=function(t){this.opt.mode=t,this.fun.decorate=n.Mode(t),this.output[t]||(this.output[t]={},this.output[t].tmp={})},n.Engine.prototype.getSortFunc=function(){return function(t,e){return t=t.split("-"),e=e.split("-"),t.length<e.length?1:t.length>e.length?-1:(t=t.slice(-1)[0],e=e.slice(-1)[0],t.length<e.length?1:t.length>e.length?-1:0)}},n.Engine.prototype.setLangTagsForCslSort=function(t){var e,i;if(t)for(this.opt["locale-sort"]=[],e=0,i=t.length;i>e;e+=1)this.opt["locale-sort"].push(t[e]);this.opt["locale-sort"].sort(this.getSortFunc())},n.Engine.prototype.setLangTagsForCslTransliteration=function(t){var e,i;if(this.opt["locale-translit"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translit"].push(t[e]);this.opt["locale-translit"].sort(this.getSortFunc())},n.Engine.prototype.setLangTagsForCslTranslation=function(t){var e,i;if(this.opt["locale-translat"]=[],t)for(e=0,i=t.length;i>e;e+=1)this.opt["locale-translat"].push(t[e]);this.opt["locale-translat"].sort(this.getSortFunc())},n.Engine.prototype.setLangPrefsForCites=function(t,e){var i=this.opt["cite-lang-prefs"];e||(e=function(t){return t.toLowerCase()});for(var s=["Persons","Institutions","Titles","Journals","Publishers","Places"],n=0,r=s.length;r>n;n+=1){var o=e(s[n]),a=s[n].toLowerCase();if(t[o]){for(var l=[];t[o].length>1;)l.push(t[o].pop());var u={orig:1,translit:2,translat:3};for(2===l.length&&u[l[0]]<u[l[1]]&&l.reverse();l.length;)t[o].push(l.pop());for(var c=i[a];c.length;)c.pop();for(var h=0,p=t[o].length;p>h;h+=1)c.push(t[o][h])}}},n.Engine.prototype.setLangPrefsForCiteAffixes=function(t){if(t&&48===t.length){for(var e,i=this.opt.citeAffixes,s=0,n=["persons","institutions","titles","journals","publishers","places"],r=["translit","orig","translit","translat"],o=0,a=n.length;a>o;o+=1)for(var l=0,u=r.length;u>l;l+=1)e="",s%8===4?i[n[o]]["locale-"+r[l]].prefix||i[n[o]]["locale-"+r[l]].suffix||(e=t[s]?t[s]:"",i[n[o]]["locale-"+r[l]].prefix=e,e=t[s]?t[s+1]:"",i[n[o]]["locale-"+r[l]].suffix=e):(e=t[s]?t[s]:"",i[n[o]]["locale-"+r[l]].prefix=e,e=t[s]?t[s+1]:"",i[n[o]]["locale-"+r[l]].suffix=e),s+=2;this.opt.citeAffixes=i}},n.Engine.prototype.setAutoVietnameseNamesOption=function(t){t?this.opt["auto-vietnamese-names"]=!0:this.opt["auto-vietnamese-names"]=!1},n.Engine.prototype.setAbbreviations=function(t){this.sys.setAbbreviations&&this.sys.setAbbreviations(t)},n.Engine.prototype.setSuppressTrailingPunctuation=function(t){this.citation.opt.suppressTrailingPunctuation=!!t},n.Output={},n.Output.Queue=function(t){this.levelname=["top"],this.state=t,this.queue=[],this.empty=new n.Token("empty");var e={};e.empty=this.empty,this.formats=new n.Stack(e),this.current=new n.Stack(this.queue)},n.Output.Queue.prototype.pop=function(){var t=this.current.value();return t.length?t.pop():t.blobs.pop()},n.Output.Queue.prototype.getToken=function(t){var e=this.formats.value()[t];return e},n.Output.Queue.prototype.mergeTokenStrings=function(t,e){var i,s,r,o;if(i=this.formats.value()[t],s=this.formats.value()[e],r=i,s){i||(i=new n.Token(t,n.SINGLETON),i.decorations=[]),r=new n.Token(t,n.SINGLETON),o="";for(o in i.strings)i.strings.hasOwnProperty(o)&&(r.strings[o]=i.strings[o]);for(o in s.strings)s.strings.hasOwnProperty(o)&&(r.strings[o]=s.strings[o]);r.decorations=i.decorations.concat(s.decorations)}return r},n.Output.Queue.prototype.addToken=function(t,e,i){var s,r;if(s=new n.Token("output"),"string"==typeof i&&(i=this.formats.value()[i]),i&&i.strings){for(r in i.strings)i.strings.hasOwnProperty(r)&&(s.strings[r]=i.strings[r]);s.decorations=i.decorations}"string"==typeof e&&(s.strings.delimiter=e),this.formats.value()[t]=s},n.Output.Queue.prototype.pushFormats=function(t){t||(t={}),t.empty=this.empty,this.formats.push(t)},n.Output.Queue.prototype.popFormats=function(t){this.formats.pop()},n.Output.Queue.prototype.startTag=function(t,e){var i={};this.state.tmp["doing-macro-with-date"]&&this.state.tmp.extension&&(e=this.empty,t="empty"),i[t]=e,this.pushFormats(i),this.openLevel(t)},n.Output.Queue.prototype.endTag=function(t){this.closeLevel(),this.popFormats()},n.Output.Queue.prototype.openLevel=function(t,e){var i,s;if("object"==typeof t)i=new n.Blob(void 0,t);else if("undefined"==typeof t)i=new n.Blob(void 0,this.formats.value().empty,"empty");else{if(!this.formats.value()||!this.formats.value()[t])throw'CSL processor error: call to nonexistent format token "'+t+'"';i=new n.Blob(void 0,this.formats.value()[t],t)}this.nestedBraces&&(i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.prefix=i.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),i.strings.suffix=i.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),s=this.current.value(),s.push(i),this.current.push(i)},n.Output.Queue.prototype.closeLevel=function(t){t&&t!==this.current.value().levelname&&n.error("Level mismatch error:  wanted "+t+" but found "+this.current.value().levelname),this.current.pop()},n.Output.Queue.prototype.append=function(t,e,i,s,r){var o,a,l,u=!0;if(i&&(s=!0),this.state.tmp["doing-macro-with-date"]&&!i){if("macro-with-date"!==e)return!1;"macro-with-date"===e&&(e="empty")}if("undefined"==typeof t)return!1;if("number"==typeof t&&(t=""+t),!i&&this.state.tmp.element_trace&&"suppress-me"===this.state.tmp.element_trace.value())return!1;if(a=!1,e?"literal"===e?(o=!0,u=!1):o="string"==typeof e?this.formats.value()[e]:e:o=this.formats.value().empty,!o)throw"CSL processor error: unknown format token name: "+e;if(o.strings&&"undefined"==typeof o.strings.delimiter&&(o.strings.delimiter=""),"string"==typeof t&&t.length&&(t=t.replace(/ ([:;?!\u00bb])/g,"$1").replace(/\u00ab /g,""),this.last_char_rendered=t.slice(-1),t=t.replace(/\s+'/g,"  '").replace(/^'/g," '"),s?i&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),a=new n.Blob(t,o),this.nestedBraces&&(a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),a.strings.prefix=a.strings.prefix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1]),a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[0][0],this.nestedBraces[0][1]),a.strings.suffix=a.strings.suffix.replace(this.nestedBraces[1][0],this.nestedBraces[1][1])),l=this.current.value(),"undefined"==typeof l&&0===this.current.mystack.length&&(this.current.mystack.push([]),l=this.current.value()),"string"==typeof a.blobs&&(s?i&&(this.state.tmp.term_predecessor_name=!0):this.state.tmp.term_predecessor=!0),i||this.state.parallel.AppendBlobPointer(l),"string"==typeof t){l.push(a),a.strings["text-case"]&&(a.blobs=n.Output.Formatters[a.strings["text-case"]](this.state,t)),this.state.tmp.strip_periods&&!r&&(a.blobs=a.blobs.replace(/\.([^a-z]|$)/g,"$1"));for(var c=a.decorations.length-1;c>-1;c+=-1)"@quotes"===a.decorations[c][0]&&"true"===a.decorations[c][1]&&(a.punctuation_in_quote=this.state.getOpt("punctuation-in-quote")),a.blobs.match(n.ROMANESQUE_REGEXP)||"@font-style"===a.decorations[c][0]&&(a.decorations=a.decorations.slice(0,c).concat(a.decorations.slice(c+1)));this.state.fun.flipflopper.init(t,a),this.state.fun.flipflopper.processTags()}else u?l.push(a):l.push(t);return!0},n.Output.Queue.prototype.string=function(t,e,i){var s,r,o,a,l,u=n.getSafeEscape(this.state),c=e.slice(),h=[];if(0===c.length)return h;var p="";i?p=i.strings.delimiter:(t.tmp.count_offset_characters=!1,t.tmp.offset_characters=0),i&&i.new_locale&&(i.old_locale=t.opt.lang,t.opt.lang=i.new_locale);var d,f,m,g;for(s=0,r=c.length;r>s;s+=1){if(d=c[s],d.strings.first_blob&&(t.tmp.count_offset_characters=d.strings.first_blob),"string"==typeof d.blobs){if("number"==typeof d.num)h.push(d);else if(d.blobs){l=u(d.blobs);var b=l.length;if(!t.tmp.suppress_decorations)for(o=0,a=d.decorations.length;a>o;o+=1)g=d.decorations[o],"@showid"!==g[0]&&(t.normalDecorIsOrphan(d,g)||(l=t.fun.decorate[g[0]][g[1]].call(d,t,l,g[2])));if(l&&l.length){if(l=u(d.strings.prefix,t.tmp.nestedBraces)+l+u(d.strings.suffix,t.tmp.nestedBraces),(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&!t.tmp.suppress_decorations)for(o=0,a=d.decorations.length;a>o;o+=1)g=d.decorations[o],"@showid"===g[0]&&(l=t.fun.decorate[g[0]][g[1]].call(d,t,l,g[2]));h.push(l),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=b+d.strings.suffix.length+d.strings.prefix.length)}}}else if(d.blobs.length){var v=t.output.string(t,d.blobs,d);h=h.concat(v)}d.strings.first_blob&&(t.registry.registry[d.strings.first_blob].offset=t.tmp.offset_characters,t.tmp.count_offset_characters=!1)}for(s=0,r=h.length-1;r>s;s+=1)"number"!=typeof h[s].num||"number"!=typeof h[s+1].num||h[s+1].UGLY_DELIMITER_SUPPRESS_HACK||(h[s].strings.suffix=h[s].strings.suffix+(p?p:""),h[s+1].successor_prefix="",h[s+1].UGLY_DELIMITER_SUPPRESS_HACK=!0);var y=0;for(s=0,r=h.length;r>s;s+=1)"string"==typeof h[s]&&(y=parseInt(s,10)+1,s<h.length-1&&"object"==typeof h[s+1]&&(p&&!h[s+1].UGLY_DELIMITER_SUPPRESS_HACK&&(h[s]+=u(p)),h[s+1].UGLY_DELIMITER_SUPPRESS_HACK=!0));i&&(i.decorations.length||i.strings.suffix||i.strings.prefix)&&(y=h.length);var _=t.output.renderBlobs(h.slice(0,y),p,!0,i);if(_&&i&&(i.decorations.length||i.strings.suffix||i.strings.prefix)){if(!t.tmp.suppress_decorations)for(s=0,r=i.decorations.length;r>s;s+=1)g=i.decorations[s],["@cite","@bibliography","@display","@showid"].indexOf(g[0])>-1||t.normalDecorIsOrphan(d,g)||"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(i,t,_,g[2]));if(l=_,f=i.strings.suffix,l&&l.length&&(m=i.strings.prefix,l=u(m,t.tmp.nestedBraces)+l+u(f,t.tmp.nestedBraces),t.tmp.count_offset_characters&&(t.tmp.offset_characters+=m.length+f.length)),_=l,!t.tmp.suppress_decorations)for(s=0,r=i.decorations.length;r>s;s+=1)g=i.decorations[s],-1!==["@cite","@bibliography","@display","@showid"].indexOf(g[0])&&"string"==typeof _&&(_=t.fun.decorate[g[0]][g[1]].call(i,t,_,g[2]))}var x=h.slice(y,h.length);return!x.length&&_?h=[_]:x.length&&!_?h=x:_&&x.length&&(h=[_].concat(x)),"undefined"==typeof i?(this.queue=[],this.current.mystack=[],this.current.mystack.push(this.queue),t.tmp.suppress_decorations&&(h=t.output.renderBlobs(h,void 0,!0))):"boolean"==typeof i&&(h=t.output.renderBlobs(h,void 0,!0)),i&&i.new_locale&&(t.opt.lang=i.old_locale),h},n.Output.Queue.prototype.clearlevel=function(){var t,e,i;for(t=this.current.value(),i=t.blobs.length,e=0;i>e;e+=1)t.blobs.pop()},n.Output.Queue.prototype.renderBlobs=function(t,e,i,s){var r,o,a,l,u,c,h,p,d,f,m,g;if(g=n.getSafeEscape(this.state),e||(e=""),r=this.state,o="",a=[],l="",h=t.length,"citation"===this.state.tmp.area&&!this.state.tmp.just_looking&&1===h&&"object"==typeof t[0]&&s)return t[0].strings.prefix=s.strings.prefix+t[0].strings.prefix,t[0].strings.suffix=t[0].strings.suffix+s.strings.suffix,t[0].decorations=t[0].decorations.concat(s.decorations),t[0].params=s.params,t[0];var b=!0;for(c=0;h>c;c+=1)t[c].checkNext?(t[c].checkNext(t[c+1],b),b=!1):b=!0;var v=!0;for(c=t.length-1;c>0;c+=-1)t[c].checkLast?v&&t[c].checkLast(t[c-1])&&(v=!1):v=!0;for(h=t.length,c=0;h>c;c+=1)if(u=t[c],o&&(l=e),"string"==typeof u)o+=g(l),o+=u,r.tmp.count_offset_characters&&(r.tmp.offset_characters+=l.length);else if(u.status!==n.SUPPRESS){f=u.formatter.format(u.num,u.gender);var y=f.replace(/<[^>]*>/g,"").length;this.append(f,"empty",!0);var _=this.pop(),x=r.tmp.count_offset_characters;if(f=this.string(r,[_],!1),r.tmp.count_offset_characters=x,u.strings["text-case"]&&(f=n.Output.Formatters[u.strings["text-case"]](this.state,f)),f&&this.state.tmp.strip_periods&&(f=f.replace(/\.([^a-z]|$)/g,"$1")),!r.tmp.suppress_decorations)for(d=u.decorations.length,p=0;d>p;p+=1)m=u.decorations[p],r.normalDecorIsOrphan(u,m)||(f=r.fun.decorate[m[0]][m[1]].call(u,r,f,m[2]));f=g(u.strings.prefix)+f+g(u.strings.suffix);var C="";u.status===n.END?C=g(u.range_prefix):u.status===n.SUCCESSOR?C=g(u.successor_prefix):u.status===n.START?C="":u.status===n.SEEN&&(C=g(u.splice_prefix)),o+=C,o+=f,r.tmp.count_offset_characters&&(r.tmp.offset_characters+=C.length+u.strings.prefix.length+y+u.strings.suffix.length)}return o},n.Output.Queue.purgeEmptyBlobs=function(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=t.blobs.length-1;e>-1;e--){n.Output.Queue.purgeEmptyBlobs(t.blobs[e]);var i=t.blobs[e];if(!i||!i.blobs||!i.blobs.length){for(var s=[];t.blobs.length-1>e;)s.push(t.blobs.pop());for(t.blobs.pop();s.length;)t.blobs.push(s.pop())}}},n.Output.Queue.adjust=function(t){function e(t){return"number"==typeof t.num||t.blobs&&1===t.blobs.length&&"number"==typeof t.blobs[0].num}function i(t){return"number"==typeof t.num?!0:t.blobs&&"object"==typeof t.blobs?i(t.blobs[t.blobs.length-1])?!0:void 0:!1}function s(t,e){var i=!1,s=["@font-style","@font-variant","@font-weight","@text-decoration","@vertical-align"];if(e&&s.push("@quotes"),t.decorations)for(var n=0,r=t.decorations.length;r>n;n++)if(s.indexOf(t.decorations[n][0])>-1){i=!0;break}return i}function n(t){if(t.decorations)for(var e=0,i=t.decorations.length;i>e;e++)if("@quotes"===t.decorations[e][0])return!0;return"object"!=typeof t.blobs?!1:n(t.blobs[t.blobs.length-1])?!0:!1}function r(t,e){if(!g[e])return!1;if("string"==typeof t.blobs)return t.blobs.slice(-1)===e?!0:!1;var i=t.blobs[t.blobs.length-1];if(i){var s=i.strings.suffix.slice(-1);return s?i.strings.suffix.slice(-1)==e?!0:!1:r(i,e)}return!1}function o(t,e,i,s,n){function r(){SecondStrings[s]=SecondStrings[s].slice(1)}function o(){FirstStrings[e]=FirstStrings[e].slice(0,-1)}function a(t){SecondStrings[s]=t+SecondStrings[s]}function l(t){FirstStrings[e]+=t}function u(){return y[m]}function c(){FirstStrings[e].slice(-1);return d[f]}function h(){var t=d[f][m];"string"==typeof t?(o(),r(),a(t)):(a(f),o())}function p(){var t=y[m][f];"string"==typeof t?(o(),r(),l(t)):(l(m),r())}FirstStrings="blobs"===e?t:t.strings,SecondStrings="blobs"===s?i:i.strings;var f=FirstStrings[e].slice(-1),m=SecondStrings[s].slice(0,1),g=n?o:r,b=n?c:u,v=n?h:p,_=f===m;_?g():b()&&v()}function a(t){if(t.blobs&&"string"==typeof t.blobs)return void(g[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=s(t,!0),i=t.blobs.length-1;i>-1;i--){i===t.blobs.length-1;this.upward(t.blobs[i]);var n=t.strings,r=t.blobs[i].strings;if(0===i){" "===n.prefix.slice(-1)&&" "===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1));var o=r.prefix.slice(0,1);e||!b[o]||n.prefix||(n.prefix+=o,r.prefix=r.prefix.slice(1))}if(i===t.blobs.length-1){var o=r.suffix.slice(-1);!e&&[" "].indexOf(o)>-1&&(n.suffix.slice(0,1)!==o&&(n.suffix=o+n.suffix),r.suffix=r.suffix.slice(0,-1))}n.delimiter&&i>0&&b[n.delimiter.slice(-1)]&&n.delimiter.slice(-1)===r.prefix.slice(0,1)&&(r.prefix=r.prefix.slice(1))}}function l(t){if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length)for(var e=t.blobs.length-1;e>-1;e--)if(this.leftward(t.blobs[e]),e<t.blobs.length-1&&!t.strings.delimiter){var i=t.blobs[e],n=i.strings.suffix.slice(-1),r=t.blobs[e+1],a=r.strings.prefix.slice(0,1),l=s(i)||s(r),u="number"==typeof n||"number"==typeof a;if(!l&&!u&&g[a]&&!u){var c=a===i.strings.suffix.slice(-1),h=!i.strings.suffix&&"string"==typeof i.blobs&&i.blobs.slice(-1)===a;c||h?r.strings.prefix=r.strings.prefix.slice(1):o(i,"suffix",r,"prefix")}}}function u(t,a){if(t.blobs&&"string"==typeof t.blobs)return void(g[t.strings.suffix.slice(0,1)]&&t.strings.suffix.slice(0,1)===t.blobs.slice(-1)&&(t.strings.suffix=t.strings.suffix.slice(1)));if("object"==typeof t&&"object"==typeof t.blobs&&t.blobs.length){for(var l=t.strings,u=!1,c=0,h=t.blobs.length;h>c;c++)if(e(t.blobs[c])){u=!0;break}if(!u&&l.delimiter&&g[l.delimiter.slice(0,1)]){for(var p=l.delimiter.slice(0,1),c=t.blobs.length-2;c>-1;c--){var d=t.blobs[c].strings;d.suffix+=p}l.delimiter=l.delimiter.slice(1)}for(var f=s(t,!0),c=(e(t),t.blobs.length-1);c>-1;c--){var m=t.blobs[c],d=t.blobs[c].strings,v=s(m,!0),y=e(m);if(c===t.blobs.length-1){if(!f||n(m)){var _=l.suffix.slice(0,1);g[_]&&(i(m)||(o(m,"suffix",t,"suffix"),"."===l.suffix.slice(0,1)&&(d.suffix+=l.suffix.slice(0,1),l.suffix=l.suffix.slice(1))))," "===d.suffix.slice(-1)&&l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(1))}b[d.suffix.slice(0,1)]&&("string"==typeof m.blobs&&m.blobs.slice(-1)===d.suffix.slice(0,1)&&(d.suffix=d.suffix.slice(1)),d.suffix.slice(-1)===l.suffix.slice(0,1)&&(l.suffix=l.suffix.slice(0,-1))),r(t,t.strings.suffix.slice(0,1))&&(t.strings.suffix=t.strings.suffix.slice(1))}else if(l.delimiter)b[l.delimiter.slice(0,1)]&&l.delimiter.slice(0,1)===d.suffix.slice(-1)&&(t.blobs[c].strings.suffix=t.blobs[c].strings.suffix.slice(0,-1));else{var x=t.blobs[c+1].strings;e(m)||v||!b[d.suffix.slice(-1)]||d.suffix.slice(-1)!==x.prefix.slice(0,1)||(x.prefix=x.prefix.slice(1))}y||v||!g[d.suffix.slice(0,1)]||"string"!=typeof m.blobs||o(m,"blobs",m,"suffix"),this.downward(t.blobs[c])}}}function c(e){if("object"==typeof e&&"object"==typeof e.blobs&&e.blobs.length){for(var i,s=0,n=e.blobs.length;n>s;s++){for(var r=e.blobs[s],a=!1,l=0,u=r.decorations.length;u>l;l++){var c=r.decorations[l];"@quotes"===c[0]&&(a=!0)}if(a)if(t){var h=r.strings.suffix.slice(0,1);if("string"==typeof r.blobs)for(;f[h];)o(r,"blobs",r,"suffix"),h=r.strings.suffix.slice(0,1);else for(;f[h];)o(r.blobs[r.blobs.length-1],"suffix",r,"suffix"),h=r.strings.suffix.slice(0,1)}else if("string"==typeof r.blobs)for(var h=r.blobs.slice(-1);m[h];)o(r,"blobs",r,"suffix",!0),h=r.blobs.slice(-1);else for(var h=r.blobs[r.blobs.length-1].strings.suffix.slice(-1);m[h];)o(r.blobs[r.blobs.length-1],"suffix",r,"suffix",!0),h=r.blobs[r.blobs.length-1].strings.suffix.slice(-1);i=this.fix(e.blobs[s]),r.blobs&&"string"==typeof r.blobs&&(i=r.blobs.slice(-1))}return i}}var h={";":!0,":":!0},p={".":!0,"!":!0,"?":!0};this.upward=a,this.leftward=l,this.downward=u,this.fix=c;var d={"!":{".":"!","?":"!?",":":"!",",":"!,",";":"!;"},"?":{"!":"?!",".":"?",":":"?",",":"?,",";":"?;"},".":{"!":".!","?":".?",":":".:",",":".,",";":".;"},":":{"!":"!","?":"?",".":":",",":":,",";":":;"},",":{"!":",!","?":",?",":":",:",".":",.",";":",;"},";":{"!":"!","?":"?",":":";",",":";,",".":";"}},f={},m={},g={},b={};for(var v in d)g[v]=!0,b[v]=!0,h[v]||(f[v]=!0),p[v]||(m[v]=!0);b[" "]=!0,b[" "]=!0;var y={};for(var v in d)for(var _ in d[v])y[_]||(y[_]={}),y[_][v]=d[v][_]},n.Engine.Opt=function(){this.has_disambiguate=!1,this.mode="html",this.dates={},this["locale-sort"]=[],this["locale-translit"]=[],this["locale-translat"]=[],this.citeAffixes={persons:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},institutions:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},titles:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},journals:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},publishers:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}},places:{"locale-orig":{prefix:"",suffix:""},"locale-translit":{prefix:"",suffix:""},"locale-translat":{prefix:"",suffix:""}}},this["default-locale"]=[],this.update_mode=n.NONE,this.bib_mode=n.NONE,this.sort_citations=!1,this["et-al-min"]=0,this["et-al-use-first"]=1,this["et-al-use-last"]=!1,this["et-al-subsequent-min"]=!1,this["et-al-subsequent-use-first"]=!1,this["demote-non-dropping-particle"]="display-and-sort",this["parse-names"]=!0,this.citation_number_slug=!1,this.trigraph="Aaaa00:AaAa00:AaAA00:AAAA00",this.development_extensions={},this.development_extensions.field_hack=!0,this.development_extensions.locator_date_and_revision=!0,this.development_extensions.locator_parsing_for_plurals=!0,this.development_extensions.locator_label_parse=!0,this.development_extensions.raw_date_parsing=!0,this.development_extensions.clean_up_csl_flaws=!0,this.development_extensions.flip_parentheses_to_braces=!0,this.development_extensions.jurisdiction_subfield=!0,this.development_extensions.static_statute_locator=!1,this.development_extensions.csl_reverse_lookup_support=!1,this.development_extensions.clobber_locator_if_no_statute_section=!1,this.development_extensions.wrap_url_and_doi=!1,this.development_extensions.allow_force_lowercase=!1,this.development_extensions.handle_parallel_articles=!1,this.development_extensions.thin_non_breaking_space_html_hack=!1,this.development_extensions.apply_citation_wrapper=!1,this.development_extensions.main_title_from_short_title=!1,this.development_extensions.normalize_lang_keys_to_lowercase=!1,this.development_extensions.strict_text_case_locales=!1,this.development_extensions.rtl_support=!1,this.development_extensions.strict_page_numbers=!1,this.development_extensions.expect_and_symbol_form=!1,this.development_extensions.require_explicit_legal_case_title_short=!1,this.nodenames=[],this.gender={},this["cite-lang-prefs"]={persons:["orig"],institutions:["orig"],titles:["orig","translat"],journals:["translit"],publishers:["orig"],places:["orig"],number:["translat"]},this.has_layout_locale=!1},n.Engine.Tmp=function(){this.names_max=new n.Stack,this.names_base=new n.Stack,this.givens_base=new n.Stack,this.value=[],this.namepart_decorations={},this.namepart_type=!1,this.area="citation",this.root="citation",this.extension="",this.can_substitute=new n.Stack(0,n.LITERAL),this.element_rendered_ok=!1,this.element_trace=new n.Stack("style"),this.nameset_counter=0,this.group_context=new n.Stack([!1,!1,!1],n.LITERAL),this.term_predecessor=!1,this.jump=new n.Stack(0,n.LITERAL),this.decorations=new n.Stack,this.tokenstore_stack=new n.Stack,this.last_suffix_used="",this.last_names_used=[],this.last_years_used=[],this.years_used=[],this.names_used=[],this.taintedItemIDs={},this.taintedCitationIDs={},this.initialize_with=new n.Stack,this.disambig_request=!1,this["name-as-sort-order"]=!1,this.suppress_decorations=!1,this.disambig_settings=new n.AmbigConfig,this.bib_sort_keys=[],this.prefix=new n.Stack("",n.LITERAL),this.suffix=new n.Stack("",n.LITERAL),this.delimiter=new n.Stack("",n.LITERAL),this.cite_locales=[],this.cite_affixes={citation:!1,bibliography:!1,citation_sort:!1,bibliography_sort:!1},this.strip_periods=0,this.shadow_numbers={}},n.Engine.Fun=function(t){this.match=new n.Util.Match,this.suffixator=new n.Util.Suffixator(n.SUFFIX_CHARS),this.romanizer=new n.Util.Romanizer,this.ordinalizer=new n.Util.Ordinalizer(t),this.long_ordinalizer=new n.Util.LongOrdinalizer},n.Engine.Build=function(){this["alternate-term"]=!1,this.in_bibliography=!1,this.in_style=!1,this.skip=!1,this.postponed_macro=!1,this.layout_flag=!1,this.name=!1,this.form=!1,this.term=!1,this.macro={},this.macro_stack=[],this.text=!1,this.lang=!1,this.area="citation",this.root="citation",this.extension="",this.substitute_level=new n.Stack(0,n.LITERAL),this.names_level=0,this.render_nesting_level=0,this.render_seen=!1},n.Engine.Configure=function(){this.fail=[],this.succeed=[]},n.Engine.Citation=function(t){this.opt={},this.tokens=[],this.srt=new n.Registry.Comparifier(t,"citation_sort"),this.opt.collapse=[],this.opt["disambiguate-add-names"]=!1,this.opt["disambiguate-add-givenname"]=!1,this.opt["disambiguate-add-year-suffix"]=!1,this.opt["givenname-disambiguation-rule"]="by-cite",this.opt["near-note-distance"]=5,this.opt.topdecor=[],this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="citation"},n.Engine.Bibliography=function(){this.opt={},this.tokens=[],this.opt.collapse=[],this.opt.topdecor=[],
this.opt.layout_decorations=[],this.opt.layout_prefix="",this.opt.layout_suffix="",this.opt.layout_delimiter="",this.opt["line-spacing"]=1,this.opt["entry-spacing"]=1,this.opt.sort_locales=[],this.opt.max_number_of_names=0,this.root="bibliography"},n.Engine.BibliographySort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="bibliography"},n.Engine.CitationSort=function(){this.tokens=[],this.opt={},this.opt.sort_directions=[],this.keys=[],this.opt.topdecor=[],this.root="citation"},n.Engine.prototype.previewCitationCluster=function(t,e,i,s){var r=this.opt.mode;this.setOutputFormat(s);var o=this.processCitationCluster(t,e,i,n.PREVIEW);return this.setOutputFormat(r),o[1]},n.Engine.prototype.appendCitationCluster=function(t){for(var e=[],i=this.registry.citationreg.citationByIndex.length,s=0;i>s;s+=1){var n=this.registry.citationreg.citationByIndex[s];e.push([""+n.citationID,n.properties.noteIndex])}return this.processCitationCluster(t,e,[])[1]},n.Engine.prototype.processCitationCluster=function(t,e,i,s){var r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_;this.debug=!1,this.tmp.citation_errors=[];var x={bibchange:!1};this.setCitationId(t);var C,w,S;if(s===n.PREVIEW){C=this.registry.citationreg.citationByIndex.slice(),w=this.registry.reflist.slice();var T=e.concat([[""+t.citationID,t.properties.noteIndex]]).concat(i),E={},I=[];for(o=0,a=T.length;a>o;o+=1)for(r=this.registry.citationreg.citationById[T[o][0]],l=0,u=r.citationItems.length;u>l;l+=1)E[r.citationItems[l].id]=!0,I.push(""+r.citationItems[l].id);for(S={},o=0,a=w.length;a>o;o+=1)if(!E[w[o].id]){var O=this.registry.registry[w[o].id].ambig,A=this.registry.ambigcites[O];if(A)for(l=0,u=A.length;u>l;l+=1)S[A[l]]=n.cloneAmbigConfig(this.registry.registry[A[l]].disambig)}}this.tmp.taintedCitationIDs={};var N=[],k={};for(o=0,a=t.citationItems.length;a>o;o+=1){g={};for(f in t.citationItems[o])g[f]=t.citationItems[o][f];if(m=this.retrieveItem(""+g.id),m.id&&this.transform.loadAbbreviation("default","hereinafter",m.id),this.remapSectionVariable([[m,g]]),this.opt.development_extensions.locator_date_and_revision&&g.locator){g.locator=""+g.locator;var P=g.locator.indexOf("|");if(P>-1){var D=g.locator;g.locator=D.slice(0,P),D=D.slice(P+1),y=D.match(/^([0-9]{4}-[0-9]{2}-[0-9]{2}).*/),y&&(g["locator-date"]=this.fun.dateparser.parse(y[1]),D=D.slice(y[1].length)),g["locator-revision"]=D.replace(/^\s+/,"").replace(/\s+$/,"")}}this.opt.development_extensions.locator_label_parse&&(!g.locator||-1!==["bill","gazette","legislation","treaty"].indexOf(m.type)||g.label&&"page"!==g.label||(y=n.LOCATOR_LABELS_REGEXP.exec(g.locator),y&&(g.label=n.LOCATOR_LABELS_MAP[y[2]],g.locator=y[3])));var R=[m,g];N.push(R),t.citationItems[o].item=m}t.sortedItems=N;var L=[];for(o=0,a=e.length;a>o;o+=1)r=e[o],this.registry.citationreg.citationById[r[0]].properties.noteIndex=r[1],L.push(this.registry.citationreg.citationById[r[0]]);for(L.push(t),o=0,a=i.length;a>o;o+=1)r=i[o],this.registry.citationreg.citationById[r[0]].properties.noteIndex=r[1],L.push(this.registry.citationreg.citationById[r[0]]);this.registry.citationreg.citationByIndex=L,this.registry.citationreg.citationsByItemId={},this.opt.update_mode===n.POSITION&&(v=[],b=[],_={});var j=[];for(o=0,a=L.length;a>o;o+=1){for(L[o].properties.index=o,l=0,u=L[o].sortedItems.length;u>l;l+=1)g=L[o].sortedItems[l],this.registry.citationreg.citationsByItemId[g[1].id]||(this.registry.citationreg.citationsByItemId[g[1].id]=[],j.push(""+g[1].id)),-1===this.registry.citationreg.citationsByItemId[g[1].id].indexOf(L[o])&&this.registry.citationreg.citationsByItemId[g[1].id].push(L[o]);this.opt.update_mode===n.POSITION&&(L[o].properties.noteIndex?b.push(L[o]):(L[o].properties.noteIndex=0,v.push(L[o])))}if(s!==n.ASSUME_ALL_ITEMS_REGISTERED&&this.updateItems(j),!this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys=n.getSortKeys.call(this,N[o][0],"citation_sort");if(this.opt.grouped_sort&&!t.properties.unsorted){for(o=0,a=N.length;a>o;o+=1){var M=N[o][1].sortkeys;this.tmp.authorstring_request=!0;var F=this.registry.registry[N[o][0].id].disambig;this.tmp.authorstring_request=!0,n.getAmbiguousCite.call(this,N[o][0],F);var B=this.registry.authorstrings[N[o][0].id];this.tmp.authorstring_request=!1,N[o][1].sortkeys=[B].concat(M)}N.sort(this.citation.srt.compareCompositeKeys);var q=!1,U=!1,H=!1;for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys[0]!==q&&(H=N[o][1].sortkeys[0],U=N[o][1].sortkeys[1]),N[o][1].sortkeys[0]=""+U+o,q=H}t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}var $;if(this.opt.update_mode===n.POSITION)for(o=0;2>o;o+=1){$=[v,b][o];var z={},V={};for(l=0,u=$.length;u>l;l+=1){var G=$[l];for($[l].properties.noteIndex||($[l].properties.noteIndex=0),$[l].properties.noteIndex=parseInt($[l].properties.noteIndex,10),l>0&&$[l-1].properties.noteIndex>$[l].properties.noteIndex&&(_={},z={},V={}),c=0,h=G.sortedItems.length;h>c;c+=1)this.registry.registry[G.sortedItems[c][1].id].parallel||(_[G.properties.noteIndex]?_[G.properties.noteIndex]+=1:_[G.properties.noteIndex]=1);for(c=0,h=$[l].sortedItems.length;h>c;c+=1){g=$[l].sortedItems[c];var W=g[0].id,X=g[1].locator,J=g[1].label;g[0].legislation_id&&(W=g[0].legislation_id);var K;if(c>0&&(K=G.sortedItems[c-1][0].legislation_id?G.sortedItems[c-1][0].legislation_id:G.sortedItems[c-1][1].id),s!==n.PREVIEW||G.citationID==t.citationID){var Q={};if(Q.position=g[1].position,Q["first-reference-note-number"]=g[1]["first-reference-note-number"],Q["near-note"]=g[1]["near-note"],g[1]["first-reference-note-number"]=0,g[1]["near-note"]=!1,this.registry.citationreg.citationsByItemId[W]&&"note"===this.opt.xclass&&this.opt.has_disambiguate){var Y=this.registry.registry[W]["citation-count"],Z=this.registry.citationreg.citationsByItemId[W].length;if(this.registry.registry[W]["citation-count"]=this.registry.citationreg.citationsByItemId[W].length,"number"==typeof Y){var tt=2>Y,et=2>Z;if(tt!==et)for(var it=0,st=this.registry.citationreg.citationsByItemId[W].length;st>it;it++)k[this.registry.registry[W].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][it].citationID]=!0}else for(var it=0,st=this.registry.citationreg.citationsByItemId[W].length;st>it;it++)k[this.registry.registry[W].ambig]=!0,this.tmp.taintedCitationIDs[this.registry.citationreg.citationsByItemId[W][it].citationID]=!0}var nt;if("undefined"==typeof z[W])z[W]=G.properties.noteIndex,this.registry.registry[W]&&(this.registry.registry[W]["first-reference-note-number"]=G.properties.noteIndex),V[W]=G.properties.noteIndex,g[1].position=n.POSITION_FIRST;else{var rt=!1,ot=!1;if(l>0&&(nt=$[l-1].sortedItems.slice(-1)[0][1].id,$[l-1].sortedItems[0].slice(-1)[0].legislation_id&&(nt=$[l-1].sortedItems[0].slice(-1)[0].legislation_id)),l>0&&0===parseInt(c,10)&&$[l-1].properties.noteIndex!==$[l].properties.noteIndex){var at=$[l-1].sortedItems,lt=!1,ut=$[l-1].sortedItems[0][0].id;for($[l-1].sortedItems[0][0].legislation_id&&(ut=$[l-1].sortedItems[0][0].legislation_id),(ut==W&&$[l-1].properties.noteIndex>=$[l].properties.noteIndex-1||$[l-1].sortedItems[0][1].id==this.registry.registry[g[1].id].parallel)&&(1===_[$[l-1].properties.noteIndex]||0===$[l-1].properties.noteIndex)&&(lt=!0),p=0,d=at.slice(1).length;d>p;p+=1){var ct=at.slice(1)[p];this.registry.registry[ct[1].id].parallel&&this.registry.registry[ct[1].id].parallel!=this.registry.registry[ct[1].id]||(lt=!1)}lt?rt=!0:ot=!0}else c>0&&K==W?rt=!0:0===c&&$[l-1].properties.noteIndex==$[l].properties.noteIndex&&$[l-1].sortedItems.length&&nt==W?rt=!0:ot=!0;var ht,pt,dt,ft,mt;if(rt&&(ht=c>0?G.sortedItems[c-1][1]:$[l-1].sortedItems[0][1],ht.locator?(dt=ht.label?ht.label:"",pt=""+ht.locator+dt):pt=ht.locator,X?(mt=J?J:"",ft=""+X+mt):ft=X),rt&&pt&&!ft&&(rt=!1,ot=!0),rt&&(!pt&&ft?g[1].position=n.POSITION_IBID_WITH_LOCATOR:pt||ft?pt&&ft===pt?g[1].position=n.POSITION_IBID:pt&&ft&&ft!==pt?g[1].position=n.POSITION_IBID_WITH_LOCATOR:(rt=!1,ot=!0):g[1].position=n.POSITION_IBID),ot&&(g[1].position=n.POSITION_SUBSEQUENT),(ot||rt)&&z[W]!=G.properties.noteIndex&&(g[1]["first-reference-note-number"]=z[W],this.registry.registry[W])){var gt=this.registry.citationreg.citationsByItemId[W][0].properties.noteIndex,bt=G.properties.noteIndex;this.registry.registry[W]["first-reference-note-number"]=gt>bt?bt:gt}}if(G.properties.noteIndex){var vt=parseInt(G.properties.noteIndex,10)-parseInt(V[W],10);g[1].position!==n.POSITION_FIRST&&vt<=this.citation.opt["near-note-distance"]&&(g[1]["near-note"]=!0),V[W]=G.properties.noteIndex}if(G.citationID!=t.citationID)for(p=0,d=n.POSITION_TEST_VARS.length;d>p;p+=1){var yt=n.POSITION_TEST_VARS[p];g[1][yt]!==Q[yt]&&("first-reference-note-number"===yt&&(k[this.registry.registry[W].ambig]=!0),this.tmp.taintedCitationIDs[G.citationID]=!0,"first-reference-note-number"===yt&&(this.tmp.taintedItemIDs[W]=!0))}this.sys.variableWrapper&&(g[1].index=G.properties.index,g[1].noteIndex=G.properties.noteIndex)}else"undefined"==typeof z[g[1].id]?(z[W]=G.properties.noteIndex,V[W]=G.properties.noteIndex):V[W]=G.properties.noteIndex}}}if(this.opt.citation_number_sort&&N&&N.length>1&&this.citation_sort.tokens.length>0){for(o=0,a=N.length;a>o;o+=1)N[o][1].sortkeys=n.getSortKeys.call(this,N[o][0],"citation_sort");t.properties.unsorted||N.sort(this.citation.srt.compareCompositeKeys)}for(f in this.tmp.taintedItemIDs)if(this.tmp.taintedItemIDs.hasOwnProperty(f)&&($=this.registry.citationreg.citationsByItemId[f]))for(o=0,a=$.length;a>o;o+=1)this.tmp.taintedCitationIDs[$[o].citationID]=!0;var _t=[];if(s===n.PREVIEW){try{_t=this.process_CitationCluster.call(this,t.sortedItems,t.citationID)}catch(xt){n.error("Error running CSL processor for preview: "+xt)}for(this.registry.citationreg.citationByIndex=C,this.registry.citationreg.citationById={},o=0,a=C.length;a>o;o+=1)this.registry.citationreg.citationById[C[o].citationID]=C[o];var Ct=[];for(o=0,a=w.length;a>o;o+=1)Ct.push(""+w[o].id);this.updateItems(Ct);for(f in S)S.hasOwnProperty(f)&&(this.registry.registry[f].disambig=S[f])}else{for(var wt in k)this.disambiguate.run(wt,t);var St;for(f in this.tmp.taintedCitationIDs)if(f!=t.citationID){var Tt=this.registry.citationreg.citationById[f];this.tmp.citation_pos=Tt.properties.index,this.tmp.citation_note_index=Tt.properties.noteIndex,this.tmp.citation_id=""+Tt.citationID,St=[],St.push(Tt.properties.index),St.push(this.process_CitationCluster.call(this,Tt.sortedItems,Tt.citationID)),_t.push(St)}this.tmp.taintedItemIDs={},this.tmp.taintedCitationIDs={},this.tmp.citation_pos=t.properties.index,this.tmp.citation_note_index=t.properties.noteIndex,this.tmp.citation_id=""+t.citationID,St=[],St.push(e.length),St.push(this.process_CitationCluster.call(this,N,t.citationID)),_t.push(St),_t.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:0})}return x.citation_errors=this.tmp.citation_errors.slice(),[x,_t]},n.Engine.prototype.process_CitationCluster=function(t,e){var i;return this.parallel.StartCitation(t),i=n.getCitationCluster.call(this,t,e)},n.Engine.prototype.makeCitationCluster=function(t){var e,i,s,r,o,a,l;for(e=[],o=t.length,r=0;o>r;r+=1){a={};for(var u in t[r])a[u]=t[r][u];if(l=this.retrieveItem(""+a.id),this.opt.development_extensions.locator_label_parse&&a.locator&&-1===["bill","gazette","legislation","treaty"].indexOf(l.type)&&(!a.label||"page"===a.label)){var c=n.LOCATOR_LABELS_REGEXP.exec(a.locator);c&&(a.label=n.LOCATOR_LABELS_MAP[c[2]],a.locator=c[3])}i=[l,a],e.push(i)}if(this.remapSectionVariable(e),e&&e.length>1&&this.citation_sort.tokens.length>0){for(o=e.length,r=0;o>r;r+=1)e[r][1].sortkeys=n.getSortKeys.call(this,e[r][0],"citation_sort");e.sort(this.citation.srt.compareCompositeKeys)}return this.tmp.citation_errors=[],this.parallel.StartCitation(e),s=n.getCitationCluster.call(this,e)},n.getAmbiguousCite=function(t,e,i){var s,r,o=this.tmp.group_context.value().slice();e?this.tmp.disambig_request=e:this.tmp.disambig_request=!1;var a={position:1};this.registry.registry[t.id]&&this.registry.citationreg.citationsByItemId&&this.registry.citationreg.citationsByItemId[t.id]&&this.registry.citationreg.citationsByItemId[t.id].length&&i&&"by-cite"===this.citation.opt["givenname-disambiguation-rule"]&&(a["first-reference-note-number"]=this.registry.registry[t.id]["first-reference-note-number"]),this.tmp.area="citation",s=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,this.tmp.just_looking=!0,n.getCite.call(this,t,a);for(var l=0,u=this.output.queue.length;u>l;l+=1)n.Output.Queue.purgeEmptyBlobs(this.output.queue[l]);if(this.opt.development_extensions.clean_up_csl_flaws)for(var c=0,h=this.output.queue.length;h>c;c+=1)this.output.adjust.upward(this.output.queue[c]),this.output.adjust.leftward(this.output.queue[c]),this.output.adjust.downward(this.output.queue[c]),this.output.adjust.fix(this.output.queue[c]);return r=this.output.string(this,this.output.queue),this.tmp.just_looking=!1,this.tmp.suppress_decorations=!1,this.parallel.use_parallels=s,this.tmp.group_context.replace(o,"literal"),r},n.getSpliceDelimiter=function(t,e){if(t&&!this.tmp.have_collapsed&&"string"==typeof this.citation.opt["after-collapse-delimiter"])this.tmp.splice_delimiter=this.citation.opt["after-collapse-delimiter"];else if(this.tmp.have_collapsed&&"in-text"===this.opt.xclass&&this.opt.update_mode!==n.NUMERIC)this.tmp.splice_delimiter=", ";else if(this.tmp.use_cite_group_delimiter)this.tmp.splice_delimiter=this.citation.opt.cite_group_delimiter;else if(this.tmp.cite_locales[e-1]){var i=this.tmp.cite_affixes[this.tmp.area][this.tmp.cite_locales[e-1]];i&&i.delimiter&&(this.tmp.splice_delimiter=i.delimiter)}return this.tmp.splice_delimiter||(this.tmp.splice_delimiter=""),this.tmp.splice_delimiter},n.getCitationCluster=function(t,e){var i,s,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x;this.tmp.last_primary_names_string=!1,this.tmp.nestedBraces=!1,_=n.getSafeEscape(this),this.tmp.area="citation",i="",s=[],this.tmp.last_suffix_used="",this.tmp.last_names_used=[],this.tmp.last_years_used=[],this.tmp.backref_index=[],this.tmp.cite_locales=[];var C=!1;if("note"===this.opt.xclass&&this.citation.opt.suppressTrailingPunctuation&&(C=!0),e&&this.registry.citationreg.citationById[e].properties["suppress-trailing-punctuation"]&&(C=!0),"note"===this.opt.xclass){for(var w=[],S=!1,T=!1,E=!1,I=[],O=0,A=t.length;A>O;O+=1){var N=t[O][0].type,k=t[O][0].title,P=t[O][1].position,D=t[O][0].id;k&&"legal_case"===N&&D!==E&&P&&((k!==S||0===w.length)&&(I=[],w.push(I)),I.push(t[O][1])),S=k,T=P,E=D}for(O=0,A=w.length;A>O;O+=1)if(I=w[O],!(I.length<2)){var R=I.slice(-1)[0].locator;if(R)for(var L=0,j=I.length-1;j>L;L+=1)I[L].locator&&(R=!1);R&&(I[0].locator=R,delete I.slice(-1)[0].locator,I[0].label=I.slice(-1)[0].label,I.slice(-1)[0].label&&delete I.slice(-1)[0].label)}}for(r=[],o=t.length,a=0;o>a;a+=1){if(m=t[a][0],l=t[a][1],u=this.tmp.have_collapsed,c={},a>0?n.getCite.call(this,m,l,""+t[a-1][0].id):(this.tmp.term_predecessor=!1,n.getCite.call(this,m,l)),this.tmp.cite_renders_content||(x={citationID:""+this.tmp.citation_id,index:this.tmp.citation_pos,noteIndex:this.tmp.citation_note_index,itemID:""+m.id,citationItems_pos:a,error_code:n.ERROR_NO_RENDERED_FORM},this.tmp.citation_errors.push(x)),a===t.length-1&&this.parallel.ComposeSet(),c.splice_delimiter=n.getSpliceDelimiter.call(this,u,a),l&&l["author-only"]&&(this.tmp.suppress_decorations=!0),a>0){y=t[a-1][1];var M=y.suffix&&"."===y.suffix.slice(-1),F=!y.suffix&&l.prefix&&"."===l.prefix.slice(0,1);if(M||F){var B=c.splice_delimiter.indexOf(" ");B>-1&&!F?c.splice_delimiter=c.splice_delimiter.slice(B):c.splice_delimiter=""}}c.suppress_decorations=this.tmp.suppress_decorations,c.have_collapsed=this.tmp.have_collapsed,r.push(c)}this.tmp.has_purged_parallel=!1,this.parallel.PruneOutputQueue(this),h=0,f=this.output.queue.slice();var q=({strings:{suffix:this.citation.opt.layout_suffix,delimiter:this.citation.opt.layout_delimiter}},this.citation.opt.layout_suffix),U=this.tmp.cite_locales[this.tmp.cite_locales.length-1];U&&this.tmp.cite_affixes[this.tmp.area][U]&&this.tmp.cite_affixes[this.tmp.area][U].suffix&&(q=this.tmp.cite_affixes[this.tmp.area][U].suffix),n.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(q.slice(0,1))>-1&&(q=q.slice(0,1));var H=this.citation.opt.layout_delimiter;H||(H=""),n.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(H.slice(0,1))>-1&&(H=H.slice(0,1));for(var $=q,O=0,A=this.output.queue.length;A>O;O+=1)n.Output.Queue.purgeEmptyBlobs(this.output.queue[O]);if(!this.tmp.suppress_decorations&&this.output.queue.length&&(this.opt.development_extensions.apply_citation_wrapper&&this.sys.wrapCitationEntry&&!this.tmp.just_looking&&"citation"===this.tmp.area||(C||(this.output.queue[this.output.queue.length-1].strings.suffix=$),this.output.queue[0].strings.prefix=this.citation.opt.layout_prefix)),this.opt.development_extensions.clean_up_csl_flaws)for(var L=0,j=this.output.queue.length;j>L;L+=1)this.output.adjust.upward(this.output.queue[L]),this.output.adjust.leftward(this.output.queue[L]),this.output.adjust.downward(this.output.queue[L]),this.tmp.last_chr=this.output.adjust.fix(this.output.queue[L]);for(a=0,o=f.length;o>a;a+=1){if(this.output.queue=[f[a]],this.tmp.suppress_decorations=r[a].suppress_decorations,this.tmp.splice_delimiter=r[a].splice_delimiter,f[a].parallel_delimiter&&(this.tmp.splice_delimiter=f[a].parallel_delimiter),this.tmp.have_collapsed=r[a].have_collapsed,p=this.output.string(this,this.output.queue),this.tmp.suppress_decorations=!1,"string"==typeof p)return this.tmp.suppress_decorations=!1,p;if("object"==typeof p&&0===p.length&&!l["suppress-author"])if(this.tmp.has_purged_parallel)p.push("");else{var z="[CSL STYLE ERROR: reference with no printed form.]",V=0===a?_(this.citation.opt.layout_prefix):"",G=a===f.length-1?_(this.citation.opt.layout_suffix):"";p.push(V+z+G)}if(s.length&&"string"==typeof p[0]){p.reverse();var W=p.pop();W&&","===W.slice(0,1)?s.push(W):"string"==typeof s.slice(-1)[0]&&","===s.slice(-1)[0].slice(-1)?s.push(" "+W):W&&s.push(_(this.tmp.splice_delimiter)+W)}else p.reverse(),d=p.pop(),"undefined"!=typeof d&&(s.length&&"string"==typeof s[s.length-1]&&(s[s.length-1]+=d.successor_prefix),s.push(d));for(g=p.length,b=0;g>b;b+=1)v=p[b],"string"!=typeof v?(d=p.pop(),"undefined"!=typeof d&&s.push(d)):s.push(_(this.tmp.splice_delimiter)+v);0!==s.length||t[a][1]["suppress-author"]||(h+=1)}if(i+=this.output.renderBlobs(s),i&&(this.output.nestedBraces=!1,!this.tmp.suppress_decorations))for(o=this.citation.opt.layout_decorations.length,a=0;o>a;a+=1)c=this.citation.opt.layout_decorations[a],"normal"!==c[1]&&(i=this.fun.decorate[c[0]][c[1]](this,i));return this.tmp.suppress_decorations=!1,i},n.getCite=function(t,e,i){var s,r;for(this.tmp.cite_renders_content=!1,this.parallel.StartCite(t,e,i),n.citeStart.call(this,t,e),s=0,this.nameOutput=new n.NameOutput(this,t,e);s<this[this.tmp.area].tokens.length;)s=n.tokenExec.call(this,this[this.tmp.area].tokens[s],t,e);return n.citeEnd.call(this,t,e),this.parallel.CloseCite(this),this.tmp.cite_renders_content||this.tmp.just_looking||"bibliography"===this.tmp.area&&(r={index:this.tmp.bibliography_pos,itemID:""+t.id,error_code:n.ERROR_NO_RENDERED_FORM},this.tmp.bibliography_errors.push(r)),""+t.id},n.citeStart=function(t,e){if(this.tmp.disambiguate_count=0,this.tmp.disambiguate_maxMax=0,this.tmp.same_author_as_previous_cite=!1,this.tmp.suppress_decorations?this.tmp.subsequent_author_substitute_ok=!1:this.tmp.subsequent_author_substitute_ok=!0,this.tmp.lastchr="","citation"===this.tmp.area&&this.citation.opt.collapse&&this.citation.opt.collapse.length?this.tmp.have_collapsed=!0:this.tmp.have_collapsed=!1,this.tmp.render_seen=!1,this.tmp.disambig_request&&!this.tmp.disambig_override?this.tmp.disambig_settings=this.tmp.disambig_request:this.registry.registry[t.id]&&!this.tmp.disambig_override?(this.tmp.disambig_request=this.registry.registry[t.id].disambig,this.tmp.disambig_settings=this.registry.registry[t.id].disambig):this.tmp.disambig_settings=new n.AmbigConfig,"citation"!==this.tmp.area&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=n.cloneAmbigConfig(this.registry.registry[t.id].disambig),"bibliography"===this.tmp.area&&this.tmp.disambig_settings&&this.tmp.disambig_override&&(this.opt["disambiguate-add-names"]&&(this.tmp.disambig_settings.names=this.registry.registry[t.id].disambig.names.slice(),this.tmp.disambig_request.names=this.registry.registry[t.id].disambig.names.slice()),this.opt["disambiguate-add-givenname"]))){this.tmp.disambig_request=this.tmp.disambig_settings,this.tmp.disambig_settings.givens=this.registry.registry[t.id].disambig.givens.slice(),this.tmp.disambig_request.givens=this.registry.registry[t.id].disambig.givens.slice();for(var i=0,s=this.tmp.disambig_settings.givens.length;s>i;i+=1)this.tmp.disambig_settings.givens[i]=this.registry.registry[t.id].disambig.givens[i].slice();for(var i=0,s=this.tmp.disambig_request.givens.length;s>i;i+=1)this.tmp.disambig_request.givens[i]=this.registry.registry[t.id].disambig.givens[i].slice()}if(this.tmp.names_used=[],this.tmp.nameset_counter=0,this.tmp.years_used=[],this.tmp.names_max.clear(),this.tmp.splice_delimiter=this[this.tmp.area].opt.layout_delimiter,this.bibliography_sort.keys=[],this.citation_sort.keys=[],this.tmp.has_done_year_suffix=!1,this.tmp.last_cite_locale=!1,!this.tmp.just_looking&&e&&!e.position&&this.registry.registry[t.id]&&(this.tmp.disambig_restore=n.cloneAmbigConfig(this.registry.registry[t.id].disambig)),this.tmp.shadow_numbers={},this.setNumberLabels(t),this.tmp.first_name_string=!1,this.opt.development_extensions.flip_parentheses_to_braces&&e&&e.prefix){var r=n.checkNestedBraceOpen.exec(e.prefix),o=n.checkNestedBraceClose.exec(e.prefix);r?o?o[0].length<r[0].length?this.output.nestedBraces=n.NestedBraces:this.output.nestedBraces=!1:this.output.nestedBraces=n.NestedBraces:o&&(this.output.nestedBraces=!1)}},n.citeEnd=function(t,e){if(this.tmp.disambig_restore){this.registry.registry[t.id].disambig.names=this.tmp.disambig_restore.names.slice(),this.registry.registry[t.id].disambig.givens=this.tmp.disambig_restore.givens.slice();for(var i=0,s=this.registry.registry[t.id].disambig.givens.length;s>i;i+=1)this.registry.registry[t.id].disambig.givens[i]=this.tmp.disambig_restore.givens[i].slice()}if(this.tmp.disambig_restore=!1,e&&e.suffix?this.tmp.last_suffix_used=e.suffix:this.tmp.last_suffix_used="",this.tmp.last_years_used=this.tmp.years_used.slice(),this.tmp.last_names_used=this.tmp.names_used.slice(),this.tmp.cut_var=!1,this.tmp.disambig_request=!1,this.tmp.cite_locales.push(this.tmp.last_cite_locale),this.tmp.issued_date&&this.tmp.renders_collection_number){for(var r=[],i=this.tmp.issued_date.list.length-1;i>this.tmp.issued_date.pos;i+=-1)r.push(this.tmp.issued_date.list.pop());for(this.tmp.issued_date.list.pop(),i=r.length-1;i>-1;i+=-1)this.tmp.issued_date.list.push(r.pop());this.parallel.use_parallels&&(this.parallel.cite.issued=!1)}if(this.tmp.issued_date=!1,this.tmp.renders_collection_number=!1,this.opt.development_extensions.flip_parentheses_to_braces&&e&&e.suffix){var o=n.checkNestedBraceOpen.exec(e.suffix),a=n.checkNestedBraceClose.exec(e.suffix);a?o?o[0].length<a[0].length?this.output.nestedBraces=!1:this.output.nestedBraces=n.NestedBraces:this.output.nestedBraces=!1:o&&(this.output.nestedBraces=n.NestedBraces)}},n.Engine.prototype.makeBibliography=function(t){var e,i,s,r,o,a,l,u,c;if(e=!1,!this.bibliography.tokens.length)return!1;"string"==typeof t&&(this.opt.citation_number_slug=t,t=!1),i=n.getBibliographyEntries.call(this,t),u=i[0],c=i[1];var h=i[2];for(s={maxoffset:0,entryspacing:this.bibliography.opt["entry-spacing"],linespacing:this.bibliography.opt["line-spacing"],"second-field-align":!1,entry_ids:u,bibliography_errors:this.tmp.bibliography_errors.slice(),done:h},this.bibliography.opt["second-field-align"]&&(s["second-field-align"]=this.bibliography.opt["second-field-align"]),r=0,a=this.registry.reflist.length,l=0;a>l;l+=1)o=this.registry.reflist[l],o.offset>s.maxoffset&&(s.maxoffset=o.offset);return this.bibliography.opt.hangingindent&&(s.hangingindent=this.bibliography.opt.hangingindent),s.bibstart=this.fun.decorate.bibstart,s.bibend=this.fun.decorate.bibend,this.opt.citation_number_slug=!1,[s,c]},n.getBibliographyEntries=function(t){function e(t,e){return t===e?!0:!1}function i(t,i){for(f=i.length,m=0;f>m;m+=1)if(e(t,i[m]))return!0;return!1}function s(t,s){return"none"!==t&&t||s?"string"==typeof s?e(t,s):s?i(t,s):!1:!0}var r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x,C,w,S,T,E,I,O;r=[],E=[],this.tmp.area="bibliography",this.tmp.last_rendered_name=!1,this.tmp.bibliography_errors=[],this.tmp.bibliography_pos=0,o=t&&t.page_start&&t.page_length?this.registry.getSortedIds():this.retrieveItems(this.registry.getSortedIds()),this.tmp.disambig_override=!0,C={};var A;if(t&&t.page_start&&t.page_length&&(A=0,t.page_start!==!0))for(y=0,_=o.length;_>y&&(C[o[y]]=!0,t.page_start!=o[y]);y+=1);var N=[];for(y=0,_=o.length;_>y;y+=1){if(t&&t.page_start&&t.page_length){if(C[o[y]])continue;if(p=this.retrieveItem(o[y]),A===t.page_length)break}else if(p=o[y],C[p.id])continue;if(t){if(a=!0,t.include){for(a=!1,I=0,O=t.include.length;O>I;I+=1)if(d=t.include[I],s(d.value,p[d.field])){a=!0;break}}else if(t.exclude){for(l=!1,I=0,O=t.exclude.length;O>I;I+=1)if(d=t.exclude[I],s(d.value,p[d.field])){l=!0;break}l&&(a=!1)}else if(t.select){for(a=!1,u=!0,I=0,O=t.select.length;O>I;I+=1)d=t.select[I],s(d.value,p[d.field])||(u=!1);u&&(a=!0)}if(t.quash){for(u=!0,I=0,O=t.quash.length;O>I;I+=1)d=t.quash[I],s(d.value,p[d.field])||(u=!1);u&&(a=!1)}if(!a)continue}if(c=new n.Token("group",n.START),c.decorations=[["@bibliography","entry"]].concat(this.bibliography.opt.layout_decorations),this.output.startTag("bib_entry",c),p.system_id&&this.sys.embedBibliographyEntry?this.output.current.value().item_id=p.system_id:this.output.current.value().system_id=p.id,w=[[{id:""+p.id},p]],b=[],!this.registry.registry[p.id].master||t&&t.page_start&&t.page_length)this.registry.registry[p.id].siblings||(this.parallel.StartCitation(w),this.tmp.term_predecessor=!1,b.push(""+n.getCite.call(this,p)),t&&t.page_start&&t.page_length&&(A+=1));else{for(v=!0,this.parallel.StartCitation(w),this.output.queue[0].strings.delimiter=", ",this.tmp.term_predecessor=!1,b.push(""+n.getCite.call(this,p)),C[p.id]=!0,x=this.registry.registry[p.id].siblings,I=0,O=x.length;O>I;I+=1){var k=this.registry.registry[p.id].siblings[I];S=this.retrieveItem(k),b.push(""+n.getCite.call(this,S)),C[S.id]=!0}this.parallel.ComposeSet(),this.parallel.PruneOutputQueue()}if(E.push(""),this.tmp.bibliography_pos+=1,N.push(b),this.output.endTag("bib_entry"),this.output.queue[0].blobs.length&&this.output.queue[0].blobs[0].blobs.length){for(v||!this.output.queue[0].blobs[0].blobs[0].strings?(g=this.output.queue[0].blobs,v=!1):g=this.output.queue[0].blobs[0].blobs,I=g.length-1;I>-1;I+=-1)if(g[I].blobs&&0!==g[I].blobs.length){var P,D=this.tmp.cite_locales[this.tmp.cite_locales.length-1];P=this.tmp.cite_affixes[this.tmp.area][D]?this.tmp.cite_affixes[this.tmp.area][D].suffix:this.bibliography.opt.layout_suffix,T=P.slice(0,1),T&&g[I].strings.suffix.slice(-1)===T&&(g[I].strings.suffix=g[I].strings.suffix.slice(0,-1)),g[I].strings.suffix+=P;break}g[0].strings.prefix=this.bibliography.opt.layout_prefix+g[0].strings.prefix}for(var I=0,O=this.output.queue.length;O>I;I+=1)n.Output.Queue.purgeEmptyBlobs(this.output.queue[I]);for(var I=0,O=this.output.queue.length;O>I;I+=1)this.output.adjust.upward(this.output.queue[I]),this.output.adjust.leftward(this.output.queue[I]),this.output.adjust.downward(this.output.queue[I],!0),this.output.adjust.fix(this.output.queue[I]);h=this.output.string(this,this.output.queue)[0],h||(h="\n[CSL STYLE ERROR: reference with no printed form.]\n"),r.push(h)}var R=!1;if(t&&t.page_start&&t.page_length){var L=o.slice(-1)[0],j=N.slice(-1)[0];L&&j&&L!=j||(R=!0)}return this.tmp.disambig_override=!1,[N,r,R]},n.Engine.prototype.setCitationId=function(t,e){var i,s,n;if(i=!1,!t.citationID||e){for(s=Math.floor(1e14*Math.random());;){if(n=0,!this.registry.citationreg.citationById[s]){t.citationID=s.toString(32);break}n=!n&&5e13>s?1:-1,s+=1===n?1:-1}i=""+s}return this.registry.citationreg.citationById[t.citationID]=t,i},n.Engine.prototype.rebuildProcessorState=function(t,e,i){t||(t=[]),e||(e="html");for(var s={},r=[],o=0,a=t.length;a>o;o+=1)for(var l=0,u=t[o].citationItems.length;u>l;l+=1){var c=""+t[o].citationItems[l].id;s[c]||r.push(c),s[c]=!0}this.updateItems(r);var h=[],p=[],d=[],f=this.opt.mode;this.setOutputFormat(e);for(var o=0,a=t.length;a>o;o+=1){var m=this.processCitationCluster(t[o],h,p,n.ASSUME_ALL_ITEMS_REGISTERED);h.push([t[o].citationID,t[o].properties.noteIndex]);for(var l=0,u=m[1].length;u>l;l+=1){var g=m[1][l][0];d[g]=[h[g][0],h[g][1],m[1][l][1]]}}return this.updateUncitedItems(i),this.setOutputFormat(f),d},n.Engine.prototype.restoreProcessorState=function(t){var e,i,s,r,o,a,l,u,c,h;u=[],c=[],t||(t=[]);var p=[],d={};for(e=0,i=t.length;i>e;e+=1)d[t[e].citationID]&&this.setCitationId(t[e],!0),d[t[e].citationID]=!0,p.push(t[e].properties.index);var f=t.slice();for(f.sort(function(t,e){return t.properties.index<e.properties.index?-1:t.properties.index>e.properties.index?1:0}),e=0,i=f.length;i>e;e+=1)f[e].properties.index=e;for(e=0,i=f.length;i>e;e+=1){for(h=[],s=0,r=f[e].citationItems.length;r>s;s+=1)o=f[e].citationItems[s],"undefined"==typeof o.sortkeys&&(o.sortkeys=[]),a=this.retrieveItem(""+o.id),l=[a,o],h.push(l),f[e].citationItems[s].item=a,c.push(""+o.id);f[e].properties.unsorted||h.sort(this.citation.srt.compareCompositeKeys),f[e].sortedItems=h,this.registry.citationreg.citationById[f[e].citationID]=f[e]}for(this.updateItems(c),e=0,i=t.length;i>e;e+=1)u.push([""+t[e].citationID,t[e].properties.noteIndex]);var m=[];return t&&t.length?m=this.processCitationCluster(t[0],[],u.slice(1)):(this.registry=new n.Registry(this),this.tmp=new n.Engine.Tmp,this.disambiguate=new n.Disambiguation(this)),m},n.Engine.prototype.updateItems=function(t,e,i){var s=this.tmp.area;if(this.registry.init(t),i)for(var n in this.registry.ambigcites)this.registry.ambigsTouched[n]=!0;return this.registry.dodeletes(this.registry.myhash),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.tmp.area=s,this.registry.getSortedIds()},n.Engine.prototype.updateUncitedItems=function(t,e){if(t||(t=[]),"object"==typeof t)if("undefined"==typeof t.length){var i=t;t=[];for(var s in i)t.push(s)}else if("number"==typeof t.length)for(var i={},n=0,r=t.length;r>n;n+=1)i[t[n]]=!0;return this.registry.init(t,!0),this.registry.dopurge(i),this.registry.doinserts(this.registry.mylist),this.registry.dorefreshes(),this.registry.rebuildlist(),this.registry.setsortkeys(),this.registry.setdisambigs(),e||this.registry.sorttokens(),this.registry.renumber(),this.registry.getSortedIds()},n.localeResolve=function(t,e){var i,s;return e||(e="en-US"),t||(t=e),i={},s=t.split(/[\-_]/),i.base=n.LANG_BASES[s[0]],"undefined"==typeof i.base?(n.debug("Warning: unknown locale "+t+", setting fallback to "+e),{base:e,best:t,bare:s[0]}):(1===s.length&&(i.generic=!0),1===s.length||"x"===s[1]?i.best=i.base.replace("_","-"):i.best=s.slice(0,2).join("-"),i.base=i.base.replace("_","-"),i.bare=s[0],i)},n.Engine.prototype.localeConfigure=function(t,e){var i;if(this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(t.best=t.best.toLowerCase(),t.bare=t.bare.toLowerCase(),t.base=t.base.toLowerCase()),(!e||!this.locale[t.best])&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale("en-US")),this.localeSet(i,"en-US",t.best),"en-US"!==t.best&&(t.base!==t.best&&(i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.base)),this.localeSet(i,t.base,t.best)),i=this.sys.xml.makeXml(this.sys.retrieveLocale(t.best)),this.localeSet(i,t.best,t.best)),this.localeSet(this.cslXml,"",t.best),this.localeSet(this.cslXml,t.bare,t.best),
t.base!==t.best&&this.localeSet(this.cslXml,t.base,t.best),this.localeSet(this.cslXml,t.best,t.best),"undefined"==typeof this.locale[t.best].terms["page-range-delimiter"]&&(["fr","pt"].indexOf(t.best.slice(0,2).toLowerCase())>-1?this.locale[t.best].terms["page-range-delimiter"]="-":this.locale[t.best].terms["page-range-delimiter"]=""),"undefined"==typeof this.locale[t.best].terms["year-range-delimiter"]&&(this.locale[t.best].terms["year-range-delimiter"]=""),"undefined"==typeof this.locale[t.best].terms["citation-range-delimiter"]&&(this.locale[t.best].terms["citation-range-delimiter"]=""),this.opt.development_extensions.normalize_lang_keys_to_lowercase)){for(var s=["default-locale","locale-sort","locale-translit","locale-translat"],n=0,r=s.length;r>n;n+=1)for(var o=0,a=this.opt[s[n]].length;a>o;o+=1)this.opt[s[n]][o]=this.opt[s[n]][o].toLowerCase();this.opt.lang=this.opt.lang.toLowerCase()}},n.Engine.prototype.localeSet=function(t,e,i){var s,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y;if(e=e.replace("_","-"),i=i.replace("_","-"),this.opt.development_extensions.normalize_lang_keys_to_lowercase&&(e=e.toLowerCase(),i=i.toLowerCase()),this.locale[i]||(this.locale[i]={},this.locale[i].terms={},this.locale[i].opts={},this.locale[i].opts["skip-words"]=n.SKIP_WORDS,this.locale[i].opts["leading-noise-words"]||(this.locale[i].opts["leading-noise-words"]=[]),this.locale[i].dates={},this.locale[i].ord={"1.0.1":!1,keys:{}},this.locale[i]["noun-genders"]={}),r=this.sys.xml.makeXml(),this.sys.xml.nodeNameIs(t,"locale"))r=t;else for(o=this.sys.xml.getNodesByName(t,"locale"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1)if(s=o[l],this.sys.xml.getAttributeValue(s,"lang","xml")===e){r=s;break}for(o=this.sys.xml.getNodesByName(r,"type"),v=0,y=this.sys.xml.numberofnodes(o);y>v;v+=1){var _=o[v],x=this.sys.xml.getAttributeValue(_,"name"),C=this.sys.xml.getAttributeValue(_,"gender");this.opt.gender[x]=C}var w=this.sys.xml.getNodesByName(r,"term","ordinal").length;if(w){for(var S in this.locale[i].ord.keys)delete this.locale[i].terms[S];this.locale[i].ord={"1.0.1":!1,keys:{}}}o=this.sys.xml.getNodesByName(r,"term");var T={"last-digit":{},"last-two-digits":{},"whole-number":{}},E=!1,I={};for(l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1){if(u=o[l],h=this.sys.xml.getAttributeValue(u,"name"),"sub verbo"===h&&(h="sub-verbo"),"ordinal"===h.slice(0,7)){this.sys.xml.getNodeValue(u);if("ordinal"===h)E=!0;else{var O=this.sys.xml.getAttributeValue(u,"match"),A=h.slice(8),g=this.sys.xml.getAttributeValue(u,"gender-form");g||(g="neuter"),O||(O="last-two-digits","0"===A.slice(0,1)&&(O="last-digit")),"0"===A.slice(0,1)&&(A=A.slice(1)),T[O][A]||(T[O][A]={}),T[O][A][g]=h}this.locale[i].ord.keys[h]=!0}"undefined"==typeof this.locale[i].terms[h]&&(this.locale[i].terms[h]={}),c="long",g=!1,this.sys.xml.getAttributeValue(u,"form")&&(c=this.sys.xml.getAttributeValue(u,"form")),this.sys.xml.getAttributeValue(u,"gender-form")&&(g=this.sys.xml.getAttributeValue(u,"gender-form")),this.sys.xml.getAttributeValue(u,"gender")&&(this.locale[i]["noun-genders"][h]=this.sys.xml.getAttributeValue(u,"gender")),g?(this.locale[i].terms[h][g]={},this.locale[i].terms[h][g][c]=[],b=this.locale[i].terms[h][g],I[h]=!0):(this.locale[i].terms[h][c]=[],b=this.locale[i].terms[h]),this.sys.xml.numberofnodes(this.sys.xml.getNodesByName(u,"multiple"))?(b[c][0]=this.sys.xml.getNodeValue(u,"single"),b[c][1]=this.sys.xml.getNodeValue(u,"multiple")):b[c]=this.sys.xml.getNodeValue(u)}if(E){for(var N in I){var k={},P=0;for(var D in this.locale[i].terms[N])["masculine","feminine"].indexOf(D)>-1?k[D]=this.locale[i].terms[N][D]:P+=1;if(!P)if(k.feminine)for(var D in k.feminine)this.locale[i].terms[N][D]=k.feminine[D];else if(k.masculine)for(var D in k.masculine)this.locale[i].terms[N][D]=k.masculine[D]}this.locale[i].ord["1.0.1"]=T}for(h in this.locale[i].terms)for(v=0,y=2;y>v;v+=1)if(g=n.GENDERS[v],this.locale[i].terms[h][g])for(c in this.locale[i].terms[h])this.locale[i].terms[h][g][c]||(this.locale[i].terms[h][g][c]=this.locale[i].terms[h][c]);for(o=this.sys.xml.getNodesByName(r,"style-options"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1){p=o[l],a=this.sys.xml.attributes(p);for(f in a)if(a.hasOwnProperty(f))if("@punctuation-in-quote"===f||"@limit-day-ordinals-to-day-1"===f)"true"===a[f]?this.locale[i].opts[f.slice(1)]=!0:this.locale[i].opts[f.slice(1)]=!1;else if("@skip-words"===f){var R=a[f].split(/\s*,\s*/);this.locale[i].opts[f.slice(1)]=R}else if("@leading-noise-words"===f&&e===i){var L=a[f].split(/\s*,\s*/);this.locale[i].opts["leading-noise-words"]=L}else if("@name-as-sort-order"===f){this.locale[i].opts["name-as-sort-order"]={};for(var j=a[f].split(/\s+/),v=0,y=j.length;y>v;v+=1)this.locale[i].opts["name-as-sort-order"][j[v]]=!0}else if("@name-as-reverse-order"===f){this.locale[i].opts["name-as-reverse-order"]={};for(var j=a[f].split(/\s+/),v=0,y=j.length;y>v;v+=1)this.locale[i].opts["name-as-reverse-order"][j[v]]=!0}else if("@name-never-short"===f){this.locale[i].opts["name-never-short"]={};for(var j=a[f].split(/\s+/),v=0,y=j.length;y>v;v+=1)this.locale[i].opts["name-never-short"][j[v]]=!0}}for(o=this.sys.xml.getNodesByName(r,"date"),l=0,m=this.sys.xml.numberofnodes(o);m>l;l+=1)d=o[l],this.locale[i].dates[this.sys.xml.getAttributeValue(d,"form")]=d},n.Node={},n.Node.bibliography={build:function(t,e){this.tokentype===n.START&&(t.build.area="bibliography",t.build.root="bibliography",t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first")),e.push(this)}},n.Node.choose={build:function(t,e){var i;this.tokentype===n.START&&(i=function(t,e){t.tmp.jump.push(void 0,n.LITERAL)}),this.tokentype===n.END&&(i=function(t,e){t.tmp.jump.pop()}),this.execs.push(i),e.push(this)},configure:function(t,e){this.tokentype===n.END?(t.configure.fail.push(e),t.configure.succeed.push(e)):(t.configure.fail.pop(),t.configure.succeed.pop())}},n.Node.citation={build:function(t,e){if(this.tokentype===n.START&&(t.fixOpt(this,"names-delimiter","delimiter"),t.fixOpt(this,"name-delimiter","delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),t.build.area="citation"),this.tokentype===n.END){if(t.opt.grouped_sort="in-text"===t.opt.xclass&&t.citation.opt.collapse&&t.citation.opt.collapse.length||t.citation.opt.cite_group_delimiter&&t.citation.opt.cite_group_delimiter.length&&t.opt.update_mode!==n.POSITION&&t.opt.update_mode!==n.NUMERIC,t.opt.grouped_sort&&t.citation_sort.opt.sort_directions.length){var i=t.citation_sort.opt.sort_directions[0].slice();t.citation_sort.opt.sort_directions=[i].concat(t.citation_sort.opt.sort_directions)}t.citation.srt=new n.Registry.Comparifier(t,"citation_sort")}}},n.Node["#comment"]={build:function(t,e){}},n.Node.date={build:function(t,e){var i,s,r,o,a,l,u,c,h,p;(this.tokentype===n.START||this.tokentype===n.SINGLETON)&&(t.build.date_parts=[],t.build.date_variables=this.variables,t.build.extension||n.Util.substituteStart.call(this,t,e),i=t.build.extension?n.dateMacroAsSortKey:function(t,e,i){var n;if(t.tmp.element_rendered_ok=!1,t.tmp.donesies=[],t.tmp.dateparts=[],n=[],!this.variables.length||t.tmp.just_looking&&"issued"!==this.variables[0])t.tmp.date_object=!1;else{for(t.parallel.StartVariable(this.variables[0]),s=e[this.variables[0]],"undefined"==typeof s&&(s={"date-parts":[[0]]},t.opt.development_extensions.locator_date_and_revision&&i&&"locator-date"===this.variables[0]&&i["locator-date"]&&(s=i["locator-date"])),t.tmp.date_object=s,r=this.dateparts.length,o=0;r>o;o+=1)a=this.dateparts[o],"undefined"!=typeof t.tmp.date_object[a+"_end"]?n.push(a):"month"===a&&"undefined"!=typeof t.tmp.date_object.season_end&&n.push(a);for(l=[],u=["year","month","day"],r=u.length,o=0;r>o;o+=1)n.indexOf(u[o])>-1&&l.push(u[o]);for(n=l.slice(),c=2,r=n.length,o=0;r>o;o+=1)if(a=n[o],h=t.tmp.date_object[a],p=t.tmp.date_object[a+"_end"],h!==p){c=o;break}t.tmp.date_collapse_at=n.slice(c)}},this.execs.push(i),i=function(t,e){if(t.output.startTag("date",this),"issued"===this.variables[0]&&"legal_case"===e.type&&!t.tmp.extension&&""+e["collection-number"]==""+t.tmp.date_object.year&&1===this.dateparts.length&&"year"===this.dateparts[0])for(var i in t.tmp.date_object)if(t.tmp.date_object.hasOwnProperty(i)&&"year"===i.slice(0,4)){t.tmp.issued_date={};var s=t.output.current.mystack.slice(-2)[0].blobs;t.tmp.issued_date.list=s,t.tmp.issued_date.pos=s.length-1}},this.execs.push(i)),t.build.extension||this.tokentype!==n.END&&this.tokentype!==n.SINGLETON||(i=function(t,e){t.output.endTag(),t.parallel.CloseVariable("date")},this.execs.push(i)),e.push(this),(this.tokentype===n.END||this.tokentype===n.SINGLETON)&&(t.build.extension||n.Util.substituteEnd.call(this,t,e))}},n.Node["date-part"]={build:function(t,e){var i,s,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x,C,w,S,T,E;this.strings.form||(this.strings.form="long"),t.build.date_parts.push(this.strings.name);var I=t.build.date_variables[0];i=function(t,e){if(t.tmp.date_object){if(o=!0,a="",l="",t.tmp.donesies.push(this.strings.name),t.tmp.date_object.literal&&"year"===this.strings.name&&(t.parallel.AppendToVariable(t.tmp.date_object.literal),t.output.append(t.tmp.date_object.literal,this)),t.tmp.date_object&&(a=t.tmp.date_object[this.strings.name],l=t.tmp.date_object[this.strings.name+"_end"]),"year"!==this.strings.name||0!==a||t.tmp.suppress_decorations||(a=!1),u=!t.tmp.suppress_decorations,c=t.tmp.have_collapsed,h="year-suffix"===t[t.tmp.area].opt.collapse||"year-suffix-ranged"===t[t.tmp.area].opt.collapse,p=t.opt["disambiguate-add-year-suffix"],u&&p&&h&&(t.tmp.years_used.push(a),d=t.tmp.last_years_used.length>=t.tmp.years_used.length,d&&c&&t.tmp.last_years_used[t.tmp.years_used.length-1]===a&&(a=!1)),"undefined"!=typeof a){f=!1,m=!1,g=!1,b=!1,"year"===this.strings.name&&(parseInt(a,10)<500&&parseInt(a,10)>0&&(m=t.getTerm("ad")),parseInt(a,10)<0&&(f=t.getTerm("bc"),a=-1*parseInt(a,10)),l&&(parseInt(l,10)<500&&parseInt(l,10)>0&&(b=t.getTerm("ad")),parseInt(l,10)<0&&(g=t.getTerm("bc"),l=-1*parseInt(l,10)))),t.parallel.AppendToVariable(a);for(var i=""+t.tmp.date_object.month;i.length<2;)i="0"+i;i="month-"+i;var O=t.locale[t.opt.lang]["noun-genders"][i];if(this.strings.form){var A=this.strings.form;if("day"===this.strings.name&&"ordinal"===A&&t.locale[t.opt.lang].opts["limit-day-ordinals-to-day-1"]&&""+a!="1"&&(A="numeric"),a=n.Util.Dates[this.strings.name][A](t,a,O,"accessed"===I),"month"===this.strings.name)if(t.tmp.strip_periods)a=a.replace(/\./g,"");else for(T=0,E=this.decorations.length;E>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){a=a.replace(/\./g,"");break}if(l)if(l=n.Util.Dates[this.strings.name][A](t,l,O,"accessed"===I,"_end"),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(T=0,E=this.decorations.length;E>T;T+=1)if("@strip-periods"===this.decorations[T][0]&&"true"===this.decorations[T][1]){l=l.replace(/\./g,"");break}}if(t.output.openLevel("empty"),t.tmp.date_collapse_at.length){for(v=!0,r=t.tmp.date_collapse_at.length,s=0;r>s;s+=1)if(S=t.tmp.date_collapse_at[s],-1===t.tmp.donesies.indexOf(S)){v=!1;break}if(v){if(""+l!="0"){if(0===t.dateput.queue.length&&(o=!0),t.opt["year-range-format"]&&"expanded"!==t.opt["year-range-format"]&&!t.tmp.date_object.day&&!t.tmp.date_object.month&&!t.tmp.date_object.season&&"year"===this.strings.name&&a&&l){l=t.fun.year_mangler(a+"-"+l,!0);var N=t.getTerm("year-range-delimiter");l=l.slice(l.indexOf(N)+1)}t.dateput.append(l,this),o&&(t.dateput.current.value()[0].strings.prefix="")}t.output.append(a,this),y=t.output.current.value(),y.blobs[y.blobs.length-1].strings.suffix="",t.output.append(t.getTerm("year-range-delimiter"),"empty"),_=t.dateput.current.value(),y.blobs=y.blobs.concat(_),t.dateput.string(t,t.dateput.queue),t.tmp.date_collapse_at=[]}else t.output.append(a,this),t.tmp.date_collapse_at.indexOf(this.strings.name)>-1&&""+l!="0"&&(0===t.dateput.queue.length&&(o=!0),t.dateput.openLevel("empty"),t.dateput.append(l,this),o&&(t.dateput.current.value().blobs[0].strings.prefix=""),f&&t.dateput.append(f),m&&t.dateput.append(m),t.dateput.closeLevel())}else t.output.append(a,this);f&&t.output.append(f),m&&t.output.append(m),t.output.closeLevel()}else"month"===this.strings.name&&t.tmp.date_object.season&&(a=""+t.tmp.date_object.season,a&&a.match(/^[1-4]$/)?(t.tmp.group_context.replace([!1,!1,!0]),t.output.append(t.getTerm("season-0"+a),this)):a&&t.output.append(a,this));t.tmp.value=[],!a&&!t.tmp.have_collapsed||t.opt.has_year_suffix||"year"!==this.strings.name||t.tmp.just_looking||t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&!t.tmp.has_done_year_suffix&&(t.tmp.has_done_year_suffix=!0,C=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),x=new n.NumericBlob(C,this,e.id),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,w=new n.Util.Suffixator(n.SUFFIX_CHARS),x.setFormatter(w),"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(x.range_prefix=t.getTerm("citation-range-delimiter")),t[t.tmp.area].opt["year-suffix-delimiter"]?x.successor_prefix=t[t.tmp.area].opt["year-suffix-delimiter"]:x.successor_prefix=t[t.tmp.area].opt.layout_delimiter,x.UGLY_DELIMITER_SUPPRESS_HACK=!0,t.output.append(x,"literal"))}},this.execs.push(i),e.push(this)}},n.Node["else-if"]={build:function(t,e){n.Conditions.TopNode.call(this,t,e),e.push(this)},configure:function(t,e){n.Conditions.Configure.call(this,t,e)}},n.Node["else"]={build:function(t,e){e.push(this)},configure:function(t,e){this.tokentype===n.START&&(t.configure.fail[t.configure.fail.length-1]=e)}},n.Node["et-al"]={build:function(t,e){if("citation"===t.build.area||"bibliography"===t.build.area){var i=function(t,e,i){t.tmp.etal_node=this,"string"==typeof this.strings.term&&(t.tmp.etal_term=this.strings.term)};this.execs.push(i)}e.push(this)}},n.Node.group={build:function(t,e){var i,s;this.tokentype===n.START?(n.Util.substituteStart.call(this,t,e),t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()+1),i=function(t,e){t.output.startTag("group",this),t.tmp.group_context.mystack.length&&(t.output.current.value().parent=t.tmp.group_context.value()[4]);var i=t.tmp.group_context.value()[5];!i&&this.strings.label_form_override&&(i=this.strings.label_form_override),t.tmp.group_context.push([!1,!1,!1,!1,t.output.current.value(),i,this.strings.set_parallel_condition],n.LITERAL),this.strings.oops&&(t.tmp.group_context.value()[3]=this.strings.oops)},s=[],s.push(i),this.execs=s.concat(this.execs),this.strings["has-publisher-and-publisher-place"]&&(t.build["publisher-special"]=!0,i=function(t,e){if(this.strings["subgroup-delimiter"]&&e.publisher&&e["publisher-place"]){var i=e.publisher.split(/;\s*/),s=e["publisher-place"].split(/;\s*/);i.length>1&&i.length===s.length&&(t.publisherOutput=new n.PublisherOutput(t,this),t.publisherOutput["publisher-list"]=i,t.publisherOutput["publisher-place-list"]=s)}},this.execs.push(i))):(t.build["publisher-special"]&&(t.build["publisher-special"]=!1,"string"==typeof t[t.build.root].opt["name-delimiter"]&&(i=function(t,e){t.publisherOutput&&(t.publisherOutput.render(),t.publisherOutput=!1)},this.execs.push(i))),i=function(t,e){var i=t.tmp.group_context.pop();t.output.endTag();t.tmp.group_context.value();if(i[1]&&(t.tmp.group_context.value()[1]=!0),i[2]||i[0]&&!i[1]){t.tmp.group_context.value()[2]=!0;var s=t.output.current.value().blobs,n=t.output.current.value().blobs.length-1;if(!t.tmp.just_looking&&"undefined"!=typeof i[6]){var r={blobs:s,conditions:i[6],id:e.id,pos:n};t.parallel.parallel_conditional_blobs_list.push(r)}}else t.output.current.value().blobs&&t.output.current.value().blobs.pop(),t.tmp.group_context.value()[3]&&(t.output.current.mystack[t.output.current.mystack.length-2].strings.delimiter=t.tmp.group_context.value()[3])},this.execs.push(i)),e.push(this),this.tokentype===n.END&&(t.build.substitute_level.value()&&t.build.substitute_level.replace(t.build.substitute_level.value()-1),n.Util.substituteEnd.call(this,t,e))}},n.Node["if"]={build:function(t,e){n.Conditions.TopNode.call(this,t,e),e.push(this)},configure:function(t,e){n.Conditions.Configure.call(this,t,e)}},n.Node.conditions={build:function(t,e){this.tokentype===n.START&&t.tmp.conditions.addMatch(this.match),this.tokentype===n.END&&t.tmp.conditions.matchCombine()}},n.Node.condition={build:function(t,e){if(this.tokentype===n.SINGLETON){var i=t.fun.match[this.match](this,t,this.tests);t.tmp.conditions.addTest(i)}}},n.Conditions={},n.Conditions.TopNode=function(t,e){var i;(this.tokentype===n.START||this.tokentype===n.SINGLETON)&&(this.locale&&(t.opt.lang=this.locale),this.tests&&this.tests.length?this.test=t.fun.match[this.match](this,t,this.tests):t.tmp.conditions=new n.Conditions.Engine(t,this)),(this.tokentype===n.END||this.tokentype===n.SINGLETON)&&(i=function(t,e){this.locale_default&&(t.output.current.value().old_locale=this.locale_default,t.output.closeLevel("empty"),t.opt.lang=this.locale_default);var i=this[t.tmp.jump.value()];return i},this.execs.push(i),this.locale_default&&(t.opt.lang=this.locale_default))},n.Conditions.Configure=function(t,e){this.tokentype===n.START?(this.fail=t.configure.fail.slice(-1)[0],this.succeed=this.next,t.configure.fail[t.configure.fail.length-1]=e):this.tokentype===n.SINGLETON?(this.fail=this.next,this.succeed=t.configure.succeed.slice(-1)[0],t.configure.fail[t.configure.fail.length-1]=e):(this.succeed=t.configure.succeed.slice(-1)[0],this.fail=this.next)},n.Conditions.Engine=function(t,e){this.token=e,this.state=t},n.Conditions.Engine.prototype.addTest=function(t){this.token.tests.push(t)},n.Conditions.Engine.prototype.addMatch=function(t){this.token.match=t},n.Conditions.Engine.prototype.matchCombine=function(){this.token.test=this.state.fun.match[this.token.match](this.token,this.state,this.token.tests)},n.Node.info={build:function(t,e){this.tokentype===n.START?t.build.skip="info":t.build.skip=!1}},n.Node.institution={build:function(t,e){if([n.SINGLETON,n.START].indexOf(this.tokentype)>-1){var i=function(t,e){"string"!=typeof t.build.name_delimiter||this.strings.delimiter||(this.strings.delimiter=t.tmp.name_delimiter);"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and?t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&":"none"===this.strings.and&&(this.and_term=this.strings.delimiter),"undefined"==typeof this.and_term&&t.tmp.and_term&&(this.and_term=t.getTerm("and","long",0)),n.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" "):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]&&this.and_prefix_multiple&&(this.and_prefix_multiple=" "),this.and={},"undefined"!=typeof this.and_term?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):"undefined"!==this.strings.delimiter&&(this.and.single=new n.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new n.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),t.nameOutput.institution=this};this.execs.push(i)}e.push(this)},configure:function(t,e){[n.SINGLETON,n.START].indexOf(this.tokentype)>-1&&(t.build.has_institution=!0)}},n.Node["institution-part"]={build:function(t,e){var i;"long"===this.strings.name?i=this.strings["if-short"]?function(t,e){t.nameOutput.institutionpart["long-with-short"]=this}:function(t,e){t.nameOutput.institutionpart["long"]=this}:"short"===this.strings.name&&(i=function(t,e){t.nameOutput.institutionpart["short"]=this}),this.execs.push(i),e.push(this)}},n.Node.key={build:function(t,e){var i,s=new n.Token("key",n.START);s.strings["et-al-min"]=this.strings["et-al-min"],s.strings["et-al-use-first"]=this.strings["et-al-use-first"],s.strings["et-al-use-last"]=this.strings["et-al-use-last"],i=function(t,e){t.tmp.done_vars=[]},s.execs.push(i),t.opt.citation_number_sort_direction=this.strings.sort_direction,i=function(t,e){t.output.openLevel("empty")},s.execs.push(i);var r=[];if(this.strings.sort_direction===n.DESCENDING?(r.push(1),r.push(-1)):(r.push(-1),r.push(1)),t[t.build.area].opt.sort_directions.push(r),n.DATE_VARIABLES.indexOf(this.variables[0])>-1&&(t.build.date_key=!0),i=function(t,e){t.tmp.sort_key_flag=!0,this.strings["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),this.strings["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"boolean"==typeof this.strings["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"])},s.execs.push(i),e.push(s),this.variables.length){var o=this.variables[0];if("citation-number"===o&&("citation_sort"===t.build.area&&(t.opt.citation_number_sort=!0),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0)),n.CREATORS.indexOf(o)>-1){var a=new n.Token("names",n.START);a.tokentype=n.START,a.variables=this.variables,n.Node.names.build.call(a,t,e);var l=new n.Token("name",n.SINGLETON);l.tokentype=n.SINGLETON,l.strings["name-as-sort-order"]="all",l.strings["sort-separator"]=" ",l.strings["et-al-use-last"]=this.strings["et-al-use-last"],l.strings["et-al-min"]=this.strings["et-al-min"],l.strings["et-al-use-first"]=this.strings["et-al-use-first"],n.Node.name.build.call(l,t,e);var u=new n.Token("institution",n.SINGLETON);u.tokentype=n.SINGLETON,n.Node.institution.build.call(u,t,e);var c=new n.Token("names",n.END);c.tokentype=n.END,n.Node.names.build.call(c,t,e)}else{var h=new n.Token("text",n.SINGLETON);if(h.dateparts=this.dateparts,n.NUMERIC_VARIABLES.indexOf(o)>-1)i=function(t,e){var i;i=!1,i="citation-number"===o?t.registry.registry[e.id].seq.toString():e[o],i&&(i=n.Util.padding(i)),t.output.append(i,this)};else if("citation-label"===o)i=function(t,e){var i=t.getCitationLabel(e);t.output.append(i,this)};else if(n.DATE_VARIABLES.indexOf(o)>-1)i=n.dateAsSortKey,h.variables=this.variables;else if("title"===o){var p="title",d=!1,f=!1,m=!0;i=t.transform.getOutputFunction(this.variables,p,d,f,m)}else i=function(t,e){var i=e[o];t.output.append(i,"empty")};h.execs.push(i),e.push(h)}}else{var g=new n.Token("text",n.SINGLETON);g.postponed_macro=this.postponed_macro,n.expandMacro.call(t,g)}var b=new n.Token("key",n.END);i=function(t,e){var i=t.output.string(t,t.output.queue);t.sys.normalizeUnicode&&(i=t.sys.normalizeUnicode(i)),""===i&&(i=void 0),("string"!=typeof i||t.tmp.empty_date)&&(i=void 0,t.tmp.empty_date=!1),t[t.tmp.area].keys.push(i),t.tmp.value=[]},b.execs.push(i),t.build.date_key&&("citation_sort"===t.build.area&&(t[t.build.area].opt.sort_directions.push([-1,1]),i=function(t,e){var i=t.registry.registry[e.id].disambig.year_suffix;i||(i=0);var s=n.Util.padding(""+i);t[t.tmp.area].keys.push(s)},b.execs.push(i)),t.build.date_key=!1),i=function(t,e){t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-use-last"]=void 0,t.tmp.sort_key_flag=!1},b.execs.push(i),e.push(b)}},n.Node.label={build:function(t,e){if(this.strings.term){this.strings.form||(this.strings.form="long");var i=function(t,e,i){var s=n.evaluateLabel(this,t,e,i);i&&"locator"===this.strings.term&&(t.parallel.StartVariable("label"),t.parallel.AppendToVariable(i.label),i.section_form_override=this.strings.form),t.output.append(s,this),i&&"locator"===this.strings.term&&t.parallel.CloseVariable()};this.execs.push(i)}else{var s=t.build.names_variables.slice(-1)[0];t.build.name_label||(t.build.name_label={});for(var r=0,o=s.length;o>r;r+=1)t.build.name_label[s[r]]||(t.build.name_label[s[r]]={});if(t.build.name_flag)for(var r=0,o=s.length;o>r;r+=1)t.build.name_label[s[r]].after=this;else for(var r=0,o=s.length;o>r;r+=1)t.build.name_label[s[r]].before=this}e.push(this)}},n.Node.layout={build:function(t,e){var i,s,r,o;this.tokentype===n.START&&(i=function(t,e,i){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&(cite_entry=new n.Token("group",n.START),cite_entry.decorations=[["@cite","entry"]],t.output.startTag("cite_entry",cite_entry),t.output.current.value().item_id=e.system_id,i&&(t.output.current.value().locator_txt=i.locator_txt,t.output.current.value().suffix_txt=i.suffix_txt))},this.execs.push(i)),this.tokentype!==n.START||t.tmp.cite_affixes[t.build.area]||(i=function(t,e){t.tmp.done_vars=[],!t.tmp.just_looking&&t.registry.registry[e.id].parallel&&t.tmp.done_vars.push("first-reference-note-number"),t.tmp.rendered_name=!1,t.tmp.name_node={}},this.execs.push(i),i=function(t,e){t.tmp.sort_key_flag=!1},this.execs.push(i),i=function(t,e){t.tmp.nameset_counter=0},this.execs.push(i),i=function(t,e){var i="empty";t.opt.development_extensions.rtl_support&&["ar","he","fa","ur","yi","ps","syr"].indexOf(e.language)>-1&&(i=new n.Token,i.strings.prefix="",i.strings.suffix=""),t.output.openLevel(i)},this.execs.push(i),e.push(this),t.opt.development_extensions.rtl_support,1,"citation"===t.build.area&&(s=new n.Token("text",n.SINGLETON),i=function(t,e,i){var s;if(i&&i.prefix){s="";var r=i.prefix.replace(/<[^>]+>/g,"").replace(/["'\u201d\u2019\u00bb\u202f\u00a0 ]+$/g,""),o=r.slice(-1);r.match(n.ENDSWITH_ROMANESQUE_REGEXP)?s=" ":n.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(o)>-1?s=" ":o.match(/[\)\],0-9]/)&&(s=" ");var a=!1;n.TERMINAL_PUNCTUATION.slice(0,-1).indexOf(o)>-1&&(t.tmp.term_predecessor=!1,a=!0),prefix=(i.prefix+s).replace(/\s+/g," "),t.output.append(prefix,this,!1,a)}},s.execs.push(i),e.push(s)));var a;if(this.locale_raw&&(a=new n.Token("dummy",n.START),a.locale=this.locale_raw,a.strings.delimiter=this.strings.delimiter,a.strings.suffix=this.strings.suffix,t.tmp.cite_affixes[t.build.area]||(t.tmp.cite_affixes[t.build.area]={})),this.tokentype===n.START&&(t.build.layout_flag=!0,this.locale_raw||(t[t.tmp.area].opt.topdecor=[this.decorations],t[t.tmp.area+"_sort"].opt.topdecor=[this.decorations],t[t.build.area].opt.layout_prefix=this.strings.prefix,t[t.build.area].opt.layout_suffix=this.strings.suffix,t[t.build.area].opt.layout_delimiter=this.strings.delimiter,t[t.build.area].opt.layout_decorations=this.decorations,t.tmp.cite_affixes[t.build.area]&&(o=new n.Token("else",n.START),n.Node["else"].build.call(o,t,e))),this.locale_raw)){if(t.build.layout_locale_flag)a.name="else-if",n.Attributes["@locale-internal"].call(a,t,this.locale_raw),n.Node["else-if"].build.call(a,t,e);else{var l=new n.Token("choose",n.START);n.Node.choose.build.call(l,t,e),a.name="if",n.Attributes["@locale-internal"].call(a,t,this.locale_raw),n.Node["if"].build.call(a,t,e)}t.tmp.cite_affixes[t.build.area][a.locale]={},t.tmp.cite_affixes[t.build.area][a.locale].delimiter=this.strings.delimiter,t.tmp.cite_affixes[t.build.area][a.locale].suffix=this.strings.suffix}this.tokentype===n.END&&(this.locale_raw&&(t.build.layout_locale_flag?(a.name="else-if",a.tokentype=n.END,n.Attributes["@locale-internal"].call(a,t,this.locale_raw),n.Node["else-if"].build.call(a,t,e)):(a.name="if",a.tokentype=n.END,n.Attributes["@locale-internal"].call(a,t,this.locale_raw),n.Node["if"].build.call(a,t,e),t.build.layout_locale_flag=!0)),this.locale_raw||(t.tmp.cite_affixes[t.build.area]&&t.build.layout_locale_flag&&(o=new n.Token("else",n.END),n.Node["else"].build.call(o,t,e),o=new n.Token("choose",n.END),n.Node.choose.build.call(o,t,e)),t.build_layout_locale_flag=!0,"citation"===t.build.area&&(r=new n.Token("text",n.SINGLETON),i=function(t,e,i){var s;i&&i.suffix&&(s="",(i.suffix.match(n.STARTSWITH_ROMANESQUE_REGEXP)||["[","("].indexOf(i.suffix.slice(0,1))>-1)&&(s=" "),t.output.append(s+i.suffix,this))},r.execs.push(i),e.push(r)),i=function(t,e){"bibliography"===t.tmp.area&&t.bibliography.opt["second-field-align"]&&t.output.endTag(),t.output.closeLevel()},this.execs.push(i),i=function(t,e){t.opt.development_extensions.apply_citation_wrapper&&t.sys.wrapCitationEntry&&!t.tmp.just_looking&&e.system_id&&"citation"===t.tmp.area&&t.output.endTag()},this.execs.push(i),e.push(this),t.build.layout_flag=!1,t.build.layout_locale_flag=!1))}},n.Node.macro={build:function(t,e){}},n.NameOutput=function(t,e,i,s){this.debug=!1,this.state=t,this.Item=e,this.item=i,this.nameset_base=0,this.etal_spec={},this._first_creator_variable=!1,this._please_chop=!1},n.NameOutput.prototype.init=function(t){this.state.tmp.term_predecessor&&(this.state.tmp.subsequent_author_substitute_ok=!1),this.nameset_offset&&(this.nameset_base=this.nameset_base+this.nameset_offset),this.nameset_offset=0,this.names=t,this.variables=t.variables,this.state.tmp.value=[],this.state.tmp.rendered_name=[],this.state.tmp.label_blob=!1,this.state.tmp.etal_node=!1,this.state.tmp.etal_term=!1;for(var e=0,i=this.variables.length;i>e;e+=1)this.Item[this.variables[e]]&&this.Item[this.variables[e]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[e]]));this["et-al"]=void 0,this["with"]=void 0,this.name=void 0,this.institutionpart={},this.state.tmp.group_context.value()[1]=!0,!this.state.tmp.value.length},n.NameOutput.prototype.reinit=function(t){if(this.state.tmp.can_substitute.value()){this.nameset_offset=0,this.variables=t.variables;var e=this.state.tmp.value.slice();this.state.tmp.value=[];for(var i=0,s=this.variables.length;s>i;i+=1)this.Item[this.variables[i]]&&this.Item[this.variables[i]].length&&(this.state.tmp.value=this.state.tmp.value.concat(this.Item[this.variables[i]]));this.state.tmp.value.length&&this.state.tmp.can_substitute.replace(!1,n.LITERAL),this.state.tmp.value=e}},n.NameOutput.prototype.outputNames=function(){var t,e,i=this.variables;if(this.institution.and&&(this.institution.and.single.blobs&&this.institution.and.single.blobs.length||(this.institution.and.single.blobs=this.name.and.single.blobs),this.institution.and.multiple.blobs&&this.institution.and.multiple.blobs.length||(this.institution.and.multiple.blobs=this.name.and.multiple.blobs)),this.variable_offset={},this.family)for(this.family_decor=n.Util.cloneToken(this.family),this.family_decor.strings.prefix="",this.family_decor.strings.suffix="",t=0,e=this.family.execs.length;e>t;t+=1)this.family.execs[t].call(this.family_decor,this.state,this.Item);else this.family_decor=!1;if(this.given)for(this.given_decor=n.Util.cloneToken(this.given),
this.given_decor.strings.prefix="",this.given_decor.strings.suffix="",t=0,e=this.given.execs.length;e>t;t+=1)this.given.execs[t].call(this.given_decor,this.state,this.Item);else this.given_decor=!1;if(this.getEtAlConfig(),this.divideAndTransliterateNames(),this.truncatePersonalNameLists(),this.disambigNames(),this.constrainNames(),"count"===this.name.strings.form)return void((this.state.tmp.extension||0!=this.names_count)&&(this.state.output.append(this.names_count,"empty"),this.state.tmp.group_context.value()[2]=!0));this.setEtAlParameters(),this.setCommonTerm(),this.state.tmp.name_node={},this.state.tmp.name_node.children=[],this.renderAllNames();var s=[];for(t=0,e=i.length;e>t;t+=1){for(var r=i[t],o=[],a=!1,l=0,u=this.institutions[r].length;u>l;l+=1)o.push(this.joinPersonsAndInstitutions([this.persons[r][l],this.institutions[r][l]]));if(this.institutions[r].length){var c=this.nameset_base+this.variable_offset[r];this.freeters[r].length&&(c+=1),a=this.joinInstitutionSets(o,c)}var h=this.joinFreetersAndInstitutionSets([this.freeters[r],a]);if(h&&("_sort"!==this.state.tmp.area.slice(-5)&&(h=this._applyLabels(h,r)),s.push(h)),this.common_term)break}for(this.state.output.openLevel("empty"),this.state.output.current.value().strings.delimiter=this.names.strings.delimiter,t=0,e=s.length;e>t;t+=1)this.state.output.append(s[t],"literal",!0);this.state.output.closeLevel("empty");var p=this.state.output.pop();if(this.state.output.append(p,this.names),this.state.tmp.term_predecessor_name&&(this.state.tmp.term_predecessor=!0),this.state.tmp.name_node.top=this.state.output.current.value(),"authority"!==i[0]){var d=[],f=this.Item[i[0]];if(f)for(var t=0,e=f.length;e>t;t+=1)substring=n.Util.Names.getRawName(f[t]),substring&&d.push(substring);d=d.join(", "),d&&(this.state.tmp.name_node.string=d)}if(this.state.tmp.name_node.string&&!this.state.tmp.first_name_string&&(this.state.tmp.first_name_string=this.state.tmp.name_node.string),"classic"===this.Item.type){var m=[];this.state.tmp.first_name_string&&m.push(this.state.tmp.first_name_string),this.Item.title&&m.push(this.Item.title),m=m.join(", "),m&&this.state.sys.getAbbreviation&&(this.state.transform.loadAbbreviation("default","classic",m),this.state.transform.abbrevs["default"].classic[m]&&(this.state.tmp.done_vars.push("title"),this.state.output.append(this.state.transform.abbrevs["default"].classic[m],"empty",!0),p=this.state.output.pop(),this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.top.blobs.push(p)))}this._collapseAuthor(),this.variables=[]},n.NameOutput.prototype._applyLabels=function(t,e){var i;if(!this.label||!this.label[e])return t;var s=0,n=this.freeters_count[e]+this.institutions_count[e];if(n>1)s=1;else{for(var r=0,o=this.persons[e].length;o>r;r+=1)n+=this.persons_count[e][r];n>1&&(s=1)}return this.label[e].before&&("number"==typeof this.label[e].before.strings.plural&&(s=this.label[e].before.strings.plural),i=this._buildLabel(e,s,"before",e),this.state.output.openLevel("empty"),this.state.output.append(i,this.label[e].before,!0),this.state.output.append(t,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),this.label[e].after&&("number"==typeof this.label[e].after.strings.plural&&(s=this.label[e].after.strings.plural),i=this._buildLabel(e,s,"after",e),this.state.output.openLevel("empty"),this.state.output.append(t,"literal",!0),this.state.output.append(i,this.label[e].after,!0),this.state.tmp.label_blob=this.state.output.pop(),this.state.output.append(this.state.tmp.label_blob,"literal",!0),this.state.output.closeLevel("empty"),t=this.state.output.pop()),t},n.NameOutput.prototype._buildLabel=function(t,e,i,s){this.common_term&&(t=this.common_term);var r=!1,o=this.label[s][i];return o&&(r=n.castLabel(this.state,o,t,e,n.TOLERANT)),r},n.NameOutput.prototype._collapseAuthor=function(){var t,e,i;0===this.nameset_base&&this.Item[this.variables[0]]&&!this._first_creator_variable&&(this._first_creator_variable=this.variables[0]),(this.item&&this.item["suppress-author"]&&this._first_creator_variable==this.variables[0]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter.length)&&(this.state.tmp.authorstring_request?(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),this.state.tmp.offset_characters=i,this.state.registry.authorstrings[this.Item.id]=e):this.state.tmp.just_looking||this.state.tmp.suppress_decorations||!(this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length||this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter)||(e="",t=this.state.tmp.name_node.top.blobs.slice(-1)[0].blobs,i=this.state.tmp.offset_characters,t&&(e=this.state.output.string(this.state,t,!1)),e===this.state.tmp.last_primary_names_string?((this.item["suppress-author"]||this.state[this.state.tmp.area].opt.collapse&&this.state[this.state.tmp.area].opt.collapse.length)&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i),this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!0)):(this.state.tmp.last_primary_names_string=e,this.variables.indexOf(this._first_creator_variable)>-1&&this.item&&this.item["suppress-author"]&&"legal_case"!==this.Item.type&&(this.state.tmp.name_node.top.blobs.pop(),this.state.tmp.name_node.children=[],this.state.tmp.offset_characters=i,this.state.tmp.term_predecessor=!1),this.state.tmp.have_collapsed=!1,this.state[this.state.tmp.area].opt.cite_group_delimiter&&this.state[this.state.tmp.area].opt.cite_group_delimiter&&(this.state.tmp.use_cite_group_delimiter=!1))))},n.NameOutput.prototype.isPerson=function(t){return t.literal||!t.given&&t.family&&t.isInstitution?!1:!0},n.NameOutput.prototype.truncatePersonalNameLists=function(){var t,e,i,s,n,r,o;this.freeters_count={},this.persons_count={},this.institutions_count={};for(t in this.freeters)this.freeters.hasOwnProperty(t)&&(this.freeters_count[t]=this.freeters[t].length,this.freeters[t]=this._truncateNameList(this.freeters,t));for(t in this.persons)if(this.persons.hasOwnProperty(t))for(this.institutions_count[t]=this.institutions[t].length,this._truncateNameList(this.institutions,t),this.persons[t]=this.persons[t].slice(0,this.institutions[t].length),this.persons_count[t]=[],s=0,n=this.persons[t].length;n>s;s+=1)this.persons_count[t][s]=this.persons[t][s].length,this.persons[t][s]=this._truncateNameList(this.persons,t,s);if(r=1!==this.etal_min||1!==this.etal_use_first||this.state.tmp.extension||this.state.tmp.just_looking?!1:t,r||this._please_chop)for(e=0,i=this.variables.length;i>e;e+=1){for(t=this.variables[e],this.freeters[t].length&&(this._please_chop===t?(this.freeters[t]=this.freeters[t].slice(1),this.freeters_count[t]+=-1,this._please_chop=!1):r&&!this._please_chop&&(this.freeters[t]=this.freeters[t].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],this._please_chop=r)),e=0,i=this.persons[t].length;i>e;e+=1)if(this.persons[t][e].length){if(this._please_chop===t){this.persons[t][e]=this.persons[t][e].slice(1),this.persons_count[t][e]+=-1,this._please_chop=!1;break}if(r&&!this._please_chop){this.freeters[t]=this.persons[t][e].slice(0,1),this.freeters_count[t]=1,this.institutions[t]=[],this.persons[t]=[],o=[],this._please_chop=r;break}}this.institutions[t].length&&(this._please_chop===t?(this.institutions[t]=this.institutions[t].slice(1),this.institutions_count[t]+=-1,this._please_chop=!1):r&&!this._please_chop&&(this.institutions[t]=this.institutions[t].slice(0,1),this.institutions_count[t]=1,o=[],this._please_chop=r))}for(e=0,i=this.variables.length;i>e;e+=1)for(this.institutions[t].length&&(this.nameset_offset+=1),e=0,i=this.persons[t].length;i>e;e+=1)this.persons[t][e].length&&(this.nameset_offset+=1)},n.NameOutput.prototype._truncateNameList=function(t,e,i){var s;return s="undefined"==typeof i?t[e]:t[e][i],this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names&&s.length>50&&s.length>this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2&&(s=s.slice(0,this.state[this.state[this.state.tmp.area].root].opt.max_number_of_names+2)),s},n.NameOutput.prototype.divideAndTransliterateNames=function(){var t,e,i,s,n=this.Item,r=this.variables;for(this.varnames=r.slice(),this.freeters={},this.persons={},this.institutions={},t=0,e=r.length;e>t;t+=1){var o=r[t];this.variable_offset[o]=this.nameset_offset;var a=this._normalizeVariableValue(n,o);if(this.name.strings["suppress-min"]&&a.length>=this.name.strings["suppress-min"]&&(a=[]),this.name.strings["suppress-max"]&&a.length<=this.name.strings["suppress-max"]&&(a=[]),this._getFreeters(o,a),this._getPersonsAndInstitutions(o,a),0===this.name.strings["suppress-min"])for(this.freeters[o]=[],i=0,s=this.persons[o].length;s>i;i+=1)this.persons[o][i]=[];else if(0===this.institution.strings["suppress-min"]){for(this.institutions[o]=[],this.freeters[o]=this.freeters[o].concat(this.persons[o]),i=0,s=this.persons[o].length;s>i;i+=1)for(var l=0,u=this.persons[o][i].length;u>l;l+=1)this.freeters[o].push(this.persons[o][i][l]);this.persons[o]=[]}}},n.NameOutput.prototype._normalizeVariableValue=function(t,e){var i;return i="string"==typeof t[e]?[{literal:t[e]}]:t[e]?t[e].slice():[]},n.NameOutput.prototype._getFreeters=function(t,e){this.freeters[t]=[];for(var i=e.length-1;i>-1&&this.isPerson(e[i]);i+=-1){var s=this._checkNickname(e.pop());s&&this.freeters[t].push(s)}this.freeters[t].reverse(),this.freeters[t].length&&(this.nameset_offset+=1)},n.NameOutput.prototype._getPersonsAndInstitutions=function(t,e){this.persons[t]=[],this.institutions[t]=[];for(var i=[],s=!1,n=!0,r=e.length-1;r>-1;r+=-1)if(this.isPerson(e[r])){var o=this._checkNickname(e[r]);o&&i.push(o)}else s=!0,this.institutions[t].push(e[r]),n||(i.reverse(),this.persons[t].push(i),i=[]),n=!1;s&&(i.reverse(),this.persons[t].push(i),this.persons[t].reverse(),this.institutions[t].reverse())},n.NameOutput.prototype._clearValues=function(t){for(var e=t.length-1;e>-1;e+=-1)t.pop()},n.NameOutput.prototype._checkNickname=function(t){if(["interview","personal_communication"].indexOf(this.Item.type)>-1){var e="";if(e=n.Util.Names.getRawName(t),e&&this.state.sys.getAbbreviation&&(!this.item||!this.item["suppress-author"])){this.state.transform.loadAbbreviation("default","nickname",e);var i=this.state.transform.abbrevs["default"].nickname[e];i&&(t="!here>>>"===i?!1:{family:i,given:""})}}return t},n.NameOutput.prototype.joinPersons=function(t,e,i){var s;return s="undefined"==typeof i?1===this.etal_spec[e].freeters?this._joinEtAl(t,"name"):2===this.etal_spec[e].freeters?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name"):1===this.etal_spec[e].persons[i]?this._joinEtAl(t,"name"):2===this.etal_spec[e].persons[i]?this._joinEllipsis(t,"name"):this.state.tmp.sort_key_flag?this._join(t," "):this._joinAnd(t,"name")},n.NameOutput.prototype.joinInstitutionSets=function(t,e){var i;return i=1===this.etal_spec[e].institutions?this._joinEtAl(t,"institution"):2===this.etal_spec[e].institutions?this._joinEllipsis(t,"institution"):this._joinAnd(t,"institution")},n.NameOutput.prototype.joinPersonsAndInstitutions=function(t){return this._join(t,this.name.strings.delimiter)},n.NameOutput.prototype.joinFreetersAndInstitutionSets=function(t){var e=this._join(t,"[never here]",this["with"].single,this["with"].multiple);return e},n.NameOutput.prototype._joinEtAl=function(t,e){var i=this._join(t,this.name.strings.delimiter);return this.state.output.openLevel(this._getToken(e)),this.state.output.current.value().strings.delimiter="",this.state.output.append(i,"literal",!0),t.length>1?this.state.output.append(this["et-al"].multiple,"literal",!0):1===t.length&&this.state.output.append(this["et-al"].single,"literal",!0),this.state.output.closeLevel(),this.state.output.pop()},n.NameOutput.prototype._joinEllipsis=function(t,e){return this._join(t,this.name.strings.delimiter,this.name.ellipsis.single,this.name.ellipsis.multiple,e)},n.NameOutput.prototype._joinAnd=function(t,e){return this._join(t,this[e].strings.delimiter,this[e].and.single,this[e].and.multiple,e)},n.NameOutput.prototype._join=function(t,e,i,s,r){var o,a;if(!t)return!1;for(o=t.length-1;o>-1;o+=-1)t[o]&&0!==t[o].length&&t[o].blobs.length||(t=t.slice(0,o).concat(t.slice(o+1)));if(!t.length)return!1;if(i&&2===t.length)i&&(i=new n.Blob(i.blobs,i)),t=[t[0],i,t[1]];else{var l;for(l=s?2:1,o=0,a=t.length-l;a>o;o+=1)t[o].strings.suffix+=e;if(t.length>1){var u=t.pop();s?(s=new n.Blob(s.blobs,s),t.push(s)):(i&&(i=new n.Blob(i.blobs,i)),t.push(i)),t.push(u)}}for(this.state.output.openLevel(this._getToken(r)),i&&s&&(this.state.output.current.value().strings.delimiter=""),o=0,a=t.length;a>o;o+=1)this.state.output.append(t[o],!1,!0);return this.state.output.closeLevel(),this.state.output.pop()},n.NameOutput.prototype._getToken=function(t){var e=this[t];if("institution"===t){var i=new n.Token;return i}return e},n.NameOutput.prototype.setCommonTerm=function(){var t=this.variables,e=t.slice();if(e.sort(),this.common_term=e.join(""),!this.common_term)return!1;var i=!1;if(this.label&&this.label[this.variables[0]]&&(this.label[this.variables[0]].before?i=this.state.getTerm(this.common_term,this.label[this.variables[0]].before.strings.form,0):this.label[this.variables[0]].after&&(i=this.state.getTerm(this.common_term,this.label[this.variables[0]].after.strings.form,0))),!this.state.locale[this.state.opt.lang].terms[this.common_term]||!i||this.variables.length<2)return void(this.common_term=!1);for(var s=0,n=0,r=this.variables.length-1;r>n;n+=1){var o=this.variables[n],a=this.variables[n+1];if(this.freeters[o].length||this.freeters[a].length){if(this.etal_spec[o].freeters!==this.etal_spec[a].freeters||!this._compareNamesets(this.freeters[o],this.freeters[a]))return void(this.common_term=!1);s+=1}if(this.persons[o].length!==this.persons[a].length)return void(this.common_term=!1);for(var l=0,u=this.persons[o].length;u>l;l+=1)if(this.etal_spec[o].persons[l]!==this.etal_spec[a].persons[l]||!this._compareNamesets(this.persons[o][l],this.persons[a][l]))return void(this.common_term=!1)}},n.NameOutput.prototype._compareNamesets=function(t,e){if(t.length!==e.length)return!1;for(var i=0,s=e.length;s>i;i+=1)for(var r=(e[i],0),o=n.NAME_PARTS.length;o>r;r+=1){var a=n.NAME_PARTS[r];if(!t[i]||t[i][a]!=e[i][a])return!1}return!0},n.NameOutput.prototype.constrainNames=function(){this.names_count=0;for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.state.tmp.names_max.push(this.freeters[s].length,"literal"),this._imposeNameConstraints(this.freeters,this.freeters_count,s,t),this.names_count+=this.freeters[s].length),this.institutions[s].length&&(this.state.tmp.names_max.push(this.institutions[s].length,"literal"),this._imposeNameConstraints(this.institutions,this.institutions_count,s,t),this.persons[s]=this.persons[s].slice(0,this.institutions[s].length),this.names_count+=this.institutions[s].length);for(var n=0,r=this.persons[s].length;r>n;n+=1)this.persons[s][n].length&&(this.state.tmp.names_max.push(this.persons[s][n].length,"literal"),this._imposeNameConstraints(this.persons[s],this.persons_count[s],n,t),this.names_count+=this.persons[s][n].length)}},n.NameOutput.prototype._imposeNameConstraints=function(t,e,i,s){var n=t[i],r=this.state.tmp["et-al-min"];this.state.tmp.suppress_decorations?this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]?r=this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(r=this.etal_use_first):(this.state.tmp.disambig_request&&this.state.tmp.disambig_request.names[s]>this.etal_use_first?r=e[i]<this.etal_min?e[i]:this.state.tmp.disambig_request.names[s]:e[i]>=this.etal_min&&(r=this.etal_use_first),this.etal_use_last&&r>this.etal_min-2&&(r=this.etal_min-2));var o=this.etal_min>=this.etal_use_first,a=e[i]>r;r>e[i]&&(r=n.length),o&&a&&(this.etal_use_last?t[i]=n.slice(0,r).concat(n.slice(-1)):t[i]=n.slice(0,r)),this.state.tmp.disambig_settings.names[s]=t[i].length,this.state.disambiguate.padBase(this.state.tmp.disambig_settings)},n.NameOutput.prototype.disambigNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];if(t=this.nameset_base+e,this.freeters[s].length&&this._runDisambigNames(this.freeters[s],t),this.institutions[s].length){"undefined"==typeof this.state.tmp.disambig_settings.givens[t]&&(this.state.tmp.disambig_settings.givens[t]=[]);for(var n=0,r=this.institutions[s].length;r>n;n+=1)"undefined"==typeof this.state.tmp.disambig_settings.givens[t][n]&&this.state.tmp.disambig_settings.givens[t].push(2)}for(var n=0,r=this.persons[s].length;r>n;n+=1)this.persons[s][n].length&&this._runDisambigNames(this.persons[s][n],t)}},n.NameOutput.prototype._runDisambigNames=function(t,e){var i,s,r,o,a,l,u;for(a=0,l=t.length;l>a;a+=1)if(t[a].given||t[a].family){if(r=this.name.strings["initialize-with"],this.state.registry.namereg.addname(""+this.Item.id,t[a],a),i=this.state.tmp.disambig_settings.givens[e],"undefined"==typeof i)for(var c=0,h=e+1;h>c;c+=1)this.state.tmp.disambig_settings.givens[c]||(this.state.tmp.disambig_settings.givens[c]=[]);if(i=this.state.tmp.disambig_settings.givens[e][a],"undefined"==typeof i&&(s=this.name.strings.form,o=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,0,s,r),this.state.tmp.disambig_settings.givens[e].push(o)),s=this.name.strings.form,u=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,0,s,r),this.state.tmp.disambig_request){var p=this.state.tmp.disambig_settings.givens[e][a];1!==p||"by-cite"!==this.state.citation.opt["givenname-disambiguation-rule"]||"undefined"!=typeof this.name.strings["initialize-with"]&&"undefined"!=typeof t[a].given||(p=2),o=p,this.state.opt["disambiguate-add-givenname"]&&t[a].given&&(o=this.state.registry.namereg.evalname(""+this.Item.id,t[a],a,o,this.name.strings.form,this.name.strings["initialize-with"]))}else o=u;!this.state.tmp.just_looking&&this.item&&this.item.position===n.POSITION_FIRST&&u>o&&(o=u),this.state.tmp.sort_key_flag||(this.state.tmp.disambig_settings.givens[e][a]=o,"string"!=typeof r||"undefined"!=typeof this.name.strings.initialize&&!0!==this.name.strings.initialize||(this.state.tmp.disambig_settings.use_initials=!0))}},n.NameOutput.prototype.getEtAlConfig=function(){var t=this.item;this["et-al"]={},this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].single=this.state.output.pop(),this["et-al"].single.strings.suffix=this.etal_suffix,this["et-al"].single.strings.prefix=this.etal_prefix_single,this.state.output.append(this.etal_term,this.etal_style,!0),this["et-al"].multiple=this.state.output.pop(),this["et-al"].multiple.strings.suffix=this.etal_suffix,this["et-al"].multiple.strings.prefix=this.etal_prefix_multiple,"undefined"==typeof t&&(t={}),t.position?(this.name.strings["et-al-subsequent-min"]?this.etal_min=this.name.strings["et-al-subsequent-min"]:this.etal_min=this.name.strings["et-al-min"],this.name.strings["et-al-subsequent-use-first"]?this.etal_use_first=this.name.strings["et-al-subsequent-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"]):(this.state.tmp["et-al-min"]?this.etal_min=this.state.tmp["et-al-min"]:this.etal_min=this.name.strings["et-al-min"],this.state.tmp["et-al-use-first"]?this.etal_use_first=this.state.tmp["et-al-use-first"]:this.etal_use_first=this.name.strings["et-al-use-first"],"boolean"==typeof this.state.tmp["et-al-use-last"]?this.etal_use_last=this.state.tmp["et-al-use-last"]:this.etal_use_last=this.name.strings["et-al-use-last"]),this.state.tmp["et-al-min"]||(this.state.tmp["et-al-min"]=this.etal_min)},n.NameOutput.prototype.setEtAlParameters=function(){var t,e,i,s;for(t=0,e=this.variables.length;e>t;t+=1){var n=this.variables[t];for("undefined"==typeof this.etal_spec[n]&&(this.etal_spec[n]={freeters:0,institutions:0,persons:[]}),this.etal_spec[this.nameset_base+t]=this.etal_spec[n],this.freeters[n].length&&this._setEtAlParameter("freeters",n),i=0,s=this.persons[n].length;s>i;i+=1)"undefined"==typeof this.etal_spec[n][i]&&(this.etal_spec[n].persons[i]=0),this._setEtAlParameter("persons",n,i);this.institutions[n].length&&this._setEtAlParameter("institutions",n)}},n.NameOutput.prototype._setEtAlParameter=function(t,e,i){var s,n;"persons"===t?(s=this.persons[e][i],n=this.persons_count[e][i]):(s=this[t][e],n=this[t+"_count"][e]),s.length<n&&!this.state.tmp.sort_key_flag?this.etal_use_last?"persons"===t?this.etal_spec[e].persons[i]=2:this.etal_spec[e][t]=2:"persons"===t?this.etal_spec[e].persons[i]=1:this.etal_spec[e][t]=1:"persons"===t?this.etal_spec[e].persons[i]=0:this.etal_spec[e][t]=0},n.NameOutput.prototype.renderAllNames=function(){for(var t,e=0,i=this.variables.length;i>e;e+=1){var s=this.variables[e];t=this.nameset_base+e,this.freeters[s].length&&(this.freeters[s]=this._renderPersonalNames(this.freeters[s],t));for(var n=0,r=this.institutions[s].length;r>n;n+=1)this.persons[s][n]=this._renderPersonalNames(this.persons[s][n],t,n)}this.renderInstitutionNames()},n.NameOutput.prototype.renderInstitutionNames=function(){for(var t=0,e=this.variables.length;e>t;t+=1)for(var i=this.variables[t],s=0,n=this.institutions[i].length;n>s;s+=1){var r,o,a,l,u,s,n,c,h=this.institutions[i][s];if(c=this.state.tmp.extension?["sort"]:h.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},c)for(var p=["primary","secondary","tertiary"],d=0,f=p.length;f>d&&!(c.length-1<d);d+=1)c[d]&&(slot[p[d]]="locale-"+c[d]);else slot.primary="locale-translat";"bibliography"===this.state.tmp.area||"citation"===this.state.tmp.area&&"note"===this.state.opt.xclass&&this.item&&!this.item.position||(slot.secondary=!1,slot.tertiary=!1);var m;this.setRenderedName(h),m=this.getName(h,slot.primary,!0);var g=m.name,b=m.usedOrig;switch(g&&(g=this.fixupInstitution(g,i,s)),secondary=!1,slot.secondary&&(m=this.getName(h,slot.secondary,!1,b),secondary=m.name,b=m.usedOrig,secondary&&(secondary=this.fixupInstitution(secondary,i,s))),tertiary=!1,slot.tertiary&&(m=this.getName(h,slot.tertiary,!1,b),tertiary=m.name,tertiary&&(tertiary=this.fixupInstitution(tertiary,i,s))),this.institution.strings["institution-parts"]){case"short":g["short"].length?(l=this._getShortStyle(),r=[this._renderOneInstitutionPart(g["short"],l)]):(u=this._getLongStyle(g,i,s),r=[this._renderOneInstitutionPart(g["long"],u)]);break;case"short-long":u=this._getLongStyle(g,i,s),l=this._getShortStyle(),o=this._renderOneInstitutionPart(g["short"],l),a=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u),r=[o,a];break;case"long-short":u=this._getLongStyle(g,i,s),l=this._getShortStyle(),o=this._renderOneInstitutionPart(g["short"],l),a=this._composeOneInstitutionPart([g,secondary,tertiary],slot,u,!0),r=[a,o];break;default:u=this._getLongStyle(g,i,s),r=[this._composeOneInstitutionPart([g,secondary,tertiary],slot,u)]}this.institutions[i][s]=this._join(r,"")}},n.NameOutput.prototype._composeOneInstitutionPart=function(t,e,i){var s=!1,r=!1,o=!1;t[0]&&(s=this._renderOneInstitutionPart(t[0]["long"],i)),t[1]&&(r=this._renderOneInstitutionPart(t[1]["long"],i)),t[2]&&(o=this._renderOneInstitutionPart(t[2]["long"],i));var a;return r||o?(this.state.output.openLevel("empty"),this.state.output.append(s),secondary_tok=n.Util.cloneToken(i),e.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[e.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[e.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(r,secondary_tok),tertiary_tok=n.Util.cloneToken(i),e.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.institutions[e.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.institutions[e.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(o,tertiary_tok),this.state.output.closeLevel(),a=this.state.output.pop()):a=s,a},n.NameOutput.prototype._renderOneInstitutionPart=function(t,e){for(var i=0,s=t.length;s>i;i+=1)if(t[i]){var r=t[i];if(this.state.tmp.strip_periods)r=r.replace(/\./g,"");else for(var o=0,a=e.decorations.length;a>o;o+=1)if("@strip-periods"===e.decorations[o][0]&&"true"===e.decorations[o][1]){r=r.replace(/\./g,"");break}this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,n.LITERAL),"!here>>>"===r?t[i]=!1:(this.state.output.append(r,e,!0),t[i]=this.state.output.pop())}return"undefined"==typeof this.institution.strings["part-separator"]&&(this.institution.strings["part-separator"]=this.name.strings.delimiter),this._join(t,this.institution.strings["part-separator"])},n.NameOutput.prototype._renderPersonalNames=function(t,e,i){var s=!1;if(t.length){for(var r=[],o=0,a=t.length;a>o;o+=1){var s,l,u=t[o];if(l=this.state.tmp.extension?["sort"]:u.isInstitution?this.state.opt["cite-lang-prefs"].institutions:this.state.opt["cite-lang-prefs"].persons,slot={primary:"locale-orig",secondary:!1,tertiary:!1},l)for(var c=["primary","secondary","tertiary"],h=0,p=c.length;p>h&&!(l.length-1<h);h+=1)slot[c[h]]="locale-"+l[h];else slot.primary="locale-translat";(this.state.tmp.sort_key_flag||"bibliography"!==this.state.tmp.area&&("citation"!==this.state.tmp.area||"note"!==this.state.opt.xclass||!this.item||this.item.position))&&(slot.secondary=!1,slot.tertiary=!1),this.setRenderedName(u);var d=this.getName(u,slot.primary,!0),f=this._renderOnePersonalName(d.name,e,o,i);secondary=!1,slot.secondary&&(d=this.getName(u,slot.secondary,!1,d.usedOrig),d.name&&(secondary=this._renderOnePersonalName(d.name,e,o,i))),tertiary=!1,slot.tertiary&&(d=this.getName(u,slot.tertiary,!1,d.usedOrig),d.name&&(tertiary=this._renderOnePersonalName(d.name,e,o,i)));var m;secondary||tertiary?(this.state.output.openLevel("empty"),this.state.output.append(f),secondary_tok=new n.Token,slot.secondary&&(secondary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.secondary].prefix,secondary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ")),this.state.output.append(secondary,secondary_tok),tertiary_tok=new n.Token,slot.tertiary&&(tertiary_tok.strings.prefix=this.state.opt.citeAffixes.persons[slot.tertiary].prefix,tertiary_tok.strings.suffix=this.state.opt.citeAffixes.persons[slot.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ")),this.state.output.append(tertiary,tertiary_tok),this.state.output.closeLevel(),m=this.state.output.pop()):m=f,r.push(m)}s=this.joinPersons(r,e,i)}return s},n.NameOutput.prototype._isRomanesque=function(t){var e=2;if(t.family.replace('"',"","g").match(n.ROMANESQUE_REGEXP)||(e=0),!e&&t.given&&t.given.match(n.STARTSWITH_ROMANESQUE_REGEXP)&&(e=1),2==e){if(t.multi&&t.multi.main)var i=t.multi.main.slice(0,2);else this.Item.language&&(i=this.Item.language.slice(0,2));["ja","zh"].indexOf(i)>-1&&(e=1)}return e},n.NameOutput.prototype._renderOnePersonalName=function(t,e,i,s){var r=t,o=this._droppingParticle(r,e,s),a=this._familyName(r),l=this._nonDroppingParticle(r),u=this._givenName(r,e,i),c=this._nameSuffix(r);this._isShort(e,i)&&!r["full-form-always"]&&(o=!1,u=!1,c=!1);var h=this.name.strings["sort-separator"];h||(h="");var p;p=r["comma-suffix"]?", ":" ";var d,f,m,g,b=this._isRomanesque(r),v=l&&"-"===l.blobs.slice(-1);return 0===b?d=this._join([l,a,u],""):1===b||r["static-ordering"]?d=this._join([l,a,u]," "):r["reverse-ordering"]?d=this._join([u,l,a]," "):this.state.tmp.sort_key_flag?"never"===this.state.opt["demote-non-dropping-particle"]?(m=this._join([l,a,o]," "),f=this._join([m,u]," "),d=this._join([f,c]," ")):(g=this._join([u,o,l]," "),f=this._join([a,g]," "),d=this._join([f,c]," ")):"all"===this.name.strings["name-as-sort-order"]||"first"===this.name.strings["name-as-sort-order"]&&0===i&&(0===s||"undefined"==typeof s)?(["Lord","Lady"].indexOf(r.given)>-1&&(h=", "),["always","display-and-sort"].indexOf(this.state.opt["demote-non-dropping-particle"])>-1&&!v?(g=this._join([u,o],r["comma-dropping-particle"]+" "),g=this._join([g,l]," "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),a&&this.family&&(a.strings.prefix=this.family.strings.prefix,a.strings.suffix=this.family.strings.suffix),f=this._join([a,g],h),d=this._join([f,c],h)):("bibliography"===this.state.tmp.area&&!this.state.tmp.term_predecessor&&l&&(v||(l.blobs=n.Output.Formatters["capitalize-first"](this.state,l.blobs))),m=v?this._join([l,a],""):this._join([l,a]," "),m&&this.family&&(m.strings.prefix=this.family.strings.prefix,m.strings.suffix=this.family.strings.suffix),g=this._join([u,o],r["comma-dropping-particle"]+" "),g&&this.given&&(g.strings.prefix=this.given.strings.prefix,g.strings.suffix=this.given.strings.suffix),f=this._join([m,g],h),d=this._join([f,c],h))):(r["dropping-particle"]&&r.family&&!r["non-dropping-particle"]&&["'","",""].indexOf(r["dropping-particle"].slice(-1))>-1&&(a=this._join([o,a],""),o=!1),this.state.tmp.term_predecessor||u||"bibliography"!==this.state.tmp.area||(!o&&l?v||(l.blobs=n.Output.Formatters["capitalize-first"](this.state,l.blobs)):o&&(o.blobs=n.Output.Formatters["capitalize-first"](this.state,o.blobs))),v?(g=this._join([l,a],""),g=this._join([o,g]," ")):g=this._join([o,l,a]," "),g=this._join([g,c],p),g&&this.family&&(g.strings.prefix=this.family.strings.prefix,g.strings.suffix=this.family.strings.suffix),u&&this.given&&(u.strings.prefix=this.given.strings.prefix,u.strings.suffix=this.given.strings.suffix),g.strings.prefix&&(r["comma-dropping-particle"]=""),d=this._join([u,g],r["comma-dropping-particle"]+" ")),this.state.tmp.group_context.value()[2]=!0,this.state.tmp.can_substitute.replace(!1,n.LITERAL),this.state.tmp.term_predecessor=!0,this.state.tmp.name_node.children.push(d),d},n.NameOutput.prototype._isShort=function(t,e){return 0===this.state.tmp.disambig_settings.givens[t][e]?!0:!1},n.NameOutput.prototype._normalizeNameInput=function(t){var e={literal:t.literal,family:t.family,isInstitution:t.isInstitution,given:t.given,suffix:t.suffix,"comma-suffix":t["comma-suffix"],"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],"static-ordering":t["static-ordering"],"reverse-ordering":t["reverse-ordering"],"full-form-always":t["full-form-always"],"parse-names":t["parse-names"],"comma-dropping-particle":"",block_initialize:t.block_initialize,multi:t.multi};return this._parseName(e),e},n.NameOutput.prototype._stripPeriods=function(t,e){var i=this[t+"_decor"];if(e)if(this.state.tmp.strip_periods)e=e.replace(/\./g,"");else if(i)for(var s=0,n=i.decorations.length;n>s;s+=1)if("@strip-periods"===i.decorations[s][0]&&"true"===i.decorations[s][1]){e=e.replace(/\./g,"");break}return e},n.NameOutput.prototype._nonDroppingParticle=function(t){var e=t["non-dropping-particle"];e&&this.state.tmp.sort_key_flag&&(e=e.replace(/[\'\u2019]/,""));var i=this._stripPeriods("family",e);return this.state.output.append(i,this.family_decor,!0)?this.state.output.pop():!1},n.NameOutput.prototype._droppingParticle=function(t,e,i){var s=t["dropping-particle"];s&&this.state.tmp.sort_key_flag&&(s=s.replace(/[\'\u2019]/,""));var n=this._stripPeriods("given",s);if(t["dropping-particle"]&&t["dropping-particle"].match(/^et.?al[^a-z]$/))this.name.strings["et-al-use-last"]?"undefined"==typeof i?this.etal_spec[e].freeters=2:this.etal_spec[e].persons=2:"undefined"==typeof i?this.etal_spec[e].freeters=1:this.etal_spec[e].persons=1,
t["comma-dropping-particle"]="";else if(this.state.output.append(n,this.given_decor,!0))return this.state.output.pop();return!1},n.NameOutput.prototype._familyName=function(t){var e=this._stripPeriods("family",t.family);return this.state.output.append(e,this.family_decor,!0)?this.state.output.pop():!1},n.NameOutput.prototype._givenName=function(t,e,i){if(this.name.strings.initialize===!1)t.family&&t.given&&this.name.strings.initialize===!1&&(t.given=n.Util.Names.initializeWith(this.state,t.given,this.name.strings["initialize-with"],!0)),t.given=n.Util.Names.unInitialize(this.state,t.given);else if(t.family&&1===this.state.tmp.disambig_settings.givens[e][i]&&!t.block_initialize){var s=this.name.strings["initialize-with"];t.given=n.Util.Names.initializeWith(this.state,t.given,s)}else t.given=n.Util.Names.unInitialize(this.state,t.given);var r=this._stripPeriods("given",t.given);return this.state.output.append(r,this.given_decor,!0)?this.state.output.pop():!1},n.NameOutput.prototype._nameSuffix=function(t){var e=t.suffix;return"string"==typeof this.name.strings["initialize-with"]&&(e=n.Util.Names.initializeWith(this.state,t.suffix,this.name.strings["initialize-with"],!0)),e=this._stripPeriods("family",e),this.state.output.append(e,"empty",!0)?this.state.output.pop():!1},n.NameOutput.prototype._getLongStyle=function(t,e,i){var s;return s=t["short"].length&&this.institutionpart["long-with-short"]?this.institutionpart["long-with-short"]:this.institutionpart["long"],s||(s=new n.Token),s},n.NameOutput.prototype._getShortStyle=function(){var t;return t=this.institutionpart["short"]?this.institutionpart["short"]:new n.Token},n.NameOutput.prototype._parseName=function(t){var e,i;if(!t["parse-names"]&&"undefined"!=typeof t["parse-names"])return t;t.family&&!t.given&&t.isInstitution&&(t.literal=t.family,t.family=void 0,t.isInstitution=void 0);var s;if(t.family&&'"'===t.family.slice(0,1)&&'"'===t.family.slice(-1)||!t["parse-names"]&&"undefined"!=typeof t["parse-names"]?(t.family=t.family.slice(1,-1),s=!0,t["parse-names"]=0):s=!1,!t["non-dropping-particle"]&&t.family&&!s&&t.given&&(e=t.family.match(/^((?:[\'\u2019a-z][ \'\u2019a-z]*[-\s\'\u2019]+|[ABDVL][^ ][-\s]+[a-z]*\s*|[ABDVL][^ ][^ ][-\s]+[a-z]*\s*))/),e&&(t.family=t.family.slice(e[1].length),t["non-dropping-particle"]=e[1].replace(/\s+$/,"").replace("'",""))),!t.suffix&&t.given&&(e=t.given.match(/(\s*,!*\s*)/))){i=t.given.indexOf(e[1]);var n=t.given.slice(i+e[1].length),r=t.given.slice(i,i+e[1].length).replace(/\s*/g,"");n.length<=3?(2===r.length&&(t["comma-suffix"]=!0),t.suffix=n):!t["dropping-particle"]&&t.given&&(t["dropping-particle"]=n,t["comma-dropping-particle"]=","),t.given=t.given.slice(0,i)}!t["dropping-particle"]&&t.given&&(e=t.given.match(/(\s+)([a-z][ \'\u2019a-z]*)$/),e&&(t.given=t.given.slice(0,-1*(e[1].length+e[2].length)),t["dropping-particle"]=e[2]))},n.NameOutput.prototype.getName=function(t,e,s,n){if(n&&"locale-orig"===e)return{name:!1,usedOrig:n};t.family||(t.family=""),t.given||(t.given="");var r={};r["static-ordering"]=this.getStaticOrder(t);var o=!0;if("locale-orig"!==e&&(o=!1,t.multi)){var a=this.state.opt[e];for(i=0,ilen=a.length;i<ilen;i+=1)if(l=a[i],t.multi._key[l]){o=!0,t=t.multi._key[l],r=this.getNameParams(l),r.transliterated=!0;break}}if(!o){var l=!1;t.multi&&t.multi.main?l=t.multi.main:this.Item.language&&(l=this.Item.language),l&&(r=this.getNameParams(l))}if(!s&&!o)return{name:!1,usedOrig:n};t.family||(t.family=""),t.given||(t.given=""),t={family:t.family,given:t.given,"non-dropping-particle":t["non-dropping-particle"],"dropping-particle":t["dropping-particle"],suffix:t.suffix,"static-ordering":r["static-ordering"],"reverse-ordering":r["reverse-ordering"],"full-form-always":r["full-form-always"],"parse-names":t["parse-names"],"comma-suffix":t["comma-suffix"],"comma-dropping-particle":t["comma-dropping-particle"],transliterated:r.transliterated,block_initialize:r["block-initialize"],literal:t.literal,isInstitution:t.isInstitution,multi:t.multi},!t.literal&&!t.given&&t.family&&t.isInstitution&&(t.literal=t.family),t.literal&&(delete t.family,delete t.given),t=this._normalizeNameInput(t);var u;return u=n?n:!o,{name:t,usedOrig:u}},n.NameOutput.prototype.getNameParams=function(t){var e={},i=n.localeResolve(this.Item.language,this.state.opt["default-locale"][0]),s=this.state.locale[i.best]?i.best:this.state.opt["default-locale"][0],r=this.state.locale[s].opts["name-as-sort-order"],o=this.state.locale[s].opts["name-as-reverse-order"],a=this.state.locale[s].opts["name-never-short"],l=t.split("-")[0];return r&&r[l]&&(e["static-ordering"]=!0,e["reverse-ordering"]=!1),o&&o[l]&&(e["reverse-ordering"]=!0,e["static-ordering"]=!1),a&&a[l]&&(e["full-form-always"]=!0),e["static-ordering"]&&(e["block-initialize"]=!0),e},n.NameOutput.prototype.setRenderedName=function(t){if("bibliography"===this.state.tmp.area){for(var e="",i=0,s=n.NAME_PARTS.length;s>i;i+=1)t[n.NAME_PARTS[i]]&&(e+=t[n.NAME_PARTS[i]]);this.state.tmp.rendered_name.push(e)}},n.NameOutput.prototype.fixupInstitution=function(t,e,i){t=this._splitInstitution(t,e,i),this.institution.strings["reverse-order"]&&t["long"].reverse();var s=t["long"],n=s.slice();if(this.state.sys.getAbbreviation)for(var r=this.Item.jurisdiction,o=0,a=s.length;a>o;o+=1)r=this.state.transform.loadAbbreviation(r,"institution-part",s[o]),this.state.transform.abbrevs[r]["institution-part"][s[o]]&&(n[o]=this.state.transform.abbrevs[r]["institution-part"][s[o]]);return t["short"]=n,t},n.NameOutput.prototype.getStaticOrder=function(t,e){var i=!1;return!e&&t["static-ordering"]?i=!0:0===this._isRomanesque(t)?i=!0:(!t.multi||!t.multi.main)&&this.Item.language&&["vi","hu"].indexOf(this.Item.language)>-1?i=!0:t.multi&&t.multi.main&&["vi","hu"].indexOf(t.multi.main.slice(0,2))>-1?i=!0:this.state.opt["auto-vietnamese-names"]&&n.VIETNAMESE_NAMES.exec(t.family+" "+t.given)&&n.VIETNAMESE_SPECIALS.exec(t.family+t.given)&&(i=!0),i},n.NameOutput.prototype._splitInstitution=function(t,e,i){var s={},n=t.literal.replace(/\s*\|\s*/g,"|");if(n=n.split("|"),"short"===this.institution.strings.form&&this.state.sys.getAbbreviation)for(var r=this.Item.jurisdiction,o=n.length;o>0;o+=-1){var a=n.slice(0,o).join("|");if(r=this.state.transform.loadAbbreviation(r,"institution-entire",a),this.state.transform.abbrevs[r]["institution-entire"][a]){var l=this.state.transform.abbrevs[r]["institution-entire"][a];l=this.state.transform.quashCheck(l);var u=l.split(/>>[0-9]{4}>>/),c=l.match(/>>([0-9]{4})>>/);if(l=u.pop(),u.length>0&&this.Item["original-date"]&&this.Item["original-date"].year)for(var h=c.length-1;h>0&&!(parseInt(this.Item["original-date"].year,10)>=parseInt(c[h],10));h+=-1)l=u.pop();l=l.replace(/\s*\|\s*/g,"|"),n=[l]}}return n.reverse(),s["long"]=this._trimInstitution(n,e,i),s},n.NameOutput.prototype._trimInstitution=function(t,e,i){var s=!1,n=!1,r=!1,o=t.slice();return this.institution&&("undefined"!=typeof this.institution.strings["use-first"]&&(s=this.institution.strings["use-first"]),"undefined"!=typeof this.institution.strings["stop-last"]&&(o=o.slice(0,this.institution.strings["stop-last"]),t=t.slice(0,this.institution.strings["stop-last"])),"undefined"!=typeof this.institution.strings["use-last"]&&(n=this.institution.strings["use-last"])),!1===s&&(0===this.persons[e].length&&(s=this.institution.strings["substitute-use-first"]),s||(s=0)),!1===n&&(n=s?0:t.length),s>t.length-n&&(s=t.length-n),r&&(n=0),t=t.slice(0,s),o=o.slice(s),n&&(n>o.length&&(n=o.length),n&&(t=t.concat(o.slice(o.length-n)))),t},n.PublisherOutput=function(t,e){this.state=t,this.group_tok=e,this.varlist=[]},n.PublisherOutput.prototype.render=function(){this.clearVars(),this.composeAndBlob(),this.composeElements(),this.composePublishers(),this.joinPublishers()},n.PublisherOutput.prototype.composeAndBlob=function(){this.and_blob={};var t=!1;"text"===this.group_tok.strings.and?t=this.state.getTerm("and"):"symbol"===this.group_tok.strings.and&&(t="&");var e=new n.Token;e.strings.suffix=" ",e.strings.prefix=" ",this.state.output.append(t,e,!0);var i=this.state.output.pop();e.strings.prefix=this.group_tok.strings["subgroup-delimiter"],this.state.output.append(t,e,!0);var s=this.state.output.pop();this.and_blob.single=!1,this.and_blob.multiple=!1,t&&("always"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?this.and_blob.single=s:"never"===this.group_tok.strings["subgroup-delimiter-precedes-last"]?(this.and_blob.single=i,this.and_blob.multiple=i):(this.and_blob.single=i,this.and_blob.multiple=s))},n.PublisherOutput.prototype.composeElements=function(){for(var t=0,e=2;e>t;t+=1)for(var i=["publisher","publisher-place"][t],s=0,n=this["publisher-list"].length;n>s;s+=1){var r=this[i+"-list"][s],o=this[i+"-token"];this.state.output.append(r,o,!0),this[i+"-list"][s]=this.state.output.pop()}},n.PublisherOutput.prototype.composePublishers=function(){for(var t,e=0,i=this["publisher-list"].length;i>e;e+=1){t=[this[this.varlist[0]+"-list"][e],this[this.varlist[1]+"-list"][e]],this["publisher-list"][e]=this._join(t,this.group_tok.strings.delimiter)}},n.PublisherOutput.prototype.joinPublishers=function(){var t=this["publisher-list"],e=(this.name_delimiter,this._join(t,this.group_tok.strings["subgroup-delimiter"],this.and_blob.single,this.and_blob.multiple,this.group_tok));this.state.output.append(e,"literal")},n.PublisherOutput.prototype._join=n.NameOutput.prototype._join,n.PublisherOutput.prototype._getToken=n.NameOutput.prototype._getToken,n.PublisherOutput.prototype.clearVars=function(){this.state.tmp["publisher-list"]=!1,this.state.tmp["publisher-place-list"]=!1,this.state.tmp["publisher-group-token"]=!1,this.state.tmp["publisher-token"]=!1,this.state.tmp["publisher-place-token"]=!1},n.evaluateLabel=function(t,e,i,s){var r;"locator"===t.strings.term?(s&&s.label&&(r="sub verbo"===s.label?"sub-verbo":s.label),r||(r="page")):r=t.strings.term;var o=t.strings.plural;return s&&"number"==typeof s.force_pluralism?o=s.force_pluralism:"number"!=typeof o&&("locator"===t.strings.term?s&&s.locator&&(e.opt.development_extensions.locator_parsing_for_plurals?(e.tmp.shadow_numbers.locator||e.processNumber(!1,s,"locator",i.type),o=e.tmp.shadow_numbers.locator.plural):o=n.evaluateStringPluralism(s.locator)):["page","page-first"].indexOf(t.variables[0])>-1?(e.processNumber(!1,i,r,i.type),o=e.tmp.shadow_numbers[r].plural,r=e.tmp.shadow_numbers[r].label):(e.tmp.shadow_numbers[r]||e.processNumber(!1,i,r,i.type),o=e.tmp.shadow_numbers[r].plural),t.decorations&&(e.opt.development_extensions.csl_reverse_lookup_support||e.sys.csl_reverse_lookup_support)&&(t.decorations.reverse(),t.decorations.push(["@showid","true",t.cslid]),t.decorations.reverse())),n.castLabel(e,t,r,o,n.TOLERANT)},n.evaluateStringPluralism=function(t){if(t){var e=t.match(/(?:[0-9],\s*[0-9]|\s+and\s+|&|([0-9]+)\s*[\-\u2013]\s*([0-9]+))/);if(e&&(!e[1]||parseInt(e[1],10)<parseInt(e[2],10)))return 1}return 0},n.castLabel=function(t,e,i,s,n){var r=e.strings.form;t.tmp.group_context.value()[5]&&(r=t.tmp.group_context.value()[5]);var o=t.getTerm(i,r,s,!1,n);if(t.tmp.strip_periods)o=o.replace(/\./g,"");else for(var a=0,l=e.decorations.length;l>a;a+=1)if("@strip-periods"===e.decorations[a][0]&&"true"===e.decorations[a][1]){o=o.replace(/\./g,"");break}return o},n.Node.name={build:function(t,e){var i;[n.SINGLETON,n.START].indexOf(this.tokentype)>-1&&(t.fixOpt(this,"name-delimiter","name_delimiter"),t.fixOpt(this,"name-form","form"),t.fixOpt(this,"and","and"),t.fixOpt(this,"delimiter-precedes-last","delimiter-precedes-last"),t.fixOpt(this,"delimiter-precedes-et-al","delimiter-precedes-et-al"),t.fixOpt(this,"initialize-with","initialize-with"),t.fixOpt(this,"initialize","initialize"),t.fixOpt(this,"name-as-sort-order","name-as-sort-order"),t.fixOpt(this,"sort-separator","sort-separator"),t.fixOpt(this,"and","and"),t.fixOpt(this,"et-al-min","et-al-min"),t.fixOpt(this,"et-al-use-first","et-al-use-first"),t.fixOpt(this,"et-al-use-last","et-al-use-last"),t.fixOpt(this,"et-al-subsequent-min","et-al-subsequent-min"),t.fixOpt(this,"et-al-subsequent-use-first","et-al-subsequent-use-first"),this.strings["et-al-subsequent-min"]&&this.strings["et-al-subsequent-min"]!==this.strings["et-al-min"]&&(t.opt.update_mode=n.POSITION),this.strings["et-al-subsequent-use-first"]&&this.strings["et-al-subsequent-use-first"]!==this.strings["et-al-use-first"]&&(t.opt.update_mode=n.POSITION),"undefined"==typeof this.strings.name_delimiter?this.strings.delimiter=", ":this.strings.delimiter=this.strings.name_delimiter,this.strings["et-al-use-last"]&&(this.ellipsis_term="",this.ellipsis_prefix_single=" ",this.ellipsis_prefix_multiple=this.strings.delimiter,this.ellipsis_suffix=" "),i=function(t,e){t.tmp.etal_term="et-al",t.tmp.name_delimiter=this.strings.delimiter,t.tmp["delimiter-precedes-et-al"]=this.strings["delimiter-precedes-et-al"],"text"===this.strings.and?this.and_term=t.getTerm("and","long",0):"symbol"===this.strings.and&&(t.opt.development_extensions.expect_and_symbol_form?this.and_term=t.getTerm("and","symbol",0):this.and_term="&"),t.tmp.and_term=this.and_term,n.STARTSWITH_ROMANESQUE_REGEXP.test(this.and_term)?(this.and_prefix_single=" ",this.and_prefix_multiple=", ","string"==typeof this.strings.delimiter&&(this.and_prefix_multiple=this.strings.delimiter),this.and_suffix=" ",t.build.name_delimiter=this.strings.delimiter):(this.and_prefix_single="",this.and_prefix_multiple="",this.and_suffix=""),"always"===this.strings["delimiter-precedes-last"]?this.and_prefix_single=this.strings.delimiter:"never"===this.strings["delimiter-precedes-last"]?this.and_prefix_multiple&&(this.and_prefix_multiple=" "):"after-inverted-name"===this.strings["delimiter-precedes-last"]&&(this.and_prefix_single&&(this.and_prefix_single=this.strings.delimiter),this.and_prefix_multiple&&(this.and_prefix_multiple=" ")),this.and={},this.strings.and?(t.output.append(this.and_term,"empty",!0),this.and.single=t.output.pop(),this.and.single.strings.prefix=this.and_prefix_single,this.and.single.strings.suffix=this.and_suffix,t.output.append(this.and_term,"empty",!0),this.and.multiple=t.output.pop(),this.and.multiple.strings.prefix=this.and_prefix_multiple,this.and.multiple.strings.suffix=this.and_suffix):this.strings.delimiter&&(this.and.single=new n.Blob(this.strings.delimiter),this.and.single.strings.prefix="",this.and.single.strings.suffix="",this.and.multiple=new n.Blob(this.strings.delimiter),this.and.multiple.strings.prefix="",this.and.multiple.strings.suffix=""),this.ellipsis={},this.strings["et-al-use-last"]&&(this.ellipsis.single=new n.Blob(this.ellipsis_term),this.ellipsis.single.strings.prefix=this.ellipsis_prefix_single,this.ellipsis.single.strings.suffix=this.ellipsis_suffix,this.ellipsis.multiple=new n.Blob(this.ellipsis_term),this.ellipsis.multiple.strings.prefix=this.ellipsis_prefix_multiple,this.ellipsis.multiple.strings.suffix=this.ellipsis_suffix),"undefined"==typeof t.tmp["et-al-min"]&&(t.tmp["et-al-min"]=this.strings["et-al-min"]),"undefined"==typeof t.tmp["et-al-use-first"]&&(t.tmp["et-al-use-first"]=this.strings["et-al-use-first"]),"undefined"==typeof t.tmp["et-al-use-last"]&&(t.tmp["et-al-use-last"]=this.strings["et-al-use-last"]),t.nameOutput.name=this},t.build.name_flag=!0,this.execs.push(i)),e.push(this)}},n.Node["name-part"]={build:function(t,e){t.build[this.strings.name]=this}},n.Node.names={build:function(t,e){var i;if((this.tokentype===n.START||this.tokentype===n.SINGLETON)&&(n.Util.substituteStart.call(this,t,e),t.build.substitute_level.push(1),t.fixOpt(this,"names-delimiter","delimiter")),this.tokentype===n.SINGLETON){t.build.names_variables.push(this.variables);for(var s=0,r=this.variables.length;r>s;s+=1)t.build.name_label[this.variables[s]]=t.build.name_label[t.build.names_variables.slice(0)[0]];i=function(t,e,i){t.nameOutput.reinit(this)},this.execs.push(i)}if(this.tokentype===n.START&&(t.build.names_flag=!0,t.build.names_level+=1,1===t.build.names_level&&(t.build.names_variables=[],t.build.name_label={}),t.build.names_variables.push(this.variables),i=function(t,e,i){t.tmp.can_substitute.push(!0),t.parallel.StartVariable("names",this.variables[0]),t.nameOutput.init(this)},this.execs.push(i)),this.tokentype===n.END){for(var s=0,r=3;r>s;s+=1){var o=["family","given","et-al"][s];this[o]=t.build[o],1===t.build.names_level&&(t.build[o]=void 0)}this.label=t.build.name_label,1===t.build.names_level&&(t.build.name_label={}),t.build.names_level+=-1,t.build.names_variables.pop();var a="with",l="",u="";n.STARTSWITH_ROMANESQUE_REGEXP.test(a)&&(l=" ",u=" "),this["with"]={},this["with"].single=new n.Blob(a),this["with"].single.strings.suffix=u,this["with"].multiple=new n.Blob(a),this["with"].multiple.strings.suffix=u,"always"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=this.strings.delimiter):"contextual"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=this.strings.delimiter):"after-inverted-name"===this.strings["delimiter-precedes-last"]?(this["with"].single.strings.prefix=this.strings.delimiter,this["with"].multiple.strings.prefix=l):(this["with"].single.strings.prefix=l,this["with"].multiple.strings.prefix=l),i=function(t,e,i){t.tmp.etal_node?this.etal_style=t.tmp.etal_node:this.etal_style="empty",this.etal_term=t.getTerm(t.tmp.etal_term,"long",0),n.STARTSWITH_ROMANESQUE_REGEXP.test(this.etal_term)?(this.etal_prefix_single=" ",this.etal_prefix_multiple=t.tmp.name_delimiter,"always"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_single=t.tmp.name_delimiter:"never"===t.tmp["delimiter-precedes-et-al"]?this.etal_prefix_multiple=" ":"after-inverted-name"===t.tmp["delimiter-precedes-et-al"]&&(this.etal_prefix_single=t.tmp.name_delimiter,this.etal_prefix_multiple=" "),this.etal_suffix=""):(this.etal_prefix_single="",this.etal_prefix_multiple="",this.etal_suffix="");for(var s=0,r=3;r>s;s+=1){var o=["family","given"][s];t.nameOutput[o]=this[o]}t.nameOutput["with"]=this["with"],t.nameOutput.label=this.label,t.nameOutput.etal_style=this.etal_style,t.nameOutput.etal_term=this.etal_term,t.nameOutput.etal_prefix_single=this.etal_prefix_single,t.nameOutput.etal_prefix_multiple=this.etal_prefix_multiple,t.nameOutput.etal_suffix=this.etal_suffix,t.nameOutput.outputNames(),t.tmp["et-al-use-first"]=void 0,t.tmp["et-al-min"]=void 0,t.tmp["et-al-use-last"]=void 0},this.execs.push(i),i=function(t,e){t.tmp.can_substitute.pop()||t.tmp.can_substitute.replace(!1,n.LITERAL),t.parallel.CloseVariable("names"),1===t.tmp.can_substitute.mystack.length&&(t.tmp.can_block_substitute=!1)},this.execs.push(i),t.build.name_flag=!1}e.push(this),(this.tokentype===n.END||this.tokentype===n.SINGLETON)&&(t.build.substitute_level.pop(),n.Util.substituteEnd.call(this,t,e))}},n.Node.number={build:function(t,e){var i;n.Util.substituteStart.call(this,t,e),"roman"===this.strings.form?this.formatter=t.fun.romanizer:"ordinal"===this.strings.form?this.formatter=t.fun.ordinalizer:"long-ordinal"===this.strings.form&&(this.formatter=t.fun.long_ordinalizer),"undefined"==typeof this.successor_prefix&&(this.successor_prefix=t[t.build.area].opt.layout_delimiter),"undefined"==typeof this.splice_prefix&&(this.splice_prefix=t[t.build.area].opt.layout_delimiter),i=function(t,e,i){var s,r,o,a;if(0!==this.variables.length){if("undefined"==typeof i)var i={};var l,u;if(l=this.variables[0],"locator"!==l||!t.tmp.just_looking){t.parallel.StartVariable(this.variables[0]),"locator"===this.variables[0]?t.parallel.AppendToVariable(e.section):t.parallel.AppendToVariable(e[this.variables[0]]);var c=new RegExp("(?:&|, | and |"+t.getTerm("page-range-delimiter")+")");"collection-number"===l&&"legal_case"===e.type&&(t.tmp.renders_collection_number=!0);var h=e[this.variables[0]],p="long";if(this.strings.label_form_override&&(p=this.strings.label_form_override),"locator"===l&&i.locator)if(i.locator=i.locator.replace(/([^\\])\s*-\s*/,"$1"+t.getTerm("page-range-delimiter")),u=i.locator.match(n.STATUTE_SUBDIV_GROUPED_REGEX)){for(a=i.locator.split(n.STATUTE_SUBDIV_PLAIN_REGEX),s=0,r=a.length;r>s;s+=1)a[s]=t.fun.page_mangler(a[s]);for(o=[a[0]],!this.strings.label_form_override&&t.tmp.group_context.value()[5]&&(p=t.tmp.group_context.value()[5]),s=1,r=a.length;r>s;s+=1){var d=0;a[s].match(c)&&(d=1);var f=n.STATUTE_SUBDIV_STRINGS[u[s-1].replace(/^\s*/,"")],m=p;i.section_label_count>s&&i.section_form_override&&(m=i.section_form_override),o.push(t.getTerm(f,m,d)),o.push(a[s].replace(/^\s*/,""))}h=o.join(" "),h=h.replace(/\\/,"","g"),t.output.append(h,this)}else h=t.fun.page_mangler(i.locator),h=h.replace(/\\/,"","g"),t.output.append(h,this);else{var g=this;(!t.tmp.shadow_numbers[l]||t.tmp.shadow_numbers[l].values.length&&t.tmp.shadow_numbers[l].values[0][2]===!1)&&("locator"===l?t.processNumber(g,i,l,e.type):t.processNumber(g,e,l,e.type));var b,v=t.tmp.shadow_numbers[l].values,y="",_="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(e.type)>-1&&"collection-number"===l&&(_="year"),("number"===l&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1||t.opt[_+"-range-format"])&&!this.strings.prefix&&!this.strings.suffix&&!this.strings.form)for(s=0,r=v.length;r>s;s+=1)y+=v[s][1];if(y&&!y.match(/^[\-.\u20130-9]+$/)){if("number"===l&&["bill","gazette","legislation","treaty"].indexOf(e.type)>-1){var x=y.split(/\s/)[0];if(x&&(o=[],u=y.match(n.STATUTE_SUBDIV_GROUPED_REGEX))){for(a=y.split(n.STATUTE_SUBDIV_PLAIN_REGEX),s=1,r=a.length;r>s;s+=1)o.push(t.getTerm(n.STATUTE_SUBDIV_STRINGS[u[s-1].replace(/^\s+/,"")],this.strings.label_form_override)),o.push(a[s].replace(/^\s+/,""));y=o.join(" ")}}t.output.append(y,this)}else if(v.length){for(t.output.openLevel("empty"),s=0,r=v.length;r>s;s+=1)b=new n[v[s][0]](v[s][1],v[s][2],e.id),s>0&&(b.strings.prefix=b.strings.prefix.replace(/^\s*/,"")),s<v.length-1&&(b.strings.suffix=b.strings.suffix.replace(/\s*$/,"")),"undefined"==typeof b.gender&&(b.gender=t.locale[t.opt.lang]["noun-genders"][l]),t.output.append(b,"literal",!1,!1,!0);t.output.closeLevel("empty")}}"locator"===l&&t.tmp.done_vars.push("locator"),t.parallel.CloseVariable("number")}}},this.execs.push(i),e.push(this),n.Util.substituteEnd.call(this,t,e)}},n.Node.sort={build:function(t,e){if(e=t[t.build.root+"_sort"].tokens,this.tokentype===n.START){"citation"===t.build.area&&(t.parallel.use_parallels=!1,t.opt.sort_citations=!0),t.build.area=t.build.root+"_sort",t.build.extension="_sort";var i=function(t,e){if(t.opt.has_layout_locale){for(var i,s=n.localeResolve(e.language,t.opt["default-locale"][0]),r=t[t.tmp.area.slice(0,-5)].opt.sort_locales,o=0,a=r.length;a>o&&(i=r[o][s.bare],i||(i=r[o][s.best]),!i);o+=1);i||(i=t.opt["default-locale"][0]),t.tmp.lang_sort_hold=t.opt.lang,t.opt.lang=i}};this.execs.push(i)}if(this.tokentype===n.END){t.build.area=t.build.root,t.build.extension="";var i=function(t,e){t.opt.has_layout_locale&&(t.opt.lang=t.tmp.lang_sort_hold,delete t.tmp.lang_sort_hold)};this.execs.push(i)}e.push(this)}},n.Node.substitute={build:function(t,e){var i;this.tokentype===n.START&&(i=function(t,e){t.tmp.can_block_substitute=!0,t.tmp.value.length&&t.tmp.can_substitute.replace(!1,n.LITERAL)},this.execs.push(i)),e.push(this)}},n.Node.text={build:function(t,e){var i,s,r,o,a,l,u,c,h,p,d,f,m,g,b;if(this.postponed_macro)return n.expandMacro.call(t,this);if(n.Util.substituteStart.call(this,t,e),this.variables_real||(this.variables_real=[]),this.variables||(this.variables=[]),s="long",r=0,this.strings.form&&(s=this.strings.form),this.strings.plural&&(r=this.strings.plural),"citation-number"===this.variables_real[0]||"year-suffix"===this.variables_real[0]||"citation-label"===this.variables_real[0])"citation-number"===this.variables_real[0]?("citation"===t.build.root&&(t.opt.update_mode=n.NUMERIC),"bibliography"===t.build.root&&(t.opt.bib_mode=n.NUMERIC),"bibliography_sort"===t.build.area&&(t.opt.citation_number_sort_used=!0),"citation-number"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,this.splice_prefix=t[t.build.area].opt.layout_delimiter,i=function(t,e,i){if(o=""+e.id,!t.tmp.just_looking){if(i&&i["author-only"]){t.tmp.element_trace.replace("do-not-suppress-me");var s=t.getTerm("reference","long","singular");"undefined"==typeof s&&(s="reference"),f=n.Output.Formatters["capitalize-first"](t,s),t.output.append(f+" "),t.tmp.last_element_trace=!0}i&&i["suppress-author"]&&(t.tmp.last_element_trace&&t.tmp.element_trace.replace("suppress-me"),t.tmp.last_element_trace=!1),a=t.registry.registry[o].seq,t.opt.citation_number_slug?t.output.append(t.opt.citation_number_slug,this):(l=new n.NumericBlob(a,this,e.id),t.output.append(l,"literal"))}},this.execs.push(i)):"year-suffix"===this.variables_real[0]?(t.opt.has_year_suffix=!0,"year-suffix-ranged"===t[t.tmp.area].opt.collapse&&(this.range_prefix=t.getTerm("citation-range-delimiter")),this.successor_prefix=t[t.build.area].opt.layout_delimiter,t[t.tmp.area].opt["year-suffix-delimiter"]&&(this.successor_prefix=t[t.build.area].opt["year-suffix-delimiter"]),i=function(t,e){if(t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&!t.tmp.just_looking){for(a=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),l=new n.NumericBlob(a,this,e.id),u=new n.Util.Suffixator(n.SUFFIX_CHARS),l.setFormatter(u),t.output.append(l,"literal"),c=!1,m=t.tmp.group_context.mystack.length,g=0;m>g;g+=1)if(b=t.tmp.group_context.mystack[g],!b[2]&&(b[1]||!b[1]&&!b[0])){c=!0;break}h=t[t.tmp.area].opt["year-suffix-delimiter"],c&&h&&!t.tmp.sort_key_flag&&(t.tmp.splice_delimiter=t[t.tmp.area].opt["year-suffix-delimiter"])}},this.execs.push(i)):"citation-label"===this.variables_real[0]&&(t.opt.has_year_suffix=!0,i=function(t,e){p=e["citation-label"],p||(p=t.getCitationLabel(e)),t.tmp.just_looking||(d="",t.registry.registry[e.id]&&t.registry.registry[e.id].disambig.year_suffix!==!1&&(a=parseInt(t.registry.registry[e.id].disambig.year_suffix,10),d=t.fun.suffixator.format(a)),p+=d),t.output.append(p,this)},this.execs.push(i));else if(this.strings.term)i=function(t,e,i){var o=t.opt.gender[e.type],a=this.strings.term;a=t.getTerm(a,s,r,o,!1,"accessed"===a);var l;if(""!==a&&(b=t.tmp.group_context.value(),b[0]=!0,t.tmp.group_context.replace(b)),l=t.tmp.term_predecessor||"in-text"===t.opt["class"]&&"citation"===t.tmp.area?a:n.Output.Formatters["capitalize-first"](t,a),t.tmp.strip_periods)l=l.replace(/\./g,"");else for(var u=0,c=this.decorations.length;c>u;u+=1)if("@strip-periods"===this.decorations[u][0]&&"true"===this.decorations[u][1]){l=l.replace(/\./g,"");break}t.output.append(l,this)},this.execs.push(i),t.build.term=!1,t.build.form=!1,t.build.plural=!1;else if(this.variables_real.length){if(i=function(t,e,i){var n=this.variables[0];"title"!==n||"short"!==s&&!e["title-short"]||(n="title-short"),t.parallel.StartVariable(n),t.parallel.AppendToVariable(e[n],n)},this.execs.push(i),n.MULTI_FIELDS.indexOf(this.variables_real[0])>-1){var v=this.variables[0],y=!1,_=!1,x=!1;"short"===s?"container-title"===this.variables_real[0]?_="journalAbbreviation":"title"===this.variables_real[0]&&(_="title-short"):v=!1,t.build.extension?x=!0:(x=!0,y=!0),i=t.transform.getOutputFunction(this.variables,v,y,_,x)}else i=n.CITE_FIELDS.indexOf(this.variables_real[0])>-1?function(t,e,i){if(i&&i[this.variables[0]]){var s=""+i[this.variables[0]];s=s.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),s=s.replace(/\\-/g,"-"),t.output.append(s,this,!1,!1,!0),"locator-revision"===this.variables[0]&&t.tmp.done_vars.push("locator-revision")}}:"page-first"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,"page-first",s),i&&(i=i.replace("\\",""),t.output.append(i,this,!1,!1,!0))}:"page"===this.variables_real[0]?function(t,e){var i=t.getVariable(e,"page",s);i&&(i=""+i,i=i.replace(/([^\\])--*/g,"$1"+t.getTerm("page-range-delimiter")),i=i.replace(/\\-/g,"-"),i=t.fun.page_mangler(i),t.output.append(i,this,!1,!1,!0))}:"volume"===this.variables_real[0]?function(t,e){if(this.variables[0]){var i=t.getVariable(e,this.variables[0],s);i&&t.output.append(i,this)}}:["URL","DOI"].indexOf(this.variables_real[0])>-1?function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],s),i&&(t.opt.development_extensions.wrap_url_and_doi?this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]||(this.decorations=[["@"+this.variables[0],"true"]].concat(this.decorations)):this.decorations.length&&this.decorations[0][0]==="@"+this.variables[0]&&(this.decorations=this.decorations.slice(1)),t.output.append(i,this,!1,!1,!0)))}:"section"===this.variables_real[0]?function(t,e){var i;i=t.getVariable(e,this.variables[0],s),i&&t.output.append(i,this)}:"hereinafter"===this.variables_real[0]?function(t,e){var i=t.transform.abbrevs["default"].hereinafter[e.id];i&&(t.output.append(i,this),t.tmp.group_context.value()[2]=!0)}:function(t,e){var i;this.variables[0]&&(i=t.getVariable(e,this.variables[0],s),i&&(i=""+i,i=i.replace("\\","","g"),t.output.append(i,this)))};this.execs.push(i),i=function(t,e){t.parallel.CloseVariable("text")},this.execs.push(i)}else this.strings.value&&(i=function(t,e){var i;i=t.tmp.group_context.value(),i[0]=!0,t.tmp.group_context.replace(i),t.output.append(this.strings.value,this)},this.execs.push(i));e.push(this),n.Util.substituteEnd.call(this,t,e)}},n.Attributes={},n.Attributes["@genre"]=function(t,e){e=e.replace("-"," ");var i=function(t,i){return e===t.genre?!0:!1};this.tests.push(i)},n.Attributes["@disambiguate"]=function(t,e){if("true"===e){t.opt.has_disambiguate=!0;var i=function(e,i){return t.tmp.disambiguate_maxMax+=1,t.tmp.disambig_settings.disambiguate&&t.tmp.disambiguate_count<t.tmp.disambig_settings.disambiguate?(t.tmp.disambiguate_count+=1,!0):!1};this.tests.push(i)}else if("check-ambiguity-and-backreference"===e){var i=function(e,i){return t.registry.registry[e.id].disambig.disambiguate&&t.registry.registry[e.id]["citation-count"]>1?!0:!1};this.tests.push(i)}},n.Attributes["@is-numeric"]=function(t,e,i){for(var s=e.split(/\s+/),r=function(e){return function(i,s){var r=i;if(["locator","locator-revision"].indexOf(e)>-1&&(r=s),"undefined"==typeof r)return!1;if(n.NUMERIC_VARIABLES.indexOf(e)>-1){if(t.tmp.shadow_numbers[e]||t.processNumber(!1,r,e,i.type),r[e]&&t.tmp.shadow_numbers[e].numeric)return!0}else if(["title","locator-revision","version"].indexOf(e)>-1&&r[e]&&r[e].slice(-1)===""+parseInt(r[e].slice(-1),10))return!0;return!1}},o=0;o<s.length;o+=1)this.tests.push(r(s[o]))},n.Attributes["@is-uncertain-date"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e,i){return e[t]&&e[t].circa?!0:!1}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@locator"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(t){return function(e,i){var s;return s="undefined"!=typeof i&&i.label?"sub verbo"===i.label?"sub-verbo":i.label:"page",t===s?!0:!1}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@position"]=function(t,e){var i;t.opt.update_mode=n.POSITION,t.parallel.use_parallels=!0;for(var s=e.split(/\s+/),r=function(e){return function(i,s){if("bibliography"===t.tmp.area)return!1;if(s&&"undefined"==typeof s.position&&(s.position=0),s&&"number"==typeof s.position){if(0===s.position&&0===e)return!0;if(e>0&&s.position>=e)return!0}else if(0===e)return!0;return!1}},o=0,a=s.length;a>o;o+=1){var i=s[o];"first"===i?i=n.POSITION_FIRST:"subsequent"===i?i=n.POSITION_SUBSEQUENT:"ibid"===i?i=n.POSITION_IBID:"ibid-with-locator"===i&&(i=n.POSITION_IBID_WITH_LOCATOR),"near-note"===i?this.tests.push(function(t,e){return e&&e.position>=n.POSITION_SUBSEQUENT&&e["near-note"]?!0:!1}):this.tests.push(r(i))}},n.Attributes["@type"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e,i){var s=e.type===t;return s?!0:!1}},n=[],r=0,o=i.length;o>r;r+=1)n.push(s(i[r]));this.tests.push(t.fun.match.any(this,t,n))},n.Attributes["@variable"]=function(t,e){var i,s,r,o;
if(this.variables=e.split(/\s+/),this.variables_real=this.variables.slice(),"label"===this.name&&this.variables[0])this.strings.term=this.variables[0];else if(["names","date","text","number"].indexOf(this.name)>-1)i=function(t,e,i){s=this.variables_real.slice();for(var n=this.variables.length-1;n>-1;n+=-1)this.variables.pop();for(r=s.length,o=0;r>o;o+=1)-1!==t.tmp.done_vars.indexOf(s[o])||i&&"legal_case"===e.type&&i["suppress-author"]&&"title"===s[o]||this.variables.push(s[o]),t.tmp.can_block_substitute&&t.tmp.done_vars.push(s[o])},this.execs.push(i),i=function(t,e,i){var s,a;for(s=!1,r=this.variables.length,o=0;r>o;o+=1){if(a=this.variables[o],"authority"===a&&"string"==typeof e[a]&&"names"===this.name){var l={family:e[a],isInstitution:!0,multi:{_key:{}}};if(e.multi&&e.multi._keys&&e.multi._keys[a])for(var u in e.multi._keys[a])creatorChild={family:e.multi._keys[a][u],isInstitution:!0},l.multi._key[u]=creatorChild;e[a]=[l]}if("short"!==this.strings.form||e[a]||("title"===a?a="title-short":"container-title"===a&&(a="journalAbbreviation")),"year-suffix"===a){s=!0;break}if(n.DATE_VARIABLES.indexOf(a)>-1){if(t.opt.development_extensions.locator_date_and_revision&&"locator-date"===a){s=!0;break}if(e[a]){for(var c in e[a])if((-1!==this.dateparts.indexOf(c)||"literal"===c)&&e[a][c]){s=!0;break}if(s)break}}else{if("locator"===a){i&&i.locator&&(s=!0);break}if("locator-revision"===a){i&&i["locator-revision"]&&(s=!0);break}if(["citation-number","citation-label"].indexOf(a)>-1){s=!0;break}if("first-reference-note-number"===a){i&&i["first-reference-note-number"]&&(s=!0);break}if("hereinafter"===a){t.transform.abbrevs["default"].hereinafter[e.id]&&t.sys.getAbbreviation&&e.id&&(s=!0);break}if("object"==typeof e[a]){e[a].length;break}if("string"==typeof e[a]&&e[a]){s=!0;break}if("number"==typeof e[a]){s=!0;break}}if(s)break}var h=t.tmp.group_context.value();s?(("citation-number"!==a||"bibliography"!==t.tmp.area)&&(t.tmp.cite_renders_content=!0),h[2]=!0,t.tmp.group_context.replace(h),t.tmp.can_substitute.value()&&"bibliography"===t.tmp.area&&"string"==typeof e[a]&&t.tmp.rendered_name.push(e[a]),t.tmp.can_substitute.replace(!1,n.LITERAL)):h[1]=!0},this.execs.push(i);else if(["if","else-if","condition"].indexOf(this.name)>-1)for(var a=function(e){return function(i,s){var n=i;if(s&&["locator","locator-revision","first-reference-note-number","locator-date"].indexOf(e)>-1&&(n=s),"hereinafter"===e&&t.sys.getAbbreviation&&n.id){if(t.transform.abbrevs["default"].hereinafter[n.id])return!0}else if(n[e]){if("number"==typeof n[e]||"string"==typeof n[e])return!0;if("object"==typeof n[e])for(key in n[e])if(n[e][key])return!0}return!1}},l=0,u=this.variables.length;u>l;l+=1)this.tests.push(a(this.variables[l]))},n.Attributes["@page"]=function(t,e){var i=e.replace("sub verbo","sub-verbo");i=i.split(/\s+/);for(var s=function(e){return function(i,s){var n;return t.processNumber(!1,i,"page",i.type),n=t.tmp.shadow_numbers.page.label?"sub verbo"===t.tmp.shadow_numbers.page.label?"sub-verbo":t.tmp.shadow_numbers.page.label:"page",e===n?!0:!1}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@jurisdiction"]=function(t,e){for(var i=e.split(/\s+/),s=0,n=i.length;n>s;s+=1)i[s]=i[s].split(";");for(var r=function(t){return function(e,i){if(!e.jurisdiction)return!1;for(var s=e.jurisdiction.split(";"),n=0,r=s.length;r>n;n+=1)s[n]=s[n].split(";");for(n=t.length;n>0;n+=-1){var o=t.slice(0,n).join(";"),a=s.slice(0,n).join(";");if(o!==a)return!1}return!0}},s=0,n=i.length;n>s;s+=1){var o=i[s].slice();this.tests.push(r(o))}},n.Attributes["@context"]=function(t,e){var i=function(i,s){var n=t.tmp.area.slice(0,e.length);return n===e?!0:!1};this.tests.push(i)},n.Attributes["@has-year-only"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e,i){var s=e[t];return!s||s.month||s.season?!1:!0}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@has-to-month-or-season"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e,i){var s=e[t];return!s||!s.month&&!s.season||s.day?!1:!0}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@has-day"]=function(t,e){for(var i=e.split(/\s+/),s=function(t){return function(e,i){var s=e[t];return s&&s.day?!0:!1}},n=0,r=i.length;r>n;n+=1)this.tests.push(s(i[n]))},n.Attributes["@subjurisdictions"]=function(t,e){var i=parseInt(e,10),s=function(t,e){var s=0;return t.jurisdiction&&(s=t.jurisdiction.split(";").length),s&&(s+=-1),s>=i?!0:!1};this.tests.push(s)},n.Attributes["@is-plural"]=function(t,e){var i=function(t,i){var s=t[e];if(s&&s.length){for(var n=0,r=0,o=!1,a=0,l=s.length;l>a;a+=1)s[a].isInstitution&&(s[a].literal||s[a].family&&!s[a].given)?(r+=1,o=!1):(n+=1,o=!0);if(n>1)return!0;if(r>1)return!0;if(r&&o)return!0}return!1};this.tests.push(i)},n.Attributes["@locale"]=function(t,e){var i,s,r,o,a,l,u=t.opt["default-locale"][0];if("layout"===this.name){if(this.locale_raw=e,this.tokentype===n.START){var c=e.split(/\s+/),h={},p=n.localeResolve(c[0],u);p.generic?h[p.generic]=p.best:h[p.best]=p.best;for(var a=1,l=c.length;l>a;a+=1){var d=n.localeResolve(c[a],u);d.generic?h[d.generic]=p.best:h[d.best]=p.best}t[t.build.area].opt.sort_locales.push(h)}t.opt.has_layout_locale=!0}else{o=e.split(/\s+/);var f=[];for(a=0,l=o.length;l>a;a+=1)r=o[a],s=n.localeResolve(r,u),2===o[a].length&&f.push(s.bare),t.localeConfigure(s,!0),o[a]=s;var m=o.slice(),g=function(t,e,s){return function(r,o){var u;i=[],u=!1;var c,h=!1;for(c=r.language?r.language:e,h=n.localeResolve(c,e),a=0,l=t.length;l>a;a+=1)if(h.best===t[a].best){u=!0;break}return!u&&s.indexOf(h.bare)>-1&&(u=!0),u}};this.tests.push(g(m,u,f))}},n.Attributes["@locale-internal"]=function(t,e){var i,s,r,o,a,l;for(o=e.split(/\s+/),this.locale_bares=[],a=0,l=o.length;l>a;a+=1)r=o[a],s=n.localeResolve(r,t.opt["default-locale"][0]),2===o[a].length&&this.locale_bares.push(s.bare),t.localeConfigure(s),o[a]=s;this.locale_default=t.opt["default-locale"][0],this.locale=o[0].best,this.locale_list=o.slice();var u=function(e){return function(s,o){var u;i=[],u=!1;var c=!1;if(s.language&&(r=s.language,c=n.localeResolve(r,t.opt["default-locale"][0]),c.best===t.opt["default-locale"][0]&&(c=!1)),c){for(a=0,l=e.locale_list.length;l>a;a+=1)if(c.best===e.locale_list[a].best){t.opt.lang=e.locale,t.tmp.last_cite_locale=e.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=e.locale,u=!0;break}!u&&e.locale_bares.indexOf(c.bare)>-1&&(t.opt.lang=e.locale,t.tmp.last_cite_locale=e.locale,t.output.openLevel("empty"),t.output.current.value().new_locale=e.locale,u=!0)}return u}},c=this;this.tests.push(u(c))},n.Attributes["@is-parallel"]=function(t,e){for(var i=e.split(" "),s=0,n=i.length;n>s;s+=1)"true"===i[s]?i[s]=!0:"false"===i[s]&&(i[s]=!1);this.strings.set_parallel_condition=i},n.Attributes["@gender"]=function(t,e){this.gender=e},n.Attributes["@cslid"]=function(t,e){this.cslid=parseInt(e,10)},n.Attributes["@label-form"]=function(t,e){this.strings.label_form_override=e},n.Attributes["@part-separator"]=function(t,e){this.strings["part-separator"]=e},n.Attributes["@leading-noise-words"]=function(t,e){this["leading-noise-words"]=e},n.Attributes["@name-never-short"]=function(t,e){this["name-never-short"]=e},n.Attributes["@class"]=function(t,e){t.opt["class"]=e},n.Attributes["@version"]=function(t,e){t.opt.version=e},n.Attributes["@value"]=function(t,e){this.strings.value=e},n.Attributes["@name"]=function(t,e){this.strings.name=e},n.Attributes["@form"]=function(t,e){this.strings.form=e},n.Attributes["@date-parts"]=function(t,e){this.strings["date-parts"]=e},n.Attributes["@range-delimiter"]=function(t,e){this.strings["range-delimiter"]=e},n.Attributes["@macro"]=function(t,e){this.postponed_macro=e},n.Attributes["@term"]=function(t,e){"sub verbo"===e?this.strings.term="sub-verbo":this.strings.term=e},n.Attributes["@xmlns"]=function(t,e){},n.Attributes["@lang"]=function(t,e){e&&(t.build.lang=e)},n.Attributes["@lingo"]=function(t,e){},n.Attributes["@macro-has-date"]=function(t,e){this["macro-has-date"]=!0},n.Attributes["@suffix"]=function(t,e){this.strings.suffix=e},n.Attributes["@prefix"]=function(t,e){this.strings.prefix=e},n.Attributes["@delimiter"]=function(t,e){"name"==this.name?this.strings.name_delimiter=e:this.strings.delimiter=e},n.Attributes["@match"]=function(t,e){this.match=e},n.Attributes["@names-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),this.strings["et-al-min"]=i},n.Attributes["@names-use-first"]=function(t,e){this.strings["et-al-use-first"]=parseInt(e,10)},n.Attributes["@names-use-last"]=function(t,e){"true"===e?this.strings["et-al-use-last"]=!0:this.strings["et-al-use-last"]=!1},n.Attributes["@sort"]=function(t,e){"descending"===e&&(this.strings.sort_direction=n.DESCENDING)},n.Attributes["@plural"]=function(t,e){"always"===e||"true"===e?this.strings.plural=1:"never"===e||"false"===e?this.strings.plural=0:"contextual"===e&&(this.strings.plural=!1)},n.Attributes["@number"]=function(t,e){var i,s=e.replace("sub verbo","sub-verbo");s=s.split(/\s+/),["if","else-if"].indexOf(this.name)>-1&&(i=function(t,e,i){var n,r=[];t.processNumber(!1,e,"number",e.type),n=t.tmp.shadow_numbers.number.label?"sub verbo"===t.tmp.shadow_numbers.number.label?"sub-verbo":t.tmp.shadow_numbers.number.label:"number";for(var o=0,a=s.length;a>o;o+=1)s[o]===n?r.push(!0):r.push(!1);return r},this.tests.push(i))},n.Attributes["@has-publisher-and-publisher-place"]=function(t,e){this.strings["has-publisher-and-publisher-place"]=!0},n.Attributes["@publisher-delimiter-precedes-last"]=function(t,e){this.strings["publisher-delimiter-precedes-last"]=e},n.Attributes["@publisher-delimiter"]=function(t,e){this.strings["publisher-delimiter"]=e},n.Attributes["@publisher-and"]=function(t,e){this.strings["publisher-and"]=e},n.Attributes["@newdate"]=function(t,e){},n.Attributes["@givenname-disambiguation-rule"]=function(t,e){n.GIVENNAME_DISAMBIGUATION_RULES.indexOf(e)>-1&&(t.citation.opt["givenname-disambiguation-rule"]=e)},n.Attributes["@collapse"]=function(t,e){e&&(t[this.name].opt.collapse=e)},n.Attributes["@cite-group-delimiter"]=function(t,e){e&&(t[t.tmp.area].opt.cite_group_delimiter=e)},n.Attributes["@names-delimiter"]=function(t,e){t.setOpt(this,"names-delimiter",e)},n.Attributes["@name-form"]=function(t,e){t.setOpt(this,"name-form",e)},n.Attributes["@subgroup-delimiter"]=function(t,e){this.strings["subgroup-delimiter"]=e},n.Attributes["@subgroup-delimiter-precedes-last"]=function(t,e){this.strings["subgroup-delimiter-precedes-last"]=e},n.Attributes["@name-delimiter"]=function(t,e){t.setOpt(this,"name-delimiter",e)},n.Attributes["@et-al-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-min",i)},n.Attributes["@et-al-use-first"]=function(t,e){t.setOpt(this,"et-al-use-first",parseInt(e,10))},n.Attributes["@et-al-use-last"]=function(t,e){"true"===e?t.setOpt(this,"et-al-use-last",!0):t.setOpt(this,"et-al-use-last",!1)},n.Attributes["@et-al-subsequent-min"]=function(t,e){var i=parseInt(e,10);t[t.tmp.area].opt.max_number_of_names<i&&(t[t.tmp.area].opt.max_number_of_names=i),t.setOpt(this,"et-al-subsequent-min",i)},n.Attributes["@et-al-subsequent-use-first"]=function(t,e){t.setOpt(this,"et-al-subsequent-use-first",parseInt(e,10))},n.Attributes["@suppress-min"]=function(t,e){this.strings["suppress-min"]=parseInt(e,10)},n.Attributes["@suppress-max"]=function(t,e){this.strings["suppress-max"]=parseInt(e,10)},n.Attributes["@and"]=function(t,e){t.setOpt(this,"and",e)},n.Attributes["@delimiter-precedes-last"]=function(t,e){t.setOpt(this,"delimiter-precedes-last",e)},n.Attributes["@delimiter-precedes-et-al"]=function(t,e){t.setOpt(this,"delimiter-precedes-et-al",e)},n.Attributes["@initialize-with"]=function(t,e){t.setOpt(this,"initialize-with",e)},n.Attributes["@initialize"]=function(t,e){"false"===e&&t.setOpt(this,"initialize",!1)},n.Attributes["@name-as-reverse-order"]=function(t,e){this["name-as-reverse-order"]=e},n.Attributes["@name-as-sort-order"]=function(t,e){"style-options"===this.name?this["name-as-sort-order"]=e:t.setOpt(this,"name-as-sort-order",e)},n.Attributes["@sort-separator"]=function(t,e){t.setOpt(this,"sort-separator",e)},n.Attributes["@year-suffix-delimiter"]=function(t,e){t[this.name].opt["year-suffix-delimiter"]=e},n.Attributes["@after-collapse-delimiter"]=function(t,e){t[this.name].opt["after-collapse-delimiter"]=e},n.Attributes["@subsequent-author-substitute"]=function(t,e){t[this.name].opt["subsequent-author-substitute"]=e},n.Attributes["@subsequent-author-substitute-rule"]=function(t,e){t[this.name].opt["subsequent-author-substitute-rule"]=e},n.Attributes["@disambiguate-add-names"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-names"]=!0)},n.Attributes["@disambiguate-add-givenname"]=function(t,e){"true"===e&&(t.opt["disambiguate-add-givenname"]=!0)},n.Attributes["@disambiguate-add-year-suffix"]=function(t,e){"true"===e&&"numeric"!==t.opt.xclass&&(t.opt["disambiguate-add-year-suffix"]=!0)},n.Attributes["@second-field-align"]=function(t,e){("flush"===e||"margin"===e)&&(t[this.name].opt["second-field-align"]=e)},n.Attributes["@hanging-indent"]=function(t,e){"true"===e&&(t[this.name].opt.hangingindent=2)},n.Attributes["@line-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["line-spacing"]=parseFloat(e,10))},n.Attributes["@entry-spacing"]=function(t,e){e&&e.match(/^[.0-9]+$/)&&(t[this.name].opt["entry-spacing"]=parseFloat(e,10))},n.Attributes["@near-note-distance"]=function(t,e){t[this.name].opt["near-note-distance"]=parseInt(e,10)},n.Attributes["@text-case"]=function(t,e){var i=function(t,i){if("normal"===e)this.text_case_normal=!0;else if(this.strings["text-case"]=e,"title"===e){t.opt["default-locale"][0].slice(0,2);i.jurisdiction&&(this.strings["text-case"]="passthrough")}};this.execs.push(i)},n.Attributes["@page-range-format"]=function(t,e){t.opt["page-range-format"]=e},n.Attributes["@year-range-format"]=function(t,e){t.opt["year-range-format"]=e},n.Attributes["@default-locale"]=function(t,e){var i,s,n,r,o;if(r=e.match(/-x-(sort|translit|translat)-/g))for(n=0,s=r.length;s>n;n+=1)r[n]=r[n].replace(/^-x-/,"").replace(/-$/,"");for(i=e.split(/-x-(?:sort|translit|translat)-/),o=[i[0]],n=1,s=i.length;s>n;n+=1)o.push(r[n-1]),o.push(i[n]);for(i=o.slice(),s=i.length,n=1;s>n;n+=2)t.opt["locale-"+i[n]].push(i[n+1].replace(/^\s*/g,"").replace(/\s*$/g,""));i.length?t.opt["default-locale"]=i.slice(0,1):t.opt["default-locale"]=["en"]},n.Attributes["@default-locale-sort"]=function(t,e){t.opt["default-locale-sort"]=e},n.Attributes["@demote-non-dropping-particle"]=function(t,e){t.opt["demote-non-dropping-particle"]=e},n.Attributes["@initialize-with-hyphen"]=function(t,e){"false"===e&&(t.opt["initialize-with-hyphen"]=!1)},n.Attributes["@institution-parts"]=function(t,e){this.strings["institution-parts"]=e},n.Attributes["@if-short"]=function(t,e){"true"===e&&(this.strings["if-short"]=!0)},n.Attributes["@substitute-use-first"]=function(t,e){this.strings["substitute-use-first"]=parseInt(e,10)},n.Attributes["@use-first"]=function(t,e){this.strings["use-first"]=parseInt(e,10)},n.Attributes["@stop-last"]=function(t,e){this.strings["stop-last"]=-1*parseInt(e,10)},n.Attributes["@oops"]=function(t,e){this.strings.oops=e},n.Attributes["@use-last"]=function(t,e){this.strings["use-last"]=parseInt(e,10)},n.Attributes["@reverse-order"]=function(t,e){"true"===e&&(this.strings["reverse-order"]=!0)},n.Attributes["@display"]=function(t,e){this.strings.cls=e},n.Stack=function(t,e){this.mystack=[],(e||t)&&this.mystack.push(t)},n.Stack.prototype.push=function(t,e){e||t?this.mystack.push(t):this.mystack.push("")},n.Stack.prototype.clear=function(){this.mystack=[]},n.Stack.prototype.replace=function(t,e){if(0===this.mystack.length)throw"Internal CSL processor error: attempt to replace nonexistent stack item with "+t;e||t?this.mystack[this.mystack.length-1]=t:this.mystack[this.mystack.length-1]=""},n.Stack.prototype.pop=function(){return this.mystack.pop()},n.Stack.prototype.value=function(){return this.mystack.slice(-1)[0]},n.Stack.prototype.length=function(){return this.mystack.length},n.Parallel=function(t){this.state=t,this.sets=new n.Stack([]),this.try_cite=!0,this.use_parallels=!1,this.midVars=["section","volume","container-title","collection-number","issue","page-first","page","number"],this.ignoreVarsLawGeneral=["first-reference-note-number","locator","label","page-first","page","genre"],this.ignoreVarsLawProceduralHistory=["issued","first-reference-note-number","locator","label","page-first","page","genre","jurisdiction"],this.ignoreVarsOrders=["first-reference-note-number"],this.ignoreVarsOther=["first-reference-note-number","locator","label","section","page-first","page"]},n.Parallel.prototype.isMid=function(t){return this.midVars.indexOf(t)>-1},n.Parallel.prototype.StartCitation=function(t,e){this.parallel_conditional_blobs_list=[],this.use_parallels&&(this.sortedItems=t,this.sortedItemsPos=-1,this.sets.clear(),this.sets.push([]),this.in_series=!0,this.delim_counter=0,this.delim_pointers=[],e?this.out=e:this.out=this.state.output.queue,this.master_was_neutral_cite=!0)},n.Parallel.prototype.StartCite=function(t,e,i){var s,r,o,a,l,u,c,h;if(this.use_parallels){this.sets.value().length&&this.sets.value()[0].itemId==t.id&&this.ComposeSet(),this.sortedItemsPos+=1,e&&(s=e.position),this.try_cite=!0;for(var p=!1,d=0,f=n.PARALLEL_MATCH_VARS.length;f>d;d+=1)if(t[n.PARALLEL_MATCH_VARS[d]]){p=!0;break}var m=!0,g=this.sets.value().slice(-1)[0];if(g&&g.Item&&(g.Item.title!==t.title?m=!1:g.Item.type!==t.type?m=!1:["article-journal","article-magazine"].indexOf(t.type)>-1&&(this.state.opt.development_extensions.handle_parallel_articles&&g.Item["container-title"]===t["container-title"]||(m=!1))),m&&p&&-1!==n.PARALLEL_TYPES.indexOf(t.type)||(this.try_cite=!0,this.in_series&&(this.in_series=!1)),this.cite={},this.cite.front=[],this.cite.mid=[],this.cite.back=[],this.cite.front_collapse={},this.cite.back_forceme=[],this.cite.position=s,this.cite.Item=t,this.cite.itemId=""+t.id,this.cite.prevItemID=""+i,this.target="front",["treaty"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOrders;else if(["article-journal","article-magazine"].indexOf(t.type)>-1)this.ignoreVars=this.ignoreVarsOther;else if(e&&e.prefix){this.ignoreVars=this.ignoreVarsLawProceduralHistory,this.cite.useProceduralHistory=!0;var b=this.sets.value()[this.sets.value().length-1];if(b&&b.back)for(var d=b.back.length-1;d>-1;d+=-1)b.back[d]&&b[b.back[d]]&&delete b[b.back[d]]}else this.ignoreVars=this.ignoreVarsLawGeneral;if(this.sortedItems&&this.sortedItemsPos>0&&this.sortedItemsPos<this.sortedItems.length){if(a=this.sortedItems[this.sortedItemsPos][1],u=""+this.sortedItems[this.sortedItemsPos-1][1].id,l=this.state.registry.registry[u].parallel,c=!1,l==a.id){for(r=this.sortedItemsPos-1,o=r;o>-1;o+=-1)if(this.sortedItems[o][1].id==t.id){c=this.sortedItems[o][1].locator;break}h=this.sortedItems[this.sortedItemsPos][1].locator,!c&&h?a.position=n.POSITION_IBID_WITH_LOCATOR:h===c?a.position=n.POSITION_IBID:a.position=n.POSITION_IBID_WITH_LOCATOR}}else{if(!this.state.registry.registry[t.id])return this.try_cite=!1,void(this.force_collapse=!1);this.state.registry.registry[t.id].parallel=!1}this.force_collapse=!1,this.state.registry.registry[t.id].parallel&&(this.force_collapse=!0)}},n.Parallel.prototype.StartVariable=function(t,e){if(this.use_parallels&&(this.try_cite||this.force_collapse)){if("names"===t?this.variable=t+":"+this.target:this.variable=t,this.ignoreVars.indexOf(t)>-1)return;"container-title"===t&&0===this.sets.value().length&&(this.master_was_neutral_cite=!1),this.data={},this.data.value="",this.data.blobs=[];var i=this.isMid(t);"authority"===e&&"names:front"===this.variable?(this.try_cite=!0,this.in_series=!1):"front"===this.target&&i?this.target="mid":"mid"===this.target&&!i&&this.cite.Item.title&&"names"!==t?this.target="back":"back"===this.target&&i&&(this.try_cite=!0,this.in_series=!1),"number"===t?this.cite.front.push(this.variable):n.PARALLEL_COLLAPSING_MID_VARSET.indexOf(t)>-1?["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1?this.cite.mid.push(this.variable):this.cite.front.push(this.variable):this.cite[this.target].push(this.variable)}},n.Parallel.prototype.AppendBlobPointer=function(t){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(["article-journal","article-magazine"].indexOf(this.cite.Item.type)>-1){if(["volume","page","page-first","issue"].indexOf(this.variable)>-1)return;if("container-title"===this.variable&&this.cite.mid.length>1)return}this.variable&&(this.try_cite||this.force_collapse)&&t&&t.blobs&&(this.cite.useProceduralHistory&&"back"===this.target||this.data.blobs.push([t,t.blobs.length]))}}},n.Parallel.prototype.AppendToVariable=function(t,e){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if(this.try_cite||this.force_collapse)if("back"!==this.target,0){var i=this.sets.value()[this.sets.value().length-1];i&&i[this.variable]&&i[this.variable].value&&(this.data.value+="::"+t)}else this.data.value+="::"+t}},n.Parallel.prototype.CloseVariable=function(){if(this.use_parallels){if(this.ignoreVars.indexOf(this.variable)>-1)return;if((this.try_cite||this.force_collapse)&&(this.cite[this.variable]=this.data,this.sets.value().length>0)){var t=this.sets.value()[this.sets.value().length-1];"front"===this.target&&"issued"===this.variable&&this.data.value&&this.master_was_neutral_cite&&(this.target="mid"),"front"===this.target?!t[this.variable]&&!this.data.value||t[this.variable]&&this.data.value===t[this.variable].value||"issued"!==this.variable&&(this.in_series=!1):"mid"===this.target?n.PARALLEL_COLLAPSING_MID_VARSET.indexOf(this.variable)>-1&&(t[this.variable]&&t[this.variable].value===this.data.value?this.cite.front_collapse[this.variable]=!0:this.cite.front_collapse[this.variable]=!1):"back"===this.target&&t[this.variable]&&this.data.value!==t[this.variable].value&&-1===this.sets.value().slice(-1)[0].back_forceme.indexOf(this.variable)&&(this.in_series=!1)}this.variable=!1}},n.Parallel.prototype.CloseCite=function(){var t,e,i,s,n,r,o;if(this.use_parallels&&(this.force_collapse||this.try_cite)){if(s=!1,this.cite.front_collapse["container-title"]||(s=!0),this.cite.front_collapse.volume===!1&&(s=!0),this.cite.front_collapse["collection-number"]===!1&&(s=!0),this.cite.front_collapse.section===!1&&(s=!0),s&&(this.cite.use_journal_info=!0,o=this.cite.front.indexOf("section"),o>-1&&(this.cite.front=this.cite.front.slice(0,o).concat(this.cite.front.slice(o+1))),n=this.cite.front.indexOf("volume"),n>-1&&(this.cite.front=this.cite.front.slice(0,n).concat(this.cite.front.slice(n+1))),r=this.cite.front.indexOf("container-title"),r>-1&&(this.cite.front=this.cite.front.slice(0,r).concat(this.cite.front.slice(r+1))),collection_number_pos=this.cite.front.indexOf("collection-number"),collection_number_pos>-1&&(this.cite.front=this.cite.front.slice(0,collection_number_pos).concat(this.cite.front.slice(collection_number_pos+1)))),this.in_series||this.force_collapse||this.ComposeSet(!0),0===this.sets.value().length){for(has_date=!1,e=0,i=this.cite.back.length;i>e;e+=1)if(t=this.cite.back[e],"issued"===t&&this.cite.issued&&this.cite.issued.value){has_date=!0;break}has_date||this.cite.back_forceme.push("issued")}else{var a=this.cite.front.indexOf("issued");if((-1===a||this.master_was_neutral_cite)&&(this.cite.back_forceme=this.sets.value().slice(-1)[0].back_forceme),a>-1){var l=this.sets.value()[this.sets.value().length-1];l.issued||(this.cite.front=this.cite.front.slice(0,a).concat(this.cite.front.slice(a+1)))}this.master_was_neutral_cite&&this.cite.mid.indexOf("names:mid")>-1&&this.cite.front.push("names:mid")}this.sets.value().push(this.cite)}},n.Parallel.prototype.ComposeSet=function(t){var e,i,s;if(this.use_parallels&&(this.force_collapse||this.try_cite)){var r=this.sets.value().length;if(1===this.sets.value().length)this.in_series||(this.sets.value().pop(),this.delim_counter+=1);else{for(s=this.sets.value().length,i=0;s>i;i+=1)e=this.sets.value()[i],0===i?this.delim_counter+=1:(!e.Item.title&&e.use_journal_info?this.delim_pointers.push(!1):this.delim_pointers.push(this.delim_counter),this.delim_counter+=1),n.POSITION_FIRST===e.position&&(0===i?(this.state.registry.registry[e.itemId].master=!0,this.state.registry.registry[e.itemId].siblings=[],this.state.registry.registry[e.itemId].parallel=!1):e.prevItemID&&(this.state.registry.registry[e.prevItemID].parallel?this.state.registry.registry[e.itemId].parallel=this.state.registry.registry[e.prevItemID].parallel:this.state.registry.registry[e.itemId].parallel=e.prevItemID,this.state.registry.registry[e.itemId].siblings=this.state.registry.registry[e.prevItemID].siblings,this.state.registry.registry[e.itemId].siblings||(this.state.registry.registry[e.itemId].siblings=[],n.debug("WARNING: adding missing siblings array to registry object")),this.state.registry.registry[e.itemId].siblings.push(e.itemId)));this.sets.push([])}2>r?this.purgeGroupsIfParallel(!1):this.purgeGroupsIfParallel(!0),this.in_series=!0}},n.Parallel.prototype.PruneOutputQueue=function(){var t,e,i,s,n,r;if(this.use_parallels)for(t=this.sets.mystack.length,e=0;t>e;e+=1)if(i=this.sets.mystack[e],i.length>1)for(n=i.length,s=0;n>s;s+=1)r=i[s],0===s?this.purgeVariableBlobs(r,r.back):s===i.length-1?this.purgeVariableBlobs(r,r.front.concat(r.back_forceme)):this.purgeVariableBlobs(r,r.front.concat(r.back))},n.Parallel.prototype.purgeVariableBlobs=function(t,e){var i,s,n,r,o,a,l;if(this.use_parallels){for(l=this.state.output.current.value(),"undefined"==typeof l.length&&(l=l.blobs),s=0,i=this.delim_pointers.length;i>s;s+=1)a=this.delim_pointers[s],a!==!1&&(l[a].parallel_delimiter=", ");for(i=e.length-1,s=i;s>-1;s+=-1)if(n=e[s],t[n])for(o=t[n].blobs.length-1,a=o;a>-1;a+=-1)r=t[n].blobs[a],r[0].blobs=r[0].blobs.slice(0,r[1]).concat(r[0].blobs.slice(r[1]+1)),this.state.tmp.has_purged_parallel=!0,r[0]&&r[0].strings&&"string"==typeof r[0].strings.oops&&r[0].parent&&r[0].parent&&(r[0].parent.parent.strings.delimiter=r[0].strings.oops)}},n.Parallel.prototype.purgeGroupsIfParallel=function(t){for(var e=this.parallel_conditional_blobs_list.length-1;e>-1;e+=-1){for(var i=this.parallel_conditional_blobs_list[e],s=!0,n=0,r=i.conditions.length;r>n;n+=1)if(!i.conditions[n]!=!!t&&("master"!==i.conditions[n]||this.state.registry.registry[i.id].master)&&("servant"!==i.conditions[n]||this.state.registry.registry[i.id].parallel)){var s=!1;break}if(s){for(var o=[];i.blobs.length>i.pos;)o.push(i.blobs.pop());for(o.length&&o.pop();o.length;)i.blobs.push(o.pop())}this.parallel_conditional_blobs_list.pop()}},n.Util={},n.Util.Match=function(){this.any=function(t,e,i){return function(t,e){for(var s=0,n=i.length;n>s;s+=1)if(result=i[s](t,e),result)return!0;return!1}},this.none=function(t,e,i){return function(t,e){for(var s=0,n=i.length;n>s;s+=1)if(result=i[s](t,e),result)return!1;return!0}},this.all=function(t,e,i){return function(t,e){for(var s=0,n=i.length;n>s;s+=1)if(result=i[s](t,e),!result)return!1;return!0}},this[void 0]=this.all,this.nand=function(t,e,i){return function(t,e){for(var s=0,n=i.length;n>s;s+=1)if(result=i[s](t,e),!result)return!0;return!1}}},n.Transform=function(t){function e(t,e,i,s,r,o){var a;if(!r)return s;var l=r,u=!1;if(["title","title-short"].indexOf(l)>-1&&!e.jurisdiction&&(u=!0),n.NUMERIC_VARIABLES.indexOf(r)>-1&&(r="number"),["publisher-place","event-place","jurisdiction","archive-place"].indexOf(r)>-1&&(r="place"),["publisher","authority"].indexOf(r)>-1&&(r="institution-part"),["genre","event","medium","title-short"].indexOf(r)>-1&&(r="title"),["archive"].indexOf(r)>-1&&(r="collection-title"),a="",t.sys.getAbbreviation){var c=t.transform.loadAbbreviation(e.jurisdiction,r,s,e.type,u);t.transform.abbrevs[c][r]&&s&&t.sys.getAbbreviation&&t.transform.abbrevs[c][r][s]&&(a=t.transform.abbrevs[c][r][s].replace("{stet}",s))}return a||t.opt.development_extensions.require_explicit_legal_case_title_short&&"legal_case"===e.type||!i||!e[i]||!o||(a=e[i]),a||(a=s),a&&"!here>>>"===a.slice(0,10)&&(a="jurisdiction"===l&&["treaty","patent"].indexOf(l)>-1?a.slice(10):!1),a}function i(e,i){var s,n=t.opt["default-locale"][0].slice(0,2);return s=t.opt.development_extensions.strict_text_case_locales?new RegExp("^([a-zA-Z]{2})(?:$|-.*| .*)"):new RegExp("^([a-zA-Z]{2})(?:$|-.*|.*)"),e.language&&(m=(""+e.language).match(s),n=m?m[1]:"tlh"),e.multi&&e.multi&&e.multi.main&&e.multi.main[i]&&(n=e.multi.main[i]),(!t.opt.development_extensions.strict_text_case_locales||t.opt.development_extensions.normalize_lang_keys_to_lowercase)&&(n=n.toLowerCase()),n}function s(e,s,n,r,o){var a,l,u,c;if(!e[s])return{name:"",usedOrig:o};if(u={name:"",usedOrig:o,locale:i(e,s)},c=t.opt[n],"locale-orig"===n)return u=o?{name:"",usedOrig:o}:{name:e[s],usedOrig:!1,locale:i(e,s)};if(r&&("undefined"==typeof c||0===c.length))return{name:e[s],usedOrig:!0,locale:i(e,s)};for(var h=0,p=c.length;p>h;h+=1){if(a=c[h],l=a.split(/[\-_]/)[0],a&&e.multi&&e.multi._keys[s]&&e.multi._keys[s][a]){u.name=e.multi._keys[s][a],u.locale=l;break}if(l&&e.multi&&e.multi._keys[s]&&e.multi._keys[s][l]){u.name=e.multi._keys[s][l],u.locale=l;break}}return!u.name&&r&&(u={name:e[s],usedOrig:!0,locale:i(e,s)}),u}function r(e,i,s,n,r){if(e||(e="default"),!s)return t.transform.abbrevs[e]||(t.transform.abbrevs[e]=new t.sys.AbbreviationSegments),e;if(t.sys.getAbbreviation){var o=["default"];if("default"!==e)for(var a=e.split(/\s*;\s*/),l=0,u=a.length;u>l;l+=1)o.push(a.slice(0,l+1).join(";"));for(var l=o.length-1;l>-1;l+=-1)if(t.transform.abbrevs[o[l]]||(t.transform.abbrevs[o[l]]=new t.sys.AbbreviationSegments),t.transform.abbrevs[o[l]][i][s]||t.sys.getAbbreviation(t.opt.styleID,t.transform.abbrevs,o[l],i,s,n,r),t.transform.abbrevs[o[l]][i][s]){l<o.length&&(t.transform.abbrevs[e][i][s]=t.transform.abbrevs[o[l]][i][s]);break}}return e}function o(i,s,n,r){var o=i.variables[0];if(t.publisherOutput&&n){if(-1===["publisher","publisher-place"].indexOf(o))return!1;t.publisherOutput[o+"-token"]=i,t.publisherOutput.varlist.push(o);var a=n.split(/;\s*/);a.length===t.publisherOutput[o+"-list"].length&&(t.publisherOutput[o+"-list"]=a);for(var l=0,u=a.length;u>l;l+=1)a[l]=e(t,s,!1,a[l],r,!0);return t.tmp[o+"-token"]=i,!0}return!1}function a(i,r,a,u,c){var h,p=n.LangPrefsMap[i[0]];return h=p?t.opt["cite-lang-prefs"][p]:!1,function(t,a,c,d){var f,m,g,b,v,y,_;if(!i[0]||!a[i[0]]&&!a[u])return null;if(t.opt.suppressJurisdictions&&"jurisdiction"===i[0]&&t.opt.suppressJurisdictions[a.jurisdiction]&&["legal_case","gazette","regulation","legislation"].indexOf(a.type)>-1)return null;var x={primary:!1,secondary:!1,tertiary:!1};if("_sort"===t.tmp.area.slice(-5))x.primary="locale-sort";else if(h)for(var C=["primary","secondary","tertiary"],w=0,S=C.length;S>w&&!(h.length-1<w);w+=1)h[w]&&(x[C[w]]="locale-"+h[w]);else x.primary="locale-orig";if("bibliography"===t.tmp.area||"citation"===t.tmp.area&&"note"===t.opt.xclass&&c&&!c.position||(x.secondary=!1,x.tertiary=!1),t.tmp["publisher-list"])return"publisher"===i[0]?t.tmp["publisher-token"]=this:"publisher-place"===i[0]&&(t.tmp["publisher-place-token"]=this),null;var T=s(a,i[0],x.primary,!0);f=T.name,m=T.locale;var E=T.usedOrig;if(o(this,a,f,r))return null;g=!1,v=!1,x.secondary&&(T=s(a,i[0],x.secondary,!1,T.usedOrig),g=T.name,b=T.locale),x.tertiary&&(T=s(a,i[0],x.tertiary,!1,T.usedOrig),v=T.name,y=T.locale),r&&(f=e(t,a,u,f,r,!0),f&&(f=l(f)),g=e(t,a,!1,g,r,!0),v=e(t,a,!1,v,r,!0));var I,O=n.Util.cloneToken(this),_=n.Util.cloneToken(this);if("locale-translit"===x.primary&&(I=t.opt.citeAffixes[p][x.primary].prefix),"<i>"===I&&"title"===i[0]&&!E){for(var A=!1,w=0,S=_.decorations.length;S>w;w+=1)"@font-style"===_.decorations[w][0]&&"italic"===_.decorations[w][1]&&(A=!0);A||_.decorations.push(["@font-style","italic"])}if("en"!==m&&"title"===_.strings["text-case"]&&(_.strings["text-case"]="passthrough"),
"title"===i[0]&&(f=n.demoteNoiseWords(t,f,this["leading-noise-words"])),g||v){if(t.output.openLevel("empty"),_.strings.suffix=_.strings.suffix.replace(/[ .,]+$/,""),t.output.append(f,_),g){secondary_tok=n.Util.cloneToken(O),secondary_tok.strings.prefix=t.opt.citeAffixes[p][x.secondary].prefix,secondary_tok.strings.suffix=t.opt.citeAffixes[p][x.secondary].suffix,secondary_tok.strings.prefix||(secondary_tok.strings.prefix=" ");for(var w=secondary_tok.decorations.length-1;w>-1;w+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(secondary_tok.decorations[w].join("/"))>-1&&(secondary_tok.decorations=secondary_tok.decorations.slice(0,w).concat(secondary_tok.decorations.slice(w+1)));"en"!==b&&"title"===secondary_tok.strings["text-case"]&&(secondary_tok.strings["text-case"]="passthrough"),t.output.append(g,secondary_tok);var N=t.output.current.value(),k=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(i[0]+":secondary"),t.parallel.cite[i[0]+":secondary"]={blobs:[[N,k]]})}if(v){tertiary_tok=n.Util.cloneToken(O),tertiary_tok.strings.prefix=t.opt.citeAffixes[p][x.tertiary].prefix,tertiary_tok.strings.suffix=t.opt.citeAffixes[p][x.tertiary].suffix,tertiary_tok.strings.prefix||(tertiary_tok.strings.prefix=" ");for(var w=tertiary_tok.decorations.length-1;w>-1;w+=-1)["@quotes/true","@font-style/italic","@font-style/oblique","@font-weight/bold"].indexOf(tertiary_tok.decorations[w].join("/"))>-1&&(tertiary_tok.decorations=tertiary_tok.decorations.slice(0,w).concat(tertiary_tok.decorations.slice(w+1)));"en"!==y&&"title"===tertiary_tok.strings["text-case"]&&(tertiary_tok.strings["text-case"]="passthrough"),t.output.append(v,tertiary_tok);var N=t.output.current.value(),k=t.output.current.value().blobs.length-1;t.parallel.use_parallels&&(t.parallel.cite.front.push(i[0]+":tertiary"),t.parallel.cite[i[0]+":tertiary"]={blobs:[[N,k]]})}t.output.closeLevel()}else t.output.append(f,_);return null}}function l(e){var i=e.match(/^!([-,_a-z]+)>>>/);if(i){var s=i[1].split(",");e=e.slice(i[0].length);for(var n=0,r=s.length;r>n;n+=1)-1===t.tmp.done_vars.indexOf(s[n])&&t.tmp.done_vars.push(s[n])}return e}this.abbrevs={},this.abbrevs["default"]=new t.sys.AbbreviationSegments,this.getTextSubField=s,this.loadAbbreviation=r,this.getOutputFunction=a,this.quashCheck=l},n.Token=function(t,e){this.name=t,this.strings={},this.strings.delimiter=void 0,this.strings.prefix="",this.strings.suffix="",this.decorations=[],this.variables=[],this.execs=[],this.tokentype=e,this.evaluator=!1,this.tests=[],this.rawtests=[],this.succeed=!1,this.fail=!1,this.next=!1},n.Util.cloneToken=function(t){var e,i,s,r;if("string"==typeof t)return t;e=new n.Token(t.name,t.tokentype);for(i in t.strings)t.strings.hasOwnProperty(i)&&(e.strings[i]=t.strings[i]);if(t.decorations)for(e.decorations=[],s=0,r=t.decorations.length;r>s;s+=1)e.decorations.push(t.decorations[s].slice());return t.variables&&(e.variables=t.variables.slice()),t.execs&&(e.execs=t.execs.slice(),e.tests=t.tests.slice(),e.rawtests=t.tests.slice()),e},n.AmbigConfig=function(){this.maxvals=[],this.minval=1,this.names=[],this.givens=[],this.year_suffix=!1,this.disambiguate=0},n.Blob=function(t,e,i){var s,n,r;if(this.levelname=i,e){this.strings={prefix:"",suffix:""};for(r in e.strings)e.strings.hasOwnProperty(r)&&(this.strings[r]=e.strings[r]);for(this.decorations=[],s=void 0===e.decorations?0:e.decorations.length,n=0;s>n;n+=1)this.decorations.push(e.decorations[n].slice())}else this.strings={},this.strings.prefix="",this.strings.suffix="",this.strings.delimiter="",this.decorations=[];"string"==typeof t?this.blobs=t:t?this.blobs=[t]:this.blobs=[],this.alldecor=[this.decorations]},n.Blob.prototype.push=function(t){if("string"==typeof this.blobs)throw"Attempt to push blob onto string object";!1!==t&&(t.alldecor=t.alldecor.concat(this.alldecor),this.blobs.push(t))},n.NumericBlob=function(t,e,i){this.id=i,this.alldecor=[],this.num=t,this.blobs=t.toString(),this.status=n.START,this.strings={},e?(this.gender=e.gender,this.decorations=e.decorations,this.strings.prefix=e.strings.prefix,this.strings.suffix=e.strings.suffix,this.strings["text-case"]=e.strings["text-case"],this.successor_prefix=e.successor_prefix,this.range_prefix=e.range_prefix,this.splice_prefix=e.splice_prefix,this.formatter=e.formatter,this.formatter||(this.formatter=new n.Output.DefaultFormatter),this.formatter&&(this.type=this.formatter.format(1))):(this.decorations=[],this.strings.prefix="",this.strings.suffix="",this.successor_prefix="",this.range_prefix="",this.splice_prefix="",this.formatter=new n.Output.DefaultFormatter)},n.NumericBlob.prototype.setFormatter=function(t){this.formatter=t,this.type=this.formatter.format(1)},n.Output.DefaultFormatter=function(){},n.Output.DefaultFormatter.prototype.format=function(t){return t.toString()},n.NumericBlob.prototype.checkNext=function(t,e){e?(this.status=n.START,"object"==typeof t&&(t.num===this.num+1?t.status=n.SUCCESSOR:t.status=n.SEEN)):t&&t.num&&this.type===t.type&&t.num===this.num+1?this.status===n.START||this.status===n.SEEN?t.status=n.SUCCESSOR:(this.status===n.SUCCESSOR||this.status===n.SUCCESSOR_OF_SUCCESSOR)&&(this.range_prefix?(t.status=n.SUCCESSOR_OF_SUCCESSOR,this.status=n.SUPPRESS):t.status=n.SUCCESSOR):(this.status===n.SUCCESSOR_OF_SUCCESSOR&&(this.status=n.END),"object"==typeof t&&(t.status=n.SEEN))},n.NumericBlob.prototype.checkLast=function(t){return this.status===n.SEEN||t.num!==this.num-1&&this.status===n.SUCCESSOR?(this.status=n.SUCCESSOR,!0):!1},n.Util.fixDateNode=function(t,e,i){var s,n,r,o,a,l,u,c,h,p,d,f,m,g;this.build.date_key=!0,s=this.sys.xml.getAttributeValue(i,"form");var b;if(b="accessed"===this.sys.xml.getAttributeValue(i,"variable")?this.opt["default-locale"][0]:this.sys.xml.getAttributeValue(i,"lingo"),!this.getDate(s))return t;var v=this.sys.xml.getAttributeValue(i,"date-parts");n=this.sys.xml.getAttributeValue(i,"variable"),c=this.sys.xml.getAttributeValue(i,"prefix"),h=this.sys.xml.getAttributeValue(i,"suffix"),m=this.sys.xml.getAttributeValue(i,"display"),g=this.sys.xml.getAttributeValue(i,"cslid"),r=this.sys.xml.nodeCopy(this.getDate(s,"accessed"===n)),this.sys.xml.setAttribute(r,"lingo",this.opt.lang),this.sys.xml.setAttribute(r,"form",s),this.sys.xml.setAttribute(r,"date-parts",v),this.sys.xml.setAttribute(r,"cslid",g),this.sys.xml.setAttribute(r,"variable",n),c&&this.sys.xml.setAttribute(r,"prefix",c),h&&this.sys.xml.setAttribute(r,"suffix",h),m&&this.sys.xml.setAttribute(r,"display",m),p=this.sys.xml.children(i);for(d in p)if(o=p[d],"date-part"===this.sys.xml.nodename(o)){a=this.sys.xml.getAttributeValue(o,"name"),f=this.sys.xml.attributes(o);for(l in f)if(f.hasOwnProperty(l)){if("@name"===l)continue;if(b&&b!==this.opt.lang&&["@suffix","@prefix","@form"].indexOf(l)>-1)continue;u=f[l],this.sys.xml.setAttributeOnNodeIdentifiedByNameAttribute(r,"date-part",a,l,u)}}return"year"===this.sys.xml.getAttributeValue(i,"date-parts")?(this.sys.xml.deleteNodeByNameAttribute(r,"month"),this.sys.xml.deleteNodeByNameAttribute(r,"day")):"year-month"===this.sys.xml.getAttributeValue(i,"date-parts")&&this.sys.xml.deleteNodeByNameAttribute(r,"day"),this.sys.xml.insertChildNodeAfter(t,i,e,r)},n.dateMacroAsSortKey=function(t,e){n.dateAsSortKey.call(this,t,e,!0)},n.dateAsSortKey=function(t,e,i){var s,r,o,a,l,u,c,h,p=this.variables[0],d="empty";for(i&&(d="macro-with-date"),s=e[p],"undefined"==typeof s&&(s={"date-parts":[[0]]},s.year||(t.tmp.empty_date=!0)),"undefined"==typeof this.dateparts&&(this.dateparts=["year","month","day"]),s.raw?s=t.fun.dateparser.parse(s.raw):s["date-parts"]&&(s=t.dateParseArray(s)),"undefined"==typeof s&&(s={}),c=0,h=n.DATE_PARTS_INTERNAL.length;h>c;c+=1)r=n.DATE_PARTS_INTERNAL[c],o=0,a=r,"_end"===a.slice(-4)&&(a=a.slice(0,-4)),s[r]&&this.dateparts.indexOf(a)>-1&&(o=s[r]),"year"===r.slice(0,4)?(l=n.Util.Dates[a].numeric(t,o),u="Y","-"===l[0]&&(u="X",l=l.slice(1),l=9999-parseInt(l,10)),t.output.append(n.Util.Dates[r.slice(0,4)].numeric(t,u+l),d)):(o=n.Util.Dates[a]["numeric-leading-zeros"](t,o),o||(o="00"),t.output.append(o,d))},n.Engine.prototype.dateParseArray=function(t){var e,i,s,r;e={};for(i in t)if("date-parts"===i){s=t["date-parts"],s.length>1&&s[0].length!==s[1].length&&n.error("CSL data error: element mismatch in date range input."),r=["","_end"];for(var o=0,a=s.length;a>o;o+=1)for(var l=0,u=n.DATE_PARTS.length;u>l;l+=1)"undefined"==typeof s[o][l]?e[n.DATE_PARTS[l]+r[o]]=s[o][l]:e[n.DATE_PARTS[l]+r[o]]=parseInt(s[o][l],10)}else t.hasOwnProperty(i)&&("literal"===i&&"object"==typeof t.literal&&"string"==typeof t.literal.part?(n.debug("Warning: fixing up weird literal date value"),e.literal=t.literal.part):e[i]=t[i]);return e},n.Util.Names={},n.Util.Names.compareNamesets=n.NameOutput.prototype._compareNamesets,n.Util.Names.unInitialize=function(t,e){var i,s,r,o,a;if(!e)return"";for(r=e.split(/(?:\-|\s+)/),o=e.match(/(\-|\s+)/g),a="",i=0,s=r.length;s>i;i+=1)n.ALL_ROMANESQUE_REGEXP.exec(r[i].slice(0,-1))&&r[i]&&r[i]!==r[i].toUpperCase()&&(r[i]=r[i].slice(0,1)+r[i].slice(1,2).toLowerCase()+r[i].slice(2)),a+=r[i],s-1>i&&(a+=o[i]);return a},n.Util.Names.initializeWith=function(t,e,i,s){var r,o,a,l,u,c,h;if(!e)return"";if(["Lord","Lady"].indexOf(e)>-1||!e.match(n.STARTSWITH_ROMANESQUE_REGEXP)&&!i.match("%s"))return e;i||(i="");var p=e;if(t.opt["initialize-with-hyphen"]===!1&&(p=p.replace(/\-/g," ")),p=p.replace(/\s*\-\s*/g,"-").replace(/\s+/g," "),p=p.replace(/-([a-z])/g,"$1"),u=p.match(/[\-\s]+/g),c=p.split(/[\-\s]+/),0===c.length)p=u;else for(p=[c[0]],r=1,o=c.length;o>r;r+=1)p.push(u[r-1]),p.push(c[r]);for(c=p,r=c.length-1;r>-1;r+=-1)if(c[r]&&c[r].slice(0,-1).indexOf(".")>-1){var d=c.slice(r+1),f=c[r].slice(0,-1).split(".");for(c=c.slice(0,r),a=0,l=f.length;l>a;a+=1)c.push(f[a]+"."),a<f.length-1&&c.push(" ");c=c.concat(d)}return h=s?n.Util.Names.doNormalize(t,c,i):n.Util.Names.doInitialize(t,c,i),h=h.replace(/\u2013([a-z])/g,"-$1")},n.Util.Names.doNormalize=function(t,e,i,s){var r,o,a=[];for(r=0,o=e.length;o>r;r+=1)e[r].length>1&&"."===e[r].slice(-1)?(e[r]=e[r].slice(0,-1),a.push(!0)):1===e[r].length&&e[r].toUpperCase()===e[r]?a.push(!0):a.push(!1);for(r=0,o=e.length;o>r;r+=2)a[r]&&(r<e.length-2&&(e[r+1]="",(!i||i.slice(-1)&&" "!==i.slice(-1))&&e[r].length&&e[r].match(n.ALL_ROMANESQUE_REGEXP)&&(e[r].length>1||e[r+2].length>1)&&(e[r+1]=" "),e[r]=e[r]+i),r===e.length-1&&(e[r]=e[r]+i));return e.join("").replace(/\s+$/,"")},n.Util.Names.doInitialize=function(t,e,i,s){var r,o,a,l,u,c,h;for(r=0,o=e.length;o>r;r+=2)if(h=e[r])if(a=h.match(n.NAME_INITIAL_REGEXP),!a&&!h.match(n.STARTSWITH_ROMANESQUE_REGEXP)&&h.length>1&&i.match("%s")&&(a=h.match(/(.)(.*)/)),a&&a[1]===a[1].toUpperCase()){var p="";if(a[2]){var d="";for(c=a[2].split(""),l=0,u=c.length;u>l;l+=1){var f=c[l];if(f!==f.toUpperCase())break;d+=f}d.length<a[2].length&&(p=d.toLocaleLowerCase())}e[r]=a[1].toLocaleUpperCase()+p,o-1>r?i.match("%s")?e[r]=i.replace("%s",e[r]):e[r+1].indexOf("-")>-1?e[r+1]=i+e[r+1]:e[r+1]=i:i.match("%s")?e[r]=i.replace("%s",e[r]):e.push(i)}else h.match(n.ROMANESQUE_REGEXP)&&(e[r]=" "+h);var m=e.join("");return m=m.replace(/\s+$/,"").replace(/\s*\-\s*/g,"-").replace(/\s+/g," ")},n.Util.Names.getRawName=function(t){var e=[];return t.given&&e.push(t.given),t.family&&e.push(t.family),e.join(" ")},n.Util.Dates={},n.Util.Dates.year={},n.Util.Dates.year["long"]=function(t,e){return e||(e="boolean"==typeof e?"":0),e.toString()},n.Util.Dates.year.imperial=function(t,e,i,s){e||(e="boolean"==typeof e?"":0),i=i?"_end":"";var n=t.tmp.date_object["month"+i];for(n=n?""+n:"1";n.length<2;)n="0"+n;var r=t.tmp.date_object["day"+i];for(r=r?""+r:"1";r.length<2;)r="0"+r;var o,a,l=parseInt(e+n+r,10);return l>=18680908&&19120730>l?(o="",a=1867):l>=19120730&&19261225>l?(o="",a=1911):l>=19261225&&19890108>l?(o="",a=1925):l>=19890108&&(o="",a=1988),o&&a&&(t.transform.abbrevs["default"].number[o]||t.transform.loadAbbreviation("default","number",o),t.transform.abbrevs["default"].number[o]&&(o=t.transform.abbrevs["default"].number[o]),year=o+(e-a)),year},n.Util.Dates.year["short"]=function(t,e){return e=e.toString(),e&&4===e.length?e.substr(2):void 0},n.Util.Dates.year.numeric=function(t,e){var i,s;for(e=""+e,i=e.match(/([0-9]*)$/),i?(s=e.slice(0,-1*i[1].length),e=i[1]):(s=e,e="");e.length<4;)e="0"+e;return s+e},n.Util.Dates.normalizeMonth=function(t,e){var i;if(t||(t=0),t=""+t,t.match(/^[0-9]+$/)||(t=0),t=parseInt(t,10),e){var s={stub:"month-",num:t};s.num<1||s.num>20?s.num=0:s.num>16?(s.stub="season-",s.num=s.num-16):s.num>12&&(s.stub="season-",s.num=s.num-12),i=s}else(1>t||t>12)&&(t=0),i=t;return i},n.Util.Dates.month={},n.Util.Dates.month.numeric=function(t,e){var e=n.Util.Dates.normalizeMonth(e);return e||(e=""),e},n.Util.Dates.month["numeric-leading-zeros"]=function(t,e){var e=n.Util.Dates.normalizeMonth(e);if(e)for(e=""+e;e.length<2;)e="0"+e;else e="";return e},n.Util.Dates.month["long"]=function(t,e,i,s){var r=n.Util.Dates.normalizeMonth(e,!0),e=r.num;if(e){for(e=""+e;e.length<2;)e="0"+e;e=t.getTerm(r.stub+e,"long",0,0,!1,s)}else e="";return e},n.Util.Dates.month["short"]=function(t,e,i,s){var r=n.Util.Dates.normalizeMonth(e,!0),e=r.num;if(e){for(e=""+e;e.length<2;)e="0"+e;e=t.getTerm(r.stub+e,"short",0,0,!1,s)}else e="";return e},n.Util.Dates.day={},n.Util.Dates.day.numeric=function(t,e){return e.toString()},n.Util.Dates.day["long"]=n.Util.Dates.day.numeric,n.Util.Dates.day["numeric-leading-zeros"]=function(t,e){for(e||(e=0),e=e.toString();e.length<2;)e="0"+e;return e.toString()},n.Util.Dates.day.ordinal=function(t,e,i){return t.fun.ordinalizer.format(e,i)},n.Util.Sort={},n.Util.Sort.strip_prepositions=function(t){var e;return"string"==typeof t&&(e=t.toLocaleLowerCase(),e=t.match(/^((a|an|the)\s+)/)),e&&(t=t.substr(e[1].length)),t},n.Util.substituteStart=function(t,e){var i,s,r,o,a,l,u;o=function(t,e){for(var i=0,s=this.decorations.length;s>i;i+=1)if("@strip-periods"===this.decorations[i][0]&&"true"===this.decorations[i][1]){t.tmp.strip_periods+=1;break}},this.execs.push(o),this.decorations&&(t.opt.development_extensions.csl_reverse_lookup_support||t.sys.csl_reverse_lookup_support)&&(this.decorations.reverse(),this.decorations.push(["@showid","true",this.cslid]),this.decorations.reverse()),u=["number","date","names"],("text"===this.name&&!this.postponed_macro||u.indexOf(this.name)>-1)&&(i=function(t,e,i){"author"===t.tmp.element_trace.value()||"names"===this.name?i&&i["author-only"]?t.tmp.element_trace.push("do-not-suppress-me"):i&&i["suppress-author"]:i&&i["author-only"]?t.tmp.element_trace.push("suppress-me"):i&&i["suppress-author"]&&t.tmp.element_trace.push("do-not-suppress-me")},this.execs.push(i)),s=this.strings.cls,this.strings.cls=!1,0===t.build.render_nesting_level&&("bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]?(r=new n.Token("group",n.START),r.decorations=[["@display","left-margin"]],o=function(t,e){t.tmp.render_seen||(r.strings.first_blob=e.id,t.output.startTag("bib_first",r))},r.execs.push(o),e.push(r)):n.DISPLAY_CLASSES.indexOf(s)>-1&&(r=new n.Token("group",n.START),r.decorations=[["@display",s]],o=function(t,e){r.strings.first_blob=e.id,t.output.startTag("bib_first",r)},r.execs.push(o),e.push(r)),t.build.cls=s),t.build.render_nesting_level+=1,1===t.build.substitute_level.value()&&(a=new n.Token("choose",n.START),n.Node.choose.build.call(a,t,e),l=new n.Token("if",n.START),o=function(e,i){return t.tmp.can_substitute.value()?!0:!1},l.tests.push(o),l.test=t.fun.match.any(this,t,l.tests),e.push(l)),t.sys.variableWrapper&&this.variables_real&&this.variables_real.length&&(o=function(t,e,i){if(!t.tmp.just_looking&&!t.tmp.suppress_decorations){variable_entry=new n.Token("text",n.START),variable_entry.decorations=[["@showid","true"]],t.output.startTag("variable_entry",variable_entry);var s=null;i&&(s=i.position),s||(s=0);var r=["first","subsequent","ibid","ibid-with-locator"],o=0;i&&i.noteIndex&&(o=i.noteIndex);var a=0;i&&i["first-reference-note-number"]&&(a=i["first-reference-note-number"]);var l=0;i&&i["citation-number"]&&(l=i["citation-number"]);var u=0;i&&i.index&&(u=i.index);var c={itemData:e,variableNames:this.variables,context:t.tmp.area,xclass:t.opt.xclass,position:r[s],"note-number":o,"first-reference-note-number":a,"citation-number":l,index:u,mode:t.opt.mode};t.output.current.value().params=c}},this.execs.push(o))},n.Util.substituteEnd=function(t,e){var i,s,r,o,a,l,u,c,h;t.sys.variableWrapper&&(this.hasVariable||this.variables_real&&this.variables_real.length)&&(i=function(t,e){t.tmp.just_looking||t.tmp.suppress_decorations||t.output.endTag("variable_entry")},this.execs.push(i)),i=function(t,e){for(var i=0,s=this.decorations.length;s>i;i+=1)if("@strip-periods"===this.decorations[i][0]&&"true"===this.decorations[i][1]){t.tmp.strip_periods+=-1;break}},this.execs.push(i),t.build.render_nesting_level+=-1,0===t.build.render_nesting_level&&(t.build.cls?(i=function(t,e){t.output.endTag("bib_first")},this.execs.push(i),t.build.cls=!1):"bibliography"===t.build.area&&t.bibliography.opt["second-field-align"]&&(s=new n.Token("group",n.END),i=function(t,e){t.tmp.render_seen||t.output.endTag()},s.execs.push(i),e.push(s),r=new n.Token("group",n.START),r.decorations=[["@display","right-inline"]],i=function(t,e){t.tmp.render_seen||(t.tmp.render_seen=!0,t.output.startTag("bib_other",r))},r.execs.push(i),e.push(r))),1===t.build.substitute_level.value()&&(o=new n.Token("if",n.END),e.push(o),a=new n.Token("choose",n.END),n.Node.choose.build.call(a,t,e)),l="names"===this.name&&0===t.build.substitute_level.value(),u="string"==typeof t[t.build.area].opt["subsequent-author-substitute"];var p=t[t.build.area].opt["subsequent-author-substitute-rule"];l&&u&&(c=new n.Token("text",n.SINGLETON),i=function(t,e){var i,s,r=!t.tmp.suppress_decorations;if(r&&"bibliography"===t.tmp.area&&t.tmp.subsequent_author_substitute_ok&&t.tmp.rendered_name)if("partial-each"===p||"partial-first"===p){var o=!0,a=[];for(i=0,s=t.tmp.name_node.children.length;s>i;i+=1){var l=t.tmp.rendered_name[i];o&&t.tmp.last_rendered_name&&t.tmp.last_rendered_name.length>i-1&&l&&!l.localeCompare(t.tmp.last_rendered_name[i])?(h=new n.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h],"partial-first"===p&&(o=!1)):o=!1,a.push(l)}t.tmp.last_rendered_name=a}else if("complete-each"===p){var a=t.tmp.rendered_name.join(",");if(a){if(!a.localeCompare(t.tmp.last_rendered_name))for(i=0,s=t.tmp.name_node.children.length;s>i;i+=1)h=new n.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.name_node.children[i].blobs=[h];t.tmp.last_rendered_name=a}}else{var a=t.tmp.rendered_name.join(",");a&&(a.localeCompare(t.tmp.last_rendered_name)||(h=new n.Blob(t[t.tmp.area].opt["subsequent-author-substitute"]),t.tmp.label_blob?t.tmp.name_node.top.blobs=[h,t.tmp.label_blob]:t.tmp.name_node.top.blobs=[h]),t.tmp.last_rendered_name=a)}},c.execs.push(i),e.push(c)),("text"===this.name&&!this.postponed_macro||["number","date","names"].indexOf(this.name)>-1)&&(i=function(t,e){t.tmp.element_trace.pop()},this.execs.push(i))},n.Util.padding=function(t){var e=t.match(/\s*(-{0,1}[0-9]+)/);if(e)for(t=parseInt(e[1],10),0>t&&(t=1e20+t),t=""+t;t.length<20;)t="0"+t;return t},n.Util.LongOrdinalizer=function(){},n.Util.LongOrdinalizer.prototype.init=function(t){this.state=t},n.Util.LongOrdinalizer.prototype.format=function(t,e){10>t&&(t="0"+t);var i=n.Engine.getField(n.LOOSE,this.state.locale[this.state.opt.lang].terms,"long-ordinal-"+t,"long",0,e);return i||(i=this.state.fun.ordinalizer.format(t,e)),this.state.tmp.cite_renders_content=!0,i},n.Util.Ordinalizer=function(t){this.state=t,this.suffixes={}},n.Util.Ordinalizer.prototype.init=function(){if(!this.suffixes[this.state.opt.lang]){this.suffixes[this.state.opt.lang]={};for(var t=0,e=3;e>t;t+=1){var i=[void 0,"masculine","feminine"][t];this.suffixes[this.state.opt.lang][i]=[];for(var s=1;5>s;s+=1){var n=this.state.getTerm("ordinal-0"+s,"long",!1,i);if("undefined"==typeof n){delete this.suffixes[this.state.opt.lang][i];break}this.suffixes[this.state.opt.lang][i].push(n)}}}},n.Util.Ordinalizer.prototype.format=function(t,e){var i;t=parseInt(t,10),i=""+t;var s="",n=[];if(e&&n.push(e),n.push("neuter"),this.state.locale[this.state.opt.lang].ord["1.0.1"]){s=this.state.getTerm("ordinal",!1,0,e);for(var r,o=0,a=n.length;a>o;o+=1){r=n[o];var l=this.state.locale[this.state.opt.lang].ord["1.0.1"];if(l["whole-number"][i]&&l["whole-number"][i][r]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["whole-number"][i][r],!1,0,e):l["last-two-digits"][i.slice(i.length-2)]&&l["last-two-digits"][i.slice(i.length-2)][r]?s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-two-digits"][i.slice(i.length-2)][r],!1,0,e):l["last-digit"][i.slice(i.length-1)]&&l["last-digit"][i.slice(i.length-1)][r]&&(s=this.state.getTerm(this.state.locale[this.state.opt.lang].ord["1.0.1"]["last-digit"][i.slice(i.length-1)][r],!1,0,e)),s)break}}else e||(e=void 0),this.state.fun.ordinalizer.init(),s=t/10%10===1||t>10&&20>t?this.suffixes[this.state.opt.lang][e][3]:t%10===1&&t%100!==11?this.suffixes[this.state.opt.lang][e][0]:t%10===2&&t%100!==12?this.suffixes[this.state.opt.lang][e][1]:t%10===3&&t%100!==13?this.suffixes[this.state.opt.lang][e][2]:this.suffixes[this.state.opt.lang][e][3];return i=i+=s},n.Util.Romanizer=function(){},n.Util.Romanizer.prototype.format=function(t){var e,i,s,r,o;if(e="",6e3>t)for(r=t.toString().split(""),r.reverse(),i=0,s=0,o=r.length,i=0;o>i;i+=1)s=parseInt(r[i],10),e=n.ROMAN_NUMERALS[i][s]+e;return e},n.Util.Suffixator=function(t){t||(t=n.SUFFIX_CHARS),this.slist=t.split(",")},n.Util.Suffixator.prototype.format=function(t){var e;t+=1;var i="";do e=t%26===0?26:t%26,i=this.slist[e-1]+i,t=(t-e)/26;while(0!==t);return i},n.Engine.prototype.processNumber=function(t,e,i,s){var r,o,a,l,u,c;if(this.tmp.shadow_numbers[i]){if(this.tmp.shadow_numbers[i].numeric)for(var a=0,l=this.tmp.shadow_numbers[i].values.length;l>a;a+=2)this.tmp.shadow_numbers[i].values[a][2]=t}else if(this.tmp.shadow_numbers[i]={},this.tmp.shadow_numbers[i].values=[],this.tmp.shadow_numbers[i].plural=0,this.tmp.shadow_numbers[i].numeric=!1,this.tmp.shadow_numbers[i].label=!1,e){var h=n.LangPrefsMap[i];if(h){var p=this.opt["cite-lang-prefs"][h][0];r=this.transform.getTextSubField(e,i,"locale-"+p,!0),r=r.name}else r=e[i];if(r&&this.sys.getAbbreviation){r=(""+r).replace(/^\"/,"").replace(/\"$/,"");var d=this.transform.loadAbbreviation(e.jurisdiction,"number",r);this.transform.abbrevs[d].number[r]?r=this.transform.abbrevs[d].number[r]:"undefined"!=typeof this.transform.abbrevs[d].number[r]&&delete this.transform.abbrevs[d].number[r]}if("undefined"!=typeof r){if("number"==typeof r&&(r=""+r),this.tmp.shadow_numbers[i].label=i,'"'===r.slice(0,1)&&'"'===r.slice(-1)&&(r=r.slice(1,-1)),r&&["number-of-volumes","number-of-pages"].indexOf(i)>-1){var o=r.match(/[^0-9]*([0-9]+).*/);o&&(this.tmp.shadow_numbers[i].numeric=!0,"1"!==o[1]&&(this.tmp.shadow_numbers[i].plural=1))}"locator"===i&&["bill","gazette","legislation","treaty"].indexOf(s)>-1&&(r=r.split(n.STATUTE_SUBDIV_PLAIN_REGEX)[0]);var f="page";if(["bill","gazette","legislation","legal_case","treaty"].indexOf(s)>-1&&"collection-number"===i&&(f="year"),["page","page-first"].indexOf(i)>-1){var o=r.split(" ")[0].match(n.STATUTE_SUBDIV_GROUPED_REGEX);if(o){this.opt.development_extensions.static_statute_locator&&(this.tmp.shadow_numbers[i].label=n.STATUTE_SUBDIV_STRINGS[o[0]]);var m=r.match(/[^ ]+\s+(.*)/);m&&(r=m[1])}}for(var g=r.split(/(?:,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/),o=r.match(/(,\s+|\s*\\*[\-\u2013]+\s*|\s*&\s*)/g),b=[],a=0,l=g.length-1;l>a;a+=1)b.push(g[a]),b.push(o[a]);b.push(g[g.length-1]);for(var v=0,y=!0,a=0,l=b.length;l>a;a+=1){var _=a%2===0;if(_){if(b[a]){if(b[a].match(/(?:[0-9]|[xivcmlXIVCML])/))if(b[a-1]&&b[a-1].match(/^\s*\\*[\-\u2013]+\s*$/)){var x=this.tmp.shadow_numbers[i].values.slice(-1);if(-1==x[0][1].indexOf("\\")){if(b[a-2]&&(""+b[a-2]).match(/(:?[a-zA-Z]*[0-9]+$|^[ivxlcmIVXLCM]+$)/)&&b[a].match(/(?:^[a-zA-Z]*[0-9]+|^[ivxlcmIVXLCM]+$)/)){var C=this.tmp.shadow_numbers[i].values.slice(-2);if(x[0][1]=this.getTerm(f+"-range-delimiter"),this.opt[f+"-range-format"]){var w=this.fun[f+"_mangler"](C[0][1]+"-"+b[a]);w=w.split(this.getTerm(f+"-range-delimiter")),b[a]=w[1]}v+=1}x[0][1].indexOf("--")>-1&&(x[0][1]=x[0][1].replace(/--*/,""))}else x[0][1]=x[0][1].replace(/\\/,"","g")}else-1===b[a].indexOf(" ")&&(v+=1);for(var S=b[a].split(/\s+/),u=0,c=S.length;c>u;u+=1)this.opt.development_extensions.strict_page_numbers&&"page"===i&&!S[u].match(/^-*[0-9]/)?y=!1:S[u].match(/[-0-9]/)||(y=!1);if(b[a].match(/^[1-9][0-9]*$/))b[a]=parseInt(b[a],10),t&&"undefined"==typeof t.gender&&(t.gender=this.locale[this.opt.lang]["noun-genders"][i],t.gender||(t.gender="")),this.tmp.shadow_numbers[i].values.push(["NumericBlob",b[a],t]);else{var T=b[a];this.tmp.shadow_numbers[i].values.push(["Blob",T,t])}}}else b[a]&&this.tmp.shadow_numbers[i].values.push(["Blob",b[a],void 0])}this.opt.development_extensions.strict_page_numbers&&"page"===i?-1===r.indexOf(" ")&&r.match(/^-*[0-9]/)?this.tmp.shadow_numbers[i].numeric=!0:this.tmp.shadow_numbers[i].numeric=y:-1===r.indexOf(" ")&&r.match(/[0-9]/)?this.tmp.shadow_numbers[i].numeric=!0:this.tmp.shadow_numbers[i].numeric=y,this.tmp.shadow_numbers[i].numeric||this.transform.loadAbbreviation(e.jurisdiction,"number",r),v>1&&(this.tmp.shadow_numbers[i].plural=1),1===e.force_pluralism?this.tmp.shadow_numbers[i].plural=1:0===e.force_pluralism&&(this.tmp.shadow_numbers[i].plural=0)}}},n.Util.PageRangeMangler={},n.Util.PageRangeMangler.getFunction=function(t,e){var i,s,n,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y=t.getTerm(e+"-range-delimiter");i=/([a-zA-Z]*)([0-9]+)\s*(?:\u2013|-)\s*([a-zA-Z]*)([0-9]+)/,r=function(i){for(n=i.length,s=1;n>s;s+=2)"object"==typeof i[s]&&(i[s]=i[s].join(""));var r=i.join("");return r=r.replace(/([^\\])\-/g,"$1"+t.getTerm(e+"-range-delimiter"))},o=function(t){var e,i,r,o="\\s+\\-\\s+",a=new RegExp("([^\\\\])["+y+"\\u2013]","g");t=t.replace(a,"$1 - ").replace(/\s+-\s+/g," - ");var l=new RegExp("([a-zA-Z]*[0-9]+"+o+"[a-zA-Z]*[0-9]+)","g"),u=new RegExp("[a-zA-Z]*[0-9]+"+o+"[a-zA-Z]*[0-9]+");if(e=t.match(l),i=t.split(u),0===i.length)r=e;else for(r=[i[0]],s=1,n=i.length;n>s;s+=1)r.push(e[s-1].replace(/\s*\-\s*/,"-","g")),r.push(i[s]);return r},a=function(t){for(t=""+t,h=o(t),n=h.length,s=1;n>s;s+=2)p=h[s].match(i),p&&(p[3]&&p[1]!==p[3]||(p[4].length<p[2].length&&(p[4]=p[2].slice(0,p[2].length-p[4].length)+p[4]),parseInt(p[2],10)<parseInt(p[4],10)&&(p[3]=y+p[1],h[s]=p.slice(1)))),"string"==typeof h[s]&&(h[s]=h[s].replace("-",y,"g"));return h},l=function(t,e,i){n=t.length;for(var s=1,o=t.length;o>s;s+=2)t[s][3]=u(t[s][1],t[s][3],e,i),t[s][2].slice(1)===t[s][0]&&(t[s][2]=y);return r(t)},u=function(t,e,i,s){if(i||(i=0),d=(""+t).split(""),f=(""+e).split(""),m=f.slice(),m.reverse(),d.length===f.length)for(var n=0,r=d.length;r>n;n+=1){if(!(d[n]===f[n]&&m.length>i)){if(i&&s&&3===m.length){var o=d.slice(0,n);o.reverse(),m=m.concat(o)}break}m.pop()}return m.reverse(),m.join("")},c=function(t){for(n=t.length,s=1;n>s;s+=2)"object"==typeof t[s]&&(p=t[s],g=parseInt(p[1],10),b=parseInt(p[3],10),g>100&&g%100&&parseInt(g/100,10)===parseInt(b/100,10)?p[3]=""+b%100:g>=1e4&&(p[3]=""+b%1e3)),p[2].slice(1)===p[0]&&(p[2]=y);return r(t)};var _=function(t,e,i,s){var n;t=""+t;var r=a(t),n=e(r,i,s);return n};return t.opt[e+"-range-format"]?"expanded"===t.opt[e+"-range-format"]?v=function(t){return _(t,r)}:"minimal"===t.opt[e+"-range-format"]?v=function(t){return _(t,l)}:"minimal-two"===t.opt[e+"-range-format"]?v=function(t,e){return _(t,l,2,e)}:"chicago"===t.opt[e+"-range-format"]&&(v=function(t){return _(t,c)}):v=function(t){return t},v},n.Util.FlipFlopper=function(t){var e,i,s,n,r,o,a,l,u,c,h,p,d,f,m,g,b,v;for(this.state=t,this.blob=!1,this.quotechars=['"',"'"],e=[["<i>","</i>","italics","@font-style",["italic","normal","normal"],!0],["<b>","</b>","bold","@font-weight",["bold","normal","normal"],!0],["<sup>","</sup>","superscript","@vertical-align",["sup","sup","baseline"],!0],["<sub>","</sub>","subscript","@vertical-align",["sub","sub","baseline"],!0],["<sc>","</sc>","smallcaps","@font-variant",["small-caps","small-caps","normal"],!0],['<span style="font-variant:small-caps;">',"</span>","smallcaps","@font-variant",["small-caps","normal","normal"],!0],['<span class="nocase">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['<span class="nodecor">',"</span>","passthrough","@passthrough",["true","true","true"],!0],['"','"',"quotes","@quotes",["true","inner","true"],"'"],[" '","'","quotes","@quotes",["inner","true","true"],'"']],i=0;2>i;i+=1){n=["-","-inner-"][i],r=[];var y=t.getTerm("open"+n+"quote");r.push(y),this.quotechars.push(y);var _=t.getTerm("close"+n+"quote");r.push(_),this.quotechars.push(_),r.push("quotes"),r.push("@quotes"),"-"===n?r.push(["true","inner"]):r.push(["inner","true"]),r.push(!0),"-"===n?r.push(t.getTerm("close-inner-quote")):r.push(t.getTerm("close-quote")),e.push(r)}for(o=function(t){for(a=[],s=t.length,i=0;s>i;i+=1)l=t[i],-1===a.indexOf(l[0])&&(u="",["(",")","[","]"].indexOf(l[0])>-1&&(u="\\"),a.push(u+l[0])),-1===a.indexOf(l[1])&&(u="",["(",")","[","]"].indexOf(l[1])>-1&&(u="\\"),a.push(u+l[1]));return a},b=o(e),v=[],i=0,s=b.length;s>i;i+=1)b[i]&&v.push(b[i]);b=v.slice(),this.allTagsRexMatch=new RegExp("("+b.join("|")+")","g"),this.allTagsRexSplit=new RegExp("(?:"+b.join("|")+")"),c=function(t){for(h={},p={},d={},f={},m={},s=t.length,i=0;s>i;i+=1)h[t[i][1]]=!0,p[t[i][1]]=t[i][5],d[t[i][0]]=t[i][1],f[t[i][0]]=[t[i][3],t[i][4]],m[t[i][3]]=[t[i][3],[t[i][4][2],t[i][1]]];return[h,p,d,f,m]},g=c(e),this.closeTagsHash=g[0],this.flipTagsHash=g[1],this.openToCloseHash=g[2],this.openToDecorations=g[3],this.okReverseHash=g[4]},n.Util.FlipFlopper.prototype.init=function(t,e){this.txt_esc=n.getSafeEscape(this.state),e?(this.blob=e,this.strs=this.getSplitStrings(this.blob.blobs),this.blob.blobs=[]):(this.strs=this.getSplitStrings(t),this.blob=new n.Blob),this.blobstack=new n.Stack(this.blob)},n.Util.FlipFlopper.prototype._normalizeString=function(t){var e,i;if(t=t.replace(/\s+'\s+/,"  ","g"),t.indexOf(this.quotechars[0])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+2]&&(t=t.replace(this.quotechars[e+2],this.quotechars[0]));if(t.indexOf(this.quotechars[1])>-1)for(e=0,i=2;i>e;e+=1)this.quotechars[e+4]&&(t=0===e?t.replace(this.quotechars[e+4]," "+this.quotechars[1]):t.replace(this.quotechars[e+4],this.quotechars[1]));return t},n.Util.FlipFlopper.prototype.getSplitStrings=function(t){var e,i,s,n,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x,C,w,S,T,E,I,O,A;for(t=this._normalizeString(t),O=t.match(this.allTagsRexMatch),e=t.split(this.allTagsRexSplit),A=[e[0]],i=1,s=e.length;s>i;i+=1)A.push(O[i-1]),A.push(e[i]);for(e=A.slice(),s=e.length-2,i=s;i>0;i+=-2)"\\"===e[i-1].slice(e[i-1].length-1)&&(n=e[i-1].slice(0,e[i-1].length-1)+e[i]+e[i+1],r=e.slice(0,i-1),o=e.slice(i+2),r.push(n),e=r.concat(o));for(a=[],l=[],u=[],c=[],h=[],S=e.length-1,p=1;S>p;p+=2)if(g=e[p],this.closeTagsHash[g]&&(a.reverse(),d=this.openToCloseHash[g],f=a.indexOf(g),m=u.indexOf(g),a.reverse(),!d||f>-1&&(m>f||-1===m))){for(b=!1,T=a.length-1,v=T;v>-1;v+=-1){if(b=!0,y=a[v],g===y){a.pop(),l.pop(),u.pop(),c.pop();break}h.push(p)}b||h.push(p)}else this.openToCloseHash[g]&&(a.push(this.openToCloseHash[g]),l.push(g),u.push(this.flipTagsHash[g]),c.push(p));for(E=a.length-1,_=E;_>-1;_+=-1)a.pop(),u.pop(),l.pop(),h.push(c.pop());for(h.sort(function(t,e){return e>t?1:t>e?-1:0}),s=h.length,i=0;s>i;i+=1)I=h[i],r=e.slice(0,I-1),o=e.slice(I+2),x=e[I],x.length&&"<"!==x[0]&&this.openToDecorations[x]&&-1===this.quotechars.indexOf(x.replace(/\s+/g,""))&&(w=this.openToDecorations[x],x=this.state.fun.decorate[w[0]][w[1][0]](this.state)),C=e[I-1]+x+e[I+1],r.push(C),e=r.concat(o);for(s=e.length,i=0;s>i;i+=2)e[i]=e[i].replace("'","","g"),e[i]=e[i].replace("  "," ","g");return e},n.Util.FlipFlopper.prototype.processTags=function(){var t,e,i,s,r,o,a,l,u,c,h,p,d,f,m,g,b,v,y,_,x,C,w,S;
if(t=[],e=[],i=[],s=[],r="",1===this.strs.length)this.blob.blobs=this.strs[0];else if(this.strs.length>2){for(x=this.strs.length-1,o=1;x>o;o+=2)if(a=this.strs[o],l=this.strs[o-1],l&&(u=new n.Blob(l),c=this.blobstack.value(),c.push(u)),this.closeTagsHash[a]&&(t.reverse(),h=this.openToCloseHash[a],p=t.indexOf(a),d=i.indexOf(a),t.reverse(),!h||p>-1&&(d>p||-1===d))){for(C=t.length,f=C;f>-1;f+=-1)if(m=t[f],a===m){t.pop(),e.pop(),i.pop(),s.pop(),this.blobstack.pop();break}}else if(this.openToCloseHash[a]){if(t.push(this.openToCloseHash[a]),e.push(a),i.push(this.flipTagsHash[a]),c=this.blobstack.value(),g=new n.Blob,c.push(g),b=this.addFlipFlop(g,this.openToDecorations[a]),'<span class="nodecor">'===a)for(v=this.state[this.state.tmp.area].opt.topdecor.concat(this.blob.alldecor).concat([[["@quotes","inner"]]]),C=v.length,f=0;C>f;f+=1)for(y=v[f],S=y.length,w=0;S>w;w+=1)_=y[w],["@font-style","@font-weight","@font-variant"].indexOf(_[0])>-1&&(b=this.addFlipFlop(g,this.okReverseHash[_[0]]));s.push(this.state.fun.decorate[b[0]][b[1]](this.state)),this.blobstack.push(g)}this.strs.length>2&&(r=this.strs[this.strs.length-1],r&&(c=this.blobstack.value(),u=new n.Blob(r),c.push(u)))}return this.blob},n.Util.FlipFlopper.prototype.addFlipFlop=function(t,e){var i,s,n,r,o,a,l,u,c,h;for(s=0,n=this.state[this.state.tmp.area].opt.topdecor.concat(t.alldecor).concat([[["@quotes","inner"]]]),r=n.length,i=0;r>i;i+=1){for(o=n[i],a=!1,h=o.length-1,u=h;u>-1;u+=-1)if(l=o[u],l[0]===e[0]){l[1]===e[1][0]&&(s=1),a=!0;break}if(a)break}return c=[e[0],e[1][s]],t.decorations.reverse(),t.decorations.push(c),t.decorations.reverse(),c},n.Output.Formatters={},n.getSafeEscape=function(t){if(["bibliography","citation"].indexOf(t.tmp.area)>-1){var e=[];return t.opt.development_extensions.thin_non_breaking_space_html_hack&&"html"===t.opt.mode&&e.push(function(t){return t.replace(/\u202f/g,'<span style="white-space:nowrap">&thinsp;</span>')}),e.length?function(i){for(var s=0,r=e.length;r>s;s+=1)i=e[s](i);return n.Output.Formats[t.opt.mode].text_escape(i)}:n.Output.Formats[t.opt.mode].text_escape}return function(t){return t}},n.Output.Formatters.passthrough=function(t,e){return e},n.Output.Formatters.lowercase=function(t,e){var i=n.Output.Formatters.doppelString(e,n.TAG_USEALL);return i.string=i.string.toLowerCase(),n.Output.Formatters.undoppelString(i)},n.Output.Formatters.uppercase=function(t,e){var i=n.Output.Formatters.doppelString(e,n.TAG_USEALL);return i.string=i.string.toUpperCase(),n.Output.Formatters.undoppelString(i)},n.Output.Formatters["capitalize-first"]=function(t,e){var i=n.Output.Formatters.doppelString(e,n.TAG_ESCAPE);return i.string.length?(i.string=i.string.slice(0,1).toUpperCase()+i.string.substr(1),n.Output.Formatters.undoppelString(i)):""},n.Output.Formatters.sentence=function(t,e){var i=n.Output.Formatters.doppelString(e,n.TAG_ESCAPE);return i.string=i.string.slice(0,1).toUpperCase()+i.string.substr(1).toLowerCase(),n.Output.Formatters.undoppelString(i)},n.Output.Formatters["capitalize-all"]=function(t,e){for(var i=n.Output.Formatters.doppelString(e,n.TAG_ESCAPE),s=i.string.split(" "),r=0,o=s.length;o>r;r+=1)s[r].length>1?t.opt.development_extensions.allow_force_lowercase?s[r]=s[r].slice(0,1).toUpperCase()+s[r].substr(1).toLowerCase():s[r]=s[r].slice(0,1).toUpperCase()+s[r].substr(1):1===s[r].length&&(s[r]=s[r].toUpperCase());return i.string=s.join(" "),n.Output.Formatters.undoppelString(i)},n.Output.Formatters.title=function(t,e){function i(t){var e=t.match(/([:?!]+\s+|-|^)(.)(.*)/);return e?e[1]+e[2].toUpperCase()+e[3]:t}var s,r,o,a,l;t.locale[t.opt.lang].opts["skip-words"];if(!e)return"";var u=n.Output.Formatters.doppelString(e,n.TAG_ESCAPE),s=u.string,l=s.split(t.locale[t.opt.lang].opts["skip-words-regexp"]);for(c=1,h=l.length;h>c;c+=2)l[c].match(/^[:?!]/)&&(l[c]=i(l[c]));l[0]||(l[1]=i(l[1])),l.length>2&&!l[l.length-1]&&(l[l.length-2]=i(l[l.length-2]));for(var c=0,h=l.length;h>c;c+=2){for(var r=l[c].split(/([:?!]*\s+|-)/),p=0,d=r.length;d>p;p+=2)if(0!==r[p].length){if(o=r[p].toUpperCase(),a=r[p].toLowerCase(),r[p].match(/[0-9]/))continue;r[p]===a&&(r[p]=i(r[p]))}l[c]=r.join("")}u.string=l.join("");var f=n.Output.Formatters.undoppelString(u);return f},n.Output.Formatters.doppelString=function(t,e){var i;i={},i.array=e(t),i.string="";for(var s=0,n=i.array.length;n>s;s+=2)"-"===i.array[s-1],i.string+=i.array[s];return i},n.Output.Formatters.undoppelString=function(t){var e;e="";for(var i=0,s=t.array.length;s>i;i+=1)i%2?e+=t.array[i]:("-"===t.array[i-1],e+=t.string.slice(0,t.array[i].length),t.string=t.string.slice(t.array[i].length));return e},n.Output.Formatters.serializeItemAsRdf=function(t){return""},n.Output.Formatters.serializeItemAsRdfA=function(t){return""},n.demoteNoiseWords=function(t,e,i){var s=t.locale[t.opt.lang].opts["leading-noise-words"];if(e&&i){e=e.split(/\s+/),e.reverse();for(var n=[],r=e.length-1;r>-1&&s.indexOf(e[r].toLowerCase())>-1;r+=-1)n.push(e.pop());e.reverse();var o=e.join(" "),a=n.join(" ");"drop"!==i&&a?"demote"===i&&(e=[o,a].join(", ")):e=o}return e},n.Output.Formats=function(){},n.Output.Formats.prototype.html={text_escape:function(t){return t||(t=""),t.replace(/&/g,"&#38;").replace(/</g,"&#60;").replace(/>/g,"&#62;").replace("  ","&#160; ","g").replace(n.SUPERSCRIPTS_REGEXP,function(t){return"<sup>"+n.SUPERSCRIPTS[t]+"</sup>"})},bibstart:'<div class="csl-bib-body">\n',bibend:"</div>","@font-style/italic":"<i>%%STRING%%</i>","@font-style/oblique":"<em>%%STRING%%</em>","@font-style/normal":'<span style="font-style:normal;">%%STRING%%</span>',"@font-variant/small-caps":'<span style="font-variant:small-caps;">%%STRING%%</span>',"@passthrough/true":n.Output.Formatters.passthrough,"@font-variant/normal":'<span style="font-variant:normal;">%%STRING%%</span>',"@font-weight/bold":"<b>%%STRING%%</b>","@font-weight/normal":'<span style="font-weight:normal;">%%STRING%%</span>',"@font-weight/light":!1,"@text-decoration/none":'<span style="text-decoration:none;">%%STRING%%</span>',"@text-decoration/underline":'<span style="text-decoration:underline;">%%STRING%%</span>',"@vertical-align/sup":"<sup>%%STRING%%</sup>","@vertical-align/sub":"<sub>%%STRING%%</sub>","@vertical-align/baseline":'<span style="baseline">%%STRING%%</span>',"@strip-periods/true":n.Output.Formatters.passthrough,"@strip-periods/false":n.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){var i="";return t.sys.embedBibliographyEntry&&(i=t.sys.embedBibliographyEntry(this.item_id)+"\n"),'  <div class="csl-entry">'+e+"</div>\n"+i},"@display/block":function(t,e){return'\n\n    <div class="csl-block">'+e+"</div>\n"},"@display/left-margin":function(t,e){return'\n    <div class="csl-left-margin">'+e+"</div>"},"@display/right-inline":function(t,e){return'<div class="csl-right-inline">'+e+"</div>\n  "},"@display/indent":function(t,e){return'<div class="csl-indent">'+e+"</div>\n  "},"@showid/true":function(t,e,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return e;if(i)return'<span class="'+t.opt.nodenames[i]+'" cslid="'+i+'">'+e+"</span>";if("string"==typeof e){var s="";if(e){var r=e.match(n.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],e=r[2]}var o="";return e&&n.SWAPPING_PUNCTUATION.indexOf(e.slice(-1))>-1&&(o=e.slice(-1),e=e.slice(0,-1)),t.sys.variableWrapper(this.params,s,e,o)}return e},"@URL/true":function(t,e){return'<a href="'+e+'">'+e+"</a>"},"@DOI/true":function(t,e){return'<a href="http://dx.doi.org/'+e+'">'+e+"</a>"}},n.Output.Formats.prototype.text={text_escape:function(t){return t||(t=""),t},bibstart:"",bibend:"","@font-style/italic":!1,"@font-style/oblique":!1,"@font-style/normal":!1,"@font-variant/small-caps":!1,"@passthrough/true":n.Output.Formatters.passthrough,"@font-variant/normal":!1,"@font-weight/bold":!1,"@font-weight/normal":!1,"@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":!1,"@vertical-align/baseline":!1,"@vertical-align/sup":!1,"@vertical-align/sub":!1,"@strip-periods/true":n.Output.Formatters.passthrough,"@strip-periods/false":n.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?t.getTerm("open-quote"):t.getTerm("open-quote")+e+t.getTerm("close-quote")},"@quotes/inner":function(t,e){return"undefined"==typeof e?"":t.getTerm("open-inner-quote")+e+t.getTerm("close-inner-quote")},"@quotes/false":!1,"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e+"\n"},"@display/block":function(t,e){return"\n"+e},"@display/left-margin":function(t,e){return e},"@display/right-inline":function(t,e){return e},"@display/indent":function(t,e){return"\n    "+e},"@showid/true":function(t,e,i){return e},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},n.Output.Formats.prototype.rtf={text_escape:function(t){return t||(t=""),t.replace(/([\\{}])/g,"\\$1","g").replace(n.SUPERSCRIPTS_REGEXP,function(t){return"\\super "+n.SUPERSCRIPTS[t]+"\\nosupersub{}"}).replace(/[\u007F-\uFFFF]/g,function(t){return"\\uc0\\u"+t.charCodeAt(0).toString()+"{}"}).replace("	","\\tab{}","g")},"@passthrough/true":n.Output.Formatters.passthrough,"@font-style/italic":"\\i %%STRING%%\\i0{}","@font-style/normal":"\\i0{}%%STRING%%\\i{}","@font-style/oblique":"\\i %%STRING%%\\i0{}","@font-variant/small-caps":"\\scaps %%STRING%%\\scaps0{}","@font-variant/normal":"\\scaps0{}%%STRING%%\\scaps{}","@font-weight/bold":"\\b %%STRING%%\\b0{}","@font-weight/normal":"\\b0{}%%STRING%%\\b{}","@font-weight/light":!1,"@text-decoration/none":!1,"@text-decoration/underline":"\\ul %%STRING%%\\ul0{}","@vertical-align/baseline":!1,"@vertical-align/sup":"\\super %%STRING%%\\nosupersub{}","@vertical-align/sub":"\\sub %%STRING%%\\nosupersub{}","@strip-periods/true":n.Output.Formatters.passthrough,"@strip-periods/false":n.Output.Formatters.passthrough,"@quotes/true":function(t,e){return"undefined"==typeof e?n.Output.Formats.rtf.text_escape(t.getTerm("open-quote")):n.Output.Formats.rtf.text_escape(t.getTerm("open-quote"))+e+n.Output.Formats.rtf.text_escape(t.getTerm("close-quote"))},"@quotes/inner":function(t,e){return"undefined"==typeof e?n.Output.Formats.rtf.text_escape(""):n.Output.Formats.rtf.text_escape(t.getTerm("open-inner-quote"))+e+n.Output.Formats.rtf.text_escape(t.getTerm("close-inner-quote"))},"@quotes/false":!1,bibstart:"{\\rtf ",bibend:"}","@display/block":"\\line{}%%STRING%%\\line\r\n","@cite/entry":function(t,e){return e},"@cite/entry":function(t,e){return t.sys.wrapCitationEntry(e,this.item_id,this.locator_txt,this.suffix_txt)},"@bibliography/entry":function(t,e){return e},"@display/left-margin":function(t,e){return e+"\\tab "},"@display/right-inline":function(t,e){return e+"\n"},"@display/indent":function(t,e){return"\n\\tab "+e},"@showid/true":function(t,e,i){if(t.tmp.just_looking||t.tmp.suppress_decorations)return e;var s="";if(e){var r=e.match(n.VARIABLE_WRAPPER_PREPUNCT_REX);s=r[1],e=r[2]}var o="";return e&&n.SWAPPING_PUNCTUATION.indexOf(e.slice(-1))>-1&&(o=e.slice(-1),e=e.slice(0,-1)),t.sys.variableWrapper(this.params,s,e,o)},"@URL/true":function(t,e){return e},"@DOI/true":function(t,e){return e}},n.Output.Formats=new n.Output.Formats,n.Registry=function(t){var e,i,s;this.debug=!1,this.state=t,this.registry={},this.reflist=[],this.namereg=new n.Registry.NameReg(t),this.citationreg=new n.Registry.CitationReg(t),this.authorstrings={},this.mylist=[],this.myhash={},this.deletes=[],this.inserts=[],this.uncited={},this.refreshes={},this.akeys={},this.oldseq={},this.return_data={},this.ambigcites={},this.ambigresets={},this.sorter=new n.Registry.Comparifier(t,"bibliography_sort"),this.getSortedIds=function(){for(e=[],i=0,s=this.reflist.length;s>i;i+=1)e.push(""+this.reflist[i].id);return e},this.getSortedRegistryItems=function(){for(e=[],i=0,s=this.reflist.length;s>i;i+=1)e.push(this.reflist[i]);return e}},n.Registry.prototype.init=function(t,e){var i,s;if(this.oldseq={},e){this.uncited={};for(var i=0,s=t.length;s>i;i+=1)this.myhash[t[i]]||this.mylist.push(""+t[i]),this.uncited[t[i]]=!0,this.myhash[t[i]]=!0}else{for(var n in this.uncited)t.push(n);var r={};for(i=t.length-1;i>-1;i+=-1)r[t[i]]?t=t.slice(0,i).concat(t.slice(i+1)):r[t[i]]=!0;this.mylist=[];for(var i=0,s=t.length;s>i;i+=1)this.mylist.push(""+t[i]);this.myhash=r}this.refreshes={},this.touched={},this.ambigsTouched={},this.ambigresets={}},n.Registry.prototype.dopurge=function(t){for(var e=this.mylist.length-1;e>-1;e+=-1)this.citationreg.citationsByItemId&&(this.citationreg.citationsByItemId[this.mylist[e]]||t[this.mylist[e]]||(delete this.myhash[this.mylist[e]],this.mylist=this.mylist.slice(0,e).concat(this.mylist.slice(e+1))));this.dodeletes(this.myhash)},n.Registry.prototype.dodeletes=function(t){var e,i,s,n,r,o,a,l,u;"string"==typeof t&&(t={},t[t]=!0);for(i in this.registry)if(!t[i]){if(this.uncited[i])continue;e=this.namereg.delitems(i);for(a in e)this.refreshes[a]=!0;for(s=this.registry[i].ambig,l=this.ambigcites[s].indexOf(i),l>-1&&(o=this.ambigcites[s].slice(),this.ambigcites[s]=o.slice(0,l).concat(o.slice(l+1,o.length)),this.ambigresets[s]=this.ambigcites[s].length),r=this.ambigcites[s].length,n=0;r>n;n+=1)u=""+this.ambigcites[s][n],this.refreshes[u]=!0;if(this.registry[i].siblings)if(1==this.registry[i].siblings.length){var c=this.registry[i].siblings[0];this.registry[c].master=!0,this.registry[c].siblings.pop(),this.registry[c].parallel=!1}else if(this.registry[i].siblings.length>1){var h=[i];if(this.registry[i].master){var p=this.registry[i].siblings[0],d=this.registry[p];d.master=!0,d.parallel=!1,h.push(p);for(var f=0,m=this.registry[i].siblings.length;m>f;f+=1)this.registry[this.registry[i].siblings[f]].parallel=p}for(var g=[],f=this.registry[i].siblings.length-1;f>-1;f+=-1){var b=this.registry[i].siblings.pop();-1===h.indexOf(b)&&g.push(b)}for(var f=g.length-1;f>-1;f+=-1)this.registry[i].siblings.push(g[f])}delete this.registry[i],this.return_data.bibchange=!0}},n.Registry.prototype.doinserts=function(t){var e,i,s,r,o,a,l;for("string"==typeof t&&(t=[t]),a=0,l=t.length;l>a;a+=1)e=t[a],this.registry[e]||(i=this.state.retrieveItem(e),s=n.getAmbiguousCite.call(this.state,i),this.ambigsTouched[s]=!0,i.legislation_id||(this.akeys[s]=!0),r={id:""+e,seq:0,offset:0,sortkeys:!1,ambig:!1,rendered:!1,disambig:!1,ref:i},this.registry[e]=r,this.citationreg.citationsByItemId&&this.citationreg.citationsByItemId[e]&&(this.registry[e]["first-reference-note-number"]=this.citationreg.citationsByItemId[e][0].properties.noteIndex),o=n.getAmbigConfig.call(this.state),this.registerAmbigToken(s,e,o),this.touched[e]=!0,this.return_data.bibchange=!0)},n.Registry.prototype.rebuildlist=function(){var t,e,i;for(this.reflist=[],this.state.opt.citation_number_sort_direction===n.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.mylist.length,e=0;t>e;e+=1)i=this.mylist[e],this.reflist.push(this.registry[i]),this.oldseq[i]=this.registry[i].seq,this.registry[i].seq=e+1;this.state.opt.citation_number_sort_direction===n.DESCENDING&&this.state.opt.citation_number_sort_used},n.Registry.prototype.dorefreshes=function(){var t,e,i,s,r;for(t in this.refreshes)if(e=this.registry[t]){e.sortkeys=void 0,i=this.state.retrieveItem(t);var s=e.ambig;"undefined"==typeof s&&(this.state.tmp.disambig_settings=!1,s=n.getAmbiguousCite.call(this.state,i),r=n.getAmbigConfig.call(this.state),this.registerAmbigToken(s,t,r));for(var o in this.ambigresets)if(1===this.ambigresets[o]){var a=this.ambigcites[s][0],i=this.state.retrieveItem(a);this.registry[a].disambig=new n.AmbigConfig,this.state.tmp.disambig_settings=!1;var s=n.getAmbiguousCite.call(this.state,i),r=n.getAmbigConfig.call(this.state);this.registerAmbigToken(s,a,r)}this.state.tmp.taintedItemIDs[t]=!0,this.ambigsTouched[s]=!0,i.legislation_id||(this.akeys[s]=!0),this.touched[t]=!0}},n.Registry.prototype.setdisambigs=function(){var t;this.leftovers=[];for(t in this.ambigsTouched)this.state.disambiguate.run(t);this.ambigsTouched={},this.akeys={}},n.Registry.prototype.renumber=function(){var t,e,i;for(this.state.opt.citation_number_sort_direction===n.DESCENDING&&this.state.opt.citation_number_sort_used,t=this.reflist.length,e=0;t>e;e+=1)i=this.reflist[e],i.seq=e+1,this.state.opt.update_mode===n.NUMERIC&&i.seq!=this.oldseq[i.id]&&(this.state.tmp.taintedItemIDs[i.id]=!0),this.state.opt.bib_mode===n.NUMERIC&&i.seq!=this.oldseq[i.id]&&(this.return_data.bibchange=!0);this.state.opt.citation_number_sort_direction===n.DESCENDING&&this.state.opt.citation_number_sort_used&&this.reflist.reverse()},n.Registry.prototype.setsortkeys=function(){for(var t,e=0,i=this.mylist.length;i>e;e+=1){var t=this.mylist[e];(this.touched[t]||this.state.tmp.taintedItemIDs[t]||!this.registry[t].sortkeys)&&(this.registry[t].sortkeys=n.getSortKeys.call(this.state,this.state.retrieveItem(t),"bibliography_sort"))}},n.Registry.prototype.sorttokens=function(){this.reflist.sort(this.sorter.compareKeys)},n.Registry.Comparifier=function(t,e){var i,s,r,o,a=n.getSortCompare(t.opt["default-locale-sort"]);i=t[e].opt.sort_directions,this.compareKeys=function(t,e){for(s=t.sortkeys?t.sortkeys.length:0,r=0;s>r;r+=1){var n=0;if(n=t.sortkeys[r]===e.sortkeys[r]?0:"undefined"==typeof t.sortkeys[r]?i[r][1]:"undefined"==typeof e.sortkeys[r]?i[r][0]:a(t.sortkeys[r],e.sortkeys[r]),n>0)return i[r][1];if(0>n)return i[r][0]}return t.seq>e.seq?1:t.seq<e.seq?-1:0},o=this.compareKeys,this.compareCompositeKeys=function(t,e){return o(t[1],e[1])}},n.Registry.prototype.compareRegistryTokens=function(t,e){return t.seq>e.seq?1:t.seq<e.seq?-1:0},n.Registry.prototype.registerAmbigToken=function(t,e,i){if(this.registry[e]&&this.registry[e].disambig&&this.registry[e].disambig.names)for(var s=0,r=i.names.length;r>s;s+=1){var o=i.names[s],a=this.registry[e].disambig.names[s];if(o!==a)this.state.tmp.taintedItemIDs[e]=!0;else if(i.givens[s])for(var l=0,u=i.givens[s].length;u>l;l+=1){var c=i.givens[s][l],h=this.registry[e].disambig.givens[s][l];c!==h&&(this.state.tmp.taintedItemIDs[e]=!0)}}this.ambigcites[t]||(this.ambigcites[t]=[]),-1===this.ambigcites[t].indexOf(""+e)&&this.ambigcites[t].push(""+e),this.registry[e].ambig=t;this.registry[e].disambig=n.cloneAmbigConfig(i)},n.getSortKeys=function(t,e){var i,s,r,o,a,l;for(i=this.tmp.area,s=this.tmp.extension,r=n.Util.Sort.strip_prepositions,this.tmp.area=e,this.tmp.extension="_sort",this.tmp.disambig_override=!0,this.tmp.disambig_request=!1,o=this.parallel.use_parallels,this.parallel.use_parallels=!1,this.tmp.suppress_decorations=!0,n.getCite.call(this,t),this.tmp.suppress_decorations=!1,this.parallel.use_parallels=o,this.tmp.disambig_override=!1,a=this[e].keys.length,l=0;a>l;l+=1)this[e].keys[l]=r(this[e].keys[l]);return this.tmp.area=i,this.tmp.extension=s,this[e].keys},n.Registry.NameReg=function(t){var e,i,s,r,o,a,l,u,c,h,p,d,f,m,g,b;this.state=t,this.namereg={},this.nameind={},this.nameindpkeys={},this.itemkeyreg={},u=function(t){return t||(t=""),t.replace("."," ","g").replace(/\s+/g," ").replace(/\s+$/,"")},c=function(t,r,o){e=u(o.family),s=u(o.given);var a=s.match(/[,\!]* ([^,]+)$/);a&&a[1]===a[1].toLowerCase()&&(s=s.replace(/[,\!]* [^,]+$/,"")),i=n.Util.Names.initializeWith(t,s,"%s"),"by-cite"===t.citation.opt["givenname-disambiguation-rule"]&&(e=""+r+e)},h=function(s,n,a,l,u,h){var p;if("bibliography"===t.tmp.area.slice(0,12)&&!u)return"string"==typeof h?1:2;var d=t.nameOutput.getName(n,"locale-translit",!0);n=d.name,c(this.state,""+s,n),p=2,r=t.opt["disambiguate-add-givenname"],o=t.citation.opt["givenname-disambiguation-rule"];var f=o;return"by-cite"===o&&(o="all-names"),"short"===u?p=0:"string"==typeof h&&(p=1),"undefined"==typeof this.namereg[e]||"undefined"==typeof this.namereg[e].ikey[i]?p:"by-cite"===f&&l>=p?l:r?"string"==typeof o&&"primary-name"===o.slice(0,12)&&a>0?p:(o&&"all-names"!==o&&"primary-name"!==o?("all-names-with-initials"===o||"primary-name-with-initials"===o)&&(p=this.namereg[e].count>1?1:0):(this.namereg[e].count>1&&(p=1),(this.namereg[e].ikey&&this.namereg[e].ikey[i].count>1||this.namereg[e].count>1&&"string"!=typeof h)&&(p=2)),t.registry.registry[s]?p:"short"==u?0:"string"==typeof h?1:void 0):p},p=function(n){var r,o,u,c,h;for(("string"==typeof n||"number"==typeof n)&&(n=[""+n]),a={},o=n.length,r=0;o>r;r+=1)if(c=""+n[r],this.nameind[c]){for(h in this.nameind[c])if(this.nameind[c].hasOwnProperty(h)){if(f=h.split("::"),e=f[0],i=f[1],s=f[2],"undefined"==typeof this.namereg[e])continue;if(l=this.namereg[e].items,s&&this.namereg[e].ikey[i]&&this.namereg[e].ikey[i].skey[s]&&(m=this.namereg[e].ikey[i].skey[s].items,u=m.indexOf(""+c),u>-1&&(this.namereg[e].ikey[i].skey[s].items=m.slice(0,u).concat(m.slice([u+1]))),0===this.namereg[e].ikey[i].skey[s].items.length&&(delete this.namereg[e].ikey[i].skey[s],this.namereg[e].ikey[i].count+=-1,this.namereg[e].ikey[i].count<2)))for(g=0,b=this.namereg[e].ikey[i].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[e].ikey[i].items[g]]=!0;if(i&&this.namereg[e].ikey[i]&&(u=this.namereg[e].ikey[i].items.indexOf(""+c),u>-1&&(l=this.namereg[e].ikey[i].items.slice(),this.namereg[e].ikey[i].items=l.slice(0,u).concat(l.slice([u+1]))),0===this.namereg[e].ikey[i].items.length&&(delete this.namereg[e].ikey[i],this.namereg[e].count+=-1,this.namereg[e].count<2)))for(g=0,b=this.namereg[e].items.length;b>g;g+=1)t.tmp.taintedItemIDs[this.namereg[e].items[g]]=!0;e&&(u=this.namereg[e].items.indexOf(""+c),u>-1&&(l=this.namereg[e].items.slice(),this.namereg[e].items=l.slice(0,u).concat(l.slice([u+1],l.length))),this.namereg[e].items.length<2&&delete this.namereg[e]),delete this.nameind[c][h]}delete this.nameind[c],delete this.nameindpkeys[c]}return a},d=function(n,r,o){var a,l,u=t.nameOutput.getName(r,"locale-translit",!0);if(r=u.name,!t.citation.opt["givenname-disambiguation-rule"]||"primary-"!==t.citation.opt["givenname-disambiguation-rule"].slice(0,8)||0===o){if(c(this.state,""+n,r),e&&("undefined"==typeof this.namereg[e]?(this.namereg[e]={},this.namereg[e].count=0,this.namereg[e].ikey={},this.namereg[e].items=[n]):-1===this.namereg[e].items.indexOf(n)&&this.namereg[e].items.push(n)),e&&i)if("undefined"==typeof this.namereg[e].ikey[i]){if(this.namereg[e].ikey[i]={},this.namereg[e].ikey[i].count=0,this.namereg[e].ikey[i].skey={},this.namereg[e].ikey[i].items=[n],this.namereg[e].count+=1,2===this.namereg[e].count)for(a=0,l=this.namereg[e].items.length;l>a;a+=1)t.tmp.taintedItemIDs[this.namereg[e].items[a]]=!0}else-1===this.namereg[e].ikey[i].items.indexOf(n)&&this.namereg[e].ikey[i].items.push(n);if(e&&i&&s)if("undefined"==typeof this.namereg[e].ikey[i].skey[s]){if(this.namereg[e].ikey[i].skey[s]={},this.namereg[e].ikey[i].skey[s].items=[n],this.namereg[e].ikey[i].count+=1,2===this.namereg[e].ikey[i].count)for(a=0,l=this.namereg[e].ikey[i].items.length;l>a;a+=1)t.tmp.taintedItemIDs[this.namereg[e].ikey[i].items[a]]=!0}else-1===this.namereg[e].ikey[i].skey[s].items.indexOf(n)&&this.namereg[e].ikey[i].skey[s].items.push(n);"undefined"==typeof this.nameind[n]&&(this.nameind[n]={},this.nameindpkeys[n]={}),e&&(this.nameind[n][e+"::"+i+"::"+s]=!0,this.nameindpkeys[n][e]=this.namereg[e])}},this.addname=d,this.delitems=p,this.evalname=h},n.Registry.CitationReg=function(t){this.citationById={},this.citationByIndex=[]},n.Disambiguation=function(t){this.state=t,this.sys=this.state.sys,this.registry=t.registry.registry,this.ambigcites=t.registry.ambigcites,this.configModes(),this.debug=!1},n.Disambiguation.prototype.run=function(t){this.modes.length&&(this.akey=t,this.initVars(t)&&this.runDisambig())},n.Disambiguation.prototype.runDisambig=function(){var t;for(this.initGivens=!0;this.lists.length;){for(this.gnameset=0,this.gname=0,this.clashes=[1,0];this.lists[0][1].length;){this.listpos=0,this.base||(this.base=this.lists[0][0]);t=this.incrementDisambig(),this.scanItems(this.lists[0]),this.evalScan(t)}this.lists=this.lists.slice(1)}},n.Disambiguation.prototype.scanItems=function(t){var e,i,s;this.Item=t[1][0],this.ItemCite=n.getAmbiguousCite.call(this.state,this.Item,this.base,!0),this.scanlist=t[1],this.partners=[],this.partners.push(this.Item),this.nonpartners=[];var r=0;for(e=1,i=t[1].length;i>e;e+=1){s=t[1][e];var o=n.getAmbiguousCite.call(this.state,s,this.base,!0);this.ItemCite===o?(r+=1,this.partners.push(s)):this.nonpartners.push(s)}this.clashes[0]=this.clashes[1],this.clashes[1]=r},n.Disambiguation.prototype.evalScan=function(t){this[this.modes[this.modeindex]](t),t&&(this.modeindex<this.modes.length-1?this.modeindex+=1:this.lists[this.listpos+1]=[this.base,[]])},n.Disambiguation.prototype.disNames=function(t){var e,i;if(0===this.clashes[1]&&1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,[]];else if(0===this.clashes[1])this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.partners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.nonpartners.length&&(this.initGivens=!0);else if(1===this.nonpartners.length)this.captureStepToBase(),this.state.registry.registerAmbigToken(this.akey,""+this.nonpartners[0].id,this.betterbase),this.lists[this.listpos]=[this.betterbase,this.partners];else if(this.clashes[1]<this.clashes[0])this.captureStepToBase(),this.lists[this.listpos]=[this.betterbase,this.partners],this.lists.push([this.betterbase,this.nonpartners]);else if(t&&(this.lists[this.listpos]=[this.betterbase,this.nonpartners],this.lists.push([this.betterbase,this.partners]),this.modeindex===this.modes.length-1)){for(e=0,i=this.partners.length;i>e;e+=1)this.state.registry.registerAmbigToken(this.akey,""+this.partners[e].id,this.betterbase);this.lists[this.listpos]=[this.betterbase,[]]}},n.Disambiguation.prototype.disExtraText=function(){var t=!1;if(0===this.clashes[1]&&this.nonpartners.length<2&&(t=!0),t||this.base.disambiguate&&this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax){if(t||this.state.tmp.disambiguate_count===this.state.tmp.disambiguate_maxMax)if(t||this.modeindex===this.modes.length-1){for(var e=this.lists[this.listpos][0],i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e);this.lists[this.listpos]=[this.betterbase,[]]}else{this.modeindex=this.modes.length-1;var e=this.lists[this.listpos][0];e.disambiguate=!0;for(var i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0,this.state.registry.registerAmbigToken(this.akey,""+this.lists[this.listpos][1][i].id,e)}}else if(this.modeindex=0,this.base.disambiguate=this.state.tmp.disambiguate_count,this.betterbase.disambiguate=this.state.tmp.disambiguate_count,this.base.disambiguate)this.disNames();else{this.initGivens=!0,this.base.disambiguate=1;for(var i=0,s=this.lists[this.listpos][1].length;s>i;i+=1)this.state.tmp.taintedItemIDs[this.lists[this.listpos][1][i].id]=!0}},n.Disambiguation.prototype.disYears=function(){var t,e,i,s;i=[];var r=this.lists[this.listpos][0];if(this.clashes[1])for(var o=0,a=this.state.registry.mylist.length;a>o;o+=1)for(var l=this.state.registry.mylist[o],u=0,c=this.lists[this.listpos][1].length;c>u;u+=1){var s=this.lists[this.listpos][1][u];if(s.id==l){i.push(this.registry[s.id]);break}}for(i.sort(this.state.registry.sorter.compareKeys),t=0,e=i.length;e>t;t+=1){r.year_suffix=""+t;var h=this.state.registry.registry[i[t].id].disambig;this.state.registry.registerAmbigToken(this.akey,""+i[t].id,r),n.ambigConfigDiff(h,r)&&(this.state.tmp.taintedItemIDs[i[t].id]=!0)}this.lists[this.listpos]=[this.betterbase,[]]},n.Disambiguation.prototype.incrementDisambig=function(){if(this.initGivens)return this.initGivens=!1,!1;var t=!1,e=!0;if("disNames"===this.modes[this.modeindex]){e=!1,"number"!=typeof this.givensMax&&(e=!0);var i=!1;if("number"!=typeof this.namesMax&&(i=!0),"number"==typeof this.givensMax&&(this.base.givens.length&&this.base.givens[this.gnameset][this.gname]<this.givensMax?this.base.givens[this.gnameset][this.gname]+=1:e=!0),"number"==typeof this.namesMax&&e&&(this.state.opt["disambiguate-add-names"]?(i=!1,this.gname<this.namesMax?(this.base.names[this.gnameset]+=1,this.gname+=1):i=!0):i=!0),"number"==typeof this.namesetsMax&&i)if(this.gnameset<this.namesetsMax)this.gnameset+=1,this.base.names[this.gnameset]=1,this.gname=0;else;"number"==typeof this.namesetsMax&&-1!==this.namesetsMax&&this.gnameset!==this.namesetsMax||this.state.opt["disambiguate-add-names"]&&"number"==typeof this.namesMax&&this.gname!==this.namesMax||"number"==typeof this.givensMax&&"undefined"!=typeof this.base.givens[this.gnameset]&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&this.base.givens[this.gnameset][this.gname]!==this.givensMax||(t=!0)}else"disExtraText"===this.modes[this.modeindex]&&(this.base.disambiguate+=1,this.betterbase.disambiguate+=1);return t},n.Disambiguation.prototype.initVars=function(t){var e,i,s,r,o;if(this.lists=[],this.base=!1,this.betterbase=!1,this.akey=t,this.maxNamesByItemId={},r=[],s=this.ambigcites[t],!s||!s.length)return!1;var a=this.state.retrieveItem(""+s[0]);if(this.getCiteData(a),this.base=n.getAmbigConfig.call(this.state),s&&s.length>1){for(r.push([this.maxNamesByItemId[a.id],a]),e=1,i=s.length;i>e;e+=1)a=this.state.retrieveItem(""+s[e]),this.getCiteData(a,this.base),r.push([this.maxNamesByItemId[a.id],a]);for(r.sort(function(t,e){return t[0]>e[0]?1:t[0]<e[0]?-1:t[1].id>e[1].id?1:t[1].id<e[1].id?-1:0}),o=[],e=0,i=r.length;i>e;e+=1)o.push(r[e][1]);this.lists.push([this.base,o]),this.Item=this.lists[0][1][0]}else this.Item=this.state.retrieveItem(""+s[0]);if(this.modeindex=0,this.state.citation.opt["disambiguate-add-names"],0)for(var l=this.base.names[0],e=1,i=this.base.names.length;i>e;e+=1)l=Math.max(l,this.base.names.names[e]);else this.namesMax=this.maxNamesByItemId[this.Item.id][0];return this.padBase(this.base),this.padBase(this.betterbase),this.base.year_suffix=!1,this.base.disambiguate=!1,this.betterbase.year_suffix=!1,this.betterbase.disambiguate=!1,"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.state.opt["disambiguate-add-givenname"]&&(this.givensMax=2),!0},n.Disambiguation.prototype.padBase=function(t){for(var e=0,i=t.names.length;i>e;e+=1){t.givens[e]||(t.givens[e]=[]);for(var s=0,n=t.names[e];n>s;s+=1)t.givens[e][s]||(t.givens[e][s]=0)}},n.Disambiguation.prototype.configModes=function(){var t,e;this.modes=[],t=this.state.opt["disambiguate-add-givenname"],e=this.state.citation.opt["givenname-disambiguation-rule"],(this.state.opt["disambiguate-add-names"]||t&&"by-cite"===e)&&this.modes.push("disNames"),this.state.opt.has_disambiguate&&this.modes.push("disExtraText"),this.state.opt["disambiguate-add-year-suffix"]&&this.modes.push("disYears")},n.Disambiguation.prototype.getCiteData=function(t,e){if(!this.maxNamesByItemId[t.id]){n.getAmbiguousCite.call(this.state,t,e),e=n.getAmbigConfig.call(this.state),this.maxNamesByItemId[t.id]=n.getMaxVals.call(this.state),this.state.registry.registry[t.id].disambig.givens=this.state.tmp.disambig_settings.givens.slice();for(var i=0,s=this.state.registry.registry[t.id].disambig.givens.length;s>i;i+=1)this.state.registry.registry[t.id].disambig.givens[i]=this.state.tmp.disambig_settings.givens[i].slice();this.namesetsMax=this.state.registry.registry[t.id].disambig.names.length-1,this.base||(this.base=e,this.betterbase=n.cloneAmbigConfig(e)),e.names.length<this.base.names.length&&(this.base=e);for(var i=0,s=e.names.length;s>i;i+=1)e.names[i]>this.base.names[i]&&(this.base.givens[i]=e.givens[i].slice(),
this.base.names[i]=e.names[i],this.betterbase.names=this.base.names.slice(),this.betterbase.givens=this.base.givens.slice(),this.padBase(this.base),this.padBase(this.betterbase));this.betterbase.givens=this.base.givens.slice();for(var r=0,o=this.base.givens.length;o>r;r+=1)this.betterbase.givens[r]=this.base.givens[r].slice()}},n.Disambiguation.prototype.captureStepToBase=function(){"by-cite"===this.state.citation.opt["givenname-disambiguation-rule"]&&this.base.givens&&this.base.givens.length&&"undefined"!=typeof this.base.givens[this.gnameset][this.gname]&&(this.betterbase.givens[this.gnameset][this.gname]=this.base.givens[this.gnameset][this.gname]),this.betterbase.names[this.gnameset]=this.base.names[this.gnameset]}},{"./csl_nodejs_jsdom":509}],508:[function(t,e,i){var s="undefined"!=typeof window,n=function(){this.institutionStr='<institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution>',this.ns="http://purl.org/net/xbiblio/csl"};n.prototype._parseDoc=function(t){if(s){var e=new window.DOMParser;return e.parseFromString(t,"text/xml")}return $(t)},n.prototype.importNode=function(t,e){return s?t.importNode(e,!0):(e._root=t._root,e)},n.prototype._hasAttributes=function(t){return t.attributes&&t.attributes.length>0},n.prototype._isElementNode=function(t){return s?t.nodeType===window.Node.ELEMENT_NODE:"tag"===t.type},n.prototype._getTagName=function(t){return t.tagName?t.tagName.toLowerCase():""},n.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},n.prototype.getStyleId=function(t,e){var i=e?"title":"id",s=$(t).find(i);return s.length&&(s=s[0]),$(s).text()},n.prototype.children=function(t){return $(t).children()},n.prototype.nodename=function(t){return this._getTagName(t)},n.prototype.attributes=function(t){var e,i,n={};if(t){if(s){if(this._hasAttributes(t)){e=t.attributes;for(var r=0,o=e.length;o>r;r+=1)i=e[r],n["@"+i.name]=i.value}}else if(t.attribs){e=t.attribs;for(var a in e)e.hasOwnProperty(a)&&(n["@"+a]=e[a])}}else;return n},n.prototype.content=function(t){return $(t).text()},n.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},n.prototype.numberofnodes=function(t){return t?t.length:0},n.prototype.getAttributeName=function(t){return t.name},n.prototype.getAttributeValue=function(t,e,i){return i&&(e=i+":"+e),$(t).attr(e)},n.prototype.getNodeValue=function(t,e){if(!e)return $(t).text();var i=$(t).find(e);return i.length?i.text():void 0},n.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,n){"@"===s.slice(0,1)&&(s=s.slice(1)),$(t).find(e).each(function(){var t=$(this);t.attr("name")===i&&t.attr(s,n)})},n.prototype.deleteNodeByNameAttribute=function(t,e){$(t).find("*[name="+e+"]").remove()},n.prototype.deleteAttribute=function(t,e){$(t).removeAttr(e)},n.prototype.setAttribute=function(t,e,i){return $(t).attr(e,i),!1},n.prototype.nodeCopy=function(t){return $(t).clone()},n.prototype.getNodesByName=function(t,e,i){return $(t).find(e+"[name="+i+"]")},n.prototype.nodeNameIs=function(t,e){return this._getTagName(t)===e},n.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var e,i=this._parseDoc(t);return e=s?i.firstChild:i._root},n.prototype.insertChildNodeAfter=function(t,e,i,s){var n=this.importNode(e.ownerDocument,s);return $(n).insertAfter(e),t},n.prototype.insertPublisherAndPlace=function(t){for(var e=$(t).find("group"),i=0,s=e.length;s>i;i+=1){var n=$(e[i]),r=n.find("[variable=publisher]"),o=n.find("[variable=publisher-place]");r.length&&o.length&&n.attr("has-publisher-and-publisher-place",!0)}},n.prototype.addMissingNameNodes=function(t){$(t).find("names").each(function(){var t=$(this),e=t.find("name");0!==e.length||t.parent("substitute")||t.append($("<name>"))})},n.prototype.addInstitutionNodes=function(t){function e(t,e){for(var i=0,s=CSL.INSTITUTION_KEYS.length;s>i;i+=1){var n=CSL.INSTITUTION_KEYS[i],r=e.attr(n);r&&t.attr(n,r)}}$(t).find("names").each(function(){var t=$(this).find("name"),i=$(this).find("institution");if(t.length&&!i.length){i=$(this.institutionStr);var s=i.find("institution-part");e(s,t),t.find("name-part[name=family]").each(function(){e(s,$(this))}),i.insertBefore(t)}})},n.prototype.flagDateMacros=function(t){$(t).find("macro").each(function(){var t=$(this),e=t.find("data");e.length&&t.attr("macro-has-date","true")})},e.exports=n},{}],509:[function(t,e,i){var s;s=t("undefined"==typeof window?"./csl_jquery":"./xmldom"),e.exports={CSL_NODEJS_JSDOM:s}},{"./csl_jquery":508,"./xmldom":510}],510:[function(t,e,i){var s,n=function(){"undefined"==typeof DOMParser||s?(s=!0,DOMParser=function(){},DOMParser.prototype.parseFromString=function(t,e){if("undefined"!=typeof ActiveXObject){var i=new ActiveXObject("MSXML.DomDocument");return i.async=!1,i.loadXML(t),i}if("undefined"!=typeof XMLHttpRequest){var i=new XMLHttpRequest;return e||(e="text/xml"),i.open("GET","data:"+e+";charset=utf-8,"+encodeURIComponent(t),!1),i.overrideMimeType&&i.overrideMimeType(e),i.send(null),i.responseXML}},this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1}):this.hasAttributes=function(t){var e;return e=t.attributes&&t.attributes.length?!0:!1},this.importNode=function(t,e){if("undefined"==typeof t.importNode)var i=this._importNode(t,e,!0);else var i=t.importNode(e,!0);return i},this._importNode=function(t,e,i){switch(e.nodeType){case 1:var s=t.createElement(e.nodeName);if(e.attributes&&e.attributes.length>0)for(var n=0,r=e.attributes.length;r>n;)s.setAttribute(e.attributes[n].nodeName,e.getAttribute(e.attributes[n++].nodeName));if(i&&e.childNodes&&e.childNodes.length>0)for(var n=0,r=e.childNodes.length;r>n;)s.appendChild(this._importNode(t,e.childNodes[n++],i));return s;case 3:case 4:case 8:}},this.parser=new DOMParser;var t='<docco><institution institution-parts="long" delimiter=", " substitute-use-first="1" use-last="1"><institution-part name="long"/></institution></docco>',e=this.parser.parseFromString(t,"text/xml"),i=e.getElementsByTagName("institution");this.institution=i.item(0);var n=e.getElementsByTagName("institution-part");this.institutionpart=n.item(0),this.ns="http://purl.org/net/xbiblio/csl"};n.prototype.clean=function(t){return t=t.replace(/<\?[^?]+\?>/g,""),t=t.replace(/<![^>]+>/g,""),t=t.replace(/^\s+/,""),t=t.replace(/\s+$/,""),t=t.replace(/^\n*/,"")},n.prototype.getStyleId=function(t){var e="",i=t.getElementsByTagName("id");return i&&i.length&&(i=i.item(0)),i&&(e=i.textContent),e||(e=i.innerText),e||(e=i.innerHTML),e},n.prototype.children=function(t){var e,i,s,n;if(t){for(n=[],e=t.childNodes,i=0,s=e.length;s>i;i+=1)"#text"!=e[i].nodeName&&n.push(e[i]);return n}return[]},n.prototype.nodename=function(t){var e=t.nodeName;return e},n.prototype.attributes=function(t){var e,i,s,n,r;if(e=new Object,t&&this.hasAttributes(t))for(i=t.attributes,n=0,r=i.length;r>n;n+=1)s=i[n],e["@"+s.name]=s.value;return e},n.prototype.content=function(t){var e;return e="undefined"!=typeof t.textContent?t.textContent:"undefined"!=typeof t.innerText?t.innerText:t.txt},n.prototype.namespace={xml:"http://www.w3.org/XML/1998/namespace"},n.prototype.numberofnodes=function(t){return t?t.length:0},n.prototype.getAttributeName=function(t){var e=t.name;return e},n.prototype.getAttributeValue=function(t,e,i){var s="";return t&&this.hasAttributes(t)&&t.getAttribute(e)&&(s=t.getAttribute(e)),s},n.prototype.getNodeValue=function(t,e){var i="";if(e){var s=t.getElementsByTagName(e);s.length>0&&(i="undefined"!=typeof s[0].textContent?s[0].textContent:"undefined"!=typeof s[0].innerText?s[0].innerText:s[0].text)}else i=t;return i&&i.childNodes&&(0==i.childNodes.length||1==i.childNodes.length&&"#text"==i.firstChild.nodeName)&&(i="undefined"!=typeof i.textContent?i.textContent:"undefined"!=typeof i.innerText?i.innerText:i.text),i},n.prototype.setAttributeOnNodeIdentifiedByNameAttribute=function(t,e,i,s,n){var r,o,a,l;for("@"===s.slice(0,1)&&(s=s.slice(1)),a=t.getElementsByTagName(e),r=0,o=a.length;o>r;r+=1)l=a[r],l.getAttribute("name")==i&&l.setAttribute(s,n)},n.prototype.deleteNodeByNameAttribute=function(t,e){var i,s,n,r;for(r=t.childNodes,i=0,s=r.length;s>i;i+=1)n=r[i],n&&n.nodeType!=n.TEXT_NODE&&this.hasAttributes(n)&&n.getAttribute("name")==e&&t.removeChild(r[i])},n.prototype.deleteAttribute=function(t,e){t.removeAttribute(e)},n.prototype.setAttribute=function(t,e,i){return t.ownerDocument||(t=t.firstChild),["function","unknown"].indexOf(typeof t.setAttribute)>-1&&t.setAttribute(e,i),!1},n.prototype.nodeCopy=function(t){var e=t.cloneNode(!0);return e},n.prototype.getNodesByName=function(t,e,i){var s,n,r,o,a;for(s=[],n=t.getElementsByTagName(e),o=0,a=n.length;a>o;o+=1)r=n.item(o),(!i||this.hasAttributes(r)&&r.getAttribute("name")==i)&&s.push(r);return s},n.prototype.nodeNameIs=function(t,e){return e==t.nodeName?!0:!1},n.prototype.makeXml=function(t){t||(t="<docco><bogus/></docco>"),t=t.replace(/\s*<\?[^>]*\?>\s*\n*/g,"");var e=this.parser.parseFromString(t,"application/xml");return e.firstChild},n.prototype.insertChildNodeAfter=function(t,e,i,s){var n;return n=this.importNode(e.ownerDocument,s),t.replaceChild(n,e),t},n.prototype.insertPublisherAndPlace=function(t){for(var e=t.getElementsByTagName("group"),i=0,s=e.length;s>i;i+=1){for(var n=e.item(i),r=[],o=0,a=n.childNodes.length;a>o;o+=1)1!==n.childNodes.item(o).nodeType&&r.push(o);if(n.childNodes.length-r.length===2){for(var l=[],o=0,a=2;a>o;o+=1)if(!(r.indexOf(o)>-1)){for(var u=n.childNodes.item(o),c=[],h=0,p=u.childNodes.length;p>h;h+=1)1!==u.childNodes.item(h).nodeType&&c.push(h);if(u.childNodes.length-c.length===0&&(l.push(u.getAttribute("variable")),u.getAttribute("suffix")||u.getAttribute("prefix"))){l=[];break}}l.indexOf("publisher")>-1&&l.indexOf("publisher-place")>-1&&n.setAttribute("has-publisher-and-publisher-place",!0)}}},n.prototype.addMissingNameNodes=function(t){for(var e=t.getElementsByTagName("names"),i=0,s=e.length;s>i;i+=1){var n=e.item(i),r=n.getElementsByTagName("name");if((!r||0===r.length)&&"substitute"!==n.parentNode.tagName.toLowerCase()){var o=n.ownerDocument,a=o.createElement("name");n.appendChild(a)}}};var r={INSTITUTION_KEYS:["font-style","font-variant","font-weight","text-decoration","text-case"]};n.prototype.addInstitutionNodes=function(t){var e,i,s,n,o,a,l,u,c;for(e=t.getElementsByTagName("names"),u=0,c=e.length;c>u;u+=1)if(i=e.item(u),a=i.getElementsByTagName("name"),0!=a.length&&(s=i.getElementsByTagName("institution"),0==s.length)){n=this.importNode(t.ownerDocument,this.institution),o=n.getElementsByTagName("institution-part").item(0),l=a.item(0),i.insertBefore(n,l.nextSibling);for(var h=0,p=r.INSTITUTION_KEYS.length;p>h;h+=1){var d=r.INSTITUTION_KEYS[h],f=l.getAttribute(d);f&&o.setAttribute(d,f)}for(var m=l.getElementsByTagName("name-part"),h=0,p=m.length;p>h;h+=1)if("family"===m[h].getAttribute("name"))for(var g=0,b=r.INSTITUTION_KEYS.length;b>g;g+=1){var d=r.INSTITUTION_KEYS[g],f=m[h].getAttribute(d);f&&o.setAttribute(d,f)}}},n.prototype.flagDateMacros=function(t){var e,i,s,n,r;for(r=t.getElementsByTagName("macro"),e=0,i=r.length;i>e;e+=1)s=r.item(e),n=s.getElementsByTagName("date"),n.length&&s.setAttribute("macro-has-date","true")},e.exports=n},{}],511:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/model/InlineNode");s.Prototype=function(){this.getDefaultProperties=function(){return{targets:[]}},this.setLabel=function(t){this.label!==t&&(this.label=t,this.emit("label:changed"))},this.onTargetChange=function(t,e,i){this.updateCollection(i)}},n.extend(s),s["static"].name="citation",s["static"].defineSchema({targets:["array","id"]}),s["static"].tagName="cite",e.exports=s},{"substance/model/InlineNode":105}],512:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/SurfaceCommand"),r=t("substance/model/transform/insertInlineNode"),o=t("lodash/object/extend");s.Prototype=function(){this.getCommandState=function(){var t=this.getSelection(),e={disabled:!0,active:!1};return t&&!t.isNull()&&t.isPropertySelection()&&(e.disabled=!1),e},this.getAnnotationData=function(){return{targets:[]}},this.getAnnotationType=function(){if(this.constructor["static"].annotationType)return this.constructor["static"].annotationType;throw new Error("Contract: CitationCommand.static.annotationType should be associated to a document citation type.")},this.execute=function(){var t,e=this.getCommandState(),i=this.getSurface();return e.disabled?void 0:(i.transaction(function(e,s){return s.containerId=i.getContainerId(),s.node=o({type:this.getAnnotationType()},this.getAnnotationData()),s=r(e,s),t=s.result,s}.bind(this)),{mode:"create",anno:t})}},n.extend(s),e.exports=s},{"lodash/object/extend":74,"substance/model/transform/insertInlineNode":141,"substance/ui/SurfaceCommand":461}],513:[function(t,e,i){"use strict";function s(){n.apply(this,arguments),this.props.node.connect(this,{"label:changed":this.onLabelChanged})}var n=t("substance/ui/InlineNodeComponent");s.Prototype=function(){var t=n.prototype;this.dispose=function(){t.dispose.call(this),this.props.node.disconnect(this)},this.render=function(){var e=t.render.call(this);return e.addClass(this.getClassNames()).attr("data-id",this.props.node.id).on("click",this.onClick).on("mousedown",this.onMouseDown).append(this.props.node.label||""),e},this.getClassNames=function(){var t=["sc-citation","sm-"+this.props.node.type];return this.props.node.highlighted&&t.push("sm-highlighted"),t.join(" ")},this.onMouseDown=function(t){t.preventDefault(),t.stopPropagation();var e=this.props.node,i=this.context.surface;i.setSelection(e.getSelection());var s=this.context.controller;s.emit("citation:selected",e)},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onLabelChanged=function(){this.rerender()}},n.extend(s),e.exports=s},{"substance/ui/InlineNodeComponent":450}],514:[function(t,e,i){"use strict";var s=t("lodash/array/compact");e.exports={type:"citation","import":function(t,e){e.id=t.attr("id")||e.id,e.targets=s(t.attr("rid").split(" "))},"export":function(t,e){var i=t.targets.join(" ");e.attr("rid",i)}}},{"lodash/array/compact":13}],515:[function(t,e,i){"use strict";function s(){r.apply(this,arguments),this._initialize(this.props)}var n=t("substance/util/helpers"),r=t("substance/ui/Component"),o=t("substance/ui/ScrollPane"),a=t("substance/ui/DialogHeader"),l=r.$$;s.Prototype=function(){this.render=function(){var t,e=this.context.componentRegistry;return t=this.items.length>0?this.items.map(function(t){var i=e.get(this.props.citationType+"-entry");return l(i,{node:t,active:this.isItemActive(t.id),handleSelection:this.handleSelection.bind(this)}).ref(t.id)}.bind(this)):[l("div").addClass("no-results").append("Nothing to reference.")],l("div").addClass("sc-cite-panel").append(l(a,{label:this.i18n.t("choose_referenced_items")}),l(o).append(t).ref("panelEl"))},this.willReceiveProps=function(t){this._initialize(t)},this._initialize=function(){this.items=this.getItems(this.props.citationType)},this.dispose=function(){this.$el.off("click",".back",this.handleCancel)},this.didMount=function(){this._scrollToTarget()},this.didReceiveProps=function(){this._scrollToTarget()},this._scrollToTarget=function(){var t=this.getFirstCitationTarget();t&&this.refs.panelEl.scrollTo(t)},this.getFirstCitationTarget=function(){var t=this.props.doc,e=t.get(this.props.citationId);return e?e.targets[0]:null},this.isItemActive=function(t){if(!this.props.citationId)return!1;var e=this.props.doc,i=e.get(this.props.citationId);return i?n.includes(i.targets,t):!1},this.handleCancel=function(t){t.preventDefault(),this.send("switchContext","toc")},this.getItems=function(t){var e=this.props.doc,i=e.getCollection(t);return i.getItems()},this.handleSelection=function(t){var e=this.props.citationId,i=this.props.doc,s=i.get(e),r=s.targets.slice();n.includes(r,t)?r=n.without(r,t):r.push(t);var o=this.context.controller;o.transaction(function(t,e){return t.set([s.id,"targets"],r),e}),this.rerender()}},r.extend(s),e.exports=s},{"substance/ui/Component":437,"substance/ui/DialogHeader":447,"substance/ui/ScrollPane":456,"substance/util/helpers":482}],516:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/packages/figure/Figure");n.extend(s),s["static"].name="image-figure",s["static"].citationType="image-figure-citation",s["static"].isBlock=!0,e.exports=s},{"substance/packages/figure/Figure":383}],517:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../citations/Citation");s.Prototype=function(){this.getItemType=function(){return"image-figure"}},n.extend(s),s["static"].name="image-figure-citation",e.exports=s},{"../citations/Citation":511}],518:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("../citations/CitationCommand");n.extend(s),s["static"].name="imageFigureCitation",s["static"].annotationType="image-figure-citation",e.exports=s},{"../citations/CitationCommand":512}],519:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/AnnotationTool");n.extend(s),s["static"].name="imageFigureCitation",s["static"].command="imageFigureCitation",e.exports=s},{"substance/ui/AnnotationTool":432}],520:[function(t,e,i){"use strict";var s=t("../citations/CitationXMLConverter");e.exports={type:"image-figure-citation",tagName:"cite",matchElement:function(t){return t.is("cite")&&"image-figure"===t.attr("rtype")},"import":function(t,e){s["import"](t,e)},"export":function(t,e){s["export"](t,e),e.attr("rtype","image-figure")}}},{"../citations/CitationXMLConverter":514}],521:[function(t,e,i){"use strict";function s(){n.apply(this,arguments)}var n=t("substance/ui/Component"),r=n.$$;s.Prototype=function(){this.render=function(){var t=r("div").addClass("figure border-bottom item pad clearfix small").attr("data-id",this.props.node.id).on("click",this.onClick).on("mousedown",this.onMouseDown);return this.props.active&&t.addClass("active"),t.append(r("img").addClass("image").attr("src",this.props.node.getContentNode().src)),t.append(r("div").addClass("title").append([this.props.node.label,this.props.node.title].join(" "))),t.append(r("div").addClass("caption truncate").append(this.props.node.caption)),t},this.onClick=function(t){t.preventDefault(),t.stopPropagation()},this.onMouseDown=function(t){t.preventDefault(),this.props.handleSelection(this.props.node.id)}},n.extend(s),e.exports=s},{"substance/ui/Component":437}],522:[function(t,e,i){"use strict";var s=t("substance/packages/figure/FigureXMLConverter");e.exports={type:"image-figure",tagName:"image-figure","import":function(t,e,i){s["import"](t,e,i);var n,r=t.find("image"),o=t.find("embed");r?n=i.convertElement(r):o&&(n=i.convertElement(o)),e.content=n.id},"export":function(t,e,i){s["export"](t,e,i)}}},{"substance/packages/figure/FigureXMLConverter":385}],523:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/model/DocumentNode");n.extend(s),s["static"].name="article-meta",s["static"].defineSchema({title:"string",authors:{type:["array","string"],"default":[]},"abstract":"string"}),e.exports=s},{"substance/model/DocumentNode":97}],524:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/model/DocumentNode");n.extend(s),s["static"].name="author",s["static"].defineSchema({name:"string"}),e.exports=s},{"substance/model/DocumentNode":97}],525:[function(t,e,i){"use strict";e.exports={type:"article-meta",tagName:"meta","import":function(t,e,i){e.id="article-meta";var s=t.find("title");s?e.title=i.annotatedText(s,[e.id,"title"]):(console.warn("ArticleMeta: no title found."),e.title="");var n=t.find("abstract");n?e["abstract"]=i.annotatedText(n,[e.id,"abstract"]):(console.warn("ArticleMeta: no abstract found."),e["abstract"]=""),e.authors=[]},"export":function(t,e,i){e.setId(null);var s=i.$$;return e.append(s("title").append(i.annotatedText([t.id,"title"])),s("abstract").append(i.annotatedText([t.id,"abstract"])))}}},{}],526:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/Component"),r=t("substance/ui/TextPropertyEditor"),o=t("substance/ui/Component").$$;s.Prototype=function(){this.render=function(){var t=this.context.controller.getDocument(),e=t.getDocumentMeta();return o("div").addClass("document-cover").append(o(r,{name:"title",tagName:"div",path:[e.id,"title"],editing:"readonly"}).addClass("title"),o("div").addClass("abstract").append(o(r,{name:"abstract",tagName:"div",path:[e.id,"abstract"],editing:"readonly"}).addClass("abstract")))}},n.extend(s),e.exports=s},{"substance/ui/Component":437,"substance/ui/TextPropertyEditor":467}],527:[function(t,e,i){"use strict";var s=t("substance/ui/Component"),n=t("substance/ui/Component").$$,r=t("substance/ui/TextPropertyEditor"),o=function(){o["super"].apply(this,arguments)};o.Prototype=function(){this.render=function(){var t=this.context.controller.getDocument(),e=this.context.config,i=t.getDocumentMeta();return n("div").addClass("document-cover").append(n(r,{name:"title",tagName:"div",commands:e.title.commands,path:[i.id,"title"],editing:"full"}).addClass("title"),n("div").addClass("abstract").append(n(r,{name:"abstract",tagName:"div",commands:e["abstract"].commands,path:[i.id,"abstract"],editing:"full"}).addClass("abstract")))}},s.extend(o),e.exports=o},{"substance/ui/Component":437,"substance/ui/TextPropertyEditor":467}],528:[function(t,e,i){"use strict";function s(){s["super"].apply(this,arguments)}var n=t("substance/ui/Toolbar"),r=t("substance/ui/Component"),o=r.$$,a=t("substance/packages/text/SwitchTextTypeTool"),l=t("substance/ui/UndoTool"),u=t("substance/ui/RedoTool"),c=t("substance/ui/SaveTool"),h=t("substance/packages/strong/StrongTool"),p=t("substance/packages/subscript/SubscriptTool"),d=t("substance/packages/superscript/SuperscriptTool"),f=t("substance/packages/code/CodeTool"),m=t("substance/packages/emphasis/EmphasisTool"),g=t("substance/ui/FontAwesomeIcon"),b=t("substance/packages/embed/EmbedTool"),v=t("substance/packages/link/LinkTool"),y=t("substance/packages/figure/InsertFigureTool"),_=t("../figures/ImageFigureCitationTool"),x=t("../bibliography/BibItemCitationTool");s.Prototype=function(){this.render=function(){return o("div").append(o(n.Group).append(o(a)),o(n.Group).append(o(l).append(o(g,{icon:"fa-undo"})),o(u).append(o(g,{icon:"fa-repeat"})),o(c).append(o(g,{icon:"fa-save"}))),o(n.Dropdown,{label:o(g,{icon:"fa-image"})}).append(o(y).removeClass("tool").addClass("option").append(this.i18n.t("insert")),o(_).append(this.i18n.t("cite"))),o(n.Dropdown,{label:o(g,{icon:"fa-book"})}).append(o(x).append(this.i18n.t("cite"))),o(n.Group).append(o(b).append(o(g,{icon:"fa-file-code-o"}))),o(n.Group).addClass("float-right").append(o(h).append(o(g,{icon:"fa-bold"})),o(m).append(o(g,{icon:"fa-italic"})),o(v).append(o(g,{icon:"fa-link"})),o(p).append(o(g,{icon:"fa-subscript"})),o(d).append(o(g,{icon:"fa-superscript"})),o(f).append(o(g,{icon:"fa-code"}))))}},r.extend(s),e.exports=s},{"../bibliography/BibItemCitationTool":495,"../figures/ImageFigureCitationTool":519,"substance/packages/code/CodeTool":371,"substance/packages/embed/EmbedTool":378,"substance/packages/emphasis/EmphasisTool":382,"substance/packages/figure/InsertFigureTool":387,"substance/packages/link/LinkTool":397,"substance/packages/strong/StrongTool":408,"substance/packages/subscript/SubscriptTool":412,"substance/packages/superscript/SuperscriptTool":416,"substance/packages/text/SwitchTextTypeTool":428,"substance/ui/Component":437,"substance/ui/FontAwesomeIcon":448,"substance/ui/RedoTool":452,"substance/ui/SaveTool":455,"substance/ui/Toolbar":470,"substance/ui/UndoTool":473}]},{},[4]);